<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€LLMã€‘Windowsæœ¬åœ°CPUéƒ¨ç½²æ°‘é—´ç‰ˆä¸­æ–‡ç¾Šé©¼æ¨¡å‹ï¼ˆChinese-LLaMA-Alpacaï¼‰è¸©å‘è®°å½• - ç¼–ç¨‹å­¦ä¹ è€…</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/d5bcc8b094a9c9af030010e972af1770/">
  <meta property="og:site_name" content="ç¼–ç¨‹å­¦ä¹ è€…">
  <meta property="og:title" content="ã€LLMã€‘Windowsæœ¬åœ°CPUéƒ¨ç½²æ°‘é—´ç‰ˆä¸­æ–‡ç¾Šé©¼æ¨¡å‹ï¼ˆChinese-LLaMA-Alpacaï¼‰è¸©å‘è®°å½•">
  <meta property="og:description" content="ç›®å½•
å‰è¨€
å‡†å¤‡å·¥ä½œ
GitÂ Python3.9Â Cmake
ä¸‹è½½æ¨¡å‹Â åˆå¹¶æ¨¡å‹
éƒ¨ç½²æ¨¡å‹Â å‰è¨€ æƒ³å¿…æœ‰å°ä¼™ä¼´ä¹Ÿæƒ³è·Ÿæˆ‘ä¸€æ ·ä½“éªŒä¸‹éƒ¨ç½²å¤§è¯­è¨€æ¨¡å‹, ä½†ç¢äºç»æµå®åŠ›, ä¸è¿‡æ°‘é—´ä¸Šå‡ºç°äº†å¤§é‡çš„é‡åŒ–æ¨¡å‹, æˆ‘ä»¬å¹³æ°‘ä¹Ÿèƒ½ä½“éªŒä½“éªŒå•¦~, è¯¥æ¨¡å‹å¯ä»¥åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šéƒ¨ç½², ç¡®ä¿ä½ ç”µè„‘è‡³å°‘æœ‰16Gè¿è¡Œå†…å­˜
å¼€åŸåœ°å€ï¼šGitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹&#43;æœ¬åœ°CPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)
Linuxå’ŒMacçš„æ•™ç¨‹åœ¨å¼€æºçš„ä»“åº“ä¸­æœ‰æä¾›ï¼Œå½“ç„¶å¦‚æœä½ æ˜¯M1çš„ä¹Ÿå¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š
https://gist.github.com/cedrickchee/e8d4cb0c4b1df6cc47ce8b18457ebde0
å‡†å¤‡å·¥ä½œ æœ€å¥½æ˜¯æœ‰ä»£ç†, ä¸ç„¶ä½ ä¸‹è½½ä¸œè¥¿å¯èƒ½å¤±è´¥, æˆ‘ä¸ºäº†ä¸‹ä¸ªæ¨¡å‹èŠ±äº†ä¸€å¤©æ—¶é—´, ç—›å“­~Â æˆ‘ä»¬éœ€è¦å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…ä»¥ä¸‹ç¯å¢ƒï¼šÂ GitPython3.9ï¼ˆä½¿ç”¨Anaconda3åˆ›å»ºè¯¥ç¯å¢ƒï¼‰Â Cmakeï¼ˆå¦‚æœä½ ç”µè„‘æ²¡æœ‰Cå’ŒC&#43;&#43;çš„ç¼–è¯‘ç¯å¢ƒè¿˜éœ€è¦å®‰è£…mingwï¼‰ GitÂ ä¸‹è½½åœ°å€ï¼šGit - Downloading PackageÂ ä¸‹è½½å¥½å®‰è£…åŒ…åæ‰“å¼€, ä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥å®‰è£…å³å¯...Â åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å¦‚æœæœ‰ç‰ˆæœ¬å·æ˜¾ç¤ºè¯´æ˜å·²ç»å®‰è£…æˆåŠŸ
git -v Python3.9Â æˆ‘è¿™é‡Œä½¿ç”¨Anaconda3æ¥ä½¿ç”¨Python,Â Anaconda3æ˜¯ä»€ä¹ˆï¼Ÿ
å¦‚æœä½ ç†Ÿæ‚‰docker, é‚£ä¹ˆä½ å¯ä»¥æŠŠdockerçš„æ¦‚å¿µå¸¦è¿‡æ¥, dockerå¯ä»¥åˆ›å»ºå¾ˆå¤šä¸ªå®¹å™¨, æ¯ä¸ªå®¹å™¨çš„ç¯å¢ƒå¯èƒ½ä¸€æ ·ä¹Ÿå¯èƒ½ä¸ä¸€æ ·,Â Anaconda3ä¹Ÿæ˜¯ä¸€æ ·çš„, å®ƒå¯ä»¥åˆ›å»ºå¾ˆå¤šä¸ªä¸åŒçš„Pythonç‰ˆæœ¬, äº’ç›¸ä¸å†²çª, æƒ³ç”¨å“ªä¸ªç‰ˆæœ¬å°±åˆ‡æ¢åˆ°å“ªä¸ªç‰ˆæœ¬...
Anaconda3ä¸‹è½½åœ°å€ï¼šAnaconda | Anaconda Distribution
å®‰è£…æ­¥éª¤å‚è€ƒï¼š
ç­‰å¾…å®‰è£…å¥½åä¸€ç›´ç‚¹next,Â ç›´åˆ°ç‚¹Finishå…³é—­å³å¯
åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤, æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™è¯´æ˜å®‰è£…æˆåŠŸ
conda -V æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªpython3.9çš„ç¯å¢ƒÂ conda create --name py39 python=3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-05-17T21:52:38+08:00">
    <meta property="article:modified_time" content="2023-05-17T21:52:38+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å­¦ä¹ è€…" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å­¦ä¹ è€…</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€LLMã€‘Windowsæœ¬åœ°CPUéƒ¨ç½²æ°‘é—´ç‰ˆä¸­æ–‡ç¾Šé©¼æ¨¡å‹ï¼ˆChinese-LLaMA-Alpacaï¼‰è¸©å‘è®°å½•</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">å‰è¨€</a></p> 
<p id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" rel="nofollow">å‡†å¤‡å·¥ä½œ</a></p> 
<p id="Git%C2%A0-toc" style="margin-left:40px;"><a href="#Git%C2%A0" rel="nofollow">GitÂ </a></p> 
<p id="Python3.9%C2%A0-toc" style="margin-left:40px;"><a href="#Python3.9%C2%A0" rel="nofollow">Python3.9Â </a></p> 
<p id="Cmake-toc" style="margin-left:40px;"><a href="#Cmake" rel="nofollow">Cmake</a></p> 
<p id="%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%C2%A0" rel="nofollow">ä¸‹è½½æ¨¡å‹Â </a></p> 
<p id="%E5%90%88%E5%B9%B6%E6%A8%A1%E5%9E%8B-toc" style="margin-left:0px;"><a href="#%E5%90%88%E5%B9%B6%E6%A8%A1%E5%9E%8B" rel="nofollow">åˆå¹¶æ¨¡å‹</a></p> 
<p id="%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%9E%8B%C2%A0-toc" style="margin-left:0px;"><a href="#%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%9E%8B%C2%A0" rel="nofollow">éƒ¨ç½²æ¨¡å‹Â </a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>å‰è¨€</h2> 
<p>æƒ³å¿…æœ‰å°ä¼™ä¼´ä¹Ÿæƒ³è·Ÿæˆ‘ä¸€æ ·ä½“éªŒä¸‹éƒ¨ç½²å¤§è¯­è¨€æ¨¡å‹, ä½†ç¢äºç»æµå®åŠ›, ä¸è¿‡æ°‘é—´ä¸Šå‡ºç°äº†å¤§é‡çš„é‡åŒ–æ¨¡å‹, æˆ‘ä»¬å¹³æ°‘ä¹Ÿèƒ½ä½“éªŒä½“éªŒå•¦~, è¯¥æ¨¡å‹å¯ä»¥åœ¨ç¬”è®°æœ¬ç”µè„‘ä¸Šéƒ¨ç½², ç¡®ä¿ä½ ç”µè„‘è‡³å°‘æœ‰16Gè¿è¡Œå†…å­˜</p> 
<p>å¼€åŸåœ°å€ï¼š<a href="https://github.com/ymcui/Chinese-LLaMA-Alpaca" title="GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)">GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)</a></p> 
<p>Linuxå’ŒMacçš„æ•™ç¨‹åœ¨å¼€æºçš„ä»“åº“ä¸­æœ‰æä¾›ï¼Œå½“ç„¶å¦‚æœä½ æ˜¯M1çš„ä¹Ÿå¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼š</p> 
<p><a href="https://gist.github.com/cedrickchee/e8d4cb0c4b1df6cc47ce8b18457ebde0" rel="nofollow" title="https://gist.github.com/cedrickchee/e8d4cb0c4b1df6cc47ce8b18457ebde0">https://gist.github.com/cedrickchee/e8d4cb0c4b1df6cc47ce8b18457ebde0</a></p> 
<hr> 
<h2 id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">å‡†å¤‡å·¥ä½œ</h2> 
<p>æœ€å¥½æ˜¯æœ‰ä»£ç†, ä¸ç„¶ä½ ä¸‹è½½ä¸œè¥¿å¯èƒ½å¤±è´¥, æˆ‘ä¸ºäº†ä¸‹ä¸ªæ¨¡å‹èŠ±äº†ä¸€å¤©æ—¶é—´, ç—›å“­~Â </p> 
<p>æˆ‘ä»¬éœ€è¦å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…ä»¥ä¸‹ç¯å¢ƒï¼šÂ Â </p> 
<ul><li>Git</li><li>Python3.9ï¼ˆä½¿ç”¨Anaconda3åˆ›å»ºè¯¥ç¯å¢ƒï¼‰Â </li><li>Cmakeï¼ˆå¦‚æœä½ ç”µè„‘æ²¡æœ‰Cå’ŒC++çš„ç¼–è¯‘ç¯å¢ƒè¿˜éœ€è¦å®‰è£…mingwï¼‰</li></ul> 
<h3 id="Git%C2%A0">GitÂ </h3> 
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://git-scm.com/download/win" rel="nofollow" title="Git - Downloading Package">Git - Downloading Package</a>Â </p> 
<p><img alt="" height="914" src="https://images2.imgbox.com/a1/9c/KYrpWsay_o.png" width="1200"></p> 
<blockquote> 
 <p>ä¸‹è½½å¥½å®‰è£…åŒ…åæ‰“å¼€, ä¸€ç›´ç‚¹ä¸‹ä¸€æ­¥å®‰è£…å³å¯...Â </p> 
</blockquote> 
<p>åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å¦‚æœæœ‰ç‰ˆæœ¬å·æ˜¾ç¤ºè¯´æ˜å·²ç»å®‰è£…æˆåŠŸ</p> 
<pre><code class="language-bash">git -v</code></pre> 
<p><img alt="" height="600" src="https://images2.imgbox.com/a2/62/v2x0M3fP_o.png" width="1200"></p> 
<h3 id="Python3.9%C2%A0">Python3.9Â </h3> 
<p>Â æˆ‘è¿™é‡Œä½¿ç”¨Anaconda3æ¥ä½¿ç”¨Python,Â Anaconda3æ˜¯ä»€ä¹ˆï¼Ÿ</p> 
<blockquote> 
 <p>å¦‚æœä½ ç†Ÿæ‚‰docker, é‚£ä¹ˆä½ å¯ä»¥æŠŠdockerçš„æ¦‚å¿µå¸¦è¿‡æ¥, dockerå¯ä»¥åˆ›å»ºå¾ˆå¤šä¸ªå®¹å™¨, æ¯ä¸ªå®¹å™¨çš„ç¯å¢ƒå¯èƒ½ä¸€æ ·ä¹Ÿå¯èƒ½ä¸ä¸€æ ·,Â Anaconda3ä¹Ÿæ˜¯ä¸€æ ·çš„, å®ƒå¯ä»¥åˆ›å»ºå¾ˆå¤šä¸ªä¸åŒçš„Pythonç‰ˆæœ¬, äº’ç›¸ä¸å†²çª, æƒ³ç”¨å“ªä¸ªç‰ˆæœ¬å°±åˆ‡æ¢åˆ°å“ªä¸ªç‰ˆæœ¬...</p> 
</blockquote> 
<p>Â Anaconda3ä¸‹è½½åœ°å€ï¼š<a href="https://www.anaconda.com/products/distribution#windows" rel="nofollow" title="Anaconda | Anaconda Distribution">Anaconda | Anaconda Distribution</a><img alt="" height="914" src="https://images2.imgbox.com/55/2d/4oBLeACG_o.png" width="1200"></p> 
<p>Â å®‰è£…æ­¥éª¤å‚è€ƒï¼š</p> 
<p class="img-center"><img alt="" height="485" src="https://images2.imgbox.com/df/da/eGT0Wh3r_o.png" width="623"></p> 
<p></p> 
<p class="img-center"><img alt="" height="485" src="https://images2.imgbox.com/7d/4a/rBSj5w85_o.png" width="623"></p> 
<p class="img-center"><img alt="" height="485" src="https://images2.imgbox.com/41/9c/YRb3Nd38_o.png" width="623"></p> 
<p></p> 
<p class="img-center"><img alt="" height="485" src="https://images2.imgbox.com/cf/47/MyUjn3uG_o.png" width="623"></p> 
<p class="img-center"><img alt="" height="485" src="https://images2.imgbox.com/9a/29/dEVmp52F_o.png" width="623"></p> 
<blockquote> 
 <p>Â ç­‰å¾…å®‰è£…å¥½åä¸€ç›´ç‚¹next,Â ç›´åˆ°ç‚¹Finishå…³é—­å³å¯</p> 
</blockquote> 
<p>åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤, æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™è¯´æ˜å®‰è£…æˆåŠŸ</p> 
<pre><code class="language-bash">conda -V</code></pre> 
<p><img alt="" height="600" src="https://images2.imgbox.com/ee/37/KiUrO6VI_o.png" width="1200"></p> 
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨cmdçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªpython3.9çš„ç¯å¢ƒÂ </p> 
<pre><code class="language-bash">conda create --name py39 python=3.9 -y</code></pre> 
<blockquote> 
 <p>--nameåé¢çš„py39æ˜¯ç¯å¢ƒåå­—, å¯ä»¥è‡ªå·±ä»»æ„èµ·, åˆ‡æ¢ç¯å¢ƒçš„æ—¶å€™éœ€è¦å®ƒ</p> 
 <p>python=3.9æ˜¯æŒ‡å®špythonç‰ˆæœ¬</p> 
 <p>æ·»åŠ -yåå°±ä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥yå»ç¡®è®¤å®‰è£…äº†</p> 
</blockquote> 
<p><img alt="" height="600" src="https://images2.imgbox.com/80/d6/zkFgemdY_o.png" width="1200"></p> 
<p>æŸ¥çœ‹æœ‰å“ªäº›ç¯å¢ƒçš„å‘½ä»¤ï¼š</p> 
<pre><code class="language-bash">conda info -e</code></pre> 
<p><img alt="" height="149" src="https://images2.imgbox.com/8b/c4/cvQerKMv_o.png" width="1156"></p> 
<p>æ¿€æ´»/åˆ‡æ¢ç¯å¢ƒçš„å‘½ä»¤ï¼š</p> 
<pre><code class="language-bash">conda activate py39</code></pre> 
<p>Â è¦ä½¿ç”¨å“ªä¸ªç¯å¢ƒçš„è¯æ¢æˆå¯¹åº”åå­—å³å¯</p> 
<p><img alt="" height="107" src="https://images2.imgbox.com/1a/2d/9Ixcd54J_o.png" width="952"></p> 
<p>Â è¿›å…¥ç¯å¢ƒåä½ å°±å¯ä»¥åœ¨è¿™è¾“å…¥pythonç›¸å…³çš„å‘½ä»¤äº†, å¦‚ï¼š</p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/22/7d/ywnjXIWx_o.png" width="1200"></p> 
<p>Â è¦é€€å‡ºç¯å¢ƒçš„è¯è¾“å…¥ï¼š</p> 
<pre><code class="language-bash">conda deactivate</code></pre> 
<p>å½“æˆ‘é€€å‡ºç¯å¢ƒåå†æŸ¥çœ‹pythonç‰ˆæœ¬çš„è¯ä¼šæç¤ºæˆ‘ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº<br> æˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚å¦‚ï¼š</p> 
<p><img alt="" height="178" src="https://images2.imgbox.com/4b/19/hfe5rVzq_o.png" width="1185"></p> 
<h3 id="Cmake">Cmake</h3> 
<p>è¿™æ˜¯ä¸€ä¸ªç¼–è¯‘å·¥å…·, æˆ‘ä»¬éœ€è¦ä½¿ç”¨å®ƒå»ç¼–è¯‘<a class="link-info" href="https://github.com/ggerganov/llama.cpp" title="llama.cpp">llama.cpp</a>, é‡åŒ–æ¨¡å‹éœ€è¦ç”¨åˆ°, ä¸é‡åŒ–æ¨¡å‹ä¸ªäººç”µè„‘è·‘ä¸èµ·æ¥, è§‰å¾—é‡åŒ–è¿™ä¸ªæ¦‚å¿µä¸ç†è§£çš„å¯ä»¥ç†è§£ä¸ºå‹ç¼©, è¿™ç§æ¦‚å¿µæ˜¯ä¸å¯¹çš„, åªæ˜¯ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£.</p> 
<p>åœ¨å®‰è£…ä¹‹å‰æˆ‘ä»¬éœ€è¦å®‰è£…mingw, é¿å…ç¼–è¯‘æ—¶æ‰¾ä¸åˆ°ç¼–è¯‘ç¯å¢ƒ, æŒ‰ä¸‹win+rå¿«æ·é”®è¾“å…¥powershell</p> 
<p>è¾“å…¥å‘½ä»¤å®‰è£…scoop, è¿™æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨, æˆ‘ä»¬ä½¿ç”¨å®ƒæ¥ä¸‹è½½å®‰è£…mingwï¼š</p> 
<p><span style="color:#fe2c24;"><strong>è¿™ä¸ªåœ°æ–¹å¦‚æœæ²¡æœ‰å¼€ä»£ç†çš„è¯å¯èƒ½ä¼šå‡ºé”™</strong></span>Â </p> 
<pre><code class="language-bash">iex "&amp; {$(irm get.scoop.sh)} -RunAsAdmin"</code></pre> 
<p>å®‰è£…å¥½ååˆ†åˆ«è¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ï¼ˆæ·»åŠ åº“ï¼‰ï¼š</p> 
<pre><code class="language-bash">scoop bucket add extras</code></pre> 
<pre><code class="language-bash">scoop bucket add main</code></pre> 
<p>Â è¾“å…¥å‘½ä»¤å®‰è£…mingw</p> 
<pre><code class="language-bash">scoop install mingw</code></pre> 
<p>åˆ°è¿™å°±å·²ç»å®‰è£…å¥½mingwäº†, å¦‚æœæŠ¥é”™äº†è¯·è¯„è®º, æˆ‘çœ‹åˆ°äº†ä¼šå›å¤</p> 
<p>æ¥ä¸‹æ¥å®‰è£…Cmake</p> 
<p>åœ°å€ï¼š<a href="https://cmake.org/download/" rel="nofollow" title="Download | CMake">Download | CMake</a>Â </p> 
<p><img alt="" height="914" src="https://images2.imgbox.com/67/f8/scFTmsGP_o.png" width="1200"></p> 
<p>Â å®‰è£…å‚è€ƒï¼š</p> 
<p class="img-center"><img alt="" height="483" src="https://images2.imgbox.com/ff/5c/iIcWQCDw_o.png" width="618"></p> 
<p class="img-center"><img alt="" height="483" src="https://images2.imgbox.com/e4/da/VifOHQYd_o.png" width="618"></p> 
<p class="img-center"><img alt="" height="483" src="https://images2.imgbox.com/b0/d9/TvSG8OHX_o.png" width="618"></p> 
<p class="img-center"><img alt="" height="483" src="https://images2.imgbox.com/7e/fe/jY8Np6yC_o.png" width="618"></p> 
<p class="img-center"><img alt="" height="483" src="https://images2.imgbox.com/1a/f0/iWEeTg6t_o.png" width="618"></p> 
<blockquote> 
 <p>Â å®‰è£…å¥½åç‚¹Finishå³å¯</p> 
</blockquote> 
<hr> 
<h2 id="%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B%C2%A0">ä¸‹è½½æ¨¡å‹Â </h2> 
<p>æˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸¤ä¸ªæ¨¡å‹, ä¸€ä¸ªæ˜¯åŸç‰ˆçš„LLaMAæ¨¡å‹, ä¸€ä¸ªæ˜¯æ‰©å……äº†ä¸­æ–‡çš„æ¨¡å‹, åç»­ä¼šè¿›è¡Œä¸€ä¸ªåˆå¹¶æ¨¡å‹çš„æ“ä½œ</p> 
<ul><li>åŸç‰ˆæ¨¡å‹ä¸‹è½½åœ°å€ï¼ˆè¦ä»£ç†ï¼‰ï¼š<a href="https://ipfs.io/ipfs/Qmb9y5GCkTG7ZzbBWMu2BXwMkzyCKcUjtEKPpgdZ7GEFKm/" rel="nofollow" title="https://ipfs.io/ipfs/Qmb9y5GCkTG7ZzbBWMu2BXwMkzyCKcUjtEKPpgdZ7GEFKm/">https://ipfs.io/ipfs/Qmb9y5GCkTG7ZzbBWMu2BXwMkzyCKcUjtEKPpgdZ7GEFKm/</a></li><li>å¤‡ç”¨ï¼š<a href="https://huggingface.co/nyanko7/LLaMA-7B/tree/main" rel="nofollow" title="nyanko7/LLaMA-7B at main">nyanko7/LLaMA-7B at main</a></li></ul> 
<p><img alt="" height="415" src="https://images2.imgbox.com/6c/f8/gYqs2cJy_o.png" width="1200">â€‹</p> 
<ul><li>æ‰©å……äº†ä¸­æ–‡çš„æ¨¡å‹ä¸‹è½½ï¼š</li></ul> 
<p>å»ºè®®åœ¨Dç›˜ä¸Šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹, åœ¨é‡Œé¢è¿›è¡Œä¸‹è½½æ“ä½œ, å¦‚ä¸‹ï¼š</p> 
<p><img alt="" height="695" src="https://images2.imgbox.com/27/b9/r5QqiR0r_o.png" width="1080">â€‹</p> 
<p>Â åœ¨å¼¹å‡ºçš„æ¡†ä¸­åˆ†åˆ«è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p> 
<div> 
 <pre><code class="language-bash">git lfs install</code></pre> 
</div> 
<div> 
 <pre><code class="language-bash">git clone https://huggingface.co/ziqingyang/chinese-alpaca-lora-7b</code></pre> 
</div> 
<p>è¿™é‡Œå¯èƒ½ä¼šå› ä¸ºç½‘ç»œé—®é¢˜ä¸€ç›´å¤±è´¥......ä¸€ç›´é‡è¯•å°±è¡Œ, æœ‰åˆ«çš„é—®é¢˜è¯·è¯„è®º, çœ‹åˆ°ä¼šå›å¤</p> 
<hr> 
<h2 id="%E5%90%88%E5%B9%B6%E6%A8%A1%E5%9E%8B">åˆå¹¶æ¨¡å‹</h2> 
<p>ç»ˆäºå†™åˆ°è¿™é‡Œäº†, ç´¯~</p> 
<p>åœ¨ä½ ä¸‹è½½äº†æ¨¡å‹çš„ç›®å½•å†…æ‰“å¼€cmdçª—å£, å¦‚ä¸‹ï¼š</p> 
<p><img alt="" height="813" src="https://images2.imgbox.com/1d/05/mnMzy07y_o.png" width="1113">â€‹</p> 
<blockquote> 
 <p>è¿™é‡Œæˆ‘å…ˆè¯´ä¸‹è¿™å›¾ç‰‡ä¸­çš„ä¸¤ä¸ªç›®å½•é‡Œæ–‡ä»¶æ˜¯å•¥å§</p> 
 <p></p> 
 <p>å…ˆæ˜¯chinese-alpaca-lora-7bç›®å½•, è¿™ä¸ªç›®å½•ä¸€èˆ¬ä½ ä¸‹è½½ä¸‹æ¥å°±ä¸ç”¨åŠ¨äº†, æ ¼å¼å¦‚ä¸‹ï¼š</p> 
 <p>chinese-alpaca-lora-7b/<br> Â Â Â Â Â Â Â Â - adapter_config.json<br> Â Â Â Â Â Â Â Â - adapter_model.bin<br> Â Â Â Â Â Â Â Â - special_tokens_map.json<br> Â Â Â Â Â Â Â Â - tokenizer_config.json<br> Â Â Â Â Â Â Â Â - tokenizer.model</p> 
 <p></p> 
 <p>ç„¶åæ˜¯path_to_original_llama_root_dirç›®å½•, è¿™ä¸ªæ–‡ä»¶å¤¹éœ€è¦åˆ›å»º, ä¿æŒä¸€è‡´çš„æ–‡ä»¶å, ç›®å½•å†…çš„æ ¼å¼å¦‚ä¸‹ï¼š</p> 
 <p>path_to_original_llama_root_dir/</p> 
 <p>Â  Â  Â  Â  - 7B/Â Â Â Â Â Â Â Â #è¿™æ˜¯ä¸€ä¸ªåä¸º7Bçš„æ–‡ä»¶å¤¹</p> 
 <p>Â  Â  Â  Â  Â  Â  Â  Â  - checklist.chk</p> 
 <p>Â  Â  Â  Â  Â  Â  Â  Â  -Â consolidated.00.pth</p> 
 <p>Â  Â  Â  Â  Â  Â  Â  Â  -Â params.json</p> 
 <p>Â  Â  Â  Â  Â  Â  Â  Â  -Â tokenizer_checklist.chk</p> 
 <p>Â  Â  Â  Â  - tokenizer.model</p> 
 <p>è‡ªè¡ŒæŒ‰ç…§ä¸Šé¢çš„æ ¼å¼å­˜æ”¾</p> 
</blockquote> 
<p>Â æ‰“å¼€çª—å£åéœ€è¦å…ˆæ¿€æ´»pythonç¯å¢ƒ, ä½¿ç”¨çš„å°±æ˜¯å‰é¢è£…Anaconda3</p> 
<div> 
 <pre><code class="language-bash"># ä¸è®°å¾—æœ‰å“ªäº›ç¯å¢ƒçš„å…ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤
conda info -e

# ç„¶åæ¿€æ´»ä½ éœ€è¦çš„ç¯å¢ƒ  æˆ‘çš„ç¯å¢ƒåæ˜¯py39
conda activate py39</code></pre> 
</div> 
<p>åˆ‡æ¢å¥½ååˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–åº“</p> 
<div> 
 <pre><code class="language-bash">pip install git+https://github.com/huggingface/transformers

pip install sentencepiece==0.1.97

pip install peft==0.2.0</code></pre> 
</div> 
<p>æ‰§è¡Œå‘½ä»¤å®‰è£…æˆåŠŸåä¼šæœ‰Successfullyçš„å­—çœ¼</p> 
<p>Â æ¥ä¸‹æ¥éœ€è¦å°†åŸç‰ˆæ¨¡å‹è½¬HFæ ¼å¼, éœ€è¦å€ŸåŠ©<a href="https://huggingface.co/docs/transformers/installation#install-from-source" rel="nofollow" title="æœ€æ–°ç‰ˆğŸ¤—transformers">æœ€æ–°ç‰ˆğŸ¤—transformers</a>æä¾›çš„è„šæœ¬<a href="https://github.com/huggingface/transformers/blob/main/src/transformers/models/llama/convert_llama_weights_to_hf.py" title="convert_llama_weights_to_hf.py">convert_llama_weights_to_hf.py</a></p> 
<p>åœ¨ç›®å½•å†…æ–°å»ºä¸€ä¸ªconvert_llama_weights_to_hf.pyæ–‡ä»¶, ç”¨è®°äº‹æœ¬æ‰“å¼€åæŠŠä»¥ä¸‹ä»£ç ç²˜è´´è¿›å»</p> 
<p><span style="color:#fe2c24;"><strong>æ³¨æ„ï¼šæˆ‘è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿ç›´æ¥æ‹·è´å‡ºæ¥äº†ï¼Œè„šæœ¬å¯èƒ½ä¼šæ›´æ–°ï¼Œå»ºè®®ç›´æ¥å»ä»¥ä¸‹åœ°å€æ‹·è´æœ€æ–°çš„ï¼š</strong></span></p> 
<p><a href="https://github.com/huggingface/transformers/blob/main/src/transformers/models/llama/convert_llama_weights_to_hf.py" title="transformers/convert_llama_weights_to_hf.py at main Â· huggingface/transformers Â· GitHub">transformers/convert_llama_weights_to_hf.py at main Â· huggingface/transformers Â· GitHub</a></p> 
<div> 
 <pre><code class="language-python"># Copyright 2022 EleutherAI and The HuggingFace Inc. team. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
import argparse
import gc
import json
import math
import os
import shutil
import warnings

import torch

from transformers import LlamaConfig, LlamaForCausalLM, LlamaTokenizer


try:
    from transformers import LlamaTokenizerFast
except ImportError as e:
    warnings.warn(e)
    warnings.warn(
        "The converted tokenizer will be the `slow` tokenizer. To use the fast, update your `tokenizers` library and re-run the tokenizer conversion"
    )
    LlamaTokenizerFast = None

"""
Sample usage:

```
python src/transformers/models/llama/convert_llama_weights_to_hf.py \
    --input_dir /path/to/downloaded/llama/weights --model_size 7B --output_dir /output/path
```

Thereafter, models can be loaded via:

```py
from transformers import LlamaForCausalLM, LlamaTokenizer

model = LlamaForCausalLM.from_pretrained("/output/path")
tokenizer = LlamaTokenizer.from_pretrained("/output/path")
```

Important note: you need to be able to host the whole model in RAM to execute this script (even if the biggest versions
come in several checkpoints they each contain a part of each weight of the model, so we need to load them all in RAM).
"""

INTERMEDIATE_SIZE_MAP = {
    "7B": 11008,
    "13B": 13824,
    "30B": 17920,
    "65B": 22016,
}
NUM_SHARDS = {
    "7B": 1,
    "13B": 2,
    "30B": 4,
    "65B": 8,
}


def compute_intermediate_size(n):
    return int(math.ceil(n * 8 / 3) + 255) // 256 * 256


def read_json(path):
    with open(path, "r") as f:
        return json.load(f)


def write_json(text, path):
    with open(path, "w") as f:
        json.dump(text, f)


def write_model(model_path, input_base_path, model_size):
    os.makedirs(model_path, exist_ok=True)
    tmp_model_path = os.path.join(model_path, "tmp")
    os.makedirs(tmp_model_path, exist_ok=True)

    params = read_json(os.path.join(input_base_path, "params.json"))
    num_shards = NUM_SHARDS[model_size]
    n_layers = params["n_layers"]
    n_heads = params["n_heads"]
    n_heads_per_shard = n_heads // num_shards
    dim = params["dim"]
    dims_per_head = dim // n_heads
    base = 10000.0
    inv_freq = 1.0 / (base ** (torch.arange(0, dims_per_head, 2).float() / dims_per_head))

    # permute for sliced rotary
    def permute(w):
        return w.view(n_heads, dim // n_heads // 2, 2, dim).transpose(1, 2).reshape(dim, dim)

    print(f"Fetching all parameters from the checkpoint at {input_base_path}.")
    # Load weights
    if model_size == "7B":
        # Not shared
        # (The sharded implementation would also work, but this is simpler.)
        loaded = torch.load(os.path.join(input_base_path, "consolidated.00.pth"), map_location="cpu")
    else:
        # Sharded
        loaded = [
            torch.load(os.path.join(input_base_path, f"consolidated.{i:02d}.pth"), map_location="cpu")
            for i in range(num_shards)
        ]
    param_count = 0
    index_dict = {"weight_map": {}}
    for layer_i in range(n_layers):
        filename = f"pytorch_model-{layer_i + 1}-of-{n_layers + 1}.bin"
        if model_size == "7B":
            # Unsharded
            state_dict = {
                f"model.layers.{layer_i}.self_attn.q_proj.weight": permute(
                    loaded[f"layers.{layer_i}.attention.wq.weight"]
                ),
                f"model.layers.{layer_i}.self_attn.k_proj.weight": permute(
                    loaded[f"layers.{layer_i}.attention.wk.weight"]
                ),
                f"model.layers.{layer_i}.self_attn.v_proj.weight": loaded[f"layers.{layer_i}.attention.wv.weight"],
                f"model.layers.{layer_i}.self_attn.o_proj.weight": loaded[f"layers.{layer_i}.attention.wo.weight"],
                f"model.layers.{layer_i}.mlp.gate_proj.weight": loaded[f"layers.{layer_i}.feed_forward.w1.weight"],
                f"model.layers.{layer_i}.mlp.down_proj.weight": loaded[f"layers.{layer_i}.feed_forward.w2.weight"],
                f"model.layers.{layer_i}.mlp.up_proj.weight": loaded[f"layers.{layer_i}.feed_forward.w3.weight"],
                f"model.layers.{layer_i}.input_layernorm.weight": loaded[f"layers.{layer_i}.attention_norm.weight"],
                f"model.layers.{layer_i}.post_attention_layernorm.weight": loaded[f"layers.{layer_i}.ffn_norm.weight"],
            }
        else:
            # Sharded
            # Note that in the 13B checkpoint, not cloning the two following weights will result in the checkpoint
            # becoming 37GB instead of 26GB for some reason.
            state_dict = {
                f"model.layers.{layer_i}.input_layernorm.weight": loaded[0][
                    f"layers.{layer_i}.attention_norm.weight"
                ].clone(),
                f"model.layers.{layer_i}.post_attention_layernorm.weight": loaded[0][
                    f"layers.{layer_i}.ffn_norm.weight"
                ].clone(),
            }
            state_dict[f"model.layers.{layer_i}.self_attn.q_proj.weight"] = permute(
                torch.cat(
                    [
                        loaded[i][f"layers.{layer_i}.attention.wq.weight"].view(n_heads_per_shard, dims_per_head, dim)
                        for i in range(num_shards)
                    ],
                    dim=0,
                ).reshape(dim, dim)
            )
            state_dict[f"model.layers.{layer_i}.self_attn.k_proj.weight"] = permute(
                torch.cat(
                    [
                        loaded[i][f"layers.{layer_i}.attention.wk.weight"].view(n_heads_per_shard, dims_per_head, dim)
                        for i in range(num_shards)
                    ],
                    dim=0,
                ).reshape(dim, dim)
            )
            state_dict[f"model.layers.{layer_i}.self_attn.v_proj.weight"] = torch.cat(
                [
                    loaded[i][f"layers.{layer_i}.attention.wv.weight"].view(n_heads_per_shard, dims_per_head, dim)
                    for i in range(num_shards)
                ],
                dim=0,
            ).reshape(dim, dim)

            state_dict[f"model.layers.{layer_i}.self_attn.o_proj.weight"] = torch.cat(
                [loaded[i][f"layers.{layer_i}.attention.wo.weight"] for i in range(num_shards)], dim=1
            )
            state_dict[f"model.layers.{layer_i}.mlp.gate_proj.weight"] = torch.cat(
                [loaded[i][f"layers.{layer_i}.feed_forward.w1.weight"] for i in range(num_shards)], dim=0
            )
            state_dict[f"model.layers.{layer_i}.mlp.down_proj.weight"] = torch.cat(
                [loaded[i][f"layers.{layer_i}.feed_forward.w2.weight"] for i in range(num_shards)], dim=1
            )
            state_dict[f"model.layers.{layer_i}.mlp.up_proj.weight"] = torch.cat(
                [loaded[i][f"layers.{layer_i}.feed_forward.w3.weight"] for i in range(num_shards)], dim=0
            )

        state_dict[f"model.layers.{layer_i}.self_attn.rotary_emb.inv_freq"] = inv_freq
        for k, v in state_dict.items():
            index_dict["weight_map"][k] = filename
            param_count += v.numel()
        torch.save(state_dict, os.path.join(tmp_model_path, filename))

    filename = f"pytorch_model-{n_layers + 1}-of-{n_layers + 1}.bin"
    if model_size == "7B":
        # Unsharded
        state_dict = {
            "model.embed_tokens.weight": loaded["tok_embeddings.weight"],
            "model.norm.weight": loaded["norm.weight"],
            "lm_head.weight": loaded["output.weight"],
        }
    else:
        state_dict = {
            "model.norm.weight": loaded[0]["norm.weight"],
            "model.embed_tokens.weight": torch.cat(
                [loaded[i]["tok_embeddings.weight"] for i in range(num_shards)], dim=1
            ),
            "lm_head.weight": torch.cat([loaded[i]["output.weight"] for i in range(num_shards)], dim=0),
        }

    for k, v in state_dict.items():
        index_dict["weight_map"][k] = filename
        param_count += v.numel()
    torch.save(state_dict, os.path.join(tmp_model_path, filename))

    # Write configs
    index_dict["metadata"] = {"total_size": param_count * 2}
    write_json(index_dict, os.path.join(tmp_model_path, "pytorch_model.bin.index.json"))

    config = LlamaConfig(
        hidden_size=dim,
        intermediate_size=compute_intermediate_size(dim),
        num_attention_heads=params["n_heads"],
        num_hidden_layers=params["n_layers"],
        rms_norm_eps=params["norm_eps"],
    )
    config.save_pretrained(tmp_model_path)

    # Make space so we can load the model properly now.
    del state_dict
    del loaded
    gc.collect()

    print("Loading the checkpoint in a Llama model.")
    model = LlamaForCausalLM.from_pretrained(tmp_model_path, torch_dtype=torch.float16, low_cpu_mem_usage=True)
    # Avoid saving this as part of the config.
    del model.config._name_or_path

    print("Saving in the Transformers format.")
    model.save_pretrained(model_path)
    shutil.rmtree(tmp_model_path)


def write_tokenizer(tokenizer_path, input_tokenizer_path):
    # Initialize the tokenizer based on the `spm` model
    tokenizer_class = LlamaTokenizer if LlamaTokenizerFast is None else LlamaTokenizerFast
    print("Saving a {tokenizer_class} to {tokenizer_path}")
    tokenizer = tokenizer_class(input_tokenizer_path)
    tokenizer.save_pretrained(tokenizer_path)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument(
        "--input_dir",
        help="Location of LLaMA weights, which contains tokenizer.model and model folders",
    )
    parser.add_argument(
        "--model_size",
        choices=["7B", "13B", "30B", "65B", "tokenizer_only"],
    )
    parser.add_argument(
        "--output_dir",
        help="Location to write HF model and tokenizer",
    )
    args = parser.parse_args()
    if args.model_size != "tokenizer_only":
        write_model(
            model_path=args.output_dir,
            input_base_path=os.path.join(args.input_dir, args.model_size),
            model_size=args.model_size,
        )
    spm_path = os.path.join(args.input_dir, "tokenizer.model")
    write_tokenizer(args.output_dir, spm_path)


if __name__ == "__main__":
    main()</code></pre> 
</div> 
<p>åœ¨cmdçª—å£æ‰§è¡Œå‘½ä»¤ï¼ˆ<span style="color:#fe2c24;"><strong>å¦‚æœä½ ä½¿ç”¨äº†anacondaï¼Œæ‰§è¡Œå‘½ä»¤å‰è¯·å…ˆæ¿€æ´»ç¯å¢ƒ</strong></span>ï¼‰ï¼š</p> 
<div> 
 <pre><code class="language-bash">python convert_llama_weights_to_hf.py --input_dir path_to_original_llama_root_dir --model_size 7B --output_dir path_to_original_llama_hf_dir</code></pre> 
</div> 
<p>ç»è¿‡æ¼«é•¿çš„ç­‰å¾…....</p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/cf/82/QVV6KKDb_o.png" width="911">â€‹</p> 
<p>Â æ¥ä¸‹æ¥åˆå¹¶è¾“å‡ºPyTorchç‰ˆæœ¬æƒé‡ï¼ˆ<code>.pth</code>æ–‡ä»¶ï¼‰ï¼Œä½¿ç”¨<code><a class="link-info" href="https://github.com/ymcui/Chinese-LLaMA-Alpaca/blob/main/scripts/merge_llama_with_chinese_lora.py" title="merge_llama_with_chinese_lora.py">merge_llama_with_chinese_lora.py</a></code>è„šæœ¬</p> 
<p>åœ¨ç›®å½•æ–°å»ºä¸€ä¸ªmerge_llama_with_chinese_lora.pyæ–‡ä»¶, ç”¨è®°äº‹æœ¬æ‰“å¼€å°†ä»¥ä¸‹ä»£ç ç²˜è´´è¿›å»</p> 
<p><span style="color:#fe2c24;"><strong>æ³¨æ„ï¼šæˆ‘è¿™é‡Œæ˜¯ä¸ºäº†æ–¹ä¾¿ç›´æ¥æ‹·è´å‡ºæ¥äº†ï¼Œè„šæœ¬å¯èƒ½ä¼šæ›´æ–°ï¼Œå»ºè®®ç›´æ¥å»ä»¥ä¸‹åœ°å€æ‹·è´æœ€æ–°çš„ï¼š</strong></span>Â </p> 
<p><a href="https://github.com/ymcui/Chinese-LLaMA-Alpaca/blob/main/scripts/merge_llama_with_chinese_lora.py" title="Chinese-LLaMA-Alpaca/merge_llama_with_chinese_lora.py at main Â· ymcui/Chinese-LLaMA-Alpaca Â· GitHub">Chinese-LLaMA-Alpaca/merge_llama_with_chinese_lora.py at main Â· ymcui/Chinese-LLaMA-Alpaca Â· GitHub</a></p> 
<div> 
 <pre><code class="language-python">"""
Borrowed and modified from https://github.com/tloen/alpaca-lora
"""

import argparse
import os
import json
import gc

import torch
import transformers
import peft
from peft import PeftModel

parser = argparse.ArgumentParser()
parser.add_argument('--base_model',default=None,required=True,type=str,help="Please specify a base_model")
parser.add_argument('--lora_model',default=None,required=True,type=str,help="Please specify a lora_model")

# deprecated; the script infers the model size from the checkpoint
parser.add_argument('--model_size',default='7B',type=str,help="Size of the LLaMA model",choices=['7B','13B'])

parser.add_argument('--offload_dir',default=None,type=str,help="(Optional) Please specify a temp folder for offloading (useful for low-RAM machines). Default None (disable offload).")
parser.add_argument('--output_dir',default='./',type=str)
args = parser.parse_args()


assert (
    "LlamaTokenizer" in transformers._import_structure["models.llama"]
), "LLaMA is now in HuggingFace's main branch.\nPlease reinstall it: pip uninstall transformers &amp;&amp; pip install git+https://github.com/huggingface/transformers.git"
from transformers import LlamaTokenizer, LlamaForCausalLM

BASE_MODEL = args.base_model
LORA_MODEL = args.lora_model
output_dir = args.output_dir

assert (
    BASE_MODEL
), "Please specify a BASE_MODEL in the script, e.g. 'decapoda-research/llama-7b-hf'"

tokenizer = LlamaTokenizer.from_pretrained(LORA_MODEL)
if args.offload_dir is not None:
    # Load with offloading, which is useful for low-RAM machines.
    # Note that if you have enough RAM, please use original method instead, as it is faster.
    base_model = LlamaForCausalLM.from_pretrained(
        BASE_MODEL,
        load_in_8bit=False,
        torch_dtype=torch.float16,
        offload_folder=args.offload_dir,
        offload_state_dict=True,
        low_cpu_mem_usage=True,
        device_map={"": "cpu"},
    )
else:
    # Original method without offloading
    base_model = LlamaForCausalLM.from_pretrained(
        BASE_MODEL,
        load_in_8bit=False,
        torch_dtype=torch.float16,
        device_map={"": "cpu"},
    )

base_model.resize_token_embeddings(len(tokenizer))
assert base_model.get_input_embeddings().weight.size(0) == len(tokenizer)
tokenizer.save_pretrained(output_dir)
print(f"Extended vocabulary size: {len(tokenizer)}")

first_weight = base_model.model.layers[0].self_attn.q_proj.weight
first_weight_old = first_weight.clone()

## infer the model size from the checkpoint
emb_to_model_size = {
    4096 : '7B',
    5120 : '13B',
    6656 : '30B',
    8192 : '65B',
}
embedding_size = base_model.get_input_embeddings().weight.size(1)
model_size = emb_to_model_size[embedding_size]
print(f"Loading LoRA for {model_size} model")

lora_model = PeftModel.from_pretrained(
    base_model,
    LORA_MODEL,
    device_map={"": "cpu"},
    torch_dtype=torch.float16,
)

assert torch.allclose(first_weight_old, first_weight)
# merge weights
print(f"Peft version: {peft.__version__}")
print(f"Merging model")
if peft.__version__ &gt; '0.2.0':
    # merge weights - new merging method from peft
    lora_model = lora_model.merge_and_unload()
else:
    # merge weights
    for layer in lora_model.base_model.model.model.layers:
        if hasattr(layer.self_attn.q_proj,'merge_weights'):
            layer.self_attn.q_proj.merge_weights = True
        if hasattr(layer.self_attn.v_proj,'merge_weights'):
            layer.self_attn.v_proj.merge_weights = True
        if hasattr(layer.self_attn.k_proj,'merge_weights'):
            layer.self_attn.k_proj.merge_weights = True
        if hasattr(layer.self_attn.o_proj,'merge_weights'):
            layer.self_attn.o_proj.merge_weights = True
        if hasattr(layer.mlp.gate_proj,'merge_weights'):
            layer.mlp.gate_proj.merge_weights = True
        if hasattr(layer.mlp.down_proj,'merge_weights'):
            layer.mlp.down_proj.merge_weights = True
        if hasattr(layer.mlp.up_proj,'merge_weights'):
            layer.mlp.up_proj.merge_weights = True

lora_model.train(False)

# did we do anything?
assert not torch.allclose(first_weight_old, first_weight)

lora_model_sd = lora_model.state_dict()
del lora_model, base_model

num_shards_of_models = {'7B': 1, '13B': 2}
params_of_models = {
    '7B':
        {
        "dim": 4096,
        "multiple_of": 256,
        "n_heads": 32,
        "n_layers": 32,
        "norm_eps": 1e-06,
        "vocab_size": -1,
        },
    '13B':
        {
        "dim": 5120,
        "multiple_of": 256,
        "n_heads": 40,
        "n_layers": 40,
        "norm_eps": 1e-06,
        "vocab_size": -1,
        },
}

params = params_of_models[model_size]
num_shards = num_shards_of_models[model_size]


n_layers = params["n_layers"]
n_heads = params["n_heads"]
dim = params["dim"]
dims_per_head = dim // n_heads
base = 10000.0
inv_freq = 1.0 / (base ** (torch.arange(0, dims_per_head, 2).float() / dims_per_head))


def permute(w):
    return (
        w.view(n_heads, dim // n_heads // 2, 2, dim).transpose(1, 2).reshape(dim, dim)
    )


def unpermute(w):
    return (
        w.view(n_heads, 2, dim // n_heads // 2, dim).transpose(1, 2).reshape(dim, dim)
    )


def translate_state_dict_key(k):
    k = k.replace("base_model.model.", "")
    if k == "model.embed_tokens.weight":
        return "tok_embeddings.weight"
    elif k == "model.norm.weight":
        return "norm.weight"
    elif k == "lm_head.weight":
        return "output.weight"
    elif k.startswith("model.layers."):
        layer = k.split(".")[2]
        if k.endswith(".self_attn.q_proj.weight"):
            return f"layers.{layer}.attention.wq.weight"
        elif k.endswith(".self_attn.k_proj.weight"):
            return f"layers.{layer}.attention.wk.weight"
        elif k.endswith(".self_attn.v_proj.weight"):
            return f"layers.{layer}.attention.wv.weight"
        elif k.endswith(".self_attn.o_proj.weight"):
            return f"layers.{layer}.attention.wo.weight"
        elif k.endswith(".mlp.gate_proj.weight"):
            return f"layers.{layer}.feed_forward.w1.weight"
        elif k.endswith(".mlp.down_proj.weight"):
            return f"layers.{layer}.feed_forward.w2.weight"
        elif k.endswith(".mlp.up_proj.weight"):
            return f"layers.{layer}.feed_forward.w3.weight"
        elif k.endswith(".input_layernorm.weight"):
            return f"layers.{layer}.attention_norm.weight"
        elif k.endswith(".post_attention_layernorm.weight"):
            return f"layers.{layer}.ffn_norm.weight"
        elif k.endswith("rotary_emb.inv_freq") or "lora" in k:
            return None
        else:
            print(layer, k)
            raise NotImplementedError
    else:
        print(k)
        raise NotImplementedError


def save_shards(lora_model_sd, num_shards: int):
    # Add the no_grad context manager
    with torch.no_grad():
        if num_shards == 1:
            new_state_dict = {}
            for k, v in lora_model_sd.items():
                new_k = translate_state_dict_key(k)
                if new_k is not None:
                    if "wq" in new_k or "wk" in new_k:
                        new_state_dict[new_k] = unpermute(v)
                    else:
                        new_state_dict[new_k] = v

            os.makedirs(output_dir, exist_ok=True)
            print(f"Saving shard 1 of {num_shards} into {output_dir}/consolidated.00.pth")
            torch.save(new_state_dict, output_dir + "/consolidated.00.pth")
            with open(output_dir + "/params.json", "w") as f:
                json.dump(params, f)
        else:
            new_state_dicts = [dict() for _ in range(num_shards)]
            for k in list(lora_model_sd.keys()):
                v = lora_model_sd[k]
                new_k = translate_state_dict_key(k)
                if new_k is not None:
                    if new_k=='tok_embeddings.weight':
                        print(f"Processing {new_k}")
                        assert v.size(1)%num_shards==0
                        splits = v.split(v.size(1)//num_shards,dim=1)
                    elif new_k=='output.weight':
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(0)//num_shards,dim=0)

                    elif new_k=='norm.weight':
                        print(f"Processing {new_k}")
                        splits = [v] * num_shards
                    elif 'ffn_norm.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = [v] * num_shards
                    elif 'attention_norm.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = [v] * num_shards


                    elif 'w1.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(0)//num_shards,dim=0)
                    elif 'w2.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(1)//num_shards,dim=1)
                    elif 'w3.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(0)//num_shards,dim=0)


                    elif 'wo.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(1)//num_shards,dim=1)

                    elif 'wv.weight' in new_k:
                        print(f"Processing {new_k}")
                        splits = v.split(v.size(0)//num_shards,dim=0)

                    elif "wq.weight" in new_k or "wk.weight" in new_k:
                        print(f"Processing {new_k}")
                        v = unpermute(v)
                        splits = v.split(v.size(0)//num_shards,dim=0)
                    else:
                        print(f"Unexpected key {new_k}")
                        raise ValueError
                    for sd,split in zip(new_state_dicts,splits):
                        sd[new_k] = split.clone()
                        del split
                    del splits
                del lora_model_sd[k],v
                gc.collect()    # Effectively enforce garbage collection

            os.makedirs(output_dir, exist_ok=True)
            for i,new_state_dict in enumerate(new_state_dicts):
                print(f"Saving shard {i+1} of {num_shards} into {output_dir}/consolidated.0{i}.pth")
                torch.save(new_state_dict, output_dir + f"/consolidated.0{i}.pth")
            with open(output_dir + "/params.json", "w") as f:
                print(f"Saving params.json into {output_dir}/params.json")
                json.dump(params, f)


save_shards(lora_model_sd=lora_model_sd, num_shards=num_shards)</code></pre> 
</div> 
<p>Â æ‰§è¡Œå‘½ä»¤ï¼ˆ<span style="color:#fe2c24;"><strong>å¦‚æœä½ ä½¿ç”¨äº†anacondaï¼Œæ‰§è¡Œå‘½ä»¤å‰è¯·å…ˆæ¿€æ´»ç¯å¢ƒ</strong></span>ï¼‰ï¼š</p> 
<div> 
 <pre><code class="language-bash">python merge_llama_with_chinese_lora.py --base_model path_to_original_llama_hf_dir --lora_model chinese-alpaca-lora-7b --output_dir path_to_output_dir</code></pre> 
</div> 
<p>å‚æ•°è¯´æ˜ï¼š</p> 
<ul><li><code>--base_model</code>ï¼šå­˜æ”¾HFæ ¼å¼çš„LLaMAæ¨¡å‹æƒé‡å’Œé…ç½®æ–‡ä»¶çš„ç›®å½•ï¼ˆå‰é¢æ­¥éª¤ä¸­è½¬çš„hfæ ¼å¼ï¼‰</li><li><code>--lora_model</code>ï¼šæ‰©å……äº†ä¸­æ–‡çš„æ¨¡å‹ç›®å½•</li><li><code>--output_dir</code>ï¼šæŒ‡å®šä¿å­˜å…¨é‡æ¨¡å‹æƒé‡çš„ç›®å½•ï¼Œé»˜è®¤ä¸º<code>./ï¼ˆåˆå¹¶å‡ºæ¥çš„ç›®å½•ï¼‰</code></li><li>ï¼ˆå¯é€‰ï¼‰<code>--offload_dir</code>ï¼šå¯¹äºä½å†…å­˜ç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªoffloadç¼“å­˜è·¯å¾„</li></ul> 
<blockquote> 
 <p>æ›´è¯¦ç»†çš„è¯·çœ‹å¼€åŸä»“åº“ï¼š<a href="https://github.com/ymcui/Chinese-LLaMA-Alpaca" title="GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPU/GPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)">GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPU/GPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)</a></p> 
</blockquote> 
<p>åˆ°è¿™é‡Œå°±å·²ç»åˆå¹¶å¥½æ¨¡å‹äº†, ç›®å½•ï¼š</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/ad/42/YbP5x3Jf_o.png" width="911">â€‹</p> 
<p>æ¥ä¸‹æ¥å°±å‡†å¤‡éƒ¨ç½²å§</p> 
<hr> 
<h2 id="%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%9E%8B%C2%A0">éƒ¨ç½²æ¨¡å‹Â </h2> 
<p>æˆ‘ä»¬éœ€è¦å…ˆä¸‹è½½llama.cppè¿›è¡Œæ¨¡å‹çš„é‡åŒ–, è¾“å…¥ä»¥ä¸‹å‘½ä»¤:Â </p> 
<div> 
 <pre><code class="language-bash">git clone https://github.com/ggerganov/llama.cpp</code></pre> 
</div> 
<p>ç›®å½•å¦‚ï¼šÂ </p> 
<p><img alt="" height="253" src="https://images2.imgbox.com/da/5f/arKbjr5g_o.png" width="911">â€‹</p> 
<p>Â é‡ç‚¹æ¥äº†, åœ¨çª—å£ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿›å…¥åˆšåˆšä¸‹è½½çš„llama.cpp</p> 
<div> 
 <pre><code class="language-bash">cd llama.cpp</code></pre> 
</div> 
<p>Â <span style="color:#fe2c24;"><strong>å¦‚æœä½ æ˜¯è·Ÿç€æ•™ç¨‹ä½¿ç”¨scoopï¼ˆåŒ…ç®¡ç†å™¨ï¼‰å®‰è£…çš„MinGWï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆä¸æ˜¯çš„è¯·å¾€åçœ‹ï¼‰ï¼š</strong></span></p> 
<div> 
 <pre><code class="language-bash">cmake . -G "MinGW Makefiles"

cmake --build . --config Release</code></pre> 
</div> 
<p>Â èµ°å®Œä»¥ä¸Šå‘½ä»¤åä½ åº”è¯¥èƒ½åœ¨llama.cppçš„binç›®å½•å†…çœ‹åˆ°ä»¥ä¸‹æ–‡ä»¶ï¼š</p> 
<p><img alt="" height="246" src="https://images2.imgbox.com/ac/b9/rPLKTPU7_o.png" width="911">â€‹</p> 
<p>Â <span style="color:#fe2c24;"><strong>å¦‚æœä½ æ˜¯ä½¿ç”¨çš„å®‰è£…åŒ…çš„æ–¹å¼å®‰è£…çš„MinGWï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</strong></span></p> 
<div> 
 <pre><code class="language-bash">mkdir build

cd build

cmake ..

cmake --build . --config Release</code></pre> 
</div> 
<p>èµ°å®Œä»¥ä¸Šå‘½ä»¤ååœ¨build =ã€‹Release =ã€‹binç›®å½•ä¸‹åº”è¯¥ä¼šæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p> 
<p><img alt="" height="716" src="https://images2.imgbox.com/ea/51/UGnR9AIA_o.png" width="1097">â€‹</p> 
<blockquote> 
 <p>ä»¥ä¸Šå‘½ä»¤ä¸èƒ½éƒ½è¾“å…¥ï¼Œçœ‹ä½ è‡ªå·±çš„æƒ…å†µé€‰æ‹©å‘½ä»¤ï¼ï¼ï¼Â </p> 
</blockquote> 
<p>å¦‚æœæ²¡æœ‰ä»¥ä¸Šçš„æ–‡ä»¶, é‚£ä½ åº”è¯¥æ˜¯æŠ¥é”™äº†, åŸºæœ¬ä¸Šè¦ä¹ˆå°±æ˜¯ä¸‹è½½ä¾èµ–çš„åœ°æ–¹é”™, è¦ä¹ˆå°±æ˜¯ç¼–è¯‘çš„åœ°æ–¹å‡ºé”™, æˆ‘åœ¨è¿™é‡Œæ‘¸ç´¢äº†å¥½ä¹…Â </p> 
<p>æ¥ä¸‹æ¥åœ¨llama.cppå†…æ–°å»ºä¸€ä¸ªzh-modelsæ–‡ä»¶å¤¹, å‡†å¤‡ç”Ÿæˆé‡åŒ–ç‰ˆæœ¬æ¨¡å‹</p> 
<blockquote> 
 <p>zh-modelsçš„ç›®å½•æ ¼å¼å¦‚ä¸‹ï¼š</p> 
 <p>zh-models/</p> 
 <p>Â Â Â Â Â Â Â Â - 7B/Â  Â  Â  Â  #è¿™æ˜¯ä¸€ä¸ªåä¸º7Bçš„æ–‡ä»¶å¤¹<br> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â - consolidated.00.pth<br> Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â - params.json<br> Â Â Â Â Â Â Â Â - tokenizer.model</p> 
 <p></p> 
 <p>æŠŠpath_to_output_diræ–‡ä»¶å¤¹å†…çš„consolidated.00.pthå’Œparams.jsonæ–‡ä»¶æ”¾å…¥ä¸Šé¢æ ¼å¼ä¸­çš„ä½ç½®</p> 
 <p>æŠŠpath_to_output_diræ–‡ä»¶å¤¹å†…çš„tokenizer.modelæ–‡ä»¶æ”¾åœ¨è·Ÿ7Bæ–‡ä»¶å¤¹åŒçº§çš„ä½ç½®</p> 
 <p><img alt="" height="175" src="https://images2.imgbox.com/64/2e/94TLy0k0_o.png" width="911">â€‹</p> 
</blockquote> 
<p>æ¥ç€åœ¨çª—å£ä¸­è¾“å…¥å‘½ä»¤å°†ä¸Šè¿°<code>.pth</code>æ¨¡å‹æƒé‡è½¬æ¢ä¸ºggmlçš„FP16æ ¼å¼ï¼Œç”Ÿæˆæ–‡ä»¶è·¯å¾„ä¸º<code>zh-models/7B/ggml-model-f16.bin</code></p> 
<div> 
 <pre><code class="language-bash">python convert-pth-to-ggml.py zh-models/7B/ 1</code></pre> 
</div> 
<p><img alt="" height="167" src="https://images2.imgbox.com/c7/c8/idhTN2vX_o.png" width="911">â€‹</p> 
<p>Â è¿›ä¸€æ­¥å¯¹FP16æ¨¡å‹è¿›è¡Œ4-bité‡åŒ–ï¼Œç”Ÿæˆé‡åŒ–æ¨¡å‹æ–‡ä»¶è·¯å¾„ä¸º<code>zh-models/7B/ggml-model-q4_0.bin</code></p> 
<div> 
 <pre><code class="language-bash">D:\llama\llama.cpp\bin\quantize.exe ./zh-models/7B/ggml-model-f16.bin ./zh-models/7B/ggml-model-q4_0.bin 2</code></pre> 
</div> 
<blockquote> 
 <p>quantize.exeæ–‡ä»¶åœ¨binç›®å½•å†…, è‡ªè¡Œæ ¹æ®è·¯å¾„æ›´æ”¹</p> 
</blockquote> 
<p><img alt="" height="169" src="https://images2.imgbox.com/cf/74/nRBDnfuY_o.png" width="911">â€‹åˆ°è¿™å°±å·²ç»é‡åŒ–å¥½äº†, å¯ä»¥è¿›è¡Œéƒ¨ç½²çœ‹çœ‹æ•ˆæœäº†, éƒ¨ç½²çš„è¯å¦‚æœä½ ç”µè„‘é…ç½®å¥½çš„å¯ä»¥é€‰æ‹©éƒ¨ç½²f16çš„,å¦åˆ™å°±éƒ¨ç½²q4_0çš„....</p> 
<div> 
 <pre><code class="language-bash">D:\llama\llama.cpp\bin\main.exe -m zh-models/7B/ggml-model-q4_0.bin --color -f prompts/alpaca.txt -ins -c 2048 --temp 0.2 -n 256 --repeat_penalty 1.3</code></pre> 
</div> 
<p>åœ¨æç¤ºç¬¦Â <code>&gt;</code>Â ä¹‹åè¾“å…¥ä½ çš„promptï¼Œ<code>cmd/ctrl+c</code>ä¸­æ–­è¾“å‡ºï¼Œå¤šè¡Œä¿¡æ¯ä»¥<code>\</code>ä½œä¸ºè¡Œå°¾Â </p> 
<blockquote> 
 <p>å¸¸ç”¨å‚æ•°<span style="color:#fe2c24;">ï¼ˆæ›´å¤šå‚æ•°è¯·æ‰§è¡ŒD:\llama\llama.cpp\bin\main.exe -hå‘½ä»¤ï¼‰</span>ï¼š</p> 
 <p>-ins å¯åŠ¨ç±»ChatGPTå¯¹è¯äº¤æµçš„è¿è¡Œæ¨¡å¼<br> -f æŒ‡å®špromptæ¨¡æ¿ï¼Œalpacaæ¨¡å‹è¯·åŠ è½½prompts/alpaca.txt<br> -c æ§åˆ¶ä¸Šä¸‹æ–‡çš„é•¿åº¦ï¼Œå€¼è¶Šå¤§è¶Šèƒ½å‚è€ƒæ›´é•¿çš„å¯¹è¯å†å²ï¼ˆé»˜è®¤ï¼š512ï¼‰<br> -n æ§åˆ¶å›å¤ç”Ÿæˆçš„æœ€å¤§é•¿åº¦ï¼ˆé»˜è®¤ï¼š128ï¼‰<br> -b æ§åˆ¶batch sizeï¼ˆé»˜è®¤ï¼š8ï¼‰ï¼Œå¯é€‚å½“å¢åŠ <br> -t æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼ˆé»˜è®¤ï¼š4ï¼‰ï¼Œå¯é€‚å½“å¢åŠ <br> --repeat_penalty æ§åˆ¶ç”Ÿæˆå›å¤ä¸­å¯¹é‡å¤æ–‡æœ¬çš„æƒ©ç½šåŠ›åº¦<br> --temp æ¸©åº¦ç³»æ•°ï¼Œå€¼è¶Šä½å›å¤çš„éšæœºæ€§è¶Šå°ï¼Œåä¹‹è¶Šå¤§<br> --top_p, top_k æ§åˆ¶è§£ç é‡‡æ ·çš„ç›¸å…³å‚æ•°</p> 
 <p></p> 
 <p>æƒ³è¦éƒ¨ç½²f16çš„å¯ä»¥æŠŠå‘½ä»¤ä¸­-må‚æ•°æ¢æˆzh-models/7B/ggml-model-f16.binå³å¯</p> 
</blockquote> 
<p>éƒ¨ç½²æ•ˆæœï¼š</p> 
<p><img alt="" height="600" src="https://images2.imgbox.com/a7/56/TDkyLD3n_o.png" width="1200">â€‹</p> 
<p>ç»ˆäºå†™å®Œäº†~</p> 
<hr> 
<p>å‚è€ƒï¼š</p> 
<ul><li><a href="https://github.com/ymcui/Chinese-LLaMA-Alpaca" title="GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPU/GPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)">GitHub - ymcui/Chinese-LLaMA-Alpaca: ä¸­æ–‡LLaMA&amp;Alpacaå¤§è¯­è¨€æ¨¡å‹+æœ¬åœ°CPU/GPUéƒ¨ç½² (Chinese LLaMA &amp; Alpaca LLMs)</a></li></ul> 
<hr> 
<p>ğŸ‘ç‚¹èµï¼Œä½ çš„è®¤å¯æ˜¯æˆ‘åˆ›ä½œçš„åŠ¨åŠ› ï¼<br> ğŸŒŸæ”¶è—ï¼Œä½ çš„é’çæ˜¯æˆ‘åŠªåŠ›çš„æ–¹å‘ï¼<br> âœï¸è¯„è®ºï¼Œä½ çš„æ„è§æ˜¯æˆ‘è¿›æ­¥çš„è´¢å¯Œï¼Â Â Â </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e838e4227c7f209eba98e56f3459751c/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Elasticsearch æ ¸å¿ƒæŠ€æœ¯ï¼ˆåï¼‰ï¼šGEO åœ°ç†æŸ¥è¯¢ï¼ˆgeo_bounding_boxã€geo_distanceã€geo_shapeï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/846c1b8b0573ba9c95337d94aefde6ad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å¦‚ä½•å¿«é€Ÿå…¥é—¨ Javaï¼Ÿ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å­¦ä¹ è€….
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>