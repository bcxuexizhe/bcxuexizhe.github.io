<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【MySQL数据库】详解数据库审核工具SQLE的部署及接口调用 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/b1b55e5a982ca61cb7439515840cd9cb/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【MySQL数据库】详解数据库审核工具SQLE的部署及接口调用">
  <meta property="og:description" content="SQLE部署及使用 1. 部署SQLE SQLE相信大家都不陌生吧，它是一款开源，支持多场景审核，支持标准化上线流程，原生支持 MySQL 审核且数据库类型可扩展的 SQL审核工具。我们可以基于此工具进行数据库SQL审核，提升SQL脚本质量，大大提高我们的开发效率。
其主要功能和优势包括：
平台管理：支持用户和角色管理、配置上线数据库、基于角色的资源隔离、配置审核规则模板，以及对不同的数据库应用不同的规则模板。SQL审核：支持工单审批流程、工单隔离、邮件推送审批事件、SQL上线、生成回滚语句、审核MyBatisXML文件，以及审核建议按SQL归类去重展示等功能。此外，SQLE还支持审核报告下载，并提供静态审核（即脱离上线数据库审核）和定时审核功能。SQL审核计划：支持通过标准接口收集来自业务的SQL统计信息，提供MyBatis文件扫描上传程序（scanner），可集成CI/CD。 SQLE3.0在SQL审核方面具有高效性和准确性的双重优势。它能够自动化地对SQL语句进行审核，从而减少了人工审核的工作量和错误率。此外，SQLE 3.0还具备强大的规则引擎，可以通过预设规则对SQL语句进行灵活的审核和检测，从而保证了SQL语句的规范性和安全性。
与其他数据库审核工具相比，SQLE具有其独特的优势。例如，本地数据库平台虽然简单，但分析范围有限，且需要人为管理。而DAM数据库活动监控平台和SIEM、日志管理工具虽然功能更多，但可能会消耗本地数据库性能。SQLE则通过提供全面的审核功能和高效的审核效率，为用户提供了更好的选择。
下载地址：https://github.com/actiontech/sqle/releases
安装：
mkdir /opt/sqle 创建SQLE元数据存储库（mysql中）： create database sqle
修改配置：修改配置文件名，并按需修改端口、元数据数据库信息
启动sqle: systemctl start sqled
2. SQLE使用 功能列表如下：
已有的审核规则 如下，大家可以部署后自行查看 配置数据源：需配置具体实例、用户信息、审核规则模板、开启审核等
创建审核任务：
点击下方审核
审核结果如下
3. 调用审核接口 审核接口：http://ip：port/v1/tasks/audits
先获取token
使用postman调用接口进行审核：需输入token 、instance_name、instance_schema 、sql
输入token:
提交待审核SQL
查看审核结果 ：
http://ip:10000/v1/tasks/audits/9/sqls?page_index=1&amp;page_size=10&amp;no_duplicate=false
注：数据库SQL脚本的审核是相当重要的一项工作，建议使用SQL审核工具进行审核，提升SQL质量。下一篇将通过代码来调用对应的接口并获得审核结果。
SQLE接口调用 1、创建自定义审核接口
因直接调用SQLE的审核接口，会出现token过期，且审核及结果查询接口是分开的，因此，出于以上2个原因的考虑，重新编写一个接口用于调用SQLE的审核接口并返回审核结果。参考代码如下：
# coding=utf-8 import requests from flask import request import json from flask import Flask app = Flask(__name__) @app.route(&#39;/audit_task&#39;, methods=[&#39;post&#39;,&#39;get&#39;]) def audit_task(): get_data = request.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-06T17:10:25+08:00">
    <meta property="article:modified_time" content="2024-05-06T17:10:25+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【MySQL数据库】详解数据库审核工具SQLE的部署及接口调用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SQLE_0"></a>SQLE部署及使用</h2> 
<h4><a id="1_SQLE_2"></a><strong>1. 部署SQLE</strong></h4> 
<blockquote> 
 <p>SQLE相信大家都不陌生吧，它是一款开源，支持多场景审核，支持标准化上线流程，原生支持 MySQL 审核且数据库类型可扩展的 SQL审核工具。我们可以基于此工具进行数据库SQL审核，提升SQL脚本质量，大大提高我们的开发效率。</p> 
</blockquote> 
<p><strong>其主要功能和优势包括：</strong></p> 
<blockquote> 
 <ul><li>平台管理：支持用户和角色管理、配置上线数据库、基于角色的资源隔离、配置审核规则模板，以及对不同的数据库应用不同的规则模板。</li><li>SQL审核：支持工单审批流程、工单隔离、邮件推送审批事件、SQL上线、生成回滚语句、审核MyBatis</li><li>XML文件，以及审核建议按SQL归类去重展示等功能。此外，SQLE还支持审核报告下载，并提供静态审核（即脱离上线数据库审核）和定时审核功能。</li><li>SQL审核计划：支持通过标准接口收集来自业务的SQL统计信息，提供MyBatis文件扫描上传程序（scanner），可集成CI/CD。</li></ul> 
</blockquote> 
<p>SQLE3.0在SQL审核方面具有高效性和准确性的双重优势。它能够自动化地对SQL语句进行审核，从而减少了人工审核的工作量和错误率。此外，SQLE 3.0还具备强大的规则引擎，可以通过预设规则对SQL语句进行灵活的审核和检测，从而保证了SQL语句的规范性和安全性。</p> 
<p>与其他数据库审核工具相比，SQLE具有其独特的优势。例如，本地数据库平台虽然简单，但分析范围有限，且需要人为管理。而DAM数据库活动监控平台和SIEM、日志管理工具虽然功能更多，但可能会消耗本地数据库性能。SQLE则通过提供全面的审核功能和高效的审核效率，为用户提供了更好的选择。</p> 
<p><strong>下载地址</strong>：https://github.com/actiontech/sqle/releases</p> 
<p><strong>安装</strong>：</p> 
<pre><code>mkdir  /opt/sqle
</code></pre> 
<p><strong>创建SQLE元数据存储库（mysql中）：</strong> create database sqle</p> 
<p><strong>修改配置</strong>：修改配置文件名，并按需修改端口、元数据数据库信息</p> 
<p><strong>启动sqle:</strong> systemctl start sqled</p> 
<h4><a id="2_SQLE_33"></a><strong>2. SQLE使用</strong></h4> 
<p>功能列表如下：</p> 
<p><img src="https://images2.imgbox.com/f7/8f/zW7SvT1V_o.png" alt="在这里插入图片描述"></p> 
<p>已有的审核规则 如下，大家可以部署后自行查看 <img src="https://images2.imgbox.com/43/cf/saVLeUyy_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e0/65/ODuHqrh7_o.png" alt="在这里插入图片描述"></p> 
<p>配置数据源：需配置具体实例、用户信息、审核规则模板、开启审核等</p> 
<p><img src="https://images2.imgbox.com/a0/1e/6P1MtyXP_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/a0/88/wixPxbMA_o.png" alt="在这里插入图片描述"></p> 
<p>创建审核任务：</p> 
<p><img src="https://images2.imgbox.com/7a/2f/YrsS38Ww_o.png" alt="在这里插入图片描述"></p> 
<p>点击下方审核</p> 
<p><img src="https://images2.imgbox.com/a6/1a/ZRYiqijH_o.png" alt="在这里插入图片描述"></p> 
<p>审核结果如下</p> 
<p><img src="https://images2.imgbox.com/bd/d1/0DYDMAAr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3__73"></a><strong>3. 调用审核接口</strong></h4> 
<p>审核接口：http://ip：port/v1/tasks/audits</p> 
<p>先获取token</p> 
<p><img src="https://images2.imgbox.com/51/88/3JEBIpHy_o.png" alt="在这里插入图片描述"></p> 
<p>使用postman调用接口进行审核：需输入token 、instance_name、instance_schema 、sql</p> 
<p><strong>输入token:</strong></p> 
<p><img src="https://images2.imgbox.com/df/9a/o2xsMpfd_o.png" alt="在这里插入图片描述"></p> 
<p><strong>提交待审核SQL</strong></p> 
<p><img src="https://images2.imgbox.com/6f/bb/sBpfJGjg_o.png" alt="在这里插入图片描述"></p> 
<p><strong>查看审核结果</strong> ：</p> 
<p>http://ip:10000/v1/tasks/audits/9/sqls?page_index=1&amp;page_size=10&amp;no_duplicate=false</p> 
<p><img src="https://images2.imgbox.com/e7/0f/zkxRLQq0_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注：数据库SQL脚本的审核是相当重要的一项工作，建议使用SQL审核工具进行审核，提升SQL质量。下一篇将通过代码来调用对应的接口并获得审核结果。</p> 
</blockquote> 
<h2><a id="SQLE_103"></a>SQLE接口调用</h2> 
<p><strong>1、创建自定义审核接口</strong></p> 
<p>因直接调用SQLE的审核接口，会出现token过期，且审核及结果查询接口是分开的，因此，出于以上2个原因的考虑，重新编写一个接口用于调用SQLE的审核接口并返回审核结果。参考代码如下：</p> 
<pre><code># coding=utf-8
import requests
from flask import request
import json
from flask import Flask
app = Flask(__name__)
@app.route('/audit_task', methods=['post','get'])

def  audit_task():
    get_data = request.args.to_dict()
    v_instance = get_data.get('instance')
    v_schema = get_data.get('schema')
    v_sql = get_data.get('sql')


    v_token = get_token()
    v_headers = {'Authorization': f"{v_token}"}
    #print(v_headers)
    url = 'http://127.0.0.1:10000/v1/tasks/audits'
    v_data_a  = {'instance_name':v_instance,'instance_schema':v_schema,'sql':v_sql}
    #print(v_data_a)
    res = requests.post(url, data=v_data_a, headers=v_headers)
    v_taskid=res.json()['data']['task_id']
    url2='http://127.0.0.1:10000/v1/tasks/audits/'+str(v_taskid)+'{/sqls?page_index=1&amp;page_size=10&amp;no_duplicate=false'
    # print(url2)
    res2 = requests.get(url2,  headers=v_headers)
    audit_result = res2.json()['data'][0]['audit_result']
    if not(audit_result):
        audit_result=f'审核通过'
    return audit_result

def  get_token():
    url = 'http://127.0.0.1:10000/v1/login'
    data = {"username": "admin", "password": "xxxx"}
    # res = requests.post(url, json=data)
    h = {
        'Content-Type': 'application/json; charset=UTF-8'
    }
    res = requests.post(url, data=json.dumps(data), headers=h)
    t = json.loads(res.text)
    #print(type(json.loads(res.text)))
    token = t['data']['token']
    #print(t['data']['token'])
    return token


if __name__ == '__main__':
    app.run(host='0.0.0.0',port=5000, debug=True)
</code></pre> 
<blockquote> 
 <p>注：使用时，需提前在SQLE中配置好实例信息。</p> 
</blockquote> 
<p><strong>2. 调用测试</strong></p> 
<p>运行以上接口，并使用postman调用进行测试</p> 
<p>输入参数名特地调整了一下，以便于区别，测试情况如下</p> 
<p><img src="https://images2.imgbox.com/57/07/1TUi5ka5_o.png" alt="在这里插入图片描述"></p> 
<p>调用结果如下：</p> 
<pre><code>[error]除了自增列及大字段列之外，每个列都必须添加默认值
[error]表必须有主键
[error]新建表必须加入if not exists create，保证重复执行不报错
</code></pre> 
<p>与上文结果一致，且 无需调用2次接口。</p> 
<hr> 
<h2><a id="_196"></a>好书推荐</h2> 
<p>​<img src="https://images2.imgbox.com/68/01/8H7rshNZ_o.jpg" alt="在这里插入图片描述"></p> 
<p><strong>《MySQL数据库管理与应用》</strong></p> 
<blockquote> 
 <p>MySQL作为一款开源的关系型数据库管理系统，有着强大的功能和广泛的应用领域，对促进信息化建设、推动数字经济发展起着重要的作用。<strong>本书全面介绍了MySQL数据库的技术原理、应用场景和开发实践，帮助读者掌握MySQL数据库的基本概念和高级特性，提升数据库设计与开发的能力。全书共11章，从数据库基础知识讲起，包括数据库概述、关系型数据库设计原则、SQL语言基础等内容，逐步深入介绍MySQL数据库的高级特性和应用技巧，如查询优化、事务管理、索引优化，延伸学习在数字经济发展情境下，数据库的发展趋势和应用等内容。此外，本书最后一章还通过两个综合应用项目将理论知识与实际应用结合在一起。</strong></p> 
</blockquote> 
<p><strong>购书链接：<a href="https://item.jd.com/14209036.html" rel="nofollow">点此进入</a></strong></p> 
<p>本书旨在通过清晰的逻辑结构、简洁易懂的语言和实际案例来帮助读者快速掌握MySQL数据库技术，并在实际工作中灵活运用，与时俱进地应对信息化发展的新要求，为企业和社会创造更大的价值，推动中国软件技术和数据库领域的创新和发展。无论你是数据库初学者、软件开发人员、数据库管理员还是数据分析师，只要你对MySQL数据库感兴趣或需要在工作中应用MySQL数据库，本书都为你提供了宝贵的知识和指导。它既可以作为学习教材，也可以作为参考书。</p> 
<hr> 
<p><img src="https://images2.imgbox.com/19/98/iXMkBLCc_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd6e55d6dfb755ffecc7ea779fb5f544/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构：线性表(详解)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5294cd99c6df32e380f6baecdc9d2827/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024年前端最全vue项目首页优化问题（前后端都要优化），web前端开发面试技巧</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>