<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C语言】深度解析：动态内存管理的机制与实践 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/0bf0d6a2cc171c9148acccd8148aef97/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【C语言】深度解析：动态内存管理的机制与实践">
  <meta property="og:description" content="🔥引言
本篇将深度解析:动态内存管理的机制。为了更加灵活分配内存中的空间，库中为了我们提供了一些的函数，去动态开辟和释放堆上的空间。
🌈个人主页：是店小二呀
🌈C语言笔记专栏：C语言笔记
🌈C&#43;&#43;笔记专栏： C&#43;&#43;笔记
🌈喜欢的诗句:无人扶我青云志 我自踏雪至山巅
文章目录 【前文】【正文】一、动态内存开辟函数1.1 malloc1.2 calloc1.3 malloc和calloc区别1.4 realloc（动态内存扩容）1.4.1 关于realloc扩展空间的两种情况: 二、free(释放动态开辟内存)三、动态内存的常见错误四、柔性数组(flexible array)4.1 柔性数组的特点4.2 柔性数组的使用 五、C/C&#43;&#43;中程序内存区域规划 【前文】 目前我们掌握申请内存的方式有两种: int a=0;//直接开辟空间 int arr[10]={0};//连续开辟空间 上面两种开辟空间的方式存在一些问题:
栈空间开辟的空间大小是固定的
数组在声明时，必须指定数组的长度(一定确定大小不能被调整)
以上不能够灵活地处理内存问题，有时候是需要的空间大小在程序运行时才能知道，那么数组在编译时开辟空间的方式就不能得到满足。
对此，为了更灵活地使用空间，C语言标准库提供了程序员在堆上申请和释放空间的函数
【正文】 C语言标准库提供申请和释放动态内存空间的库函数，声明在stdlib.h头文件中。
一、动态内存开辟函数 【温馨提示】:
以下三种动态内存开辟函数，都有可能会出现开辟失败的情况，对此返回值为空，通过判断指针是否为空，做出及时的处理。在OJ需要开辟空间时，一般不需要判断，一般不会开辟失败。
1.1 malloc #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main() { int *p=(int *)malloc(10*sizeof(int)) if(p==NULL) { perror(&#34;malloc fail!!!&#34;) return 1; } free(p) p=NULL; return 0; } 【说明】:
向内存申请空间不完成初始化，返回指向这块空间的大小malloc是void*类型，当我们申请空间时候，需要知道申请空间交给什么类型去维护如果参数size为0，malloc可能会报错(取决于编译器)同时申请空间有时候不一定会成功。如果失败的话，将会返回一个空指针，比如申请的空间太大，就会申请失败，这一点使用的时候要去注意。 1.2 calloc #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main() { int *p=(int *)calloc(10,sizeof(int)) if(p==NULL) { perror(&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-17T09:15:01+08:00">
    <meta property="article:modified_time" content="2024-05-17T09:15:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C语言】深度解析：动态内存管理的机制与实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/5d/80/x73fYyzA_o.gif" alt="请添加图片描述"></p> 
<p>🔥引言</p> 
<blockquote> 
 <p>本篇将深度解析:动态内存管理的机制。为了更加灵活分配内存中的空间，库中为了我们提供了一些的函数，去动态开辟和释放堆上的空间。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/a4/54/Cl5tcO80_o.gif" alt="请添加图片描述" width="600" height="60"><br> <img src="https://images2.imgbox.com/cc/e3/6R1aK2AA_o.png" alt="Alt" width="200" height="200"></p> 
<p>🌈个人主页：<a href="https://blog.csdn.net/2302_79177254?type=blog">是店小二呀</a><br> 🌈C语言笔记专栏：<a href="https://blog.csdn.net/2302_79177254/category_12498683.html?spm=1001.2014.3001.5482">C语言笔记</a><br> 🌈C++笔记专栏： <a href="https://blog.csdn.net/2302_79177254/category_12596619.html">C++笔记</a></p> 
<p>🌈喜欢的诗句:无人扶我青云志 我自踏雪至山巅<br> <img src="https://images2.imgbox.com/46/fa/dxheV5xn_o.gif" alt="请添加图片描述" width="600" height="60"></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#font_colorcornflowerbluefont_20" rel="nofollow"><font color="cornflowerblue">【前文】</font></a></li><li><a href="#font_colorcornflowerbluefont_43" rel="nofollow"><font color="cornflowerblue">【正文】</font></a></li><li><a href="#font_colorcornflowerbluefont_47" rel="nofollow"><font color="cornflowerblue">一、动态内存开辟函数</font></a></li><li><ul><li><a href="#font_colorcornflowerblue11_mallocfont_53" rel="nofollow"><font color="cornflowerblue">1.1 malloc</font></a></li><li><a href="#font_colorcornflowerblue12_callocfont_85" rel="nofollow"><font color="cornflowerblue">1.2 calloc</font></a></li><li><a href="#font_colorcornflowerblue13_malloccallocfont_115" rel="nofollow"><font color="cornflowerblue">1.3 malloc和calloc区别</font></a></li><li><a href="#font_colorcornflowerblue14_reallocfont_123" rel="nofollow"><font color="cornflowerblue">1.4 realloc</font>（动态内存扩容）</a></li><li><ul><li><a href="#font_colorcornflowerblue141_reallocfont_167" rel="nofollow"><font color="cornflowerblue">1.4.1 关于realloc扩展空间的两种情况</font>:</a></li></ul> 
  </li></ul> 
  </li><li><a href="#font_colorcornflowerbluefreefont_181" rel="nofollow"><font color="cornflowerblue">二、free</font>(释放动态开辟内存)</a></li><li><a href="#font_colorcornflowerbluefont_198" rel="nofollow"><font color="cornflowerblue">三、动态内存的常见错误</font></a></li><li><a href="#font_colorcornflowerbluefontflexible_array_209" rel="nofollow"><font color="cornflowerblue">四、柔性数组</font>(flexible array)</a></li><li><ul><li><a href="#font_colorcornflowerblue41_font_229" rel="nofollow"><font color="cornflowerblue">4.1 柔性数组的特点</font></a></li><li><a href="#font_colorcornflowerblue42_font_250" rel="nofollow"><font color="cornflowerblue">4.2 柔性数组的使用</font></a></li></ul> 
  </li><li><a href="#font_colorcornflowerblueCCfont_318" rel="nofollow"><font color="cornflowerblue">五、C/C++中程序内存区域规划</font></a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="font_colorcornflowerbluefont_20"></a><font color="cornflowerblue">【前文】</font></h2> 
<pre><code class="prism language-cpp">目前我们掌握申请内存的方式有两种<span class="token operator">:</span>
<span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//直接开辟空间</span>

<span class="token keyword">int</span> arr<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//连续开辟空间</span>
</code></pre> 
<p><strong>上面两种开辟空间的方式存在一些问题</strong>:</p> 
<ul><li> <p>栈空间开辟的<strong>空间大小是固定的</strong></p> </li><li> <p>数组在声明时，必须指定数组的长度(一定确定大小不能被调整)</p> </li></ul> 
<p>以上不能够灵活地处理内存问题，有时候是需要的空间大小在程序运行时才能知道，那么数组在编译时开辟空间的方式就不能得到满足。</p> 
<p>对此，为了更灵活地使用空间，C语言标准库提供了程序员在堆上申请和释放空间的函数</p> 
<hr> 
<h2><a id="font_colorcornflowerbluefont_43"></a><font color="cornflowerblue">【正文】</font></h2> 
<p>C语言标准库提供申请和释放动态内存空间的库函数，声明在<code>stdlib.h</code>头文件中。</p> 
<h2><a id="font_colorcornflowerbluefont_47"></a><font color="cornflowerblue">一、动态内存开辟函数</font></h2> 
<p>【<strong>温馨提示</strong>】:</p> 
<p>以下三种动态内存开辟函数，都有可能会出现开辟失败的情况，对此返回值为空，通过判断指针是否为空，做出及时的处理。在OJ需要开辟空间时，一般不需要判断，一般不会开辟失败。</p> 
<h3><a id="font_colorcornflowerblue11_mallocfont_53"></a><font color="cornflowerblue">1.1 malloc</font></h3> 
<p><img src="https://images2.imgbox.com/00/6f/lYJ4R3nG_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc fail!!!"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        p<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>说明</strong>】:</p> 
<ul><li>向内存申请空间<strong>不完成初始化</strong>，返回指向这块空间的大小</li><li>malloc是void*类型，当我们申请空间时候，需要知道<strong>申请空间交给什么类型去维护</strong></li><li>如果参数size为0，malloc可能会报错(取决于编译器)</li><li><strong>同时申请空间有时候不一定会成功</strong>。如果失败的话，将会返回一个空指针，比如申请的空间太大，就会申请失败，这一点使用的时候要去注意。</li></ul> 
<hr> 
<h3><a id="font_colorcornflowerblue12_callocfont_85"></a><font color="cornflowerblue">1.2 calloc</font></h3> 
<p><img src="https://images2.imgbox.com/c0/4a/9AFccLgI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"calloc fail!!!"</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        p<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>说明</strong>】:</p> 
<ul><li>向内存申请空间<strong>完成初始化为0</strong>，并且返回指向这块空间的指针</li><li>因为calloc是void*类型，当我们申请空间时候，需要知道<strong>申请空间交给什么类型去维护</strong></li><li><strong>同时申请空间有时候不一定会成功</strong>。如果失败的话，将会返回一个空指针，比如申请的空间太大，就会申请失败，这一点使用的时候要去注意。</li></ul> 
<hr> 
<h3><a id="font_colorcornflowerblue13_malloccallocfont_115"></a><font color="cornflowerblue">1.3 malloc和calloc区别</font></h3> 
<ul><li>都是向<strong>堆上申请空间</strong></li><li><strong>参数部分不同</strong></li><li>malloc申请空间<strong>没有初始化</strong>，calloc申请空间<strong>初始化为0</strong></li></ul> 
<hr> 
<h3><a id="font_colorcornflowerblue14_reallocfont_123"></a><font color="cornflowerblue">1.4 realloc</font>（动态内存扩容）</h3> 
<p><img src="https://images2.imgbox.com/0f/9f/VlxhDJ3M_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc fail！！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>pe<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">realloc</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">20</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pe<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"realloc fail！！！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    p<span class="token operator">=</span>pe<span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        p<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    pe<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>说明</strong>】：</p> 
<ul><li> <p>申请扩展空间并返回指向扩展空间的地址</p> </li><li> <p>一般realloc函数的使用，是在开辟好空间的基础上进行进一步的扩容</p> </li><li> <p>如果第一个参数部分为空指针，那么realloc等价于malloc。同时需要注意是否开辟空间成功</p> </li></ul> 
<p>【<strong>问题</strong>】:realloc需要扩容大小，是在malloc开辟空间大小的基础上追加，还是直接申请整个空间的大小</p> 
<p>【<strong>回答</strong>】:直接申请整个空间的大小</p> 
<hr> 
<h4><a id="font_colorcornflowerblue141_reallocfont_167"></a><font color="cornflowerblue">1.4.1 关于realloc扩展空间的两种情况</font>:</h4> 
<p>【<strong>情况一</strong>】：当内存空间足够的时候，直接在<strong>申请好的空间追加</strong></p> 
<p><img src="https://images2.imgbox.com/56/ca/771WTXoN_o.png" alt="在这里插入图片描述"></p> 
<p>【<strong>情况二</strong>】；当内存空间不够的时候，会在内存中寻找一块更大的空间存放，<strong>将目前的数据拷贝一份到新的空间位置中，再将原来的空间释放掉.</strong></p> 
<p><img src="https://images2.imgbox.com/9e/61/NKet0fCB_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="font_colorcornflowerbluefreefont_181"></a><font color="cornflowerblue">二、free</font>(释放动态开辟内存)</h2> 
<p><img src="https://images2.imgbox.com/df/2a/HtaqrkE0_o.png" alt="在这里插入图片描述"></p> 
<p>【<strong>说明</strong>】:</p> 
<ul><li>释放动态内存空间</li><li>使用方法在上面都有体现</li><li><strong>free参数部分是空指针，则函数什么事都不做</strong></li><li><strong>free非动态内存就会报错重复，行为是未定义的</strong></li><li><strong>重复释放同一块动态内存空间，会报错</strong></li></ul> 
<p>【<strong>注意</strong>】:如果忘记去free指针指向空间，操作系统会自动的回收使用权，但是尽量能写就写，万一出现内存泄漏危险了。</p> 
<hr> 
<h2><a id="font_colorcornflowerbluefont_198"></a><font color="cornflowerblue">三、动态内存的常见错误</font></h2> 
<ul><li>对空指针的解引用操作</li><li>对动态开辟的空间越界访问</li><li>对非动态开辟的空间使用free释放</li><li>对free释放一块动态开辟空间的一部分（空间只能一整块还）</li><li>多次对一块动态内存空间使用free释放</li><li>动态开辟内存忘记释放(内存泄漏)</li></ul> 
<hr> 
<h2><a id="font_colorcornflowerbluefontflexible_array_209"></a><font color="cornflowerblue">四、柔性数组</font>(flexible array)</h2> 
<p>在C99中，<strong>结构体最后一个成员为未知大小的数组</strong>，这个被称为柔性数组的成员，帮助用户根据要求自己给大小，更加轻松地处理可变长度的数据结构。</p> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">st_type</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>type_a<span class="token punctuation">;</span>
有些编译器可能会编译失败，可以化成nums<span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">st_type</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">int</span> nums<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>type_a<span class="token punctuation">;</span> 
</code></pre> 
<hr> 
<h3><a id="font_colorcornflowerblue41_font_229"></a><font color="cornflowerblue">4.1 柔性数组的特点</font></h3> 
<ul><li>结构体中至少有一个成员在柔性数组前面(<strong>如果顺序错了，也会报错</strong>)</li><li>sizeof返回的这种结构大小是不包含柔性数组的内存，编译器在计算结构体大小时会忽略柔性数组成员</li><li>对包含柔性数组的结构体，申请空间的时候适度大于结构体的大小，以便于适应柔性数组的大小</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">st_type</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//柔性数组成员</span>
<span class="token punctuation">}</span>type_a<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>type_a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出的是4</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="font_colorcornflowerblue42_font_250"></a><font color="cornflowerblue">4.2 柔性数组的使用</font></h3> 
<p>【<strong>代码一</strong>】:</p> 
<pre><code class="prism language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">st_type</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>type_a<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    type_a <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span>type_a<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>type_a<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">100</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        p<span class="token operator">-&gt;</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>代码二</strong>】:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">st_type</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p_a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>type_a<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    type_a <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span>type_a <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>type_a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>p_a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>i<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//业务处理</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        p<span class="token operator">-&gt;</span>p_a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//释放空间</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>p_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>p_a <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    p<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>说明</strong>】:</p> 
<ul><li>就是在一块空间内再开辟一块空间使用。</li><li>第一种和第二种都能实现相同的效果，但是第一种有两个好处</li></ul> 
<p><strong>【第一个好处】</strong>:</p> 
<ul><li>如果里面做了二次内存分配，并把整个结构体返回给用户。当用户需要释放空间时候，并不知道这个结构体内成员也需要free。</li><li>如果结构体的内存以及其成员要的内存一次性分配好，返回一个结构体指针，<strong>用户只需要一次free就可以把所有的内存也给释放掉了</strong>。</li></ul> 
<p><strong>【第二个好处】</strong>:连续的内存有益于提高访问速度，也有益于减少内存碎片</p> 
<hr> 
<h2><a id="font_colorcornflowerblueCCfont_318"></a><font color="cornflowerblue">五、C/C++中程序内存区域规划</font></h2> 
<p><img src="https://images2.imgbox.com/c7/f8/h1FGquOw_o.png" alt="请添加图片描述"></p> 
<p><font color="cornflowerblue">内存分配的几个区域</font>:</p> 
<p><strong>栈区(stack)</strong>:</p> 
<ul><li>在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。</li><li>栈内存分配运算内置于处理器的指令集中，效率很高，但是分的内存容量有限</li><li>栈区主要存放运行函数而分配的局部变量、函数参数、返回数据、返回地址等</li></ul> 
<p><strong>堆区(heap)</strong>：<br> 一般由程序员分配释放，若程序员不释放，程序结束时可能由OS(操作系统)回收。</p> 
<p><strong>数据段(静态区)</strong>:(static)存放全局变量、静态数据。程序结束后由系统释放。</p> 
<p><strong>代码段</strong>:存放函数体(类成员函数和全局函数)的二进制代码</p> 
<hr> 
<p><img src="https://images2.imgbox.com/a6/e1/iYsexGwJ_o.gif" alt="请添加图片描述"></p> 
<p><strong><font color="cornflowerblue">以上就是本篇文章的所有内容，在此感谢大家的观看！这里是店小二C语言笔记，希望对你在学习C语言中有所帮助！</font></strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3ec32e6bd68bf3434051894904310cad/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#进阶-ASP.NET的WebService跨域CORS问题解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8fe22e9454734fadca8df22cd0767cbe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL-----事务（详解）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>