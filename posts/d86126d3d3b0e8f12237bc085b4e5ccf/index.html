<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CoGPT: 通过GitHub Copilot免费使用gpt-4 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/d86126d3d3b0e8f12237bc085b4e5ccf/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="CoGPT: 通过GitHub Copilot免费使用gpt-4">
  <meta property="og:description" content="这次介绍项目可以把 OpenAI API 格式的请求转发到 GitHub Copilot 服务端，从而免费使用 gpt-4。当然前提是你有 GitHub Copilot。对于学生，可以通过 GitHub Education 免费使用。
先上项目链接: https://github.com/Geniucker/CoGPT
原理介绍 通过修改 Copilot Chat 插件的 js 文件，我们可以 dump 出请求体和请求头，我们可以发现 GitHub Copilot 基本上就是一个提供了 gpt 模型的 API 服务，我们只需要把请求转发到 GitHub Copilot 服务端就可以。但是经过测试，Copilot 并不支持 OpenAPI 最新的模型，但是其包含的 gpt-3.5-turbo 和 gpt-4 基本上可以满足我们的需求。
项目发展过程 最开始使用的是 Python 的 FastAPI 作为服务器，因为 Python 语言本身较为简单，同时 FastAPI 提供了较为方便的请求体解析，异步的支持使得他的性能在 Python 的 http 框架中较为突出。如有兴趣，具体代码可以看 py 分支。
然而，过程中遇到了一些困难：
如何返回流式响应：查找了文档，可以使用 fastapi.responses.StreamingResponse 函数，我们只需要写一个异步生成器，就可以返回流式响应。但是，如果在流式响应的过程中发生了错误，这个异常会被 FastAPI 捕获，导致我们无法自行处理异常。这个问题非常难以解决，所以最终我还是放弃了 Python 作为服务器的方案。
那么服务端剩下的选择基本上就是 Go, Java, Node.js 之类的语言了。由于我之前有接触过一点 Go，同时也给 copilot-gpt4-service 项目贡献过了较多代码，所以我就选择了 Go 作为服务端的语言。这次我们使用了 gin 框架。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-10T23:22:03+08:00">
    <meta property="article:modified_time" content="2024-02-10T23:22:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CoGPT: 通过GitHub Copilot免费使用gpt-4</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>这次介绍项目可以把 OpenAI API 格式的请求转发到 GitHub Copilot 服务端，从而免费使用 gpt-4。当然前提是你有 GitHub Copilot。对于学生，可以通过 GitHub Education 免费使用。</p> 
<p>先上项目链接: <a href="https://github.com/Geniucker/CoGPT">https://github.com/Geniucker/CoGPT</a></p> 
<h3><a id="_4"></a>原理介绍</h3> 
<p>通过修改 Copilot Chat 插件的 js 文件，我们可以 dump 出请求体和请求头，我们可以发现 GitHub Copilot 基本上就是一个提供了 gpt 模型的 API 服务，我们只需要把请求转发到 GitHub Copilot 服务端就可以。但是经过测试，Copilot 并不支持 OpenAPI 最新的模型，但是其包含的 gpt-3.5-turbo 和 gpt-4 基本上可以满足我们的需求。</p> 
<h3><a id="_8"></a>项目发展过程</h3> 
<p>最开始使用的是 Python 的 FastAPI 作为服务器，因为 Python 语言本身较为简单，同时 FastAPI 提供了较为方便的请求体解析，异步的支持使得他的性能在 Python 的 http 框架中较为突出。如有兴趣，具体代码可以看 <a href="https://github.com/Geniucker/CoGPT/tree/py">py</a> 分支。</p> 
<p>然而，过程中遇到了一些困难：</p> 
<p>如何返回流式响应：查找了文档，可以使用 <code>fastapi.responses.StreamingResponse</code> 函数，我们只需要写一个异步生成器，就可以返回流式响应。但是，如果在流式响应的过程中发生了错误，这个异常会被 FastAPI 捕获，导致我们无法自行处理异常。这个问题非常难以解决，所以最终我还是放弃了 Python 作为服务器的方案。</p> 
<p>那么服务端剩下的选择基本上就是 Go, Java, Node.js 之类的语言了。由于我之前有接触过一点 Go，同时也给 <a href="https://github.com/aaamoon/copilot-gpt4-service">copilot-gpt4-service</a> 项目贡献过了较多代码，所以我就选择了 Go 作为服务端的语言。这次我们使用了 <a href="https://github.com/gin-gonic/gin">gin</a> 框架。</p> 
<h3><a id="_18"></a>如何使用</h3> 
<h4><a id="_20"></a>警告</h4> 
<p>这个项目仅适合<strong>个人</strong>使用。并不适合访问量巨大的盈利项目。</p> 
<p>最佳实践方式：</p> 
<ul><li>本机部署，仅自己使用（推荐）</li><li>部署在个人服务器上，仅自己使用，或和几个朋友共同使用（不公开）</li></ul> 
<p>不建议的方式：</p> 
<ul><li>提供公共服务 
  <ul><li>在一个 ip 上使用了很多 token 容易被判定为异常行为</li></ul> </li><li>使用 Serverless 服务 
  <ul><li>由于 Serverless 服务的 ip 不固定，所以很容易被判定为异常行为</li></ul> </li><li>用于盈利项目 
  <ul><li>请求量过大，容易被判定为异常行为</li></ul> </li></ul> 
<p><font size="5"><strong>重要提示</strong></font></p> 
<p>请不要尝试上述任何一种不建议的方式，否则可能会导致 GitHub Copilot 账号，甚至 GitHub 账号被封禁。</p> 
<h4><a id="Docker__42"></a>Docker 部署</h4> 
<p>Linux 上非常推荐使用 Docker 部署</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/Geniucker/CoGPT.git <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> CoGPT
<span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code></pre> 
<p>默认情况下，服务会监听在 <code>8080</code> 端口，如果需要修改，可以修改 <code>docker-compose.yml</code> 文件中的 <code>ports</code> 部分。例如，如果你想要监听在 <code>8081</code> 端口，可以把 <code>8080:8080</code> 改为 <code>8081:8080</code>。</p> 
<h4><a id="_53"></a>本机部署</h4> 
<p>如果你不想使用 Docker，也可以直接在本机使用</p> 
<p>从 <a href="https://github.com/Geniucker/CoGPT/releases">Release</a> 页面下载对应平台的文件，解压后运行其中的 <code>cogpt-api</code> 文件即可。</p> 
<p>默认情况下，服务会监听在 <code>localhost:8080</code>，如果需要修改，可以参考下文的 <a href="#%E9%85%8D%E7%BD%AE" rel="nofollow">配置</a> 部分。</p> 
<h4><a id="_61"></a>配置</h4> 
<p>支持两种配置方式，一种是通过环境变量，一种是通过命令行参数</p> 
<h5><a id="_65"></a>环境变量</h5> 
<p>支持环境变量和 <code>.env</code> 文件，环境变量的优先级高于 <code>.env</code> 文件</p> 
<p>下面是所有支持的环境变量和默认值</p> 
<table><thead><tr><th>keys</th><th>default</th><th>description</th></tr></thead><tbody><tr><td><code>HOST</code></td><td><code>localhost</code></td><td>Host to listen on</td></tr><tr><td><code>PORT</code></td><td><code>8080</code></td><td>Port to listen on</td></tr><tr><td><code>CACHE</code></td><td><code>true</code></td><td>Whether to cache tokens in sqlite database. If false, tokens will be cached in memory</td></tr><tr><td><code>CACHE_PATH</code></td><td><code>db/cache.sqlite3</code></td><td>Path to sqlite database. Only used if <code>CACHE</code> is <code>true</code></td></tr><tr><td><code>DEBUG</code></td><td><code>false</code></td><td>Whether to enable debug mode. If true, the service will print debug info</td></tr><tr><td><code>LOG_LEVEL</code></td><td><code>info</code></td><td>Log level.</td></tr></tbody></table> 
<h5><a id="_80"></a>命令行参数</h5> 
<p>可以通过 <code>./cogpt-api -h</code> 查看所有支持的命令行参数</p> 
<h4><a id="_84"></a>使用</h4> 
<h5><a id="_token_86"></a>获取 token</h5> 
<p>首先，你要确保你的 GitHub 账号有 GitHub Copilot 的权限。然后从 <a href="https://github.com/Geniucker/CoGPT/releases">Release</a> 页面下载对应平台的文件，解压后运行其中的 <code>cogpt-get-apptoken</code> 文件即可，按照说明操作即可。</p> 
<p>如有必要设置代理，运行<code>./cogpt-get-apptoken -h</code> 查看帮助</p> 
<h5><a id="_92"></a>使用</h5> 
<p>假设你部署的服务在 <code>localhost:8080</code>，你可以在原本应该填<code>https://api.openai.com</code>的地方替换为<code>http://localhost:8080</code>，然后在填写 token 的地方填写你刚刚获取的 token 即可。</p> 
<h3><a id="_96"></a>许可申明</h3> 
<p>这个项目大体上基于 <a href="https://github.com/aaamoon/copilot-gpt4-service">copilot-gpt4-service</a> 项目，但是我本身就是这个项目的 Collaborator，并且有很多代码都是我写的，同时 <a href="https://github.com/aaamoon/copilot-gpt4-service">copilot-gpt4-service</a> 为 MIT 协议，所以没有许可问题。</p> 
<p>由于 <a href="https://github.com/aaaMoon/copilot-gpt4-service">copilot-gpt4-service</a> 的架构较为混乱，并且 PR 保持较多的状态，所以在原项目重构不太现实，所以我就自己写了一个。</p> 
<p>当前 <a href="https://github.com/Geniucker/CoGPT/">CoGPT</a> 项目为 <a href="https://github.com/Geniucker/CoGPT/blob/main/LICENSE">MPL-2.0</a> 协议。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3146a4c2e789d3717eda7cfc2375d990/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言：基础知识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e1fb39d9cddfbc12399e141bdc09adcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spark编程实验六：Spark机器学习库MLlib编程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>