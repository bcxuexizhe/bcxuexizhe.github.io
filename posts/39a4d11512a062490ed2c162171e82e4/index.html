<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable Diffusion XL webui tagger 插件Linux安装（保姆级教程） - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/39a4d11512a062490ed2c162171e82e4/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Stable Diffusion XL webui tagger 插件Linux安装（保姆级教程）">
  <meta property="og:description" content="文章目录 Stable Diffusion XL webui tagger 插件Linux安装为什么要安装tagger插件安装tagger插件下载tagger仓库下载wd-v1-4-vit-tagger 模型权重 Stable Diffusion XL webui tagger 插件Linux安装 为什么要安装tagger插件 为了使SD能生成我们想要的图像效果，往往需要对SD模型进行微调，但其权重参数太多，如果是用更新全部参数的方法来微调，会耗费大量的计算资源。那么可不可以仅需少量计算资源，对模型进行微调，也有不错的效果呢？答案是肯定的，那就是：基于LoRA对其进行微调！
本文写作动机：想自己训练LoRA，需要对训练数据进行tag，但是自己手动tag，比较麻烦，于是考虑用tagger插件，来实现对每张训练图像进行tag，然后在其基础上进行修改，以减少工作量。
webui提供了插件扩展，方便我们安装tagger插件。
可以看到，tagger插件能直接生成对于训练图片的描述。
安装tagger插件 在安装前，敲黑板！！！这个插件对于webui版本有很强的依赖性，所以需要安装合适的版本，以下教程，全部基于webui v1.6.0-2版本，还没有安装的可以参考我之前的文章，传送门
有三种安装方式。分别是：
在linux终端通过git 命令来安装在webui界面，直接输入tagger仓库的URL
通过available界面直接选择 这里主要介绍第二种方式。
下载tagger仓库 输入https://github.com/toriato/stable-diffusion-webui-wd14-tagger，点击Install就行了。
如果出现以下报错：
在/stable-diffusion-webui/extensions/stable-diffusion-webui-wd14-tagger/tagger/ui.py第10行左右
修改
from webui import wrap_gradio_gpu_call 为
# from webui import wrap_gradio_gpu_call from modules.call_queue import wrap_gradio_gpu_call 如果出现以下报错：
在/stable-diffusion-webui/extensions/stable-diffusion-webui-wd14-tagger/preload.py文件第4行左右，删掉
from modules.shared import models_path default_ddp_path = Path(models_path, &#39;deepdanbooru&#39;) 改为
from modules import paths default_ddp_path = Path(paths.models_path, &#39;deepdanbooru&#39;) 下载wd-v1-4-vit-tagger 模型权重 由于huggingface被墙了，需要手动下载，URL。下载这两项即可：
然后新建一个文件夹，将下载好的两个文件放在.cache下。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-28T08:38:22+08:00">
    <meta property="article:modified_time" content="2023-11-28T08:38:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable Diffusion XL webui tagger 插件Linux安装（保姆级教程）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Stable_Diffusion_XL_webui_tagger_Linux_1" rel="nofollow">Stable Diffusion XL webui tagger 插件Linux安装</a></li><li><ul><li><a href="#tagger_2" rel="nofollow">为什么要安装tagger插件</a></li><li><a href="#tagger_11" rel="nofollow">安装tagger插件</a></li><li><ul><li><a href="#tagger_23" rel="nofollow">下载tagger仓库</a></li><li><a href="#wdv14vittagger__53" rel="nofollow">下载wd-v1-4-vit-tagger 模型权重</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Stable_Diffusion_XL_webui_tagger_Linux_1"></a>Stable Diffusion XL webui tagger 插件Linux安装</h2> 
<h3><a id="tagger_2"></a>为什么要安装tagger插件</h3> 
<p>为了使SD能生成我们想要的图像效果，往往需要对SD模型进行微调，但其权重参数太多，如果是用更新全部参数的方法来微调，会耗费大量的计算资源。那么可不可以仅需少量计算资源，对模型进行微调，也有不错的效果呢？答案是肯定的，那就是：基于LoRA对其进行微调！</p> 
<p>本文写作动机：想自己训练LoRA，需要对训练数据进行tag，但是自己手动tag，比较麻烦，于是考虑用tagger插件，来实现对每张训练图像进行tag，然后在其基础上进行修改，以减少工作量。</p> 
<p>webui提供了插件扩展，方便我们安装tagger插件。<br> <img src="https://images2.imgbox.com/33/82/xel4Ahyr_o.png" alt="扩展"><br> 可以看到，tagger插件能直接生成对于训练图片的描述。<br> <img src="https://images2.imgbox.com/f1/63/kyNg8B6q_o.png" alt="插件效果"></p> 
<h3><a id="tagger_11"></a>安装tagger插件</h3> 
<p>在安装前，敲黑板！！！<strong>这个插件对于webui版本有很强的依赖性，所以需要安装合适的版本，以下教程，全部基于webui v1.6.0-2版本</strong>，还没有安装的可以参考我之前的文章，<a href="https://blog.csdn.net/a1112315165/article/details/134571499?spm=1001.2014.3001.5502">传送门</a></p> 
<p>有三种安装方式。分别是：</p> 
<ol><li>在linux终端通过git 命令来安装</li><li>在webui界面，直接输入tagger仓库的URL<br> <img src="https://images2.imgbox.com/81/b0/8Xkva1zO_o.png" alt="在这里插入图片描述"></li><li>通过available界面直接选择</li></ol> 
<p><img src="https://images2.imgbox.com/04/cf/rEcywbm0_o.png" alt="在这里插入图片描述">这里主要介绍第二种方式。</p> 
<h4><a id="tagger_23"></a>下载tagger仓库</h4> 
<p>输入<code>https://github.com/toriato/stable-diffusion-webui-wd14-tagger</code>，点击Install就行了。</p> 
<p>如果出现以下报错：<br> <img src="https://images2.imgbox.com/38/cc/Rm5WfAEd_o.png" alt="在这里插入图片描述"><br> 在<code>/stable-diffusion-webui/extensions/stable-diffusion-webui-wd14-tagger/tagger/ui.py</code>第10行左右<br> 修改</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> webui <span class="token keyword">import</span> wrap_gradio_gpu_call
</code></pre> 
<p>为</p> 
<pre><code class="prism language-python"><span class="token comment"># from webui import wrap_gradio_gpu_call</span>
<span class="token keyword">from</span> modules<span class="token punctuation">.</span>call_queue <span class="token keyword">import</span> wrap_gradio_gpu_call
</code></pre> 
<p>如果出现以下报错：<br> <img src="https://images2.imgbox.com/54/21/eG3bQgRh_o.png" alt="在这里插入图片描述"><br> 在<code>/stable-diffusion-webui/extensions/stable-diffusion-webui-wd14-tagger/preload.py</code>文件第4行左右，删掉</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> modules<span class="token punctuation">.</span>shared <span class="token keyword">import</span> models_path
default_ddp_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>models_path<span class="token punctuation">,</span> <span class="token string">'deepdanbooru'</span><span class="token punctuation">)</span>
</code></pre> 
<p>改为</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> modules <span class="token keyword">import</span> paths
default_ddp_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>paths<span class="token punctuation">.</span>models_path<span class="token punctuation">,</span> <span class="token string">'deepdanbooru'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="wdv14vittagger__53"></a>下载wd-v1-4-vit-tagger 模型权重</h4> 
<p>由于huggingface被墙了，需要手动下载，<a href="https://huggingface.co/SmilingWolf/wd-v1-4-vit-tagger/tree/main" rel="nofollow">URL</a>。下载这两项即可：</p> 
<p><img src="https://images2.imgbox.com/71/82/x9IC2w5f_o.png" alt="在这里插入图片描述"><br> 然后新建一个文件夹，将下载好的两个文件放在<code>.cache</code>下。</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /.cache/huggingface/hub
<span class="token function">mkdir</span> models--SmilingWolf--wd-v1-4-vit-tagger-v2
</code></pre> 
<p>然后修改<code>/stable-diffusion-webui/extensions/stable-diffusion-webui-wd14-tagger/tagger/interrogator.py</code>文件，在229行左右。</p> 
<pre><code class="prism language-python">model_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>hf_hub_download<span class="token punctuation">(</span>
    <span class="token operator">**</span>self<span class="token punctuation">.</span>kwargs<span class="token punctuation">,</span> filename<span class="token operator">=</span>self<span class="token punctuation">.</span>model_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
tags_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>hf_hub_download<span class="token punctuation">(</span>
    <span class="token operator">**</span>self<span class="token punctuation">.</span>kwargs<span class="token punctuation">,</span> filename<span class="token operator">=</span>self<span class="token punctuation">.</span>tags_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>改为下载后两个文件的绝对路径</p> 
<pre><code class="prism language-bash">model_path <span class="token operator">=</span> <span class="token string">"/.cache/huggingface/hub/models--SmilingWolf--wd-v1-4-vit-tagger-v2/model.onnx"</span>
tags_path <span class="token operator">=</span> <span class="token string">"/.cache/huggingface/hub/models--SmilingWolf--wd-v1-4-vit-tagger-v2/selected_tags.csv"</span>
</code></pre> 
<p>最后，运行<code>./webui.sh</code>，就可以正常使用tagger插件了！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d9836f26252baeea33cd5cee180da88a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio入门实战--实现数据库增删查改 备忘录实例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12752285858200d6e5e3829421ee0a15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Android】在Android中设置网络代理：一文详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>