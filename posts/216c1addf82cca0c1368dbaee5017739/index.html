<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2024 Flutter iOS 隐私清单上线，5 月 1 号最后期限，你收到 「ITMS-91053」 了吗？ - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/216c1addf82cca0c1368dbaee5017739/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="2024 Flutter iOS 隐私清单上线，5 月 1 号最后期限，你收到 「ITMS-91053」 了吗？">
  <meta property="og:description" content="2023 年底的时候，我就发过了 《Flutter 上了 Apple 第三方重大列表，2024 春季 iOS 的隐私清单究竟是什么？》 相关内容，如果你还对隐私清单等相关要求不了解，建议先看看前文。
如果你已经有相关了解，并且近期也提交过 App 到 App Store ，那么你可能已经收到过类似 「ITMS-91053」 的相关警告邮件，这就是隐私清单里的「必要理由的 API 声明」，也是隐私清单里最大家最容易遇到的问题之一，主要包括了：
File timestamp APIsSystem boot time APIsDisk space APIsActive keyboard APIsUser defaults APIs 邮件里也写明了，最后的要求期限是 5 月 1 号，所以正如去年说的那样，春季过去后，也是时候面对隐私清单的适配要求了。
实际上在 Flutter 进度里，官方和主流的插件基本都已经完成了隐私清单的适配要求，而目前主要出现在 Upcoming third-party SDK requirements 列表的插件，还没适配动静的应该就是 fluttertoast 了，尽管已经有了 PR #489 ，但是暂时还没有相关回应。
不过问题不大，最多自己 fork 一个 merge 下。
另外针对之前所说的，对于 “收集” 的定义目前很模糊的问题，类似 webview_flutter ，webview_flutter 本身不收集任何内容，但是App 可以用来 webview_flutter 收集浏览历史记录，然后这如何在 SDK 的隐私清单里去体现？
官方的回复是，如果SDK没有收集任何数据，那么应该提供一个隐私清单，概述没有收集任何信息，所以这也是 webview_flutter 等插件目前的适配逻辑之一。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-08T07:29:59+08:00">
    <meta property="article:modified_time" content="2024-05-08T07:29:59+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2024 Flutter iOS 隐私清单上线，5 月 1 号最后期限，你收到 「ITMS-91053」 了吗？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>2023 年底的时候，我就发过了 <a href="https://juejin.cn/post/7311876701909549065" rel="nofollow">《Flutter 上了 Apple 第三方重大列表，2024 春季 iOS 的隐私清单究竟是什么？》</a> 相关内容，如果你还对隐私清单等相关要求不了解，建议先看看前文。</p> 
<p>如果你已经有相关了解，并且近期也提交过 App 到 App Store ，那么你可能已经收到过类似 「ITMS-91053」 的相关警告邮件，这就是隐私清单里的「必要理由的 API 声明」，也是隐私清单里最大家最容易遇到的问题之一，主要包括了：</p> 
<ul><li>File timestamp APIs</li><li>System boot time APIs</li><li>Disk space APIs</li><li>Active keyboard APIs</li><li>User defaults APIs</li></ul> 
<p><img src="https://images2.imgbox.com/dd/1f/9T4tDoxZ_o.png" alt=""></p> 
<p>邮件里也写明了，<strong>最后的要求期限是 5 月 1 号，所以正如去年说的那样，春季过去后，也是时候面对隐私清单的适配要求了</strong>。</p> 
<p>实际上在 Flutter 进度里，官方和主流的插件基本都已经完成了隐私清单的适配要求，而目前主要出现在 <a href="https://developer.apple.com/support/third-party-SDK-requirements/" rel="nofollow">Upcoming third-party SDK requirements</a> 列表的插件，还没适配动静的应该就是 fluttertoast 了，尽管已经有了 <a href="https://github.com/ponnamkarthik/FlutterToast/pull/489">PR #489</a> ，但是暂时还没有相关回应。</p> 
<p><img src="https://images2.imgbox.com/88/3a/qEZa0Nuc_o.png" alt=""></p> 
<blockquote> 
 <p>不过问题不大，最多自己 fork 一个 merge 下。</p> 
</blockquote> 
<p>另外针对之前所说的，对于 “收集” 的定义目前很模糊的问题，类似 <code>webview_flutter</code> ，<code>webview_flutter</code> 本身不收集任何内容，但是App 可以用来 <code>webview_flutter</code> 收集浏览历史记录，然后这如何在 SDK 的隐私清单里去体现？</p> 
<p>官方的回复是，如果SDK没有收集任何数据，那么应该提供一个隐私清单，概述没有收集任何信息，所以这也是 <code>webview_flutter</code> 等插件目前的适配逻辑之一。</p> 
<p><img src="https://images2.imgbox.com/ce/33/L9rNs8gw_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/d7/84/yFxs6phJ_o.png" alt=""></p> 
<blockquote> 
 <p>没适配的插件，也可以考虑自己 fork 过来通过类似方式兼容。</p> 
</blockquote> 
<p>接着我们聊 「ITMS-91053」，如果你收到 <code>ITMS-91053: Missing API declaration - Your app’s code in the “Runner” file</code> ，首先要做的就是确定<strong>你的 Flutter SDK 是否升级到了 3.19</strong> ，因为 Engine 的适配官方是在 3.19 做的，当然，如果你就是想做「钉子户」，那么你也可以参考下方的 issue 和 pr ，自己 fork 个 engine 去适配支持：</p> 
<ul><li> <p><a href="https://github.com/flutter/engine/pull/48951/">#48951 Add xcprivacy privacy manifest to iOS framework</a></p> </li><li> <p><a href="https://github.com/flutter/flutter/issues/131494">#131494 Find Required Reason API usage in Flutter Engine and create Privacy Manifest</a></p> </li></ul> 
<p>另外，并不是看到 <code>Your app’s code in the “Runner” file </code> 就是说明是 Engine 的隐私清单有问题，因为构建方式也可能会影响到警告的提示。</p> 
<p>Flutter 3.19 本身已经有一个合规的隐私清单，如果你在 3.19 还能遇到 <code>ITMS-91053: Missing API declaration - Your app’s code in the “Runner” file</code>，官方表示可能是：</p> 
<ol><li>引入的插件有隐私清单 ( <code>podspec</code> 使用了 <code>s.static_framework = true</code> )，但目前你使用的是旧版本，所以需要更新插件</li><li>使用的插件没有声明隐私清单，或者隐私清单不完整</li></ol> 
<p>对于 1 的情况，可以将插件的依赖版本升级到最新，<strong>然后不要忘了运行一次 <code>flutter pub upgrade</code></strong> ，因为很多插件最近才添加清单支持，另外运行 <code>flutter pub upgrade</code> 的必要性在于：</p> 
<p>例如 <code>shared_preferences</code> 目前是 <code>2.2.2</code>，其清单文件是在其依赖的 <code>shared_preferences_foundation</code> 上 ，而 <code>shared_preferences_foundation</code> 在其内部依赖版本是 <code>^2.2.0</code> ，但是其实包含隐私清单的包是 <code>2.3.5</code> ，<strong>所以如果你不执行 <code>flutter pub upgrade</code> ，那么你本地的 <code>shared_preferences</code> 插件所使用的 foundation 依赖可能会是旧版本</strong>。</p> 
<p><img src="https://images2.imgbox.com/5c/8a/va7ElUC9_o.png" alt=""></p> 
<blockquote> 
 <p><strong>所以就算升级完插件后，查看插件里是否包含 privacy 文件也是非常重要的一个步骤</strong>。<img src="https://images2.imgbox.com/a8/90/AWfk9gKa_o.png" alt=""></p> 
</blockquote> 
<p>另外，对于项目的 <code>Podfile</code> 构建是否使用 <code>use_frameworks!</code> ，也是目前 「ITMS-91053」 警告的主要问题之一 ，为了更好区分和解决 「ITMS-91053」 的问题，官方建议：</p> 
<ol><li>一般建议使用 <code>use_frameworks!</code> ，或者插件的 podspec 配置 <code>static_framework = true</code> 为强制静态链接，正常情况下可以把出现的警告指向插件，然后沟通插件方配合解决问题，至少清楚问题在哪里。</li><li>如果因为构建等原因，无法使用 1 的方式，或者说可以不使用 1 ，那么可以直接在 App 端强制<a href="https://developer.apple.com/documentation/bundleresources/privacy_manifest_files#4284009" rel="nofollow">创建隐私清单</a> ，然后通过 <code>find build/ios/iphoneos -name *.xcprivacy </code> 在的项目中运行，对于所有 <code>&lt;some_plugin_name&gt;.bundle/PrivacyInfo.xcprivacy</code> 查看它们所做的声明，然后合并复制到上面创建的文件，然后自己补充缺少的。</li></ol> 
<p><strong>因为 Flutter 目前在处理 「ITMS-91053」 问题上，最难就是找到警告来自哪个插件，又是因为什么原因不符合</strong>， 例如一开始 <code>permission_handler_apple</code> 插件做了隐私清单申明，但是其实少了 <code>NSUserDefaults</code> ，因为它设置了 <code>static_framework = true</code>，所以导致 NSUserDefaults 代码位于 <code>Runner</code> ，一开始找问题的时候，因为它已经适配过了，大家都忽略了 <code>permission_handler</code> ，后来才发现，目前 <a href="https://github.com/Baseflow/flutter-permission-handler/issues/1292">flutter-permission-handler #1292</a> 已经修复了这个问题。</p> 
<p>最后，如果你在向官方提出相关 issue 时，例如在 <a href="https://github.com/flutter/flutter/issues/145269">#145269</a> 下提出相关问题的时候，最好是附上下列配置，以便于快速定位问题：</p> 
<ul><li><code>pubspec.yaml</code> 和 <code>pubspec.lock</code> ，特别是 <code>pubspec.lock</code></li><li><code>ios/Podfile</code></li><li>是否自己修改过 Runner 中的 native 代码</li><li>如果方便提供 <code>.ipa</code> 或 <code>.xcarchive</code></li></ul> 
<p>目前来说一些问题还是存在，而存在的原因基本是定位到是哪个插件，和如果理解这样做是否符合条款，目前 issue 都有人提供 create demo 包提交测试是否会触发 「ITMS-91053」，只能说大家都还在“以身试法”，前任种树后人乘凉，感兴趣的可以继续关注：</p> 
<ul><li> <p>https://github.com/flutter/flutter/issues/143232</p> </li><li> <p>https://github.com/flutter/flutter/issues/131940</p> </li><li> <p>https://github.com/flutter/flutter/issues/145269</p> </li></ul> 
<p>那么 ，5 月 1 号马上就要来了，你是继续做钉子户，还是升级到 Flutter 3.19 ？如果还有什么问题，欢迎交流讨论。</p> 
<h2><a id="5_81"></a>5月更新</h2> 
<p>目前，从 5 月 1 日开始强制执行的一系列内容会仅限于动态框架，不过预计插件的静态构建要求的强制执行会在未来回归。</p> 
<p><img src="https://images2.imgbox.com/8a/c3/YxtFNSFr_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/08/79/gCUcM8z5_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6b51c078a3ff7d16d97f1ec6dba6e48/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">红黑树（RBTree）认识总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b623730f12c9abeacd8b0bfcee93d390/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI大模型探索之路-训练篇17：大语言模型预训练-微调技术之QLoRA</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>