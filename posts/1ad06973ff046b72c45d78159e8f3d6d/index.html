<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10) - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/1ad06973ff046b72c45d78159e8f3d6d/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10)">
  <meta property="og:description" content="原文：Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10) - 知乎
阿里的FunAsr对Whisper中文领域的转写能力造成了一定的挑战，但实际上，Whisper的使用者完全可以针对中文的语音做一些优化的措施，换句话说，Whisper的“默认”形态可能在中文领域斗不过FunAsr，但是经过中文特殊优化的Whisper就未必了。
中文文本标注优化 Whisper经常被人诟病的一点是对中文语音转写后标点符号的支持不够完备。首先安装whisper:
pip install -U openai-whisper 编写转写脚本：
import whisper device = &#34;cuda:0&#34; if torch.cuda.is_available() else &#34;cpu&#34; audio = whisper.load_audio(audio_path) audio = whisper.pad_or_trim(audio) model = whisper.load_model(&#34;large-v2&#34;,download_root=&#34;./whisper_model/&#34;) mel = whisper.log_mel_spectrogram(audio).to(model.device) options = whisper.DecodingOptions(beam_size=5) result = whisper.decode(model, mel, options) print(result.text) 程序返回：
Erwin_0.wav|Erwin|ZH|如果这个作战顺利。 Erwin_1.wav|Erwin|ZH|你也许可以趁此机会干掉狩之巨人 Erwin_10.wav|Erwin|ZH|如果到時候我不衝在最前面 Erwin_11.wav|Erwin|ZH|他们根本不会往前冲然后我会第一个去死 Erwin_12.wav|Erwin|ZH|地下室里到底有什么 Erwin_13.wav|Erwin|ZH|也就无从知晓了好想去地下室看一看我之所以能撑着走到今天 Erwin_14.wav|Erwin|ZH|就是因为相信这一天的到来。 Erwin_15.wav|Erwin|ZH|因为艰辛着 Erwin_16.wav|Erwin|ZH|我才想能够得到证实 Erwin_17.wav|Erwin|ZH|我之前無數次的想過,要不然乾脆死了算了。 Erwin_18.wav|Erwin|ZH|可即便如此,我還是想要實現父親的夢想。 Erwin_19.wav|Erwin|ZH|然而现在 Erwin_2.wav|Erwin|ZH|但得拿所有新兵不管選擇哪條路 Erwin_20.wav|Erwin|ZH|她的答案就在我触手可及的地方 Erwin_21.wav|Erwin|ZH|仅在咫尺死去的同伴们也是如此吗 Erwin_22.wav|Erwin|ZH|那些流血的棲身,都是沒有意義的嗎? Erwin_23.wav|Erwin|ZH|不!不對! Erwin_24.wav|Erwin|ZH|那些死去士兵的意义将由我们来赋予 Erwin_25.wav|Erwin|ZH|那些勇敢的死者可憐的死者 Erwin_26.wav|Erwin|ZH|是他们的牺牲换来了我们活着的今天 Erwin_27.wav|Erwin|ZH|让我们能站在这里否则今天我们将会死去 Erwin_28.wav|Erwin|ZH|将依依托福给下一个活着的人 Erwin_29.wav|Erwin|ZH|这就是我们与这个残酷的世界 Erwin_3.wav|Erwin|ZH|我们基本都会死吧是的全灭的可能性相当的高 Erwin_30.wav|Erwin|ZH|抗爭的意義 Erwin_4.wav|Erwin|ZH|但事到如今,也只能做好玉石俱焚的觉悟。 Erwin_5.wav|Erwin|ZH|將一切賭在獲勝渺茫的戰術上 Erwin_6.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-03T17:24:26+08:00">
    <meta property="article:modified_time" content="2024-04-03T17:24:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><img alt="" height="799" src="https://images2.imgbox.com/c6/ab/19fTKRIo_o.png" width="1200"></h2> 
<p></p> 
<p>原文：<a href="https://zhuanlan.zhihu.com/p/679763812" rel="nofollow" title="Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10) - 知乎">Whisper对于中文语音识别与转写中文文本优化的实践(Python3.10) - 知乎</a></p> 
<p>阿里的FunAsr对Whisper中文领域的转写能力造成了一定的挑战，但实际上，Whisper的使用者完全可以针对中文的语音做一些优化的措施，换句话说，Whisper的“默认”形态可能在中文领域斗不过FunAsr，但是经过中文特殊优化的Whisper就未必了。</p> 
<h4>中文文本标注优化</h4> 
<p>Whisper经常被人诟病的一点是对中文语音转写后标点符号的支持不够完备。首先安装whisper:</p> 
<pre><code>pip install -U openai-whisper</code></pre> 
<p>编写转写脚本：</p> 
<pre><code>import whisper  
device = "cuda:0" if torch.cuda.is_available() else "cpu"
audio = whisper.load_audio(audio_path)  
audio = whisper.pad_or_trim(audio)

model = whisper.load_model("large-v2",download_root="./whisper_model/")

mel = whisper.log_mel_spectrogram(audio).to(model.device)

options = whisper.DecodingOptions(beam_size=5)

result = whisper.decode(model, mel, options)  
print(result.text)</code></pre> 
<p>程序返回：</p> 
<pre><code>Erwin_0.wav|Erwin|ZH|如果这个作战顺利。  
Erwin_1.wav|Erwin|ZH|你也许可以趁此机会干掉狩之巨人  
Erwin_10.wav|Erwin|ZH|如果到時候我不衝在最前面  
Erwin_11.wav|Erwin|ZH|他们根本不会往前冲然后我会第一个去死  
Erwin_12.wav|Erwin|ZH|地下室里到底有什么  
Erwin_13.wav|Erwin|ZH|也就无从知晓了好想去地下室看一看我之所以能撑着走到今天  
Erwin_14.wav|Erwin|ZH|就是因为相信这一天的到来。  
Erwin_15.wav|Erwin|ZH|因为艰辛着  
Erwin_16.wav|Erwin|ZH|我才想能够得到证实  
Erwin_17.wav|Erwin|ZH|我之前無數次的想過,要不然乾脆死了算了。  
Erwin_18.wav|Erwin|ZH|可即便如此,我還是想要實現父親的夢想。  
Erwin_19.wav|Erwin|ZH|然而现在  
Erwin_2.wav|Erwin|ZH|但得拿所有新兵不管選擇哪條路  
Erwin_20.wav|Erwin|ZH|她的答案就在我触手可及的地方  
Erwin_21.wav|Erwin|ZH|仅在咫尺死去的同伴们也是如此吗  
Erwin_22.wav|Erwin|ZH|那些流血的棲身,都是沒有意義的嗎?  
Erwin_23.wav|Erwin|ZH|不!不對!  
Erwin_24.wav|Erwin|ZH|那些死去士兵的意义将由我们来赋予  
Erwin_25.wav|Erwin|ZH|那些勇敢的死者可憐的死者  
Erwin_26.wav|Erwin|ZH|是他们的牺牲换来了我们活着的今天  
Erwin_27.wav|Erwin|ZH|让我们能站在这里否则今天我们将会死去  
Erwin_28.wav|Erwin|ZH|将依依托福给下一个活着的人  
Erwin_29.wav|Erwin|ZH|这就是我们与这个残酷的世界  
Erwin_3.wav|Erwin|ZH|我们基本都会死吧是的全灭的可能性相当的高  
Erwin_30.wav|Erwin|ZH|抗爭的意義  
Erwin_4.wav|Erwin|ZH|但事到如今,也只能做好玉石俱焚的觉悟。  
Erwin_5.wav|Erwin|ZH|將一切賭在獲勝渺茫的戰術上  
Erwin_6.wav|Erwin|ZH|到了这一步  
Erwin_7.wav|Erwin|ZH|要让那些年轻人们去死  
Erwin_8.wav|Erwin|ZH|就必须像一个一流的诈骗犯一样  
Erwin_9.wav|Erwin|ZH|对他们花言巧语一番</code></pre> 
<p>可以看到，除了语气特别强烈的素材，大部分都没有进行标点符号的标注。</p> 
<p>但事实上，Whisper完全可以针对中文进行标注，只需要添加对应的引导词：</p> 
<pre><code>options = whisper.DecodingOptions(beam_size=5,prompt="生于忧患，死于欢乐。不亦快哉！")</code></pre> 
<p>这里通过prompt对其进行引导，通过逗号、句号以及感叹号对文本标注，引导后的效果：</p> 
<pre><code>Erwin_0.wav|Erwin|ZH|如果这个作战顺利。  
Erwin_1.wav|Erwin|ZH|你也许可以趁此机会干掉受之虚人。  
Erwin_10.wav|Erwin|ZH|如果到时候我不冲在最前面  
Erwin_11.wav|Erwin|ZH|他们根本不会往前冲,然后我会第一个去死。  
Erwin_12.wav|Erwin|ZH|地下室里到底有什么?  
Erwin_13.wav|Erwin|ZH|好想去地下室看一看,我之所以能撑着走到今天。  
Erwin_14.wav|Erwin|ZH|就是因为相信这一天的到来。  
Erwin_15.wav|Erwin|ZH|因为艰辛着Ｄ  
Erwin_16.wav|Erwin|ZH|我的猜想能够得到证实。  
Erwin_17.wav|Erwin|ZH|我之前无数次地想过,要不然干脆死了算了。  
Erwin_18.wav|Erwin|ZH|可即便如此,我还是想要实现父亲的梦想。  
Erwin_19.wav|Erwin|ZH|然而现在  
Erwin_2.wav|Erwin|ZH|但得拿所有新兵,不管选择哪条路。  
Erwin_20.wav|Erwin|ZH|他的答案就在我触手可及的地方。  
Erwin_21.wav|Erwin|ZH|竟在咫尺。死去的同伴们也是如此吗?  
Erwin_22.wav|Erwin|ZH|那些流血的牺牲,都是没有意义的吗?  
Erwin_23.wav|Erwin|ZH|不!不对!  
Erwin_24.wav|Erwin|ZH|那些死去士兵的意义将由我们来赋予!  
Erwin_25.wav|Erwin|ZH|那些勇敢的死者,可怜的死者!  
Erwin_26.wav|Erwin|ZH|是他们的牺牲换来了我们活着的今天!  
Erwin_27.wav|Erwin|ZH|让我们能站在这里,而今天我们将会死去!  
Erwin_28.wav|Erwin|ZH|将依依托福给下一个活着的人!  
Erwin_29.wav|Erwin|ZH|这就是我们与这个残酷的世界。  
Erwin_3.wav|Erwin|ZH|是的,全灭的可能性相当的高。  
Erwin_30.wav|Erwin|ZH|抗争的意义!  
Erwin_4.wav|Erwin|ZH|但事到如今,也只能做好玉石俱焚的觉悟。  
Erwin_5.wav|Erwin|ZH|将一切赌在获胜渺茫的战术上。  
Erwin_6.wav|Erwin|ZH|到了这一步  
Erwin_7.wav|Erwin|ZH|要让那些年轻人们去死。  
Erwin_8.wav|Erwin|ZH|就必须像一个一流的诈骗犯一样。  
Erwin_9.wav|Erwin|ZH|对他们花言巧语一番。</code></pre> 
<h4>通过transformers来调用中文模型</h4> 
<p>transformers是一个用于自然语言处理（NLP）的开源库，由Hugging Face开发和维护。它提供了各种预训练的模型，包括文本生成、文本分类、命名实体识别等多种NLP任务的模型。transformers库基于Transformer模型架构，这是一种用于处理序列数据的深度学习模型。Transformer模型在NLP领域取得了巨大成功，因为它能够处理长距离依赖关系，并且在各种NLP任务上取得了优异的性能。</p> 
<p>使用transformers库，开发人员可以轻松地访问和使用各种预训练的NLP模型，也可以使用该库进行模型的微调和训练。transformers库支持多种主流深度学习框架，包括PyTorch和TensorFlow。</p> 
<p>首先安装transformers:</p> 
<pre><code>pip install -U transformers</code></pre> 
<p>编写转写代码：</p> 
<pre><code>from transformers import pipeline  

device = "cuda:0" if torch.cuda.is_available() else "cpu"  

def transcribe_bela(audio_path):  

    transcriber = pipeline(  
    "automatic-speech-recognition",   
    model="BELLE-2/Belle-whisper-large-v2-zh",  
    device=device  
    )  

    transcriber.model.config.forced_decoder_ids = (  
    transcriber.tokenizer.get_decoder_prompt_ids(  
        language="zh",   
        task="transcribe",  
    )  
    )  

    transcription = transcriber(audio_path)   

    print(transcription["text"])  
    return transcription["text"]</code></pre> 
<p>这里通过BELLE-2/Belle-whisper-large-v2-zh模型来进行转写，提高中文的识别准确度和效率。</p> 
<p>这个模型是在whisper的large-v2模型上针对中文进行了微调，以增强中文语音识别能力， Belle-whisper-large-v2-zh 在中国 ASR 基准测试（包括 AISHELL1、AISHELL2、WENETSPEECH 和 HKUST）上表现出 30-70% 的相对改进。</p> 
<p>该模型的官方地址：</p> 
<pre><code>https://huggingface.co/BELLE-2/Belle-whisper-large-v2-zh</code></pre> 
<p>当然，也不是没有缺陷，BELLE-2模型目前基于AISHELL、WENETSPEECH等数据做的微调，弱化了标点能力。</p> 
<p>换句话说，没法通过引导词来打标，但其实也有其他解决方案，即可以基于标点模型 对转写文本加标点。比如这个方案：</p> 
<pre><code>https://modelscope.cn/models/damo/punc_ct-transformer_cn-en-common-vocab471067-large/summary</code></pre> 
<p>BELLE-2模型的作者相当热心，有问必答，这是笔者对其模型提的Issues:</p> 
<pre><code>https://github.com/LianjiaTech/BELLE/issues/571</code></pre> 
<p>现在该模型的瓶颈是，如果微调带标点的中文数据，这块开源数据相对比较少，无法进行有效的训练。</p> 
<p>除了大模型的中文优化版本，也有针对small模型的中文优化版本：</p> 
<pre><code>https://huggingface.co/Jingmiao/whisper-small-chinese_base</code></pre> 
<h4>结语</h4> 
<p>Whisper开源模型通过transformers的微调，可以将预训练模型应用于特定的中文NLP任务，从而提高模型在该任务上的性能。微调使模型能够学习适应特定任务的特征和模式，从而实现更好的效果。</p> 
<p>发布于 2024-01-25 14:30・IP 属地北京</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86a7ca9975d3b9f4ab3fc622eaf3da17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2011-2023各省数字普惠金融指数（数据&#43;计算方法&#43;参考文献）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dd4fe8b873ce5074955a2312d2b0739b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android学习笔记（四）：TextView 设置内容、字体大小、颜色、背景</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>