<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Go 使用 MongoDB - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/098f5d8d0e435fdd97db7f79160bbfca/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Go 使用 MongoDB">
  <meta property="og:description" content="MongoDB 安装(Docker)安装 MongoDB Go 驱动使用 Go Driver 连接到 MongoDB在 Go 里面使用 BSON 对象CRUD 操作 插入文档更新文档查询文档删除文档 下一步 MongoDB 安装(Docker) 先装个 mongo，为了省事就用 docker 了。
docker 的 daemon.json 加一个国内的源地址：
&#34;registry-mirrors&#34;: [ &#34;http://hub-mirror.c.163.com&#34; ] 然后拉取 mongo 镜像:
docker pull mongodb 启动 mongo:
docker run -p 27017:27017 mongo 安装 MongoDB Go 驱动 go get go.mongodb.org/mongo-driver 基础代码 创建 main.go 文件，并且导入 bson，mongo 和 mongo/options 包。
package main import( &#34;context&#34; &#34;fmt&#34; &#34;log&#34; &#34;go.mongodb.org/mongo-driver/bson&#34; &#34;go.mongodb.org/mongo-driver/mongo&#34; &#34;go.mongodb.org/mongo-driver/mongo/options&#34; ) // 在后面的代码中将会使用这个 Trainer 结构体 type Trainer struct { Name string Age int City string } func main() { // } 使用 Go Driver 连接到 MongoDB 一旦 MongoDB 的 Go 驱动被导入之后，我们就可以使用 mongo.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-10T10:32:40+08:00">
    <meta property="article:modified_time" content="2024-05-10T10:32:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Go 使用 MongoDB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ul><li><a href="#MongoDB-%E5%AE%89%E8%A3%85-Docker" rel="nofollow">MongoDB 安装(Docker)</a></li><li><a href="#%E5%AE%89%E8%A3%85-MongoDB-Go-%E9%A9%B1%E5%8A%A8" rel="nofollow">安装 MongoDB Go 驱动</a></li><li><a href="#%E4%BD%BF%E7%94%A8-Go-Driver-%E8%BF%9E%E6%8E%A5%E5%88%B0-MongoDB" rel="nofollow">使用 Go Driver 连接到 MongoDB</a></li><li><a href="#%E5%9C%A8-Go-%E9%87%8C%E9%9D%A2%E4%BD%BF%E7%94%A8-BSON-%E5%AF%B9%E8%B1%A1" rel="nofollow">在 Go 里面使用 BSON 对象</a></li><li><a href="#CRUD-%E6%93%8D%E4%BD%9C" rel="nofollow">CRUD 操作</a> 
  <ul><li><a href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3" rel="nofollow">插入文档</a></li><li><a href="#%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3" rel="nofollow">更新文档</a></li><li><a href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3" rel="nofollow">查询文档</a></li><li><a href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3" rel="nofollow">删除文档</a></li></ul> </li><li><a href="#%E4%B8%8B%E4%B8%80%E6%AD%A5" rel="nofollow">下一步</a></li></ul> 
<h3><a id="MongoDB_Docker_13"></a>MongoDB 安装(Docker)</h3> 
<p>先装个 mongo，为了省事就用 docker 了。</p> 
<p>docker 的 daemon.json 加一个国内的源地址：</p> 
<pre><code class="prism language-json"><span class="token string-property property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"http://hub-mirror.c.163.com"</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>然后拉取 mongo 镜像:</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> pull mongodb
</code></pre> 
<p>启动 mongo:</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">27017</span>:27017 mongo
</code></pre> 
<h3><a id="_MongoDB_Go__38"></a>安装 MongoDB Go 驱动</h3> 
<pre><code class="prism language-shell">go get go.mongodb.org/mongo-driver
</code></pre> 
<h3><a id="_45"></a>基础代码</h3> 
<p>创建 main.go 文件，并且导入 <code>bson</code>，<code>mongo</code> 和 <code>mongo/options</code> 包。</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span><span class="token punctuation">(</span>
    <span class="token string">"context"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"log"</span>

    <span class="token string">"go.mongodb.org/mongo-driver/bson"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/mongo"</span>
    <span class="token string">"go.mongodb.org/mongo-driver/mongo/options"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 在后面的代码中将会使用这个 Trainer 结构体</span>
<span class="token keyword">type</span> Trainer <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
    City <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// </span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_Go_Driver__MongoDB_75"></a>使用 Go Driver 连接到 MongoDB</h3> 
<p>一旦 MongoDB 的 Go 驱动被导入之后，我们就可以使用 <code>mongo.Connect</code> 函数来连接到 MongoDB。你必须传递一个 <code>context</code> 和 <code>options.ClientOptions</code> 对象给 <code>mongo.Connect</code> 函数。<a href="https://godoc.org/go.mongodb.org/mongo-driver/mongo/options" rel="nofollow">options.ClientOptions</a> 被用来设置连接配置。</p> 
<pre><code class="prism language-go"><span class="token comment">// 设置连接参数</span>
clientOptions <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ApplyURI</span><span class="token punctuation">(</span><span class="token string">"mongodb://localhost:27017"</span><span class="token punctuation">)</span>

<span class="token comment">// 连接到 MongoDB</span>
client<span class="token punctuation">,</span> err <span class="token operator">:=</span> mongo<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> clientOptions<span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 检查连接</span>
err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Connected to MongoDB!"</span><span class="token punctuation">)</span>
</code></pre> 
<p>一旦你连接上了 MongoDB，你现在可以获取 test 数据库的 trainers 集合。</p> 
<pre><code class="prism language-go">collection <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Dataabse</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token string">"trainers"</span><span class="token punctuation">)</span>
</code></pre> 
<p>下面的代码将会使用 <code>collection</code> 来查询 <code>trainers</code> 集合。</p> 
<p>如果你不在需要查询 MongoDB，就可以使用 <code>client.Disconnect()</code> 来关闭 MongoDB 连接。</p> 
<pre><code class="prism language-go">err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Connection to MongoDB closed."</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_Go__BSON__120"></a>在 Go 里面使用 BSON 对象</h3> 
<p>在发送查询请求到 MongoDB 之前，了解如何使用 BSON 对象是非常有必要的。在 MongoDB 中存储的 JSON 文档叫 BSON，是以二进制形式存储的。不像其他数据库以字符串形式存储 JSOn 数据，BSON 还包含了字段类型，这使得应用程序更容易可靠地处理、排序和比较。Go 的 MongoDB 驱动有两个表示 BSON 数据的类型：D 类型和 Raw 类型。</p> 
<p>D 类型用于使用 Go 中的原始类型来构建 BSON 对象。这对于传递给 MongoDB 的命令特别有用。D 类型包括四种类型：</p> 
<ul><li> <p>D：一个 BSON 文档。</p> </li><li> <p>M：无序的 map。</p> </li><li> <p>A：一个 BSON 数组。</p> </li><li> <p>E：D 里面的单个元素。</p> </li></ul> 
<p>这里是一个使用 D 类型筛选文档的例子，这里会筛选出名字为 Alice 或者 Bob 的数据：</p> 
<pre><code class="prism language-go">bson<span class="token punctuation">.</span><span class="token function">D</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">"name"</span><span class="token punctuation">,</span>
    bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"$in"</span><span class="token punctuation">:</span> bson<span class="token punctuation">.</span>A<span class="token punctuation">{<!-- --></span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="CRUD__146"></a>CRUD 操作</h3> 
<p>一旦你连接到了数据库，我们就可以开始添加或者操作数据库中的数据了。<code>Collection</code> 类型有一些方法允许你发送查询到数据库中。</p> 
<h4><a id="_150"></a>插入文档</h4> 
<p>首先，创建一些新的 <code>Trainer</code> 结构体来插入到数据库中：</p> 
<pre><code class="prism language-go">ash <span class="token operator">:=</span> Trainer<span class="token punctuation">{<!-- --></span><span class="token string">"Ash"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"Pallet Town"</span><span class="token punctuation">}</span>
misty <span class="token operator">:=</span> Trainer<span class="token punctuation">{<!-- --></span><span class="token string">"Misty"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"Cerulean City"</span><span class="token punctuation">}</span>
brock <span class="token operator">:=</span> Trainer<span class="token punctuation">{<!-- --></span><span class="token string">"Brock"</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">"Pewter"</span> City<span class="token punctuation">}</span>
</code></pre> 
<p>可以使用 <code>collection.InsertOne()</code> 方法来插入单个文档：</p> 
<pre><code class="prism language-go">insertResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> collection<span class="token punctuation">.</span><span class="token function">InsertOne</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ash<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Inserted a single document: "</span><span class="token punctuation">,</span> insertResult<span class="token punctuation">.</span>InsertedID<span class="token punctuation">)</span>
</code></pre> 
<p>如果我们想一次性插入多个文档，可以传递一个切片给 <code>collection.InsertMany</code> 方法：</p> 
<pre><code class="prism language-go">trainers <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">{<!-- --></span>misty<span class="token punctuation">,</span> brock<span class="token punctuation">}</span>

insertManyResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> collection<span class="token punctuation">.</span><span class="token function">InsertMany</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trainers<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Inserted multiple documents: "</span><span class="token punctuation">,</span> insertManyResult<span class="token punctuation">.</span>InsertedIDs<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_184"></a>更新文档</h4> 
<p><code>collection.UpdateOne()</code> 方法允许你更新单个文档。它需要一个 <code>bson.D</code> 类型的参数来筛选数据库中特定的文档，然后更新它。</p> 
<pre><code class="prism language-go"><span class="token comment">// 筛选 name 字段的值为 Ash 的记录</span>
filter <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Ash"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// 更新 age 字段，值加 1</span>
update <span class="token operator">:=</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"$inc"</span><span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">{<!-- --></span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这几行代码会将数据库中名字为 Ash 的文档的 age 字段的值加 1。</p> 
<pre><code class="prism language-go">updateResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> collection<span class="token punctuation">.</span><span class="token function">UpdateOne</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filter<span class="token punctuation">,</span> update<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Matched %v documents and updated %v documents.\n"</span><span class="token punctuation">,</span> updateResult<span class="token punctuation">.</span>MatchedCount<span class="token punctuation">,</span> updateResult<span class="token punctuation">.</span>ModifiedCount<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_211"></a>查询文档</h4> 
<p>如果想要查询一个文档，同样需要提供一个 filter 文档来筛选，同时需要一个接收结果的指针。为了查询单个文档，可以使用 <code>collection.FindOne()</code> 方法。这个方法会返回一条匹配上的记录并解析到我们指针指向的地方。你可以使用和上面相同的 filter 来查询 name 为 Ash 的记录。</p> 
<pre><code class="prism language-go"><span class="token comment">// 创建一个变量用来接收解析后的结果</span>
<span class="token keyword">var</span> result Trainer

err <span class="token operator">=</span> collection<span class="token punctuation">.</span><span class="token function">FindOne</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Found a single document: %+v\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
</code></pre> 
<p>如果想要查询多个文档，可以使用 <code>collection.Find()</code> 方法。这个方法返回一个 <code>Cursor</code>（游标）。一个 <code>Cursor</code> （游标）可以让我们一次获取到其中一条记录。一旦一个游标遍历完毕，你应该关闭这个游标。</p> 
<p>下面的例子中，我们在 Find 的时候同时指定了额外的一些选项，这里我们设置最多获取的记录数为 2。</p> 
<pre><code class="prism language-go"><span class="token comment">// 这个选项会被传递给 Find 方法</span>
findOptions <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
findOptions<span class="token punctuation">.</span><span class="token function">SetLimit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// 这是用来保存查询结果的数组</span>
<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Trainer

<span class="token comment">// 传递 bson.D{<!-- -->{}} 作为 filter 来匹配 collection 中的所有文档</span>
cur<span class="token punctuation">,</span> err <span class="token operator">:=</span> collection<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> findOptions<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 查询多个文档的时候返回一个 cursor</span>
<span class="token comment">// 迭代这个 cursor 允许我们一次解码一个文档</span>
<span class="token keyword">for</span> cur<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 创建一个用来接收单个文档的变量</span>
    <span class="token keyword">var</span> elem Trainer
    err <span class="token operator">:=</span> cur<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>elem<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    results <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token operator">&amp;</span>elem<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> cur<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 一旦结束了获取数据的操作，我们需要关闭 cursor</span>
cur<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Found multiple documents (array of pointers): %+v\n"</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_268"></a>删除文档</h4> 
<p>最后，你可以使用 <code>collection.DeleteOne()</code> 或者 <code>collection.DeleteMany()</code> 来删除文档。这里传递了 <code>bson.D{ {} }</code> 作为 filter 参数，将会匹配集合中的所有文档。你也可以使用 <code>collection.Drop</code> 来删除整个集合。</p> 
<pre><code class="prism language-go">deleteResult<span class="token punctuation">,</span> err <span class="token operator">:=</span> collection<span class="token punctuation">.</span><span class="token function">DeleteMany</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bson<span class="token punctuation">.</span>D<span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Deleted %v documents in the trainers collection\n"</span><span class="token punctuation">,</span> deleteResult<span class="token punctuation">.</span>DeletedCount<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_281"></a>下一步</h3> 
<p>MongoDB Go 驱动的完整文档可以在 <a href="https://pkg.go.dev/go.mongodb.org/mongo-driver/mongo?tab=doc" rel="nofollow">pkg.go.dev</a> 中查看。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/76f834dd5267a70b729ec4cc42db21c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JavaScript中的深拷贝与浅拷贝详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b68fabb53e8d1b6d112aacf7e5a2d3d5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#进阶-OleDb操作Excel和数据库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>