<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>人工智能视觉：基于OpenCV的人脸识别技术的深度解析 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/346e13780987f388b56cbbb3e2e80aac/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="人工智能视觉：基于OpenCV的人脸识别技术的深度解析">
  <meta property="og:description" content="文章目录 🚀一、OpenCV简介🔥1. 安装 OpenCV 模块💥2. OpenCV 基本使用 🌈二、人脸检测🎬1. Haar 级联的概念🚀2. 使用 OpenCV 进行人脸检测🌈3. 视频中的人脸检测 🚀三、人脸识别🎬1. 基于 LBPH 的人脸识别 🚀一、OpenCV简介 OpenCV 的全称是 Open Source Computer Vision Library，是一个跨平台的计算机视觉库。OpenCV 是由英特尔公司发起并参与开发，以 BSD 许可证授权发行，可以在商业和研究领域中免费使用。OpenCV 可用于开发实时的图像处理、计算机视觉以及模式识别程序。该程序库也可以使用英特尔公司的 IPP 进行加速处理。
OpenCV 用 C&#43;&#43;语言编写，它的主要接口也是 C&#43;&#43;语言，但是依然保留了大量的 C 语言接口。该库也有大量的 Python、Java and MATLAB/OCTAVE（版本 2.5）的接口。这些语言的 API 接口函数可以通过在线文档获得。如今也提供对于 C#、Ch、Ruby、GO 的支持。
🔥1. 安装 OpenCV 模块 OpenCV 已经支持 python 的模块了，直接使用 pip 就可以进行安装，命令如下：
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple some-package
💥2. OpenCV 基本使用 ❤️读取图片
显示图像是 OpenCV 最基本的操作之一，imshow()函数可以实现该操作。如果使用过其他 GUI 框架背景，就会很自然第调用 imshow()来显示一幅图像。imshow()函数有两个参数：显示图像的帧名称以及要显示的图像本身。直接调用 imshow()函数图像确实会显示，但随即会消失。要保证图片一直在窗口上显示，要通过 waitKey()函数。waitKey()函数的参数为等待键盘触发的时间，单位为毫秒，其返回值是-1（表示没有键被按下）">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-19T11:57:53+08:00">
    <meta property="article:modified_time" content="2024-05-19T11:57:53+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">人工智能视觉：基于OpenCV的人脸识别技术的深度解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#OpenCV_1" rel="nofollow">🚀一、OpenCV简介</a></li><li><ul><li><a href="#1__OpenCV__7" rel="nofollow">🔥1. 安装 OpenCV 模块</a></li><li><a href="#2_OpenCV__11" rel="nofollow">💥2. OpenCV 基本使用</a></li></ul> 
    </li><li><a href="#_98" rel="nofollow">🌈二、人脸检测</a></li><li><ul><li><a href="#1_Haar__99" rel="nofollow">🎬1. Haar 级联的概念</a></li><li><a href="#2__OpenCV__116" rel="nofollow">🚀2. 使用 OpenCV 进行人脸检测</a></li><li><a href="#3__168" rel="nofollow">🌈3. 视频中的人脸检测</a></li></ul> 
    </li><li><a href="#_203" rel="nofollow">🚀三、人脸识别</a></li><li><ul><li><a href="#1__LBPH__261" rel="nofollow">🎬1. 基于 LBPH 的人脸识别</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="OpenCV_1"></a>🚀一、OpenCV简介</h4> 
<p><img src="https://images2.imgbox.com/78/f4/PClr1qc2_o.png" alt="在这里插入图片描述"><br> OpenCV 的全称是 Open Source Computer Vision Library，是一个跨平台的计算机视觉库。OpenCV 是由英特尔公司发起并参与开发，以 BSD 许可证授权发行，可以在商业和研究领域中免费使用。OpenCV 可用于开发实时的图像处理、计算机视觉以及模式识别程序。该程序库也可以使用英特尔公司的 IPP 进行加速处理。</p> 
<p>OpenCV 用 C++语言编写，它的主要接口也是 C++语言，但是依然保留了大量的 C 语言接口。该库也有大量的 Python、Java and MATLAB/OCTAVE（版本 2.5）的接口。这些语言的 API 接口函数可以通过在线文档获得。如今也提供对于 C#、Ch、Ruby、GO 的支持。</p> 
<h5><a id="1__OpenCV__7"></a>🔥1. 安装 OpenCV 模块</h5> 
<p>OpenCV 已经支持 python 的模块了，直接使用 pip 就可以进行安装，命令如下：</p> 
<blockquote> 
 <p><code>pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple some-package</code></p> 
</blockquote> 
<h5><a id="2_OpenCV__11"></a>💥2. OpenCV 基本使用</h5> 
<p><strong>❤️读取图片</strong><br> 显示图像是 OpenCV 最基本的操作之一，imshow()函数可以实现该操作。如果使用过其他 GUI 框架背景，就会很自然第调用 imshow()来显示一幅图像。imshow()函数有两个参数：显示图像的帧名称以及要显示的图像本身。直接调用 imshow()函数图像确实会显示，但随即会消失。要保证图片一直在窗口上显示，要通过 waitKey()函数。waitKey()函数的参数为等待键盘触发的时间，单位为毫秒，其返回值是-1（表示没有键被按下）</p> 
<p><strong>【示例】读取图片</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">print</span><span class="token punctuation">(</span>cv<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>  <span class="token comment"># 打印OpenCV版本</span>

<span class="token comment"># 加载图片</span>
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span>
<span class="token comment"># 打印图像类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token comment"># 等待时间, 毫米级, 0表示按任意键终止</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><font color="red"><strong>注意</strong>：</font>图片路径不能有<strong>中文</strong>，否则将导致图片加载失败。<br> <img src="https://images2.imgbox.com/a2/49/qEpTpLvL_o.png" alt="在这里插入图片描述"><br> <strong>☔图片灰度转换</strong><br> OpenCV 中有数百种关于在不同色彩空间之间转换的方法。当前，在计算机视觉中有三种常用的色彩空间：灰度、BGR、以及 HSV（Hue，Saturation，Value）。</p> 
<ol><li>灰度色彩空间是通过去除彩色信息来将其转换成灰阶，灰度色彩空间对中间处理特别有效，比如人脸识别。</li><li>BGR 及蓝、绿、红色彩空间，每一个像素点都由一个三元数组来表示，分别代表蓝、绿、红三种颜色。网页开发者可能熟悉另一个与之相似的颜色空间：RGB 它们只是颜色顺序上不同。</li><li>HSV，H（Hue）是色调，S（Saturation）是饱和度，V（Value）表示黑暗的程度（或光谱另一端的明亮程度）。</li></ol> 
<p>灰度转换的作用就是：转换成灰度的图片的<strong>计算强度得以降低</strong>。</p> 
<p><strong>【示例】将图片灰度</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 灰色显示</span>
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

src <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'input image'</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span>
<span class="token comment"># cv2 读取图片的通道是 BGR（蓝绿红）</span>
<span class="token comment"># PIL 读取图片的通道是 RGB</span>
gray_img <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>src<span class="token punctuation">,</span> code<span class="token operator">=</span>cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'gray_image'</span><span class="token punctuation">,</span> gray_img<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 保存图片</span>
cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'gray_lena.jpg'</span><span class="token punctuation">,</span> gray_img<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/5e/urFSAkh5_o.png" alt="在这里插入图片描述"></p> 
<p><strong>👊修改图片尺寸</strong><br> <strong>【示例】修改图片尺寸</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'input image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token comment"># 修改图片的尺寸</span>
<span class="token comment"># resize_img=cv.resize(img,dsize=(110,160))</span>
resize_img <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> dsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>resize_img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'resize_img'</span><span class="token punctuation">,</span> resize_img<span class="token punctuation">)</span>
<span class="token comment"># 如果键盘输入的是 q 时候 退出</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span> <span class="token operator">==</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/d5/8BXID1tp_o.png" alt="在这里插入图片描述"></p> 
<p><strong>🚲画图</strong><br> OpenCV 的强大之处的一个体现就是其可以对图片进行任意编辑，处理。 下面的这个函数最后一个参数指定的就是画笔的大小。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">)</span>
<span class="token comment"># 画矩形</span>
x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span>
cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># color=BGR</span>
cv<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">+</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token operator">=</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9b/2a/N3MU2MmG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_98"></a>🌈二、人脸检测</h4> 
<h5><a id="1_Haar__99"></a>🎬1. Haar 级联的概念</h5> 
<p>摄影作品可能包含很多令人愉悦的细节。但是，由于灯光、视角、视距、摄像头抖动以及数字噪声的变化，图像细节变得不稳定。人们在分类时不会受这些物理细节方面差异的影响。以前学过，在显微镜下没有两片看起来很像的雪花。幸运的是，作者生长在加拿大，已经学会如何不用显微镜来识别雪花。</p> 
<p>因此，提取出图像的细节对产生稳定分类结果和跟踪结果很有用。这些提取的结果被称为特征，专业的表述为：从图像数据中提取特征。虽然任意像素都可以能影响多个特征，但特征应该比像素少得多。两个图像的相似程度可以通过它们对应特征的欧氏距离来度量。</p> 
<p>Haar 特征是一种用于实现实时人脸跟踪的特征。每一个 Haar 特征都描述了相邻图像区域的对比模式。例如，边、顶点和细线都能生成具有判别性的特征。</p> 
<p><strong>⭐获取 Haar 级联数据</strong><br> 首先我们要进入 OpenCV 官网：https://opencv.org 下载你需要的版本。点击 RELEASES（发布）。如下图所示：<br> <img src="https://images2.imgbox.com/5b/88/Lp50x8UI_o.png" alt="在这里插入图片描述"><br> 由于 OpenCV 支持好多平台，比如 Windows, Android, Maemo, FreeBSD, OpenBSD, iOS, Linux 和 Mac OS，一般初学者都是用 windows，点击 Windows。<br> <img src="https://images2.imgbox.com/23/e4/ecKbHIHI_o.png" alt="在这里插入图片描述"><br> 然后双击下载的文件，进行安装，实质就是解压一下，解压完出来一个文件夹，其他什么也没发生。安装完后的目录结构如下。其中 build 是 OpenCV 使用时要用到的一些库文件，而 sources 中则是 OpenCV 官方为我们提供的一些 demo 示例源码。<br> <img src="https://images2.imgbox.com/3b/a8/wxhBvJbR_o.png" alt="在这里插入图片描述"><br> 在 sources 的一个文件夹 data/haarcascades。该文件夹包含了所有 OpenCV 的人脸检测的XML 文件，这些可用于检测静止图像、视频和摄像头所得到图像中的人脸。<br> <img src="https://images2.imgbox.com/e5/2d/IkTWBJqH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/df/53/kMLhNRBU_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2__OpenCV__116"></a>🚀2. 使用 OpenCV 进行人脸检测</h5> 
<p><strong>静态图像中人脸检测</strong><br> 人脸检测首先是加载图像并检测人脸，这也是最基本的一步。为了使所得到的结果有意义，可在原始图像的人脸周围绘制矩形框。</p> 
<p><strong>【示例】识别图片中的人脸</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

<span class="token keyword">def</span> <span class="token function">face_detect_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将图片转换为灰度图片</span>
    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 加载特征数据</span>
    face_detector <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">r'D:/opencv/sources/data/haarcascades/haarcascade_frontalface_alt_tree.xml'</span><span class="token punctuation">)</span>
    faces <span class="token operator">=</span> face_detector<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>

<span class="token comment"># 加载图片</span>
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'lena.jpg'</span><span class="token punctuation">)</span>
face_detect_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/cf/dJpwBkLz_o.png" alt="在这里插入图片描述"></p> 
<p><strong>【示例】识别图片中多张人脸</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

<span class="token keyword">def</span> <span class="token function">face_detect_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将图片灰度</span>
    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 加载特征数据</span>
    face_detector <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span><span class="token string">'D:/opencv/sources/data/haarcascades/haarcascade_frontalface_alt_tree.xml'</span><span class="token punctuation">)</span>
    faces <span class="token operator">=</span> face_detector<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> scaleFactor<span class="token operator">=</span><span class="token number">1.01</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
        cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># 显示图片</span>
    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>

<span class="token comment"># 加载图片</span>
img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'face3.jpg'</span><span class="token punctuation">)</span>
<span class="token comment"># 调用人脸检测方法</span>
face_detect_demo<span class="token punctuation">(</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/0a/2mAyw6qJ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3__168"></a>🌈3. 视频中的人脸检测</h5> 
<p>视频是一张一张图片组成的，在视频的帧上重复这个过程就能完成视频中的人脸检测。<br> <strong>【示例】识别视频中人脸</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv

<span class="token keyword">def</span> <span class="token function">face_detect_demo</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 将图片灰度</span>
    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># 加载特征数据</span>
    face_detector <span class="token operator">=</span> cv<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>
        <span class="token string">'D:/opencv/sources/data/haarcascades/haarcascade_frontalface_alt_tree.xml'</span><span class="token punctuation">)</span>
    faces <span class="token operator">=</span> face_detector<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
        cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        cv<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span>x <span class="token operator">+</span> w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> y <span class="token operator">+</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>

<span class="token comment"># 读取视频</span>
cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'video.mp4'</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    flag<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'flag:'</span><span class="token punctuation">,</span> flag<span class="token punctuation">,</span> <span class="token string">'frame.shape:'</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    face_detect_demo<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span> <span class="token operator">==</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/b1/sDtPpU8O_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_203"></a>🚀三、人脸识别</h4> 
<p>人脸检测是 OpenCV 的一个很不错的功能，它是人脸识别的基础。什么是人脸识别呢？<br> 其实就是一个程序能识别给定图像或视频中的人脸。实现这一目标的方法之一是用一系列分好类的图像来“训练”程序，并基于这些图像来进行识别。这就是 OpenCV 及其人脸识别模块进行人脸识别的过程。</p> 
<p>人脸识别模块的另外一个重要特征是：每个识别都具有转置信（confidence）评分，因此可在实际应用中通过对其设置阈值来进行筛选。</p> 
<p>为了对这些样本进行人脸识别，必须要在包含人脸的样本图像上进行人脸识别。这是一个学习的过程，但并不像自己提供的图像那样令人满意。</p> 
<p><strong>训练数据</strong><br> 有了数据，需要将这些样本图像加载到人脸识别算法中。所有的人脸识别算法在它们的train()函数中都有两个参数：图像数组和标签数组。这些标签表示进行识别时候某人人脸的ID，因此根据 ID 可以知道被识别的人是谁。要做到这一点，将在「trainer/」目录中保存为.yml文件。</p> 
<p>在使用 Python 3 &amp;OpenCV 3.0.0 进行人脸识别训练时发现异常：<br> AttributeError: ‘module’ object has no attribute ‘LBPHFaceRecognizer_create’OpenCV，需要安装 opencv-contrib-python 模块，直接使用 pip 就可以进行安装，命令如下：</p> 
<blockquote> 
 <p><code>pip install opencv-contrib-python</code></p> 
</blockquote> 
<p><strong>【示例】训练数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">getImageAndLabels</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    facesSamples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    imagePaths <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 检测人脸</span>
    face_detector <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>
        <span class="token string">'D:/opencv/sources/data/haarcascades/haarcascade_frontalface_default.xml'</span><span class="token punctuation">)</span>

    <span class="token comment"># 遍历列表中的图片</span>
    <span class="token keyword">for</span> imagePath <span class="token keyword">in</span> imagePaths<span class="token punctuation">:</span>
        <span class="token comment"># 打开图片</span>
        PIL_img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span>
        <span class="token comment"># 将图像转换为数组</span>
        img_numpy <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>PIL_img<span class="token punctuation">,</span> <span class="token string">'uint8'</span><span class="token punctuation">)</span>
        faces <span class="token operator">=</span> face_detector<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>img_numpy<span class="token punctuation">)</span>
        <span class="token comment"># 获取每张图片的id</span>
        <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>imagePath<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
            facesSamples<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_numpy<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span>
            ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> facesSamples<span class="token punctuation">,</span> ids


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 图片路径</span>
    path <span class="token operator">=</span> <span class="token string">'./data/jm/'</span>
    <span class="token comment"># 获取图像数组和id标签数组</span>
    faces<span class="token punctuation">,</span> ids <span class="token operator">=</span> getImageAndLabels<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token comment"># 获取训练对象</span>
    recognizer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>face<span class="token punctuation">.</span>LBPHFaceRecognizer_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
    recognizer<span class="token punctuation">.</span>train<span class="token punctuation">(</span>faces<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 保存文件</span>
    recognizer<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'trainer/trainer.yml'</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="1__LBPH__261"></a>🎬1. 基于 LBPH 的人脸识别</h5> 
<p>LBPH（Local Binary Pattern Histogram）将检测到的人脸分为小单元，并将其与模型中的对应单元进行比较，对每个区域的匹配值产生一个直方图。由于这种方法的灵活性，LBPH是唯一允许模型样本人脸和检测到的人脸在形状、大小上可以不同的人脸识别算法。<br> 调整后的区域中调用 predict()函数，该函数返回两个元素的数组：第一个元素是所识别个体的标签，第二个是置信度评分。所有的算法都有一个置信度评分阈值，置信度评分用来衡量所识别人脸与原模型的差距，0 表示完全匹配。可能有时不想保留所有的识别结果，则需要进一步处理，因此可用自己的算法来估算识别的置信度评分。LBPH 一个好的识别参考值要低于 50 ，任何高于 80 的参考值都会被认为是低的置信度评分。</p> 
<p><strong>【示例】基于 LBPH 的人脸识别</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os

<span class="token comment"># 加载训练数据集文件</span>
recogizer <span class="token operator">=</span> cv2<span class="token punctuation">.</span>face<span class="token punctuation">.</span>LBPHFaceRecognizer_create<span class="token punctuation">(</span><span class="token punctuation">)</span>
recogizer<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'trainer/trainer.yml'</span><span class="token punctuation">)</span>
<span class="token comment"># 准备识别的图片</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'3.pgm'</span><span class="token punctuation">)</span>
gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
face_detector <span class="token operator">=</span> cv2<span class="token punctuation">.</span>CascadeClassifier<span class="token punctuation">(</span>
    <span class="token string">'D:/opencv/sources/data/haarcascades/haarcascade_frontalface_default.xml'</span><span class="token punctuation">)</span>
faces <span class="token operator">=</span> face_detector<span class="token punctuation">.</span>detectMultiScale<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span class="token keyword">for</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> w<span class="token punctuation">,</span> y <span class="token operator">+</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># 人脸识别</span>
    <span class="token builtin">id</span><span class="token punctuation">,</span> confidence <span class="token operator">=</span> recogizer<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>gray<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'标签id:'</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> <span class="token string">'置信评分：'</span><span class="token punctuation">,</span> confidence<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31d418189308af79bfd07a3c6ff87332/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[JAVASE] 类和对象(四) - 多态</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f2a2344224c98d6d927028845e5bdc0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">土家风景文化|基于SSM＋vue的土家风景文化管理平台的设计与实现(源码&#43;数据库&#43;文档)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>