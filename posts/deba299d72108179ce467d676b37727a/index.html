<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€Javaã€‘å®ç°ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ±  - ç¼–ç¨‹å­¦ä¹ è€…</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/deba299d72108179ce467d676b37727a/">
  <meta property="og:site_name" content="ç¼–ç¨‹å­¦ä¹ è€…">
  <meta property="og:title" content="ã€Javaã€‘å®ç°ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± ">
  <meta property="og:description" content="ğŸ“ä¸ªäººä¸»é¡µï¼šå“ˆ__
æœŸå¾…æ‚¨çš„å…³æ³¨Â ç›®å½•
â€‹ç¼–è¾‘
ä¸€ã€çº¿ç¨‹æ± çš„æ¨¡å¼
äºŒã€çº¿ç¨‹æ± çš„ä¸€äº›å‚æ•°Â ä¸‰ã€ä»£ç å®ç°
1.BlockingQueue
2.ThreadPool
å››ã€æ‹’ç»ç­–ç•¥
ä¸€ã€çº¿ç¨‹æ± çš„æ¨¡å¼ çº¿ç¨‹æ± é¡¾åæ€ä¹‰å°±æ˜¯ç®¡ç†çº¿ç¨‹çš„ä¸€ä¸ªæ± å­ï¼Œæˆ‘ä»¬æŠŠåˆ›å»ºçº¿ç¨‹çš„è¿‡ç¨‹äº¤ç»™çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹éƒ½ä¼šä»é˜»å¡é˜Ÿåˆ—å½“ä¸­å–è·å–ä»»åŠ¡æ‰§è¡Œã€‚
æˆ‘ä»¬ä¸åœ¨ç›´æ¥æŠŠä»»åŠ¡çš„åˆ›å»ºè¿‡ç¨‹å†™åˆ°æˆ‘ä»¬åˆå§‹åŒ–çš„çº¿ç¨‹å¯¹è±¡ä¸­ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„execute()æ–¹æ³•ï¼ŒåŒæ—¶æŠŠæˆ‘ä»¬çš„å…·ä½“ä»»åŠ¡äº¤ä½œä¸ºå‚æ•°ä¼ ç»™çº¿ç¨‹æ± ï¼Œä¹‹åçº¿ç¨‹æ± å°±ä¼šæŠŠä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—å½“ä¸­ï¼Œè€Œçº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹ä¼šä»é˜»å¡é˜Ÿåˆ—å½“ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚
äºŒã€çº¿ç¨‹æ± çš„ä¸€äº›å‚æ•°Â corePoolSizeï¼šçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹å¤§å°ï¼Œå³æœ€å°çº¿ç¨‹æ•°ï¼ˆåˆå§‹åŒ–çº¿ç¨‹æ•°ï¼‰ã€‚çº¿ç¨‹æ± ä¼šç»´æŠ¤å½“å‰æ•°é‡çš„çº¿ç¨‹åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿è¿™äº›çº¿ç¨‹ä¸€ç›´å¤„äºé—²ç½®çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOutã€‚maximumPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚å½“ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä½†å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚keepAliveTimeï¼šç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ä¸”çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œåœ¨æŒ‡å®šæ—¶é—´åï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†ä¼šè¢«é”€æ¯ï¼Œä»è€Œé€æ¸æ¢å¤åˆ°ç¨³å®šçš„æ ¸å¿ƒçº¿ç¨‹æ•°æ•°é‡ã€‚unitï¼škeepAliveTimeçš„å­˜æ´»æ—¶é—´çš„è®¡é‡å•ä½ï¼Œé€šå¸¸ä½¿ç”¨TimeUnitæšä¸¾ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚TimeUnit.SECONDSè¡¨ç¤ºç§’çº§ã€‚workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ã€‚ç”¨äºå­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¸¸è§çš„å®ç°ç±»æœ‰LinkedBlockingQueueã€ArrayBlockingQueueç­‰ã€‚threadFactoryï¼šçº¿ç¨‹å·¥å‚ã€‚ç”¨äºåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹çš„åç§°ã€ä¼˜å…ˆçº§ç­‰ã€‚handlerï¼šæ‹’ç»ç­–ç•¥ã€‚å½“ä»»åŠ¡æ— æ³•æ‰§è¡Œï¼ˆå¦‚çº¿ç¨‹æ± å·²æ»¡ï¼‰æ—¶ï¼Œå¯ä»¥é€‰æ‹©çš„ç­–ç•¥æœ‰ï¼šAbortPolicyï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ã€CallerRunsPolicyï¼ˆè°ƒç”¨è€…è¿è¡Œï¼‰ã€DiscardOldestPolicyï¼ˆä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ï¼‰ã€DiscardPolicyï¼ˆæ— å£°ä¸¢å¼ƒï¼‰ã€‚ ä¸‰ã€ä»£ç å®ç° å› ä¸ºæˆ‘ä»¬åªæ˜¯ç®€å•çš„å®ç°ï¼Œæ‰€ä»¥æœ‰ä¸€äº›æƒ…å†µå’Œå®é™…ä¸å¤ªç›¸ä¼¼ã€‚
1.BlockingQueue å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬é˜»å¡é˜Ÿåˆ—å½“ä¸­çš„ä¸€äº›å‚æ•°ï¼Œä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é˜²æ­¢å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨äº†ReentrantLockï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†åˆ›å»ºå¤šä¸ªä¸åŒçš„é˜»å¡æ¡ä»¶ã€‚
åœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„await()æ–¹æ³•åï¼Œæˆ‘ä»¬çš„å½“å‰çº¿ç¨‹å°±ä¼šåŠ å…¥åˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—å½“ä¸­å»ç­‰å¾…ï¼Œç›´åˆ°æœ‰è°ƒç”¨äº†è¿™ä¸ªå¯¹è±¡çš„notify()æ–¹æ³•åæ‰ä¼šä»è¿™ä¸ªé˜Ÿåˆ—ä¸­æŠ½å–ä¸€ä¸ªçº¿ç¨‹å”¤é†’ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å»åŒ»é™¢çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒ»ç”ŸåŒä¸€æ—¶é—´åªèƒ½çœ‹ä¸€ä¸ªç—…äººï¼Œå‰©ä¸‹çš„äººéƒ½åªèƒ½ç­‰å¾…ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå¤§å…çš„è¯ï¼Œçœ‹ä¸åŒç—…çš„ç—…äººéƒ½åªèƒ½ç­‰å¾…åœ¨ä¸€ä¸ªå€™è¯Šå®¤ä¸­ã€‚ä½¿ç”¨ReentrentLockçš„æ„æ€å°±æ˜¯ä¸ºäº†åˆ›å»ºå¤šä¸ªä¸åŒçš„å€™è¯Šå®¤ï¼Œå°†ä¸åŒåŒ»ç”Ÿçš„ç—…äººåˆ†å¼€åœ¨ä¸åŒçš„å€™è¯Šå®¤å½“ä¸­ã€‚
//1.é˜»å¡é˜Ÿåˆ— private Deque&lt;T&gt; deque = new ArrayDeque&lt;&gt;(); //2.å®ç°é˜»å¡çš„é” private ReentrantLock lock = new ReentrantLock(); //3. ç”Ÿäº§è€…ç­‰å¾…æ¡ä»¶ private Condition fullWaitSet = lock.newCondition(); //4.æ¶ˆè´¹è€…ç­‰å¾…æ¡ä»¶ private Condition emptyWaitSet = lock.newCondition(); //5.é˜»å¡é˜Ÿåˆ—çš„å¤§å° private int CAPACITY; åœ¨è‡ªå®šä¹‰çš„é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼Œå¹¶ä¸”è®¾ç½®äº†ä¸€ä¸ªé˜Ÿåˆ—å¤§å°çš„å±æ€§ï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆå§‹åŒ–ã€‚
å…ˆæ¥çœ‹çœ‹é˜»å¡é˜Ÿåˆ—ä»»åŠ¡çš„æ·»åŠ è¿‡ç¨‹ã€‚è¿™ä¸ªé€»è¾‘å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬åœ¨ä»£ç çš„ä¸Šæ–¹ä¸Šé”ï¼Œåœ¨finallyä¸­è§£é”ã€‚å¦‚æœè¿™æ—¶æˆ‘ä»¬çš„é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œå°±æ— æ³•åœ¨ç»§ç»­æ·»åŠ ä»»åŠ¡äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼ˆæ³¨æ„æˆ‘ä»¬çš„æŒ‚èµ·æ¡ä»¶ï¼‰ã€‚å¦‚æœé˜Ÿåˆ—ä¸æ˜¯æ»¡çš„è¯é‚£æˆ‘ä»¬å°±åŠ å…¥åˆ°é˜Ÿå°¾ï¼ŒåŒæ—¶æŠŠå¦ä¸€ç±»æŒ‚èµ·çš„çº¿ç¨‹å”¤é†’ï¼ˆè¿™ç±»çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™æŒ‚èµ·ï¼Œç­‰å¾…ä»»åŠ¡çš„æ·»åŠ ï¼‰ã€‚
// ç”Ÿäº§è€…æ”¾å…¥æ•°æ® public void put(T t) { lock.lock(); try { while (deque.size() == CAPACITY) { fullWaitSet.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-30T17:22:41+08:00">
    <meta property="article:modified_time" content="2024-04-30T17:22:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å­¦ä¹ è€…" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å­¦ä¹ è€…</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€Javaã€‘å®ç°ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± </h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="150" src="https://images2.imgbox.com/29/d3/HsLhs4Nu_o.png" width="150"></p> 
<p style="text-align:center;">Â <strong>Â ğŸ“ä¸ªäººä¸»é¡µï¼š<a class="link-info" href="https://blog.csdn.net/qq_61024956?type=blog" title="å“ˆ__">å“ˆ__</a></strong></p> 
<p style="text-align:center;"><span style="color:#fe2c24;">æœŸå¾…æ‚¨çš„å…³æ³¨Â </span></p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91" style="text-align:center;"><img alt="" height="100" src="https://images2.imgbox.com/b5/b5/JnVDRG0s_o.gif" width="1000"></h2> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91-toc" style="margin-left:0px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91" rel="nofollow">â€‹ç¼–è¾‘</a></p> 
<p id="%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A8%A1%E5%BC%8F-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A8%A1%E5%BC%8F" rel="nofollow">ä¸€ã€çº¿ç¨‹æ± çš„æ¨¡å¼</a></p> 
<p id="%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0%C2%A0" rel="nofollow">äºŒã€çº¿ç¨‹æ± çš„ä¸€äº›å‚æ•°Â </a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" rel="nofollow">ä¸‰ã€ä»£ç å®ç°</a></p> 
<p id="1.BlockingQueue-toc" style="margin-left:40px;"><a href="#1.BlockingQueue" rel="nofollow">1.BlockingQueue</a></p> 
<p id="2.ThreadPool-toc" style="margin-left:40px;"><a href="#2.ThreadPool" rel="nofollow">2.ThreadPool</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5" rel="nofollow">å››ã€æ‹’ç»ç­–ç•¥</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A8%A1%E5%BC%8F">ä¸€ã€çº¿ç¨‹æ± çš„æ¨¡å¼</h2> 
<p>çº¿ç¨‹æ± é¡¾åæ€ä¹‰å°±æ˜¯ç®¡ç†çº¿ç¨‹çš„ä¸€ä¸ªæ± å­ï¼Œæˆ‘ä»¬æŠŠåˆ›å»ºçº¿ç¨‹çš„è¿‡ç¨‹äº¤ç»™çº¿ç¨‹æ± æ¥å¤„ç†ï¼Œè€Œè¿™ä¸ªçº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹éƒ½ä¼šä»é˜»å¡é˜Ÿåˆ—å½“ä¸­å–è·å–ä»»åŠ¡æ‰§è¡Œã€‚</p> 
<p>æˆ‘ä»¬ä¸åœ¨ç›´æ¥æŠŠä»»åŠ¡çš„åˆ›å»ºè¿‡ç¨‹å†™åˆ°æˆ‘ä»¬åˆå§‹åŒ–çš„çº¿ç¨‹å¯¹è±¡ä¸­ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„execute()æ–¹æ³•ï¼ŒåŒæ—¶æŠŠæˆ‘ä»¬çš„å…·ä½“ä»»åŠ¡äº¤ä½œä¸ºå‚æ•°ä¼ ç»™çº¿ç¨‹æ± ï¼Œä¹‹åçº¿ç¨‹æ± å°±ä¼šæŠŠä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—å½“ä¸­ï¼Œè€Œçº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹ä¼šä»é˜»å¡é˜Ÿåˆ—å½“ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p> 
<p><img alt="" height="453" src="https://images2.imgbox.com/ee/47/EDbJJ0Gw_o.png" width="1200"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0%C2%A0">äºŒã€çº¿ç¨‹æ± çš„ä¸€äº›å‚æ•°Â </h2> 
<ol><li><strong>corePoolSize</strong>ï¼šçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹å¤§å°ï¼Œå³æœ€å°çº¿ç¨‹æ•°ï¼ˆåˆå§‹åŒ–çº¿ç¨‹æ•°ï¼‰ã€‚çº¿ç¨‹æ± ä¼šç»´æŠ¤å½“å‰æ•°é‡çš„çº¿ç¨‹åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿è¿™äº›çº¿ç¨‹ä¸€ç›´å¤„äºé—²ç½®çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOutã€‚</li><li><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚å½“ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± åï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œä½†å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚</li><li><strong>keepAliveTime</strong>ï¼šç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ä¸”çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œåœ¨æŒ‡å®šæ—¶é—´åï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹å°†ä¼šè¢«é”€æ¯ï¼Œä»è€Œé€æ¸æ¢å¤åˆ°ç¨³å®šçš„æ ¸å¿ƒçº¿ç¨‹æ•°æ•°é‡ã€‚</li><li><strong>unit</strong>ï¼škeepAliveTimeçš„å­˜æ´»æ—¶é—´çš„è®¡é‡å•ä½ï¼Œé€šå¸¸ä½¿ç”¨TimeUnitæšä¸¾ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚TimeUnit.SECONDSè¡¨ç¤ºç§’çº§ã€‚</li><li><strong>workQueue</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ã€‚ç”¨äºå­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¸¸è§çš„å®ç°ç±»æœ‰LinkedBlockingQueueã€ArrayBlockingQueueç­‰ã€‚</li><li><strong>threadFactory</strong>ï¼šçº¿ç¨‹å·¥å‚ã€‚ç”¨äºåˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œå¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹çš„åç§°ã€ä¼˜å…ˆçº§ç­‰ã€‚</li><li><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ã€‚å½“ä»»åŠ¡æ— æ³•æ‰§è¡Œï¼ˆå¦‚çº¿ç¨‹æ± å·²æ»¡ï¼‰æ—¶ï¼Œå¯ä»¥é€‰æ‹©çš„ç­–ç•¥æœ‰ï¼šAbortPolicyï¼ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ã€CallerRunsPolicyï¼ˆè°ƒç”¨è€…è¿è¡Œï¼‰ã€DiscardOldestPolicyï¼ˆä¸¢å¼ƒæœ€è€çš„ä»»åŠ¡ï¼‰ã€DiscardPolicyï¼ˆæ— å£°ä¸¢å¼ƒï¼‰ã€‚</li></ol> 
<h2 id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">ä¸‰ã€ä»£ç å®ç°</h2> 
<p>å› ä¸ºæˆ‘ä»¬åªæ˜¯ç®€å•çš„å®ç°ï¼Œæ‰€ä»¥æœ‰ä¸€äº›æƒ…å†µå’Œå®é™…ä¸å¤ªç›¸ä¼¼ã€‚</p> 
<h3 id="1.BlockingQueue">1.BlockingQueue</h3> 
<p>å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬é˜»å¡é˜Ÿåˆ—å½“ä¸­çš„ä¸€äº›å‚æ•°ï¼Œä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é˜²æ­¢å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä½¿ç”¨äº†ReentrantLockï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†åˆ›å»ºå¤šä¸ªä¸åŒçš„é˜»å¡æ¡ä»¶ã€‚</p> 
<p>åœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„await()æ–¹æ³•åï¼Œæˆ‘ä»¬çš„å½“å‰çº¿ç¨‹å°±ä¼šåŠ å…¥åˆ°ä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—å½“ä¸­å»ç­‰å¾…ï¼Œç›´åˆ°æœ‰è°ƒç”¨äº†è¿™ä¸ªå¯¹è±¡çš„notify()æ–¹æ³•åæ‰ä¼šä»è¿™ä¸ªé˜Ÿåˆ—ä¸­æŠ½å–ä¸€ä¸ªçº¿ç¨‹å”¤é†’ã€‚</p> 
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å»åŒ»é™¢çš„æ—¶å€™ï¼Œä¸€ä¸ªåŒ»ç”ŸåŒä¸€æ—¶é—´åªèƒ½çœ‹ä¸€ä¸ªç—…äººï¼Œå‰©ä¸‹çš„äººéƒ½åªèƒ½ç­‰å¾…ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå¤§å…çš„è¯ï¼Œçœ‹ä¸åŒç—…çš„ç—…äººéƒ½åªèƒ½ç­‰å¾…åœ¨ä¸€ä¸ªå€™è¯Šå®¤ä¸­ã€‚ä½¿ç”¨ReentrentLockçš„æ„æ€å°±æ˜¯ä¸ºäº†åˆ›å»ºå¤šä¸ªä¸åŒçš„å€™è¯Šå®¤ï¼Œå°†ä¸åŒåŒ»ç”Ÿçš„ç—…äººåˆ†å¼€åœ¨ä¸åŒçš„å€™è¯Šå®¤å½“ä¸­ã€‚</p> 
<pre><code class="language-java">    //1.é˜»å¡é˜Ÿåˆ—
    private Deque&lt;T&gt; deque = new ArrayDeque&lt;&gt;();
    //2.å®ç°é˜»å¡çš„é”
    private ReentrantLock lock = new ReentrantLock();
    //3. ç”Ÿäº§è€…ç­‰å¾…æ¡ä»¶
    private Condition fullWaitSet = lock.newCondition();
    //4.æ¶ˆè´¹è€…ç­‰å¾…æ¡ä»¶
    private Condition emptyWaitSet = lock.newCondition();
    //5.é˜»å¡é˜Ÿåˆ—çš„å¤§å°
    private  int CAPACITY;</code></pre> 
<p>åœ¨è‡ªå®šä¹‰çš„é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªåŒå‘é˜Ÿåˆ—æ¥å­˜å‚¨ä»»åŠ¡ï¼Œå¹¶ä¸”è®¾ç½®äº†ä¸€ä¸ªé˜Ÿåˆ—å¤§å°çš„å±æ€§ï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆå§‹åŒ–ã€‚</p> 
<p><strong>å…ˆæ¥çœ‹çœ‹é˜»å¡é˜Ÿåˆ—ä»»åŠ¡çš„æ·»åŠ è¿‡ç¨‹ã€‚</strong>è¿™ä¸ªé€»è¾‘å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬åœ¨ä»£ç çš„ä¸Šæ–¹ä¸Šé”ï¼Œåœ¨finallyä¸­è§£é”ã€‚å¦‚æœè¿™æ—¶æˆ‘ä»¬çš„é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œå°±æ— æ³•åœ¨ç»§ç»­æ·»åŠ ä»»åŠ¡äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·<strong>ï¼ˆæ³¨æ„æˆ‘ä»¬çš„æŒ‚èµ·æ¡ä»¶ï¼‰</strong>ã€‚å¦‚æœé˜Ÿåˆ—ä¸æ˜¯æ»¡çš„è¯é‚£æˆ‘ä»¬å°±åŠ å…¥åˆ°é˜Ÿå°¾ï¼ŒåŒæ—¶æŠŠå¦ä¸€ç±»æŒ‚èµ·çš„çº¿ç¨‹å”¤é†’<strong>ï¼ˆè¿™ç±»çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™æŒ‚èµ·ï¼Œç­‰å¾…ä»»åŠ¡çš„æ·»åŠ ï¼‰</strong>ã€‚</p> 
<p></p> 
<pre><code class="language-java"> // ç”Ÿäº§è€…æ”¾å…¥æ•°æ®
    public void put(T t) {
        lock.lock();
        try {
            while (deque.size() == CAPACITY) {
                fullWaitSet.await();
            }
            deque.addLast(t);
            emptyWaitSet.signal();
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }</code></pre> 
<p><strong>åœ¨çœ‹çœ‹æˆ‘ä»¬å–ä»»åŠ¡çš„è¿‡ç¨‹</strong>ã€‚åŒæ ·åŠ é”ï¼Œå½“æˆ‘ä»¬çš„é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…ä»»åŠ¡çš„æ·»åŠ ä¹‹åçº¿ç¨‹å”¤é†’ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºçš„è¯ï¼Œæˆ‘ä»¬ä»é˜Ÿåˆ—å¤´éƒ¨å–å‡ºä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”å”¤èµ·ä¸€ç±»çº¿ç¨‹<strong>ï¼ˆè¿™ç±»çº¿ç¨‹åœ¨ä»»åŠ¡å·²ç»æ»¡äº†çš„æ—¶å€™æ— æ³•åœ¨æ·»åŠ ä»»åŠ¡äº†ï¼Œè¿›è¡ŒæŒ‚èµ·ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸ä¸ºæ»¡ï¼‰</strong>ã€‚</p> 
<pre><code class="language-java">  // æ¶ˆè´¹è€…ä»çº¿ç¨‹æ± å½“ä¸­è·å–ä»»åŠ¡
    public T take(){
        T t = null;
        lock.lock();
        try {
            while(deque.size() == 0){
                emptyWaitSet.await();
            }
            t = deque.removeFirst();
            fullWaitSet.signal();
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            lock.unlock();
        }
        return t;
    }</code></pre> 
<p>æˆ‘ä»¬ä¸Šè¾¹çš„ä»£ç å±•ç¤ºçš„é˜Ÿåˆ—çš„å­˜å–çš„è¿‡ç¨‹éƒ½æ˜¯æ­»ç­‰çŠ¶æ€ï¼Œä»€ä¹ˆæ˜¯æ­»ç­‰çŠ¶æ€ï¼Ÿå°±æ˜¯ä»»åŠ¡æ·»åŠ ä¸è¿›å»æˆ–è€…å–ä¸å‡ºæ¥çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šè¢«ä¸€ç›´æŒ‚èµ·ã€‚çœŸå®å¹¶ä¸æ˜¯å¦‚æ­¤ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„å±•ç¤ºã€‚</p> 
<p>é˜»å¡é˜Ÿåˆ—éœ€è¦çš„å°±æ˜¯è¿™ä¸¤ä¸ªå­˜å–çš„è¿‡ç¨‹ã€‚</p> 
<h3 id="2.ThreadPool">2.ThreadPool</h3> 
<p>å…ˆçœ‹çœ‹çº¿ç¨‹æ± å½“ä¸­çš„å±æ€§ã€‚æŠŠåˆšæ‰åˆ›å»ºçš„ä»»åŠ¡é˜Ÿåˆ—åŠ è¿›å»ï¼Œå› ä¸ºçº¿ç¨‹æ± è¦æ—¶å¸¸å’Œä»»åŠ¡é˜Ÿåˆ—æ²Ÿé€šã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªHashSetç»“æ„ç”¨äºå­˜å‚¨æˆ‘ä»¬çš„çº¿ç¨‹ã€‚ä¸‹è¾¹çš„éƒ½æ˜¯æˆ‘ä»¬çº¿ç¨‹æ± éœ€è¦çš„ä¸€äº›å‚æ•°äº†ï¼Œæ‹’ç»ç­–ç•¥åœ¨è¿™é‡Œæ²¡æœ‰å†™ã€‚</p> 
<pre><code class="language-java">    // ä»»åŠ¡é˜Ÿåˆ—
    private BlockedQueue&lt;Runnable&gt; taskQueue;

    // çº¿ç¨‹é›†åˆ
    private HashSet&lt;Worker&gt; workers = new HashSet&lt;&gt;();

    //æ ¸å¿ƒçº¿ç¨‹æ•°
    private int coreSize;

    // è¶…æ—¶æ—¶é—´
    private int timeout;

    // è¶…æ—¶å•ä½
    private TimeUnit timeUnit;
</code></pre> 
<p>æ¥çœ‹çœ‹æˆ‘ä»¬çš„çº¿ç¨‹æ± æ˜¯å¦‚ä½•å·¥ä½œçš„å§ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çº¿ç¨‹æ± ä¿å­˜çš„æ˜¯Workerå¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªWorkerå¯¹è±¡æ˜¯å¹²å•¥çš„ã€‚è¿™ä¸ªWorkerå¯¹è±¡å®ç°äº†Runnableæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç±»å½“ä½œçº¿ç¨‹ç±»ï¼Œè¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªtaskå±æ€§ï¼Œå› ä¸ºæˆ‘ä»¬çº¿ç¨‹æ± å½“ä¸­çš„çº¿ç¨‹æ˜¯è¦è·å–ä»»åŠ¡æ‰§è¡Œçš„ï¼Œè¿™ä¸ªä»»åŠ¡å°±ç”¨è¿™ä¸ªtaskå±æ€§ä»£è¡¨ã€‚</p> 
<p>è¿™ä¸ªWorkerç±»ä¸€ç›´åœ¨å¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ä¸æ–­åœ°ä»æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­è·å–ä»»åŠ¡ï¼ˆWorkerç±»æ˜¯ThreadPoolçš„å†…éƒ¨ç±»ï¼‰ï¼Œå¦‚æœè·å–çš„ä»»åŠ¡ä¸ä¸ºç©ºçš„è¯å°±æ‰§è¡Œä»»åŠ¡ï¼Œä¸€æ—¦æ²¡æœ‰ä»»åŠ¡å¯ä»¥æ‰§è¡Œé‚£ä¹ˆå°±æŠŠå½“å‰çš„çº¿ç¨‹ä»çº¿ç¨‹æ± å½“ä¸­ç§»é™¤ã€‚</p> 
<pre><code class="language-java">class Worker implements Runnable{
        private Runnable task;
        public Worker(Runnable task){
            this.task = task;
        }
        @Override
        public void run() {
            while(task!=null || (task = taskQueue.take())!=null){
                System.out.println("å–å‡ºçš„ä»»åŠ¡æ˜¯"+task);
                try {
                    task.run();
                }catch (Exception e){
                    e.printStackTrace();
                }finally {
                    task = null;
                }
                synchronized (workers){
                    workers.remove(this);
                }
            }
        }
    }</code></pre> 
<p>é‚£ä»€ä¹ˆæ—¶å€™ç”¨åˆ°è¿™ä¸ªWorkerç±»å‘¢ï¼Ÿå½“æˆ‘ä»¬è°ƒç”¨ThreadPoolä¸­çš„execute()æ–¹æ³•æ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¼šå°±è°ƒç”¨è¿™ä¸ªrun()æ–¹æ³•ã€‚</p> 
<p>æ¥çœ‹æˆ‘ä»¬çš„execute()æ–¹æ³•ã€‚å½“æˆ‘ä»¬çš„çº¿ç¨‹æ•°å°äºæˆ‘ä»¬çš„æ ¸å¿ƒçº¿ç¨‹æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä¸”æŠŠæˆ‘ä»¬çš„ä»»åŠ¡ç›´æ¥äº¤ç»™è¿™ä¸ªæ ¸å¿ƒçº¿ç¨‹ã€‚åä¹‹æˆ‘ä»¬ä¸èƒ½åˆ›å»ºï¼Œè€Œæ˜¯æŠŠä»»åŠ¡æ·»åŠ åˆ°æˆ‘ä»¬çš„ä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ï¼Œç­‰å¾…æ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚</p> 
<pre><code class="language-java"> // ä»»åŠ¡æ‰§è¡Œ
    public void execute(Runnable task){
        synchronized (workers){
            if(workers.size() &lt; coreSize){
                // åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹
                Worker worker = new Worker(task);
                workers.add(worker);
                Thread thread = new Thread(worker);
                thread.start();
            }else {
               
                taskQueue.put(task);
            }
        }

    }</code></pre> 
<p>å†™å®Œäº†ä¸Šè¾¹çš„ä»£ç æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚</p> 
<pre><code class="language-java"> public static void main(String[] args) {
        ThreadPool threadPool = new ThreadPool(2,10,TimeUnit.MILLISECONDS,10);
        for(int i = 0;i&lt;12;i++){
            int j = i;
            threadPool.execute(()-&gt;{
                System.out.println("å½“å‰çº¿ç¨‹"+Thread.currentThread().getName()+"task "+j+" is running");
                try {
                    Thread.currentThread().sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            });
        }
    }</code></pre> 
<p><img alt="" height="250" src="https://images2.imgbox.com/02/30/9LuqivxC_o.png" width="797"></p> 
<p>æ–¹æ³•è¿è¡Œäº†ä¹‹åï¼Œå³ä½¿ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œï¼Œçº¿ç¨‹ä¹Ÿä¸ä¼šç»“æŸã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„workerç±»ä¸­çš„runæ–¹æ³•è°ƒç”¨äº†ä»»åŠ¡é˜Ÿåˆ—çš„take()æ–¹æ³•ï¼Œè€Œtakeæ–¹æ³•æ˜¯ä¼šä¸€ç›´æŒ‚èµ·çš„ã€‚</p> 
<p>æˆ‘ä»¬ç°åœ¨æ¢ä¸€ç§å¸¦è¶…æ—¶è·å–ï¼Œåœ¨è§„å®šæ—¶é—´å†…è·å–ä¸åˆ°ä»»åŠ¡å°±è‡ªåŠ¨ç»“æŸä»»åŠ¡ã€‚è¿™æ—¶å€™å°±ç”¨åˆ°æˆ‘ä»¬ä¼ å…¥çš„æ—¶é—´å‚æ•°äº†ï¼Œæˆ‘ä»¬ä¸å†è°ƒç”¨await()æ–¹æ³•äº†ï¼Œè€Œæ˜¯è°ƒç”¨awaitNanos()æ–¹æ³•ï¼Œæ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ—¶é—´å‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥æ¶ˆè€—æˆ‘ä»¬çš„nanosæ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…å¦‚æœè·å–ä¸åˆ°çš„è¯çº¿ç¨‹å°±ä¸åœ¨æŒ‚èµ·äº†ï¼Œè¿™æ—¶è¿˜ä¼šè¿›å…¥åˆ°æˆ‘ä»¬çš„whileå¾ªç¯å½“ä¸­ï¼Œåˆ¤æ–­æˆ‘ä»¬çš„nanosæ˜¯ä¸æ˜¯è¢«æ¶ˆè€—å®Œäº†ï¼Œå¦‚æœè¢«æ¶ˆè€—å®Œäº†å°±è¯´æ˜åœ¨è§„å®šæ—¶é—´å†…è·å–ä¸åˆ°ä»»åŠ¡ï¼Œç›´æ¥returnç»“æŸçº¿ç¨‹ã€‚</p> 
<pre><code class="language-java"> // å¸¦è¶…æ—¶è·å–
    public T poll(int timeout,TimeUnit timeUnit){
        T t = null;
        lock.lock();
        try {
            long nanos = timeUnit.toNanos(timeout);
            while(deque.size() == 0){
                if(nanos &lt;= 0){
                    return null;
                }
                nanos = emptyWaitSet.awaitNanos(nanos);
            }

            t = deque.removeFirst();
            fullWaitSet.signal();
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            lock.unlock();
        }
        return t;
    }</code></pre> 
<p>Â ä¿®æ”¹Workerç±»ã€‚</p> 
<pre><code class="language-java"> class Worker implements Runnable{
        private Runnable task;
        public Worker(Runnable task){
            this.task = task;
        }
        @Override
        public void run() {
            while(task!=null || (task = taskQueue.poll(timeout,timeUnit))!=null){
                System.out.println("å–å‡ºçš„ä»»åŠ¡æ˜¯"+task);
                try {
                    task.run();
                }catch (Exception e){
                    e.printStackTrace();
                }finally {
                    task = null;
                }
                synchronized (workers){
                    workers.remove(this);
                }
            }
        }
    }</code></pre> 
<p><img alt="" height="239" src="https://images2.imgbox.com/a8/ed/03UOCfU5_o.png" width="665"></p> 
<p>ç°åœ¨å°±å¯ä»¥æ­£å¸¸ç»“æŸäº†ã€‚</p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5">å››ã€æ‹’ç»ç­–ç•¥</h2> 
<p>å…¨éƒ¨ä»£ç å¦‚ä¸‹ã€‚è¦ä½¿ç”¨æ‹’ç»ç­–ç•¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ŒåŒæ—¶å†™ä¸€ä¸ªå‚æ•°ä¼ ç»™çº¿ç¨‹æ± ï¼Œå‚æ•°çš„å…·ä½“å†…å®¹å°±æ˜¯æ‹’ç»ç­–ç•¥çš„æ‹’ç»æ–¹æ³•ï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ã€‚</p> 
<p>åŒæ—¶æˆ‘ä»¬çš„execute()æ–¹æ³•ä¸åœ¨ä½¿ç”¨putæ¥æ·»åŠ ä»»åŠ¡äº†ï¼Œè€Œæ˜¯ä½¿ç”¨tryPutï¼Œå¦‚æœå¤§å®¶å¯¹è¿™ä¸€å—æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥åœ¨bilibiliä¸Šè§‚çœ‹é»‘é©¬ç¨‹åºå‘˜çš„è¯¾ç¨‹å­¦ä¹ ä¸€ä¸‹ã€‚</p> 
<pre><code class="language-java">/**
 * è‡ªå®šä¹‰çº¿ç¨‹æ± 
 */
public class TestPool {
    public static void main(String[] args) {
        ThreadPool threadPool = new ThreadPool(2,10,TimeUnit.SECONDS,10,((queue, task) -&gt; {queue.put(task);}));
        for(int i = 0;i&lt;12;i++){
            int j = i;
            threadPool.execute(()-&gt;{
                System.out.println("å½“å‰çº¿ç¨‹"+Thread.currentThread().getName()+"task "+j+" is running");
                try {
                    Thread.currentThread().sleep(1000);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            });
        }
    }
}

/**
 * æ‹’ç»ç­–ç•¥
 */
@FunctionalInterface
interface RejectPolicy&lt;T&gt;{
    void reject(BlockedQueue&lt;T&gt; queue,T task);
}
/**
 * é˜»å¡é˜Ÿåˆ—
 */
class BlockedQueue &lt;T&gt;{
    //1.é˜»å¡é˜Ÿåˆ—
    private Deque&lt;T&gt; deque = new ArrayDeque&lt;&gt;();
    //2.å®ç°é˜»å¡çš„é”
    private ReentrantLock lock = new ReentrantLock();
    //3. ç”Ÿäº§è€…ç­‰å¾…æ¡ä»¶
    private Condition fullWaitSet = lock.newCondition();
    //4.æ¶ˆè´¹è€…ç­‰å¾…æ¡ä»¶
    private Condition emptyWaitSet = lock.newCondition();
    //5.é˜»å¡é˜Ÿåˆ—çš„å¤§å°
    private  int CAPACITY;

    public BlockedQueue(int queueCapacity) {
        this.CAPACITY = queueCapacity;
    }

    // ç”Ÿäº§è€…æ”¾å…¥æ•°æ®
    public void put(T t) {
        lock.lock();
        try {
            while (deque.size() == CAPACITY) {
                fullWaitSet.await();
            }
            deque.addLast(t);
            emptyWaitSet.signal();
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
    }
    // å¸¦è¶…æ—¶æ·»åŠ 
    public boolean offer(T t,int timeout,TimeUnit timeUnit) {
        lock.lock();
        long nanos = timeUnit.toNanos(timeout);
        try {
            while (deque.size() == CAPACITY) {
                if(nanos &lt;= 0){
                    return  false;
                }
                nanos = fullWaitSet.awaitNanos(nanos);
            }
            deque.addLast(t);
            emptyWaitSet.signal();
            return  true;
        } catch (InterruptedException e) {
            e.printStackTrace();
        } finally {
            lock.unlock();
        }
        return true;
    }
    // å¸¦è¶…æ—¶è·å–
    public T poll(int timeout,TimeUnit timeUnit){
        T t = null;
        lock.lock();
        try {
            long nanos = timeUnit.toNanos(timeout);
            while(deque.size() == 0){
                if(nanos &lt;= 0){
                    return null;
                }
                nanos = emptyWaitSet.awaitNanos(nanos);
            }

            t = deque.removeFirst();
            fullWaitSet.signal();
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            lock.unlock();
        }
        return t;
    }
    // æ¶ˆè´¹è€…ä»çº¿ç¨‹æ± å½“ä¸­è·å–ä»»åŠ¡
    public T take(){
        T t = null;
        lock.lock();
        try {
            while(deque.size() == 0){
                emptyWaitSet.await();
            }
            t = deque.removeFirst();
            fullWaitSet.signal();
        }catch (Exception e){
            e.printStackTrace();
        }finally {
            lock.unlock();
        }
        return t;
    }

    public void tryPut(RejectPolicy&lt;T&gt; rejectPolicy, T task) {
        lock.lock();
        try {
            if(deque.size()==CAPACITY){
                rejectPolicy.reject(this,task);
            }else{
                deque.addLast(task);
                emptyWaitSet.signal();

            }
        } finally {
            lock.unlock();
        }
    }
}
/**
 * çº¿ç¨‹æ± 
 */
class ThreadPool{
    // ä»»åŠ¡é˜Ÿåˆ—
    private BlockedQueue&lt;Runnable&gt; taskQueue;

    // çº¿ç¨‹é›†åˆ
    private HashSet&lt;Worker&gt; workers = new HashSet&lt;&gt;();

    //æ ¸å¿ƒçº¿ç¨‹æ•°
    private int coreSize;

    // è¶…æ—¶æ—¶é—´
    private int timeout;

    // è¶…æ—¶å•ä½
    private TimeUnit timeUnit;

    //æ‹’ç»ç­–ç•¥
    private RejectPolicy&lt;Runnable&gt; rejectPolicy;

    // ä»»åŠ¡æ‰§è¡Œ
    public void execute(Runnable task){
        synchronized (workers){
            if(workers.size() &lt; coreSize){
                // åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹
                Worker worker = new Worker(task);
                workers.add(worker);
                Thread thread = new Thread(worker);
                thread.start();
            }else {
                // ä»»åŠ¡é˜Ÿåˆ—
                //taskQueue.offer(task,timeout,timeUnit);
                taskQueue.tryPut(rejectPolicy,task);
                //taskQueue.put(task);
            }
        }

    }
    public ThreadPool(int coreSize, int timeout, TimeUnit timeUnit,int queueCapacity,RejectPolicy&lt;Runnable&gt; rejectPolicy){
        this.coreSize = coreSize;
        this.timeout = timeout;
        this.timeUnit = timeUnit;
        this.taskQueue = new BlockedQueue&lt;&gt;(queueCapacity);

        this.rejectPolicy = rejectPolicy;
    }


    class Worker implements Runnable{
        private Runnable task;
        public Worker(Runnable task){
            this.task = task;
        }
        @Override
        public void run() {
            while(task!=null || (task = taskQueue.poll(timeout,timeUnit))!=null){
                System.out.println("å–å‡ºçš„ä»»åŠ¡æ˜¯"+task);
                try {
                    task.run();
                }catch (Exception e){
                    e.printStackTrace();
                }finally {
                    task = null;
                }
                synchronized (workers){
                    workers.remove(this);
                }
            }
        }
    }
}</code></pre> 
<p><strong>è¿™ä¸ªä»£ç æˆ‘è‡ªå·±è§‰å¾—æ˜¯æœ‰äº›é—®é¢˜ï¼Œå› ä¸ºå¦‚æœæˆ‘çš„ä»»åŠ¡é˜Ÿåˆ—å¤§å°æœ‰10çš„æ—¶å€™ï¼Œæˆ‘ç»™å‡ºäº†13ä¸ªä»»åŠ¡ï¼Œä¸¤ä¸ªäº¤ç»™æ ¸å¿ƒçº¿ç¨‹ä¸å ä»»åŠ¡é˜Ÿåˆ—å¤§å°ï¼Œå¦å¤–10ä¸ªä»»åŠ¡æ­£å¥½å æ»¡ï¼Œå‰©ä¸‹ä¸€ä¸ªæ”¾ä¸è¿›å»ï¼Œè¿™æ—¶å°±ä¼šå¡ä½ä¸è¾“å‡ºã€‚---------æœªè§£å†³</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a0ba73b538d79ac83657ca390e79f1f/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Javaä¹‹æŠ½è±¡ç±»å’Œæ¥å£</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ccf1993ed78dc9a7f739dd7e668b49bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€Springã€‘SpringBootæ•´åˆRedisï¼Œç”¨Rediså®ç°é™æµï¼ˆé™„Redisè§£å‹åŒ…ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å­¦ä¹ è€….
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>