<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【研发日记】Matlab/Simulink技能解锁(八)——分布式仿真 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/a15c7d47b1ea119ea441309a4854194a/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【研发日记】Matlab/Simulink技能解锁(八)——分布式仿真">
  <meta property="og:description" content="文章目录 前言
背景
分布式仿真
使用方式
分析和应用
总结
参考资料
前言 见《【研发日记】Matlab/Simulink技能解锁(三)——在Stateflow编辑窗口Debug》
见《【研发日记】Matlab/Simulink技能解锁(四)——在Simulink Debugger窗口调试》
见《【研发日记】Matlab/Simulink技能解锁(五)——七个Simulink布线技巧》
见《【研发日记】Matlab/Simulink技能解锁(六)——六种Simulink模型架构》
见《【研发日记】Matlab/Simulink技能解锁(七)——两种复数移相算法》
背景 使用Simulink开发嵌入式软件，Contrl Model在进行仿真运行时，最常规的方法是搭建一个被控Plane Model，来配合为嵌入式软件开发的Contrl Model，在Simulink编辑窗口就就能仿真运行。这种仿真方式是一种纯虚拟的仿真，Contrl Model和Plane Model运行的平台是工程师的Computer。其中最关键的工作是搭建Plane Model，Plane Model的质量直接影响Contrl Model仿真的效果。
一个高质量Plane Model的搭建往往对需要投入非常专业的技术人员，并且耗费大量的工作时间。即便如此，Contrl Model在Computer上运行和在MCU上运行仍然存在一些差别，Plane Model在Computer上运行和在真实世界里的表现也存在差异。这种大投入和不完美因素，很多开发团队经常是无法接受的。在这种纯虚拟仿真的基础上跨出一步后，诞生了分布式仿真。其在MBD工作流中的地位如下图所示：
分布式仿真 分布式仿真，也称半实物仿真，Mathworks官方的说法是Connected I/O Simulation，顾名思义就是仿真模型的运行不全在Computer上。Contrl Model被分成两部分，纯算法的Model仍在Computer上运行，I/O之类的外设在外部MCU（I/O Server）上执行，Computer和外部MCU之间通过Serial协议进行连接。当仿真运行时，Model Block向IO Server发送命令和请求数据。Plane Model用真实世界中的物理实体替代，并受IO Server控制，整体框架示例如下：
使用方式 第一步，硬件连接
将USB串口线的两头，分别连接在MCU板子和Computer之间，确保Computer的设备管理器中能出现对应的COM资源。
Tips：MCU板子上的一个SCI module将会被占用，所以不能跟其他应用冲突。
第二步，配置Serial协议
打开Simulink Configuration Parameters窗口，在Hardware Implementation一栏的Target hardware resources中找到Connected I/O分组，配置串口通信资源，示例如下：
Tips：上述分布式仿真，依赖于Simulink和MCU之间的Serial协议和传输接口，以及MCU中的IO Server引擎，所以需要Simulink和MCU两边厂家的共同支持，不是每款MCU都支持这项功能。
第三步，连接I/O
在Simulink的Hardware工具页中, 点击Run on Board下拉按钮， 然后点击Connected I/O (inputs/outputs mode)按钮，示例如下：
第四步，加载Contrl Model
Contrl Model按照正常的方式搭建，不用做特殊修改，示例如下：
第五步，运行仿真
在Simulink的Hardware工具页中，点击Run with I/O按钮，即可利用Dashboard、Dispiay、Data lable和Data Inspect等工具查看信号，示例如下：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-17T07:15:00+08:00">
    <meta property="article:modified_time" content="2024-05-17T07:15:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【研发日记】Matlab/Simulink技能解锁(八)——分布式仿真</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="307" src="https://images2.imgbox.com/1e/3d/SGJsJvU5_o.png" width="740"></p> 
<h3 id="main-toc"><span style="color:#1a439c;"><strong>文章目录</strong></span></h3> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:40px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E8%83%8C%E6%99%AF-toc" style="margin-left:40px;"><a href="#%E8%83%8C%E6%99%AF" rel="nofollow">背景</a></p> 
<p id="%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BF%E7%9C%9F-toc" style="margin-left:40px;"><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BF%E7%9C%9F" rel="nofollow">分布式仿真</a></p> 
<p id="%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-toc" style="margin-left:40px;"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" rel="nofollow">使用方式</a></p> 
<p id="%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8-toc" style="margin-left:40px;"><a href="#%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8" rel="nofollow">分析和应用</a></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<p id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:40px;"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">参考资料</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E5%89%8D%E8%A8%80" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">前言</span></h3> 
<p>        见《<a href="https://blog.csdn.net/CSSUST/article/details/136420718" title="【研发日记】Matlab/Simulink技能解锁(三)——在Stateflow编辑窗口Debug">【研发日记】Matlab/Simulink技能解锁(三)——在Stateflow编辑窗口Debug</a>》</p> 
<p>        见《<a href="https://blog.csdn.net/CSSUST/article/details/136825854" title="【研发日记】Matlab/Simulink技能解锁(四)——在Simulink Debugger窗口调试">【研发日记】Matlab/Simulink技能解锁(四)——在Simulink Debugger窗口调试</a>》</p> 
<p>        见《<a href="https://blog.csdn.net/CSSUST/article/details/137127981" title="【研发日记】Matlab/Simulink技能解锁(五)——七个Simulink布线技巧">【研发日记】Matlab/Simulink技能解锁(五)——七个Simulink布线技巧</a>》</p> 
<p>        见《<a href="https://blog.csdn.net/CSSUST/article/details/137713868" title="【研发日记】Matlab/Simulink技能解锁(六)——六种Simulink模型架构">【研发日记】Matlab/Simulink技能解锁(六)——六种Simulink模型架构</a>》</p> 
<p style="margin-left:0;text-align:justify;">        见《<a class="link-info" href="https://blog.csdn.net/CSSUST/article/details/138747225" title="【研发日记】Matlab/Simulink技能解锁(七)——两种复数移相算法">【研发日记】Matlab/Simulink技能解锁(七)——两种复数移相算法</a>》</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E8%83%8C%E6%99%AF" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">背景</span></h3> 
<p style="margin-left:0;text-align:justify;">        使用Simulink开发嵌入式软件，<span style="color:#ff0000;">Contrl Model</span>在进行仿真运行时，最常规的方法是搭建一个被控<span style="color:#ff0000;">Plane Model</span>，来配合为嵌入式软件开发的Contrl Model，在Simulink编辑窗口就就能仿真运行。这种仿真方式是一种<span style="color:#ff0000;">纯虚拟</span>的仿真，Contrl Model和Plane Model运行的平台是工程师的Computer。其中最关键的工作是搭建Plane Model，Plane Model的质量直接影响Contrl Model仿真的效果。</p> 
<p style="margin-left:0;text-align:justify;">        一个高质量Plane Model的搭建往往对需要投入非常专业的技术人员，并且耗费大量的工作时间。即便如此，Contrl Model在Computer上运行和在MCU上运行仍然存在一些差别，Plane Model在Computer上运行和在真实世界里的表现也存在差异。这种<span style="color:#ff0000;">大投入</span>和<span style="color:#ff0000;">不完美</span>因素，很多开发团队经常是无法接受的。在这种纯虚拟仿真的基础上跨出一步后，诞生了<span style="color:#ff0000;">分布式仿真</span>。其在MBD工作流中的地位如下图所示：</p> 
<p class="img-center"><img alt="" height="341" src="https://images2.imgbox.com/31/2d/MKjKBx8O_o.png" width="678"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E5%88%86%E5%B8%83%E5%BC%8F%E4%BB%BF%E7%9C%9F" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">分布式仿真</span></h3> 
<p style="margin-left:0;text-align:justify;">        分布式仿真，也称<span style="color:#ff0000;">半实物仿真</span>，Mathworks官方的说法是<span style="color:#ff0000;">Connected I/O Simulation</span>，顾名思义就是仿真模型的运行不全在Computer上。Contrl Model被分成两部分，纯算法的Model仍在Computer上运行，I/O之类的外设在<span style="color:#ff0000;">外部MCU（I/O Server）</span>上执行，Computer和外部MCU之间通过<span style="color:#ff0000;">Serial</span><span style="color:#ff0000;">协议</span>进行连接。当仿真运行时，Model Block向IO Server<span style="color:#ff0000;">发送命令</span>和<span style="color:#ff0000;">请求数据</span>。Plane Model用真实世界中的<span style="color:#ff0000;">物理实体</span>替代，并受IO Server控制，整体框架示例如下：</p> 
<p class="img-center"><img alt="" height="232" src="https://images2.imgbox.com/d3/fb/Iqtm8Kua_o.png" width="589"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">使用方式</span></h3> 
<p style="margin-left:0;text-align:justify;"><strong>        第一步，硬件连接</strong></p> 
<p style="margin-left:0;text-align:justify;">        将USB串口线的两头，分别连接在MCU板子和Computer之间，确保Computer的设备管理器中能出现对应的<span style="color:#ff0000;">COM</span>资源。</p> 
<p style="margin-left:0;text-align:justify;">        Tips：MCU板子上的一个<span style="color:#ff0000;">SCI module</span>将会被占用，所以不能跟其他应用冲突。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong>        第二步，配置Serial协议</strong></p> 
<p style="margin-left:0;text-align:justify;">        打开Simulink Configuration Parameters窗口，在Hardware Implementation一栏的Target hardware resources中找到<span style="color:#ff0000;">Connected I/O</span>分组，配置串口通信资源，示例如下：</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p class="img-center"><img alt="https://ww2.mathworks.cn/help/ti-c2000/ug/connected-io.png" height="498" src="https://images2.imgbox.com/bc/af/qzL90bRG_o.png" width="674"></p> 
<p style="margin-left:0;text-align:justify;">        Tips：上述分布式仿真，依赖于Simulink和MCU之间的Serial协议和传输接口，以及MCU中的IO Server引擎，所以需要<span style="color:#ff0000;">Simulink</span><span style="color:#ff0000;">和MCU两边厂家的共同支持</span>，不是每款MCU都支持这项功能。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong>        第三步，连接I/O</strong></p> 
<p style="margin-left:0;text-align:justify;">        在Simulink的Hardware工具页中, 点击Run on Board下拉按钮， 然后点击<span style="color:#ff0000;">Connected I/O</span> (inputs/outputs mode)按钮，示例如下：</p> 
<p class="img-center"><img alt="" height="153" src="https://images2.imgbox.com/80/e2/Jl16Jf2I_o.png" width="677"></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        第四步，加载Contrl Model</strong></p> 
<p style="margin-left:0;text-align:justify;">        Contrl Model按照正常的方式搭建，不用做特殊修改，示例如下：</p> 
<p class="img-center"><img alt="" height="89" src="https://images2.imgbox.com/6f/22/bM1f7jve_o.png" width="325"></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        第五步，运行仿真</strong></p> 
<p style="margin-left:0;text-align:justify;">        在Simulink的Hardware工具页中，点击<span style="color:#ff0000;">Run with I/O</span>按钮，即可利用Dashboard、Dispiay、Data lable和Data Inspect等工具<span style="color:#ff0000;">查看信号</span>，示例如下：</p> 
<p class="img-center"><img alt="" height="87" src="https://images2.imgbox.com/48/fc/weew5YJ5_o.png" width="675"></p> 
<p>         </p> 
<p>        也可以在MCU板子（例如电机控制器）上用探针检查信号，或者直接在被控实物（例如电机）上<span style="color:#ff0000;">观察现象</span>。示例如下：</p> 
<p class="img-center"><img alt="" height="290" src="https://images2.imgbox.com/79/5c/W8CBsdrl_o.png" width="567"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E5%88%86%E6%9E%90%E5%92%8C%E5%BA%94%E7%94%A8" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">分析和应用</span></h3> 
<p style="margin-left:0;text-align:justify;">        1、Plane Model是真实世界中的物理实物，不存在<span style="color:#ff0000;">仿真拟合</span>偏差。</p> 
<p style="margin-left:0;text-align:justify;">        2、Contrl Model的算法仍在Computer上运行，可以非常方便地<span style="color:#ff0000;">查看和分析数据</span>。</p> 
<p style="margin-left:0;text-align:justify;">        3、Contrl Model不再MUC板子上运行，不需要编译生成嵌入式代码的环节，可以非常灵活地<span style="color:#ff0000;">修改调整</span>Contrl Model，加速仿真调试进程。</p> 
<p style="margin-left:0;text-align:justify;">        4、由于<span style="color:#ff0000;">通信</span>传输速率和数据量的限制，Simulink向MCU板子发送的指令，Simulink从MCU板子上获取的数据，都会有一定的<span style="color:#ff0000;">时间开销</span>，导致real time性能受到一定程度的限制。为保证系统整体的运行，Contrl Model的仿真步长和Sample time需要设置的稍长一些，至少要大于通信传输周期和MCU板子的响应周期。Contrl Model单个step的tasks量也要适当少一些，simulation pacing适当慢一些，确保MCU板子指定的时间内能够执行完。示例如下：</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p class="img-center"><img alt="https://ww2.mathworks.cn/help/ti-c2000/ug/connected-io-simulation.png" height="149" src="https://images2.imgbox.com/93/eb/cMe3RaET_o.png" width="664"></p> 
<p style="margin-left:0;text-align:justify;">        5、对于<span style="color:#ff0000;">多内核</span>的MCU，只支持第一个主核的应用，其他Core的使用会受限。</p> 
<p style="margin-left:0;text-align:justify;">        6、对于<span style="color:#ff0000;">多时钟</span>的MCU，只支持第一个timer0的应用，其他时钟源的使用会受限。</p> 
<p style="margin-left:0;text-align:justify;">        7、对于<span style="color:#ff0000;">高速响应</span>的硬件性能会受限，例如不支持ePWM模块中HRPWM（高分辨率PWM），不支持中断的使用。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E6%80%BB%E7%BB%93" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">总结</span></h3> 
<p style="margin-left:0;text-align:justify;">        以上就是本人在研发中使用<span style="color:#ff0000;">Simulink</span><span style="color:#ff0000;">仿真</span>时，一些个人理解和分析的总结，主要介绍了<span style="color:#ff0000;">分布式仿真</span>的工作原理，展示了仿真运行的效果，并分析了这种仿真方式的特点和适用场景。</p> 
<p style="margin-left:0;text-align:justify;">        后续还会分享另外几个最近解锁的Matlab/Simulink新技能，欢迎评论区留言、点赞、收藏和关注，这些鼓励和支持都将成文本人持续分享的动力。</p> 
<p style="margin-left:0;text-align:justify;">        另外，上述例程使用的Demo工程，可以到笔者的主页查找和下载。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" style="margin-left:0;text-align:justify;"><span style="color:#0070c0;">参考资料</span></h3> 
<pre><code class="language-cpp">    Mathworks Help - Connected IO Simulation</code></pre> 
<p style="margin-left:0;text-align:justify;"></p> 
<hr> 
<p class="img-center"><img alt="" height="246" src="https://images2.imgbox.com/3d/0e/hi9ndvID_o.png" width="1179"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2147daa282c05eae75c908c69a0a60a4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【不太正常的题】LeetCode.232:用栈的函数接口实现队列</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa04c8e271594378635acb654401af25/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【架构之路】提升后端接口性能的实战技巧</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>