<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java / Spring Boot &#43; POI 给 Word 添加水印 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/9ec9f45d60a064eabbecb6e743b3128a/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Java / Spring Boot &#43; POI 给 Word 添加水印">
  <meta property="og:description" content="1、前言(瞎扯) 有个需求：整一个给 Word 加水印的demo，于是我就网上找呗~
看到那个 Aspose 好像是收费的，然后就把目光转向了 POI，看到各种形形色色的也不知道哪个能用。整了一会，自己拷贝出一个比较精简的能用的 demo 了。
2、人狠话不多，上效果图 我一般都是直接上图的，先看效果图（每一页都有的）：
水印的分布如果不理想，只能小伙伴们自行研究调整了~
3、人狠话不多，直接来代码 3.1、我的代码结构 3.2 、直接贴代码了 pom 依赖的版本不要改，修改版本可能会导致一些东西缺失
代码你们可以直接复制这里的使用
或者在码云仓库：点击这里跳转
3.2.1、pom 依赖 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;3.2.2&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.lyk&lt;/groupId&gt; &lt;artifactId&gt;springboot-word-finger&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;springboot-word-finger&lt;/name&gt; &lt;description&gt;springboot-word-finger&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;17&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.jsoup&lt;/groupId&gt; &lt;artifactId&gt;jsoup&lt;/artifactId&gt; &lt;version&gt;1.11.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;4.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-29T20:38:55+08:00">
    <meta property="article:modified_time" content="2024-03-29T20:38:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java / Spring Boot &#43; POI 给 Word 添加水印</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_0"></a>1、前言(瞎扯)</h2> 
<blockquote> 
 <p>有个需求：整一个给 Word 加水印的demo，于是我就网上找呗~<br> 看到那个 <code>Aspose</code> 好像是收费的，然后就把目光转向了 POI，看到各种形形色色的也不知道哪个能用。整了一会，自己拷贝出一个比较精简的能用的 demo 了。</p> 
</blockquote> 
<h2><a id="2_5"></a>2、人狠话不多，上效果图</h2> 
<p>我一般都是直接上图的，先看效果图（每一页都有的）：</p> 
<blockquote> 
 <p>水印的分布如果不理想，只能小伙伴们自行研究调整了~</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/78/3c/BmlLlFrd_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_12"></a>3、人狠话不多，直接来代码</h2> 
<h3><a id="31_13"></a>3.1、我的代码结构</h3> 
<p><img src="https://images2.imgbox.com/11/3f/5ZfzGWya_o.png" alt="目录结构"></p> 
<h3><a id="32__15"></a>3.2 、直接贴代码了</h3> 
<blockquote> 
 <p><code>pom 依赖的版本不要改，修改版本可能会导致一些东西缺失</code><br> 代码你们可以直接复制这里的使用<br> 或者在码云仓库：<a href="https://gitee.com/lequal/springboot-word-finger" rel="nofollow">点击这里跳转</a></p> 
</blockquote> 
<h4><a id="321pom__21"></a>3.2.1、pom 依赖</h4> 
<pre><code class="prism language-xlm">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.lyk&lt;/groupId&gt;
    &lt;artifactId&gt;springboot-word-finger&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;springboot-word-finger&lt;/name&gt;
    &lt;description&gt;springboot-word-finger&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.jsoup&lt;/groupId&gt;
            &lt;artifactId&gt;jsoup&lt;/artifactId&gt;
            &lt;version&gt;1.11.2&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi&lt;/artifactId&gt;
            &lt;version&gt;4.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-scratchpad&lt;/artifactId&gt;
            &lt;version&gt;4.1.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
            &lt;version&gt;4.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt;
            &lt;version&gt;4.1.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</code></pre> 
<h4><a id="322_97"></a>3.2.2、处理工具类</h4> 
<pre><code class="prism language-java">

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>schemas<span class="token punctuation">.</span>office<span class="token punctuation">.</span>office<span class="token punctuation">.</span></span><span class="token class-name">CTLock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>microsoft<span class="token punctuation">.</span>schemas<span class="token punctuation">.</span>vml<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>openxml4j<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span></span><span class="token class-name">InvalidFormatException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>openxml4j<span class="token punctuation">.</span>opc<span class="token punctuation">.</span></span><span class="token class-name">OPCPackage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>wp<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span></span><span class="token class-name">HeaderFooterType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span></span><span class="token class-name">XWPFDocument</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>poi<span class="token punctuation">.</span>xwpf<span class="token punctuation">.</span>usermodel<span class="token punctuation">.</span></span><span class="token class-name">XWPFHeader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>openxmlformats<span class="token punctuation">.</span>schemas<span class="token punctuation">.</span>wordprocessingml<span class="token punctuation">.</span>x2006<span class="token punctuation">.</span>main<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Stream</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: lyk
 * @description: Word 添加水印工具类
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WatermarkUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">WatermarkUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/** word字体 */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FONT_NAME</span> <span class="token operator">=</span> <span class="token string">"宋体"</span><span class="token punctuation">;</span>
    <span class="token comment">/** 字体大小 */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FONT_SIZE</span> <span class="token operator">=</span> <span class="token string">"0.2pt"</span><span class="token punctuation">;</span>
    <span class="token comment">/** 字体颜色 */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FONT_COLOR</span> <span class="token operator">=</span> <span class="token string">"#d0d0d0"</span><span class="token punctuation">;</span>

    <span class="token comment">/** 一个字平均长度，单位pt，用于：计算文本占用的长度（文本总个数*单字长度）*/</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> <span class="token constant">WIDTH_PER_WORD</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">/** 与顶部的间距 */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token constant">STYLE_TOP</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">/** 文本旋转角度 */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">STYLE_ROTATION</span> <span class="token operator">=</span> <span class="token string">"30"</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * @param inPutPath
     * @param putPutPath
     * @param fingerText
     * @author: lyk
     * @description: 添加水印入口方法
     * @date: 2024/1/25 23:42
     **/</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">waterMarkDocXDocument</span><span class="token punctuation">(</span><span class="token class-name">String</span> inPutPath<span class="token punctuation">,</span> <span class="token class-name">String</span> putPutPath<span class="token punctuation">,</span> <span class="token class-name">String</span> fingerText<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">long</span> beginTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">(</span>
                <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>putPutPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>inPutPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">OPCPackage</span> srcPackage <span class="token operator">=</span> <span class="token class-name">OPCPackage</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">XWPFDocument</span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XWPFDocument</span><span class="token punctuation">(</span>srcPackage<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token comment">// 把整页都打上水印</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> lineIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">;</span> lineIndex <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> lineIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token constant">STYLE_TOP</span> <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">*</span> lineIndex<span class="token punctuation">;</span>
                <span class="token function">waterMarkDocXDocument</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> fingerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 输出新文档</span>
            doc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"添加水印成功!,一共耗时"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> beginTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"毫秒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidFormatException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>



    <span class="token comment">/**
     * 为文档添加水印
     * @param doc        需要被处理的docx文档对象
     * @param fingerText 需要添加的水印文字
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">waterMarkDocXDocument</span><span class="token punctuation">(</span><span class="token class-name">XWPFDocument</span> doc<span class="token punctuation">,</span> <span class="token class-name">String</span> fingerText<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 水印文字之间使用8个空格分隔</span>
        fingerText <span class="token operator">=</span> fingerText <span class="token operator">+</span> <span class="token function">repeatString</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一行水印重复水印文字次数</span>
        fingerText <span class="token operator">=</span> <span class="token function">repeatString</span><span class="token punctuation">(</span>fingerText<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果之前已经创建过 DEFAULT 的Header，将会复用</span>
        <span class="token class-name">XWPFHeader</span> header <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createHeader</span><span class="token punctuation">(</span><span class="token class-name">HeaderFooterType</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">getParagraphs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            header<span class="token punctuation">.</span><span class="token function">createParagraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">CTP</span> ctp <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">getParagraphArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCTP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rsidr <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRsidR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rsidrDefault <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRsidRDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctp<span class="token punctuation">.</span><span class="token function">setRsidP</span><span class="token punctuation">(</span>rsidr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctp<span class="token punctuation">.</span><span class="token function">setRsidRDefault</span><span class="token punctuation">(</span>rsidrDefault<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTPPr</span> ppr <span class="token operator">=</span> ctp<span class="token punctuation">.</span><span class="token function">addNewPPr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ppr<span class="token punctuation">.</span><span class="token function">addNewPStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setVal</span><span class="token punctuation">(</span><span class="token string">"Header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 开始加水印</span>
        <span class="token class-name">CTR</span> ctr <span class="token operator">=</span> ctp<span class="token punctuation">.</span><span class="token function">addNewR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTRPr</span> ctrpr <span class="token operator">=</span> ctr<span class="token punctuation">.</span><span class="token function">addNewRPr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctrpr<span class="token punctuation">.</span><span class="token function">addNewNoProof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTGroup</span> group <span class="token operator">=</span> <span class="token class-name">CTGroup<span class="token punctuation">.</span>Factory</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTShapetype</span> shapeType <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">addNewShapetype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTTextPath</span> shapeTypeTextPath <span class="token operator">=</span> shapeType<span class="token punctuation">.</span><span class="token function">addNewTextpath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shapeTypeTextPath<span class="token punctuation">.</span><span class="token function">setOn</span><span class="token punctuation">(</span><span class="token class-name">STTrueFalse<span class="token punctuation">.</span>T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shapeTypeTextPath<span class="token punctuation">.</span><span class="token function">setFitshape</span><span class="token punctuation">(</span><span class="token class-name">STTrueFalse<span class="token punctuation">.</span>T</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTLock</span> lock <span class="token operator">=</span> shapeType<span class="token punctuation">.</span><span class="token function">addNewLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">setExt</span><span class="token punctuation">(</span><span class="token class-name">STExt</span><span class="token punctuation">.</span><span class="token constant">VIEW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTShape</span> shape <span class="token operator">=</span> group<span class="token punctuation">.</span><span class="token function">addNewShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shape<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">"PowerPlusWaterMarkObject"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shape<span class="token punctuation">.</span><span class="token function">setSpid</span><span class="token punctuation">(</span><span class="token string">"_x0000_s102"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shape<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">"#_x0000_t136"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置形状样式（旋转，位置，相对路径等参数）</span>
        shape<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token function">getShapeStyle</span><span class="token punctuation">(</span>fingerText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shape<span class="token punctuation">.</span><span class="token function">setFillcolor</span><span class="token punctuation">(</span><span class="token constant">FONT_COLOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 字体设置为实心</span>
        shape<span class="token punctuation">.</span><span class="token function">setStroked</span><span class="token punctuation">(</span><span class="token class-name">STTrueFalse</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绘制文本的路径</span>
        <span class="token class-name">CTTextPath</span> shapeTextPath <span class="token operator">=</span> shape<span class="token punctuation">.</span><span class="token function">addNewTextpath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置文本字体与大小</span>
        shapeTextPath<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token string">"font-family:"</span> <span class="token operator">+</span> <span class="token constant">FONT_NAME</span> <span class="token operator">+</span> <span class="token string">";font-size:"</span> <span class="token operator">+</span> <span class="token constant">FONT_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shapeTextPath<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>fingerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CTPicture</span> pict <span class="token operator">=</span> ctr<span class="token punctuation">.</span><span class="token function">addNewPict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pict<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 构建Shape的样式参数
     *
     * @param fingerText
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getShapeStyle</span><span class="token punctuation">(</span><span class="token class-name">String</span> fingerText<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 文本path绘制的定位方式</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"position: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"absolute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算文本占用的长度（文本总个数*单字长度）</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";width: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>fingerText<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">WIDTH_PER_WORD</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"pt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 字体高度</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";height: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"20pt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";z-index: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"-251654144"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";mso-wrap-edited: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置水印的间隔，这是一个大坑，不能用top,必须要margin-top。</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";margin-top: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">STYLE_TOP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";mso-position-horizontal-relative: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";mso-position-vertical-relative: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";mso-position-vertical: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"left"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";mso-position-horizontal: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"center"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">";rotation: "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token constant">STYLE_ROTATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将指定的字符串重复repeats次.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">repeatString</span><span class="token punctuation">(</span><span class="token class-name">String</span> pattern<span class="token punctuation">,</span> <span class="token keyword">int</span> repeats<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StringBuilder</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>pattern<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> repeats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> pattern<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>repeats<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>buffer<span class="token operator">::</span><span class="token function">append</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author lyk
 * @version 1.0
 * @date 2024/1/25 23:16
 * @description
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> inPath <span class="token operator">=</span> <span class="token string">"src/main/java/com/lyk/finger/doc/aaaa.docx"</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> outPath <span class="token operator">=</span> <span class="token string">"src/main/java/com/lyk/finger/doc/out.docx"</span><span class="token punctuation">;</span>

        <span class="token comment">// 添加水印</span>
        <span class="token class-name">WatermarkUtil</span><span class="token punctuation">.</span><span class="token function">waterMarkDocXDocument</span><span class="token punctuation">(</span>inPath<span class="token punctuation">,</span> outPath<span class="token punctuation">,</span> <span class="token string">"落魄程序员在线炒粉"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="4OK__293"></a>4、OK 完事~</h2> 
<blockquote> 
 <p>拿去好好享用吧~<br> <mark>注意:大文档不确定是否有效，我没有大文档测试，如果那种几百页的文档请自行查看，据网友反馈大文档后面的生成不了水印(200页之后的)</mark></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/caaf66b2fff52da1a080dc7a0e83994a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Midjourney软件介绍及使用教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e082035388c356b4186f0f98618bac7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【已解决】伪分布式Hadoop服务已经开启，但是无法访问http://localhost:9870（缺少NameNode进程）\http://localhost:8088</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>