<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【JS】前端文件读取FileReader操作总结 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/dfb711eafcedf5a9048ed1a287004e2e/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【JS】前端文件读取FileReader操作总结">
  <meta property="og:description" content="前言：开发中经常遇到文件上传的场景，有时需要前端将文件内容读取出来再以base64格式传到接口。
目录 FileReader主要方法readAsArrayBuffer(blob)readAsText(blob, [encoding])readAsDataURL(blob) 主要事件React &#43; antd Upload 组件示例 FileReader FileReader 是一个对象，允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。
构造函数：
let reader = new FileReader(); // 没有参数 主要方法 readAsArrayBuffer(blob) 将数据读取为二进制格式的 ArrayBuffer。当读取操作完成时，readyState 变成 DONE（已完成），并触发 loadend 事件，同时 result 属性中将包含一个 ArrayBuffer 对象以表示所读取文件的数据。
reader.readAsArrayBuffer(blob) readAsText(blob, [encoding]) 将数据读取为给定编码（默认为 utf-8 编码）的文本字符串。
instanceOfFileReader.readAsText(blob[, encoding]); readAsDataURL(blob) 读取二进制数据，并将其编码为 base64 的 data url。
reader.readAsDataURL(blob); 读取方法都是异步的，也就是说只有当执行完成后才能够查看到结果，如果直接查看是无结果的，并返回 undefined。必须要挂载 实例下的 onload 或 onloadend 的方法才能处理转化后的结果
FileReader的三个属性：
error: 返回读取时的错误信息readyState: 返回操作的当前状态result: 返回读取文件的结果 读取文件的示例：
参考 https://blog.csdn.net/qq_60440599/article/details/136071142
&lt;input type=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-26T10:22:03+08:00">
    <meta property="article:modified_time" content="2024-04-26T10:22:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【JS】前端文件读取FileReader操作总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>前言：开发中经常遇到文件上传的场景，有时需要前端将文件内容读取出来再以base64格式传到接口。</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#FileReader_4" rel="nofollow">FileReader</a></li><li><ul><li><a href="#_12" rel="nofollow">主要方法</a></li><li><ul><li><a href="#readAsArrayBufferblob_13" rel="nofollow">readAsArrayBuffer(blob)</a></li><li><a href="#readAsTextblob_encoding_20" rel="nofollow">readAsText(blob, [encoding])</a></li><li><a href="#readAsDataURLblob_28" rel="nofollow">readAsDataURL(blob)</a></li></ul> 
   </li><li><a href="#_130" rel="nofollow">主要事件</a></li><li><a href="#React__antd_Upload__158" rel="nofollow">React + antd Upload 组件示例</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="FileReader_4"></a>FileReader</h2> 
<p>FileReader 是一个对象，允许 Web 应用程序异步读取存储在用户计算机上的文件（或原始数据缓冲区）的内容，使用 File 或 Blob 对象指定要读取的文件或数据。</p> 
<p>构造函数：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有参数</span>
</code></pre> 
<h3><a id="_12"></a>主要方法</h3> 
<h4><a id="readAsArrayBufferblob_13"></a>readAsArrayBuffer(blob)</h4> 
<p>将数据读取为二进制格式的 ArrayBuffer。当读取操作完成时，readyState 变成 DONE（已完成），并触发 loadend 事件，同时 result 属性中将包含一个 ArrayBuffer 对象以表示所读取文件的数据。</p> 
<pre><code class="prism language-javascript">reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="readAsTextblob_encoding_20"></a>readAsText(blob, [encoding])</h4> 
<p>将数据读取为给定编码（默认为 utf-8 编码）的文本字符串。</p> 
<pre><code class="prism language-javascript">instanceOfFileReader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">[</span><span class="token punctuation">,</span> encoding<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h4><a id="readAsDataURLblob_28"></a>readAsDataURL(blob)</h4> 
<p>读取二进制数据，并将其编码为 base64 的 data url。</p> 
<pre><code class="prism language-javascript">reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>读取方法都是<code>异步</code>的，也就是说只有当执行完成后才能够查看到结果，如果直接查看是无结果的，并返回 undefined。必须要挂载 实例下的 onload 或 onloadend 的方法才能处理转化后的结果</p> 
</blockquote> 
<p>FileReader的三个属性：</p> 
<ol><li>error: 返回读取时的错误信息</li><li>readyState: 返回操作的当前状态</li><li>result: 返回读取文件的结果</li></ol> 
<p>读取文件的示例：<br> 参考 <a href="https://blog.csdn.net/qq_60440599/article/details/136071142">https://blog.csdn.net/qq_60440599/article/details/136071142</a></p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> onchange<span class="token operator">=</span><span class="token string">"readFile(this)"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">function</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> file <span class="token operator">=</span> input<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> fileReader<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  fileReader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 或者 fileReader.readAsArrayBuffer(file)</span>
  
  <span class="token comment">/**
   * 该方法在读取时调用
   */</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onloadstart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"开始读取"</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileReader<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token comment">//调用函数,但还没有结束,返回1</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 该方法在读取成功时调用
   */</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取成功"</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileReader<span class="token punctuation">.</span>result<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileReader<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token comment">//调用完成,返回2</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 该方法在读取结束时调用
   */</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取结束"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 读取过程中触发
   */</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"读取中"</span><span class="token punctuation">)</span>
      <span class="token comment">//获取已经加载的数据量</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"loaded==&gt;"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>loaded<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 该方法在调用abort函数时触发
   */</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"操作终止"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//当读取出现失败时触发</span>
  fileReader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"出现错误"</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileReader<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<hr> 
<p><strong>read 方法的选择tips：</strong></p> 
<ul><li><code>readAsArrayBuffer </code>—— 用于二进制文件，执行低级别的二进制操作。对于诸如切片（slicing）之类的高级别的操作，File 是继承自 Blob 的，所以可以直接调用它们，而无需读取。</li><li><code>readAsText</code> —— 用于<strong>文本文件</strong>，当我们想要获取字符串时。</li><li><code>readAsDataURL</code> —— 用于在 src 中使用此数据，并将其用于<code>img</code> 或其他标签时。 
  <blockquote> 
   <p><em>还有一种用于此的读取文件的替代方案：<code>URL.createObjectURL(file)</code>。</em></p> 
  </blockquote> </li></ul> 
<blockquote> 
 <p>示例：根据用户传入的图片文件,来生成一个对应的临时url,并将临时url作为src传给img标签</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"file"</span> id<span class="token operator">=</span><span class="token string">"file"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>img  id<span class="token operator">=</span><span class="token string">"img"</span><span class="token operator">&gt;</span>

<span class="token keyword">let</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> img<span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span>
file<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> fileList<span class="token operator">=</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files
    <span class="token comment">//先获取一份文件</span>
    <span class="token comment">//这里获取的才是File对象</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> fileList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">//因为file也是Blob对象,所以直接传入即可</span>
    img<span class="token punctuation">.</span>src<span class="token operator">=</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_130"></a>主要事件</h3> 
<p>读取过程中，有以下事件：</p> 
<ul><li>loadstart —— 开始加载。</li><li>progress —— 在读取过程中出现，当FileReader读取数据时，进度事件会定期触发。</li><li>load —— 读取完成时触发，没有 error。</li><li>abort —— 在中止读取时会触发 abort 事件：例如程序调用 abort()。。</li><li>error —— 出现 error时触发。</li><li>loadend —— 读取完成，无论成功还是失败。</li></ul> 
<p>读取完成后，可以通过以下方式访问读取结果：</p> 
<ul><li>reader.result 是结果（如果成功）</li><li>reader.error 是 error（如果失败）。</li></ul> 
<p><strong>检测浏览器对 FileReader 的支持：</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>FileReader<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> fr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// add your code here</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Not supported by your browser!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="React__antd_Upload__158"></a>React + antd Upload 组件示例</h3> 
<p>场景： 表单文件上传，读取后以base64格式与表单一起传给后端。</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>Upload
  maxCount<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span>
  accept<span class="token operator">=</span><span class="token string">".jpg,.jpeg,.png"</span>
  beforeUpload<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件类型'</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>type<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 限制文件类型</span>
    <span class="token keyword">const</span> allowTypes <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token string">'image/png'</span><span class="token punctuation">,</span>
      <span class="token string">'image/jpeg'</span><span class="token punctuation">,</span>
      <span class="token string">'image/jpg'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> isAllowType <span class="token operator">=</span> allowTypes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 校验文件大小和类型</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAllowType <span class="token operator">||</span> file<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'文件格式大小错误'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> Upload<span class="token punctuation">.</span><span class="token constant">LIST_IGNORE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将上传的文件读取成base64</span>
    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    reader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件Base64内容'</span><span class="token punctuation">,</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 阻止上传，为了最后和表单一起提交</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Button icon<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token operator">&lt;</span>UploadOutlined <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">"primary"</span><span class="token operator">&gt;</span>
    文件上传
  <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Upload<span class="token operator">&gt;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6168494b39f43824639edea522966fbf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS7安装并配置Yearning并实现无公网IP远程SQL审核与数据查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9df022403f497c2fcb926dd92a1551fd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一文教你在windows上实现ollama&#43;open webui、外网访问本地模型、ollama使用GPU加速</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>