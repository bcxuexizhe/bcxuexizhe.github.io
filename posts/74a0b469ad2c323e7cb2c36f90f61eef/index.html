<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【prometheus】监控MySQL并实现可视化 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/74a0b469ad2c323e7cb2c36f90f61eef/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【prometheus】监控MySQL并实现可视化">
  <meta property="og:description" content="目录
一、概述
1.1下载解压mysqld_exporter
1.2创建MySQL授权用户
1.3配置my.cnf
1.4启动mysqld_exporter
1.5prometheus配置修改
二、Grafana展示 【Prometheus】概念和工作原理介绍_prometheus工作原理
【Prometheus】k8s集群部署node-exporter
【prometheus】k8s集群部署prometheus server-CSDN博客
【prometheus】k8s集群部署Grafana安装和配置
【prometheus】k8s集群部署AlertManager实现邮件和钉钉告警-CSDN博客
一、概述 mysqld_exporter 是一个用于监控 MySQL 服务器的开源工具，它是由 Prometheus 社区维护的一个官方 Exporter。该工具通过连接到 MySQL 服务器并执行各种查询来收集关于 MySQL 服务器性能和状态的指标，并将这些指标暴露给 Prometheus 监控系统。
以下是 mysqld_exporter 的一些主要特点和功能：
指标收集: mysqld_exporter 通过执行 SQL 查询来收集关于 MySQL 服务器的各种指标，包括查询性能、连接状态、InnoDB 状态、复制状态等。Prometheus 兼容: mysqld_exporter 输出的指标符合 Prometheus 的指标格式，并且可以直接由 Prometheus 进行收集和存储。灵活的配置: 用户可以通过配置文件或命令行参数来配置 mysqld_exporter 的行为，包括指定要监控的 MySQL 实例、连接参数、指标的收集频率等。安全性: mysqld_exporter 支持通过 TLS/SSL 进行安全连接，以确保监控数据的机密性和完整性。多版本支持: mysqld_exporter 可以与多个 MySQL 版本兼容，并且可以通过配置选择性地启用或禁用特定版本的指标收集。自定义查询: 用户可以通过配置文件自定义要执行的 SQL 查询，以收集特定于其环境的自定义指标。易于部署: mysqld_exporter 可以作为一个独立的二进制文件部署，并且支持多种部署方式，包括 Docker 容器、系统服务等。 总的来说，mysqld_exporter 是一个功能强大且易于使用的工具，可以帮助用户监控和诊断其 MySQL 服务器的性能和健康状态，从而及时发现和解决潜在的问题。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-25T08:54:30+08:00">
    <meta property="article:modified_time" content="2024-04-25T08:54:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【prometheus】监控MySQL并实现可视化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="534" id="Ra1OT" src="https://images2.imgbox.com/7e/02/L2wO4Q2n_o.png" width="950"></p> 
<p id="u53746b17"></p> 
<p id="ud38513c6"><strong>目录</strong></p> 
<p id="v9PpE-toc" style="margin-left:0px;"><a href="#v9PpE" rel="nofollow">一、概述</a></p> 
<p id="TP8xi-toc" style="margin-left:40px;"><a href="#TP8xi" rel="nofollow">1.1下载解压mysqld_exporter</a></p> 
<p id="zC4ua-toc" style="margin-left:40px;"><a href="#zC4ua" rel="nofollow">1.2创建MySQL授权用户</a></p> 
<p id="AjiWJ-toc" style="margin-left:40px;"><a href="#AjiWJ" rel="nofollow">1.3配置my.cnf</a></p> 
<p id="Myhnh-toc" style="margin-left:40px;"><a href="#Myhnh" rel="nofollow">1.4启动mysqld_exporter</a></p> 
<p id="q5jTb-toc" style="margin-left:40px;"><a href="#q5jTb" rel="nofollow">1.5prometheus配置修改</a></p> 
<p id="gPHNv-toc" style="margin-left:0px;"><a href="#gPHNv" rel="nofollow">二、Grafana展示</a> </p> 
<hr id="SiX8k"> 
<p id="ud59a12d6"><a href="https://kangll.blog.csdn.net/article/details/136219364" rel="nofollow" title="【Prometheus】概念和工作原理介绍_prometheus工作原理">【Prometheus】概念和工作原理介绍_prometheus工作原理</a></p> 
<p id="u989426f0"><a href="https://kangll.blog.csdn.net/article/details/136447177" rel="nofollow" title="【Prometheus】k8s集群部署node-exporter">【Prometheus】k8s集群部署node-exporter</a></p> 
<p id="u8295d3a8"><a href="https://kangll.blog.csdn.net/article/details/136783153" rel="nofollow" title="【prometheus】k8s集群部署prometheus server-CSDN博客">【prometheus】k8s集群部署prometheus server-CSDN博客</a></p> 
<p><a href="https://blog.csdn.net/qq_35995514/article/details/137217639?spm=1001.2014.3001.5501" title="【prometheus】k8s集群部署Grafana安装和配置">【prometheus】k8s集群部署Grafana安装和配置</a></p> 
<p><a href="https://blog.csdn.net/qq_35995514/article/details/138046738?spm=1001.2014.3001.5501" title="【prometheus】k8s集群部署AlertManager实现邮件和钉钉告警-CSDN博客">【prometheus】k8s集群部署AlertManager实现邮件和钉钉告警-CSDN博客</a></p> 
<hr> 
<h3> <span style="color:#511b78;">一、概述</span></h3> 
<hr id="VPkkQ"> 
<blockquote> 
 <p id="uc8c32bc5">mysqld_exporter 是一个用于监控 MySQL 服务器的开源工具，它是由 Prometheus 社区维护的一个官方 Exporter。该工具通过连接到 MySQL 服务器并执行各种查询来收集关于 MySQL 服务器性能和状态的指标，并将这些指标暴露给 Prometheus 监控系统。</p> 
</blockquote> 
<p id="u228fdfda"></p> 
<p id="u04b42a3d">以下是 mysqld_exporter 的一些主要特点和功能：</p> 
<ul><li id="u96918001"><strong>指标收集:</strong> mysqld_exporter 通过执行 SQL 查询来收集关于 MySQL 服务器的各种指标，包括查询性能、连接状态、InnoDB 状态、复制状态等。</li><li id="udd2fdadc"><strong>Prometheus 兼容</strong>: mysqld_exporter 输出的指标符合 Prometheus 的指标格式，并且可以直接由 Prometheus 进行收集和存储。</li><li id="u839998ff"><strong>灵活的配置:</strong> 用户可以通过配置文件或命令行参数来配置 mysqld_exporter 的行为，包括指定要监控的 MySQL 实例、连接参数、指标的收集频率等。</li><li id="u96e389b5"><strong>安全性: </strong>mysqld_exporter 支持通过 TLS/SSL 进行安全连接，以确保监控数据的机密性和完整性。</li><li id="u8674ee13"><strong>多版本支持</strong>: mysqld_exporter 可以与多个 MySQL 版本兼容，并且可以通过配置选择性地启用或禁用特定版本的指标收集。</li><li id="u72c92c92"><strong>自定义查询: </strong>用户可以通过配置文件自定义要执行的 SQL 查询，以收集特定于其环境的自定义指标。</li><li id="u8f99d820"><strong>易于部署</strong>: mysqld_exporter 可以作为一个独立的二进制文件部署，并且支持多种部署方式，包括 Docker 容器、系统服务等。</li></ul> 
<p id="uea823660">总的来说，mysqld_exporter 是一个功能强大且易于使用的工具，可以帮助用户监控和诊断其 MySQL 服务器的性能和健康状态，从而及时发现和解决潜在的问题。</p> 
<p id="uef5292f6"><strong>官网：</strong><a href="https://prometheus.io/download/" rel="nofollow" title="Download | Prometheus">Download | Prometheus</a></p> 
<p id="u1173dd2b"><strong>MySQLExpoter: </strong><a href="https://github.com/prometheus/mysqld_exporter" title="GitHub - prometheus/mysqld_exporter: Exporter for MySQL server metrics">GitHub - prometheus/mysqld_exporter: Exporter for MySQL server metrics</a></p> 
<p><a href="https://blog.csdn.net/qq_35995514/article/details/134350572?spm=1001.2014.3001.5501" title="【Linux】Centos7 shell实现MySQL5.7 tar 一键安装_shell一键安装mysql5.7.44-CSDN博客">【Linux】Centos7 shell实现MySQL5.7 tar 一键安装_shell一键安装mysql5.7.44-CSDN博客</a> </p> 
<hr id="tftga"> 
<h3 id="TP8xi">1.1下载解压mysqld_exporter</h3> 
<hr id="VTB4V"> 
<pre id="Y0q3N"><code>wget --no-check-certificate   https://github.com/prometheus/mysqld_exporter/releases/download/v0.15.1/mysqld_exporter-0.15.1.linux-amd64.tar.gz


cd mysqld_exporter-0.15.1.linux-amd64
cp -ar mysqld_exporter /usr/local/bin/
chmod +x /usr/local/bin/mysqld_exporter
</code></pre> 
<p class="img-center"><img alt="" height="492" id="ub7b455d3" src="https://images2.imgbox.com/03/7a/x0qvQRdc_o.png" width="1200"></p> 
<p id="u5cce5a13"></p> 
<h3 id="zC4ua">1.2创建MySQL授权用户</h3> 
<hr id="RnnnX"> 
<pre id="Xhgrb"><code># 创建数据库用户。
CREATE USER 'mysql_exporter'@'192.168.2.139' IDENTIFIED BY 'Abcdef123!.';

# 对mysql_exporter用户授权
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'mysql_exporter'@'192.168.2.139';
</code></pre> 
<p id="u1d0c3203"></p> 
<p class="img-center"><img alt="" height="218" id="ue598779d" src="https://images2.imgbox.com/d3/6d/vTfB7VYL_o.png" width="1200"></p> 
<h3 id="AjiWJ">1.3配置my.cnf</h3> 
<hr id="VXlWk"> 
<p id="ue57951b7">创建mysql配置文件、运行时可免密码连接数据库</p> 
<pre id="PUI5I"><code>cd mysqld_exporter-0.15.1.linux-amd64

cat &gt; my.cnf &lt;&lt; EOF
[client]
host=192.168.2.211
port=3306
user=mysql_exporter
password=Abcdef123!.

[client.servers]
host=192.168.2.211
port=3306
user=mysql_exporter
password=Abcdef123!.

EOF</code></pre> 
<h3 id="Myhnh">1.4启动mysqld_exporter</h3> 
<hr id="rEcEn"> 
<p id="uf0d8e149">直接命令行启动mysql_exporter客户端</p> 
<pre id="USe2F"><code>nohup ./mysqld_exporter --config.my-cnf=./my.cnf &amp;</code></pre> 
<p id="ufda1e88c">也可以注册为服务</p> 
<pre id="BOwYM"><code>cat &lt;&lt;EOF&gt;&gt;  /usr/lib/systemd/system/mysqld-exporter.service 
[Unit]
Description=mysqld_exporter


[Service]
User=root
ExecStart=/root/prome/mysqld_exporter-0.15.1.linux-amd64/mysqld_exporter --config.my-cnf /root/prome/mysqld_exporter-0.15.1.linux-amd64/my.cnf --web.listen-address=0.0.0.0:9104 \
--collect.slave_status \
--collect.binlog_size \
--collect.info_schema.processlist \
--collect.info_schema.innodb_metrics \
--collect.engine_innodb_status \
--collect.perf_schema.file_events \
--collect.perf_schema.replication_group_member_stats
Restart=on-failure

[Install]
WantedBy=multi-user.targe
EOF
</code></pre> 
<h3 id="q5jTb">1.5prometheus配置修改</h3> 
<hr id="yRm5S"> 
<p id="u93e52989">修改prometheus-cfg.yaml文件，添加如下</p> 
<pre id="CQ9KM"><code>  - job_name: 'mysql'
    static_configs:
    - targets: ['192.168.124.16:9104']

kubectl apply  -f prometheus-alertmanager-cfg.yaml
kubectl delete -f prometheus-deploy.yaml
kubectl apply  -f prometheus-deploy.yaml


curl -XPOST localhost:9090/-/reload</code></pre> 
<p id="u20ce4efe"><img alt="" height="380" src="https://images2.imgbox.com/1a/13/BsTW5R3v_o.png" width="1014"></p> 
<p id="uab628abb"></p> 
<p id="u802051ed">登录 promethetus 可以看到采集到了</p> 
<p class="img-center"><img alt="" height="159" id="ubb74eb16" src="https://images2.imgbox.com/e5/24/5rZRfZmx_o.png" width="1200"></p> 
<hr id="YYO78"> 
<h2 id="gPHNv" style="background-color:transparent;"><span style="color:#511b78;">二、Grafana展示</span></h2> 
<hr id="AImbz"> 
<p id="u7e48d544">官网模板地址<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a></p> 
<p id="u7f0a40dd"><img alt="" height="448" src="https://images2.imgbox.com/85/9f/Q4g4k4ot_o.png" width="929"></p> 
<p id="ud2ceb96c">mysql-overview_rev5.json</p> 
<p id="u9302f065">导入模板</p> 
<p class="img-center"><img alt="" height="445" id="u269d62ba" src="https://images2.imgbox.com/3b/df/LPKef2f3_o.png" width="1200"></p> 
<p id="u76120a08">选择“Import Json File”</p> 
<p id="u10d3f800"></p> 
<p class="img-center"><img alt="" height="552" id="ua8ad77c9" src="https://images2.imgbox.com/0b/5e/YFBx6Whv_o.png" width="1200"></p> 
<p id="u324dc19e">导入模板后，选择import</p> 
<p id="u4fb604f9"></p> 
<p class="img-center"><img alt="" height="650" id="u3081bc9b" src="https://images2.imgbox.com/66/bb/aohIV5KW_o.png" width="1200"></p> 
<p id="uff464c23"></p> 
<p id="uf6c4b2f5">展示成功<img alt="" height="832" src="https://images2.imgbox.com/1c/f6/f4TsRYb0_o.png" width="1200"></p> 
<p id="u99939acd">参考链接：</p> 
<p id="ud9eef60a"><a href="https://blog.csdn.net/weixin_42434700/article/details/126732987" title="mysqld_exporter部署-CSDN博客">mysqld_exporter部署-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5242cd2f61665d07196aa965552bd0f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;干货基地】深度理解C&#43;&#43;中的高效内存管理方式 new &amp; delete</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/94934a933473f9dbca7cd7c38c72bfcc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Go语言快速上手(四)】面向对象的三大特性引入</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>