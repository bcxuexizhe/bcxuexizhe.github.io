<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#进阶-OleDb操作Excel和数据库 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/b68fabb53e8d1b6d112aacf7e5a2d3d5/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="C#进阶-OleDb操作Excel和数据库">
  <meta property="og:description" content="在C#编程中，使用OleDb可以方便地实现对Excel文件和数据库的操作。本文探讨了在C#中使用OleDb技术操作Excel和数据库的策略。文章详述了OleDb的定义、配置环境的步骤，并通过实际代码示例演示了如何高效读写Excel文件和交互数据库。文中还评估了OleDb技术的优缺点，为需要处理多种数据源的开发者提供了一种有效的数据操作方案。
一、OleDb简介 OleDb（Object Linking and Embedding, Database）是微软的一套数据库访问接口，支持对多种数据源的访问，包括SQL Server、Access以及Excel等。它提供了一种统一的方法来访问不同的数据源。在.NET环境下，OleDb可以通过System.Data.OleDb命名空间提供的类来使用。
二、OleDb安装前准备 1. 环境准备 .NET Framework: 确保您的开发环境中安装了.NET Framework，因为OleDb类库是基于.NET Framework的。
引用设置: 在Visual Studio中，需要添加对System.Data.dll的引用，以确保项目可以使用System.Data.OleDb命名空间。
2. 安装相应的驱动 使用 OLE DB 操作数据库或 Excel 时，你需要确保安装了适当的 OLE DB 驱动程序，这取决于你要连接的具体数据库系统。每种数据库系统都可能有一个或多个专用的 OLE DB 驱动，这些驱动允许应用程序通过 OLE DB 接口与数据库通信。
Excel 的 OLE DB 驱动：
对于Excel文件的数据操作，你可以使用Microsoft提供的OLE DB驱动来进行读取和写入操作。这些驱动允许通过OLE DB接口与Excel文件进行交互。具体使用的驱动取决于Excel文件的版本和你的系统类型（32位或64位）。
① 🎯Microsoft Access Database Engine OLE DB Provider
适用版本：Excel 2007 及更高版本的文件（.xlsx）。驱动名称： 对于旧版本或需要兼容性的，可以使用 Microsoft.ACE.OLEDB.12.0。对于更高版本的Office，可以使用 Microsoft.ACE.OLEDB.16.0。 ② 🔥Microsoft Jet OLE DB Provider
适用版本：Excel 2003 及更早版本的文件（.xls）。驱动名称：Microsoft.Jet.OLEDB.4.0。注意：这个驱动仅支持32位系统。 驱动下载地址
Access Database Engine最新版本下载地址：(https://learn.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-10T11:40:09+08:00">
    <meta property="article:modified_time" content="2024-05-10T11:40:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#进阶-OleDb操作Excel和数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在C#编程中，使用OleDb可以方便地实现对Excel文件和数据库的操作。本文探讨了在C#中使用OleDb技术操作Excel和数据库的策略。文章详述了OleDb的定义、配置环境的步骤，并通过实际代码示例演示了如何高效读写Excel文件和交互数据库。文中还评估了OleDb技术的优缺点，为需要处理多种数据源的开发者提供了一种有效的数据操作方案。</p> 
<hr> 
<h3><a id="OleDb_3"></a>一、OleDb简介</h3> 
<p>OleDb（Object Linking and Embedding, Database）是微软的一套数据库访问接口，支持对多种数据源的访问，包括SQL Server、Access以及Excel等。它提供了一种统一的方法来访问不同的数据源。在.NET环境下，OleDb可以通过System.Data.OleDb命名空间提供的类来使用。</p> 
<hr> 
<h3><a id="OleDb_8"></a>二、OleDb安装前准备</h3> 
<h4><a id="1__9"></a>1. 环境准备</h4> 
<p><strong>.NET Framework</strong>: 确保您的开发环境中安装了.NET Framework，因为OleDb类库是基于.NET Framework的。</p> 
<p><strong>引用设置</strong>: 在Visual Studio中，需要添加对System.Data.dll的引用，以确保项目可以使用System.Data.OleDb命名空间。</p> 
<hr> 
<h4><a id="2__16"></a>2. 安装相应的驱动</h4> 
<p>使用 OLE DB 操作数据库或 Excel 时，你需要确保安装了适当的 OLE DB 驱动程序，这取决于你要连接的具体数据库系统。每种数据库系统都可能有一个或多个专用的 OLE DB 驱动，这些驱动允许应用程序通过 OLE DB 接口与数据库通信。</p> 
<p><strong>Excel 的 OLE DB 驱动：</strong><br> 对于Excel文件的数据操作，你可以使用Microsoft提供的OLE DB驱动来进行读取和写入操作。这些驱动允许通过OLE DB接口与Excel文件进行交互。具体使用的驱动取决于Excel文件的版本和你的系统类型（32位或64位）。</p> 
<p><strong>① 🎯Microsoft Access Database Engine OLE DB Provider</strong></p> 
<ul><li><strong>适用版本</strong>：Excel 2007 及更高版本的文件（.xlsx）。</li><li><strong>驱动名称</strong>： 
  <ul><li>对于旧版本或需要兼容性的，可以使用 <code>Microsoft.ACE.OLEDB.12.0</code>。</li><li>对于更高版本的Office，可以使用 <code>Microsoft.ACE.OLEDB.16.0</code>。</li></ul> </li></ul> 
<p><strong>② 🔥Microsoft Jet OLE DB Provider</strong></p> 
<ul><li><strong>适用版本</strong>：Excel 2003 及更早版本的文件（.xls）。</li><li><strong>驱动名称</strong>：<code>Microsoft.Jet.OLEDB.4.0</code>。</li><li><strong>注意</strong>：这个驱动仅支持32位系统。</li></ul> 
<p><strong>驱动下载地址</strong></p> 
<p>Access Database Engine最新版本下载地址：(<a href="https://learn.microsoft.com/zh-cn/sql/connect/oledb/download-oledb-driver-for-sql-server?view=sql-server-ver16" rel="nofollow">https://learn.microsoft.com/zh-cn/sql/connect/oledb/download-oledb-driver-for-sql-server?view=sql-server-ver16</a>)；<br> Access Database Engine历史版本(16及之后)下载地址：(<a href="https://learn.microsoft.com/zh-cn/sql/connect/oledb/release-notes-for-oledb-driver-for-sql-server?view=sql-server-ver16#previous-releases" rel="nofollow">https://learn.microsoft.com/zh-cn/sql/connect/oledb/release-notes-for-oledb-driver-for-sql-server?view=sql-server-ver16#previous-releases</a>)；<br> 已经绝版的Microsoft.ACE.OLEDB.12.0(Microsoft Access 2010 数据库引擎)下载地址：(<a href="https://download.csdn.net/download/weixin_41793160/89286174">https://download.csdn.net/download/weixin_41793160/89286174</a>) (注意只支持32位，.NET程序目标生成不能位X64)；<br> 已经绝版的Microsoft.Jet.OLEDB.4.0(2007 Office system 驱动程序)下载地址：<br> 同Microsoft.ACE.OLEDB.12.0。</p> 
<p><strong>安装流程</strong><br> 未安装Microsoft.ACE.OLEDB.12.0驱动报错的截图。<br> <img src="https://images2.imgbox.com/18/86/eVp5w3Fm_o.png" alt="在这里插入图片描述"><br> 下载Microsoft.ACE.OLEDB.12.0驱动安装程序。<br> <img src="https://images2.imgbox.com/a1/3e/JfNxEIES_o.png" alt="在这里插入图片描述"><br> 点击安装。<br> <img src="https://images2.imgbox.com/d9/31/Ibc9P4q0_o.png" alt="在这里插入图片描述"><br> 选择安装路径。<br> <img src="https://images2.imgbox.com/be/cd/goraajIL_o.png" alt="在这里插入图片描述"><br> 安装完成。<br> <img src="https://images2.imgbox.com/28/51/oEobCIKb_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>常见数据库的 OLE DB 驱动：</strong></p> 
<p><strong>① 🌈Microsoft SQL Server</strong>：</p> 
<ul><li><strong>Microsoft OLE DB Driver for SQL Server (MSOLEDBSQL)</strong>：是当前推荐的驱动，支持最新的SQL Server功能。</li><li><strong>SQL Server Native Client (SQLNCLI)</strong>：旧版本的驱动，依然广泛使用，但可能不支持最新的数据库功能。</li></ul> 
<p><strong>② ✨Microsoft Access</strong>：</p> 
<ul><li><strong>Microsoft Access Database Engine OLE DB Provider (ACEOLEDB)</strong>：适用于 Access 2007 及以上版本。</li><li><strong>Microsoft Jet OLE DB Provider (Jet.OLEDB)</strong>：用于 Access 2003 及更早版本。</li></ul> 
<p><strong>③ 🚀Oracle</strong>：</p> 
<ul><li><strong>Oracle Provider for OLE DB</strong>：Oracle 官方提供的 OLE DB 驱动。</li></ul> 
<p><strong>④ 🍀MySQL</strong>：</p> 
<ul><li>MySQL 官方没有直接提供专用的 OLE DB 驱动，通常推荐使用 ODBC 驱动或第三方提供的 OLE DB 驱动。</li></ul> 
<p><strong>⑤ 🧩PostgreSQL</strong>：</p> 
<ul><li>类似于 MySQL，PostgreSQL 官方也没有提供 OLE DB 驱动。推荐使用 ODBC 驱动或第三方提供的 OLE DB 驱动。</li></ul> 
<p>确保驱动安装正确并且连接字符串配置适当是成功使用 OLE DB 的关键。不正确的驱动安装或配置可能导致连接失败或数据访问错误。</p> 
<hr> 
<h3><a id="OleDbEXCEL_77"></a>三、OleDb操作EXCEL</h3> 
<h4><a id="1__78"></a>1. 连接字符串</h4> 
<p>连接Excel文件时，您的连接字符串会略有不同，这取决于Excel文件的版本（例如Excel 97-2003工作簿.xls与Excel 工作簿.xlsx）：</p> 
<ul><li>对于.xls文件：<code>Provider=Microsoft.Jet.OLEDB.4.0;Data Source=路径;Extended Properties="Excel 8.0;HDR=Yes;IMEX=1";</code></li><li>对于.xlsx文件：<code>Provider=Microsoft.ACE.OLEDB.12.0;Data Source=路径;Extended Properties="Excel 12.0 Xml;HDR=Yes;IMEX=1";</code></li></ul> 
<hr> 
<h4><a id="2__86"></a>2. 读取数据</h4> 
<p>使用OleDb读取Excel文件通常涉及以下步骤：</p> 
<ol><li><strong>创建OleDbConnection对象</strong>来建立到Excel文件的连接。</li><li><strong>创建OleDbCommand对象</strong>来定义要执行的SQL查询。</li><li><strong>创建OleDbDataAdapter和DataSet</strong>，用于接收查询结果。</li><li><strong>执行查询</strong>并填充DataSet，之后可以通过DataTable对象来操作数据。</li></ol> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\\path\\to\\file.xlsx;Extended Properties='Excel 12.0 Xml;HDR=YES;'"</span><span class="token punctuation">;</span>
<span class="token keyword">using</span><span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OleDbCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM [Sheet1$]"</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">OleDbDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataSet</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DataTable</span> data <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 数据现在存储在data中，可以进行进一步处理</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h4><a id="3__110"></a>3. 写入数据</h4> 
<p>要向Excel文件写入数据，可以使用<code>OleDbConnection</code>和<code>OleDbCommand</code>对象。</p> 
<p>下面示例展示了如何打开一个连接，单条写入数据到Excel表格中。</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 打开连接</span>

    <span class="token comment">// 构建插入命令</span>
    <span class="token class-name">OleDbCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO [Sheet1$] (Column1, Column2) VALUES ('Value1', 'Value2')"</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 执行插入命令</span>
    cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 关闭连接</span>
    conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果需要向Excel文件批量写入数据，可以构建多个INSERT语句，或使用<code>OleDbDataAdapter</code>和<code>DataTable</code>，通过调整<code>DataTable</code>中的数据然后调用<code>Update()</code>方法来实现。</p> 
<pre><code class="prism language-csharp"><span class="token class-name">DataTable</span> dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 假设dt已经被填充了数据</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">OleDbDataAdapter</span> adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbDataAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span>InsertCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO [Sheet1$] (Column1, Column2) VALUES (?, ?)"</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span>InsertCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"@Column1"</span><span class="token punctuation">,</span> OleDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token string">"Column1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span>InsertCommand<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"@Column2"</span><span class="token punctuation">,</span> OleDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token string">"Column2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    adapter<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 更新Excel文件</span>
    conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这种方法特别适合处理大量数据，可以显著提高数据插入的效率。</p> 
<hr> 
<h3><a id="OleDb_153"></a>四、OleDb操作数据库</h3> 
<p>使用OLE DB进行数据库访问（包括增加、删除、修改和查询操作）涉及到几个关键的.NET类，主要是<code>OleDbConnection</code>、<code>OleDbCommand</code>、<code>OleDbDataAdapter</code>和<code>OleDbDataReader</code>。下面是一个使用OLE DB来执行增删改查（CRUD：Create, Read, Update, Delete）操作的基本示例，这里假设数据库是一个简单的Microsoft Access数据库或其他支持OLE DB的数据库。</p> 
<h4><a id="1_OleDb_155"></a>1. OleDb实现数据增删改查</h4> 
<p><strong>代码示例</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>OleDb</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\yourdatabase.mdb;"</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建一个新的OleDbConnection，并将其封装在using语句中以确保资源的释放</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 创建（Create）</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO Employees (FirstName, LastName) VALUES ('John', 'Doe')"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 读取（Read）</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"SELECT FirstName, LastName FROM Employees"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbDataReader</span> reader <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">reader<span class="token punctuation">[</span><span class="token string">"FirstName"</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">reader<span class="token punctuation">[</span><span class="token string">"LastName"</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 更新（Update）</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"UPDATE Employees SET LastName = 'Smith' WHERE FirstName = 'John'"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 删除（Delete）</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM Employees WHERE FirstName = 'John'"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>解释</strong></p> 
<ol><li><strong>连接字符串</strong> (<code>connectionString</code>): 指定了OLE DB提供者、数据库文件路径等信息。</li><li><strong>OleDbConnection</strong>: 用于建立与数据库的连接。</li><li><strong>OleDbCommand</strong>: 用于执行SQL命令。</li><li><strong>OleDbDataReader</strong>: 用于读取从数据库返回的结果。</li></ol> 
<p><strong>注意事项</strong></p> 
<ul><li>确保修改连接字符串以匹配你的数据库设置。</li><li>这个例子中使用的是Microsoft Access的OLE DB提供者 (<code>Microsoft.Jet.OLEDB.4.0</code>)，你可能需要根据你的数据库类型调整提供者。</li><li>确保数据库路径、SQL语句和数据库表结构与示例代码中的相符。</li></ul> 
<hr> 
<h4><a id="2_OleDb_221"></a>2. OleDb实现事务管理</h4> 
<p>OLE DB 允许你通过<code>OleDbTransaction</code>来控制事务，这样可以确保数据的完整性和一致性。在一个事务中，你可以执行多个操作，要么全部成功，要么全部失败，从而避免数据不一致的情况出现。</p> 
<p><strong>代码示例</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>OleDb</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\yourdatabase.mdb;"</span><span class="token punctuation">;</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">OleDbTransaction</span> transaction <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">BeginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">CreateCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                command<span class="token punctuation">.</span>Transaction <span class="token operator">=</span> transaction<span class="token punctuation">;</span>

                command<span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">"INSERT INTO Table1 (Column1) VALUES ('Value1')"</span><span class="token punctuation">;</span>
                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                command<span class="token punctuation">.</span>CommandText <span class="token operator">=</span> <span class="token string">"INSERT INTO Table2 (Column2) VALUES ('Value2')"</span><span class="token punctuation">;</span>
                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 提交事务</span>
                transaction<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Both records are written to database."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 回滚事务</span>
                transaction<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"There was an error, transaction was rolled back."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个示例展示了如何使用事务来确保数据的一致性，只有当所有操作都成功时才提交事务，否则回滚所有操作。这是数据库操作中一个非常重要的高级功能。</p> 
<hr> 
<h4><a id="3_OleDb_271"></a>3. OleDb实现异步操作</h4> 
<p>在.NET中，使用OLE DB进行异步数据库操作可以通过多种方式实现，比如使用<code>Task</code>和<code>async/await</code>模式。</p> 
<p><strong>代码示例</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>OleDb</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\yourdatabase.mdb;"</span><span class="token punctuation">;</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">OpenAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM Employees"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbDataReader</span> reader <span class="token operator">=</span> <span class="token punctuation">(</span>OleDbDataReader<span class="token punctuation">)</span><span class="token keyword">await</span> command<span class="token punctuation">.</span><span class="token function">ExecuteReaderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">await</span> reader<span class="token punctuation">.</span><span class="token function">ReadAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">reader<span class="token punctuation">[</span><span class="token string">"FirstName"</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">reader<span class="token punctuation">[</span><span class="token string">"LastName"</span><span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个例子中，<code>OpenAsync</code>, <code>ExecuteReaderAsync</code>, 和 <code>ReadAsync</code> 方法被用来异步打开连接、执行查询和读取结果。这种方法非常适合用在需要维护应用程序响应性的场景中，比如GUI应用程序或者高负载Web应用程序。</p> 
<hr> 
<h4><a id="4_OleDb_310"></a>4. OleDb调用存储过程</h4> 
<p><strong>代码示例</strong></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>OleDb</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\yourdatabase.mdb;"</span><span class="token punctuation">;</span>
        <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbConnection</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">OleDbCommand</span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbCommand</span><span class="token punctuation">(</span><span class="token string">"GetEmployeeDetails"</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                command<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>

                <span class="token comment">// 添加输入参数</span>
                command<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddWithValue</span><span class="token punctuation">(</span><span class="token string">"@EmployeeId"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 如果存储过程有返回值</span>
                command<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">OleDbParameter</span><span class="token punctuation">(</span><span class="token string">"@ReturnValue"</span><span class="token punctuation">,</span> OleDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                command<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">"@ReturnValue"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Direction <span class="token operator">=</span> ParameterDirection<span class="token punctuation">.</span>Output<span class="token punctuation">;</span>

                command<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 读取输出参数的值</span>
                <span class="token class-name"><span class="token keyword">string</span></span> result <span class="token operator">=</span> command<span class="token punctuation">.</span>Parameters<span class="token punctuation">[</span><span class="token string">"@ReturnValue"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Result: "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个示例展示了如何调用名为"GetEmployeeDetails"的存储过程，它假定此存储过程接收一个名为<code>@EmployeeId</code>的输入参数，并返回一些数据。在实际应用中，你需要根据实际存储过程的定义来调整参数的名称和类型。</p> 
<hr> 
<h3><a id="OleDb_354"></a>五、OleDb操作总结</h3> 
<h4><a id="1_OleDb_356"></a>1. OleDb和其他数据库操作方式的对比</h4> 
<table><thead><tr><th>特性</th><th>OleDb</th><th>ADO.NET（SqlClient等）</th><th>Entity Framework</th></tr></thead><tbody><tr><td>数据库支持</td><td>支持多种数据库，包括SQL Server、Oracle等</td><td>特定于数据库（如SqlClient针对SQL Server）</td><td>支持多种数据库</td></tr><tr><td>性能</td><td>通常较慢，因为它提供了一层抽象</td><td>直接与数据库通信，性能较高</td><td>高级抽象，性能优化可变</td></tr><tr><td>操作方式</td><td>低级，需要手动编写SQL语句和管理连接</td><td>低级，同样需要手动处理SQL和连接</td><td>高级抽象，自动处理SQL</td></tr><tr><td>代码复杂性</td><td>较高，需要处理更多的细节</td><td>较高，类似OleDb</td><td>较低，简化数据操作</td></tr><tr><td>平台依赖性</td><td>较高，依赖于安装的OLE DB提供程序</td><td>较低，通常内置支持</td><td>较低，内置支持</td></tr><tr><td>设计目的</td><td>数据访问的通用解决方案，兼容性好</td><td>针对特定数据库的优化访问</td><td>全面的ORM解决方案</td></tr></tbody></table> 
<h4><a id="2_OleDbExcel_367"></a>2. OleDb和其他Excel操作方式的对比</h4> 
<table><thead><tr><th>特性</th><th>OleDb</th><th>Excel Interop</th><th>EPPlus等第三方库</th></tr></thead><tbody><tr><td>系统要求</td><td>需要安装OLE DB驱动</td><td>需要安装Microsoft Office</td><td>无额外安装要求</td></tr><tr><td>性能</td><td>中等，适合中小规模数据处理</td><td>较慢，尤其是大量数据时</td><td>较快，针对大数据进行了优化</td></tr><tr><td>操作复杂性</td><td>高，需要编写SQL语句</td><td>高，需要使用Office COM API</td><td>低，简洁的API</td></tr><tr><td>功能丰富性</td><td>适合简单的数据读写</td><td>功能丰富，可以操作Excel的几乎所有特性</td><td>功能丰富，专注于数据处理</td></tr><tr><td>编程模型</td><td>通过SQL语句访问数据</td><td>直接操作Excel对象模型</td><td>使用类似Excel的对象模型</td></tr><tr><td>处理复杂文档能力</td><td>限制较多，不适合处理复杂的Excel文件格式</td><td>非常适合处理复杂文档</td><td>较适合处理数据密集型文档</td></tr></tbody></table> 
<h4><a id="3_OleDb_378"></a>3. OleDb操作总结</h4> 
<ul><li><strong>通用性</strong>：OleDb提供了一个广泛的数据库访问解决方案，支持多种数据库系统。这使得它非常适合需要与多种数据源交互的应用程序。</li><li><strong>性能考虑</strong>：由于OleDb提供了一个通用的接口，可能在性能上不如专用的数据库访问技术，如直接使用SqlClient等。</li><li><strong>适用场景</strong>：OleDb非常适合那些不需要高性能数据库交互，但需要与多种数据库兼容的应用程序。对于简单的Excel数据操作也很有用，尤其是在没有安装Excel的服务器环境中。</li><li><strong>编程复杂性</strong>：使用OleDb进行数据库操作通常需要较为复杂的代码来管理连接、执行SQL命令等，不如某些现代ORM框架（如Entity Framework）提供的抽象级别高。</li></ul> 
<p>总的来说，OleDb是一个非常强大的工具，特别是在需要操作多种数据源的情况下。然而，对于特定的应用需求，使用更现代和专用的库可能会更加高效和简洁。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/098f5d8d0e435fdd97db7f79160bbfca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Go 使用 MongoDB</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6ffed89bcf11dfed5f1ec54a7299cff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【MySQL数据库】丨一文详解 JdbcTemplate(Spring中的CRUD)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>