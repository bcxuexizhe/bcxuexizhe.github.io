<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python web实战之Django的文件上传和处理详解 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/5f9fd0e116066f08775a03307ea7aa0e/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Python web实战之Django的文件上传和处理详解">
  <meta property="og:description" content="概要 关键词：Python Web开发、Django、文件上传、文件处理
今天分享一下Django的文件上传和处理。
1. 上传文件的基本原理 在开始深入讲解Django的文件上传和处理之前，先了解一下文件上传的基本原理。当用户选择要上传的文件后，该文件会被发送到服务器端，并存储在服务器的某个位置上。我们需要在服务器端对这些上传的文件进行处理，例如存储到数据库中、生成缩略图、验证文件类型等等。
1.1 Django的文件上传流程简介 在Django中，文件上传的流程可以简单概括为以下几个步骤：
用户在网页上选择要上传的文件，并点击上传按钮。
前端将文件发送给后端服务器。
Django后端接收到文件并保存到指定的位置。
根据需求对文件进行处理，如存储到数据库、生成缩略图等。
返回上传结果给用户。
2. Django文件上传的实现步骤 2.1 设置文件上传配置 首先在settings.py文件中找到MEDIA_ROOT和MEDIA_URL两个配置项。MEDIA_ROOT指定了文件上传后的存储路径，而MEDIA_URL则是文件在网页中的访问路径。
MEDIA_ROOT = os.path.join(BASE_DIR, &#39;media&#39;) MEDIA_URL = &#39;/media/&#39; 2.2 编写文件上传表单 然后在前端编写一个文件上传表单。在Django中，可以使用forms模块来方便地创建表单。
文件上传表单示例：
from django import forms class UploadFileForm(forms.Form): file = forms.FileField() 2.3 处理文件上传请求 当用户提交文件上传表单后，我们需要在后端处理文件上传的请求。在Django中，可以使用视图函数来处理请求。
处理文件上传的视图函数示例：
from django.shortcuts import render from .forms import UploadFileForm def upload_file(request): if request.method == &#39;POST&#39;: form = UploadFileForm(request.POST, request.FILES) if form.is_valid(): file = form.cleaned_data[&#39;file&#39;] # 在这里对文件进行处理，如保存到指定位置、生成缩略图等 # .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-07T10:46:50+08:00">
    <meta property="article:modified_time" content="2023-08-07T10:46:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python web实战之Django的文件上传和处理详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>     <img alt="" height="350" src="https://images2.imgbox.com/76/77/C14TfKE0_o.png" width="594"></h2> 
<p> </p> 
<hr> 
<h2>概要</h2> 
<p></p> 
<p>关键词：Python Web开发、Django、文件上传、文件处理</p> 
<p>今天分享一下Django的文件上传和处理。</p> 
<p></p> 
<h3>1. 上传文件的基本原理</h3> 
<p>在开始深入讲解Django的文件上传和处理之前，先了解一下文件上传的基本原理。当用户选择要上传的文件后，该文件会被发送到服务器端，并存储在服务器的某个位置上。我们需要在服务器端对这些上传的文件进行处理，例如存储到数据库中、生成缩略图、验证文件类型等等。</p> 
<h4>1.1 Django的文件上传流程简介</h4> 
<p>在Django中，文件上传的流程可以简单概括为以下几个步骤：</p> 
<ol><li> <p>用户在网页上选择要上传的文件，并点击上传按钮。</p> </li><li> <p>前端将文件发送给后端服务器。</p> </li><li> <p>Django后端接收到文件并保存到指定的位置。</p> </li><li> <p>根据需求对文件进行处理，如存储到数据库、生成缩略图等。</p> </li><li> <p>返回上传结果给用户。</p> </li></ol> 
<h3>2. Django文件上传的实现步骤</h3> 
<h4>2.1 设置文件上传配置</h4> 
<p>首先在<code>settings.py</code>文件中找到<code>MEDIA_ROOT</code>和<code>MEDIA_URL</code>两个配置项。<code>MEDIA_ROOT</code>指定了文件上传后的存储路径，而<code>MEDIA_URL</code>则是文件在网页中的访问路径。</p> 
<pre><code>MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
MEDIA_URL = '/media/'
</code></pre> 
<h4>2.2 编写文件上传表单</h4> 
<p>然后在前端编写一个文件上传表单。在Django中，可以使用<code>forms</code>模块来方便地创建表单。</p> 
<p>文件上传表单示例：</p> 
<pre><code>from django import forms

class UploadFileForm(forms.Form):
    file = forms.FileField()
</code></pre> 
<h4>2.3 处理文件上传请求</h4> 
<p>当用户提交文件上传表单后，我们需要在后端处理文件上传的请求。在Django中，可以使用视图函数来处理请求。</p> 
<p>处理文件上传的视图函数示例：</p> 
<pre><code>from django.shortcuts import render
from .forms import UploadFileForm

def upload_file(request):
    if request.method == 'POST':
        form = UploadFileForm(request.POST, request.FILES)
        if form.is_valid():
            file = form.cleaned_data['file']
            # 在这里对文件进行处理，如保存到指定位置、生成缩略图等
            # ...
            return render(request, 'upload_success.html')
    else:
        form = UploadFileForm()
    return render(request, 'upload.html', {'form': form})
</code></pre> 
<h4>2.4 处理上传的文件</h4> 
<p>在视图函数中，我们可以通过<code>request.FILES</code>获取到上传的文件对象。接下来，我们可以根据需求对文件进行处理，例如保存到指定位置、生成缩略图等。</p> 
<p>简单的文件保存示例：</p> 
<pre><code>import os
from django.conf import settings
from django.shortcuts import render
from .forms import UploadFileForm

def upload_file(request):
    if request.method == 'POST':
        form = UploadFileForm(request.POST, request.FILES)
        if form.is_valid():
            file = form.cleaned_data['file']
            # 将文件保存到指定位置
            with open(os.path.join(settings.MEDIA_ROOT, file.name), 'wb') as destination:
                for chunk in file.chunks():
                    destination.write(chunk)
            return render(request, 'upload_success.html')
    else:
        form = UploadFileForm()
        return render(request, 'upload.html', {'form': form})
</code></pre> 
<h4>2.5 文件上传成功页面</h4> 
<p>最后，我们需要为文件上传成功后的页面创建一个模板。在这个模板中，我们可以展示上传成功的信息，或者提供其他操作选项。</p> 
<p>简单的文件上传成功页面示例：</p> 
<pre><code>&lt;!-- upload_success.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;文件上传成功&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;文件上传成功！&lt;/h1&gt;
    &lt;!-- 在这里添加其他内容或操作选项 --&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre> 
<h3>2.6 阿里云OSS文件上传</h3> 
<p>除了本地文件系统，我们还可以将上传的文件存储到云存储服务中，例如阿里云的对象存储服务（OSS）。在Django中，使用阿里云OSS进行文件上传非常简单。</p> 
<h4>2.6.1 安装阿里云Python SDK</h4> 
<p>首先，我们需要安装阿里云Python SDK，它提供了与阿里云各项服务交互的功能。在终端中执行以下命令进行安装：</p> 
<pre><code>pip install aliyun-python-sdk-core
pip install aliyun-python-sdk-oss2
</code></pre> 
<h4>2.6.2 配置阿里云OSS</h4> 
<p>在使用阿里云OSS之前，我们需要先进行配置。在<code>settings.py</code>文件中添加以下配置项：</p> 
<pre><code>ALIYUN_ACCESS_KEY_ID = 'your_access_key_id'
ALIYUN_ACCESS_KEY_SECRET = 'your_access_key_secret'
ALIYUN_OSS_ENDPOINT = 'your_oss_endpoint'
ALIYUN_OSS_BUCKET_NAME = 'your_bucket_name'
</code></pre> 
<p>在这里，你需要将<code>your_access_key_id</code>和<code>your_access_key_secret</code>替换为你的阿里云Access Key ID和Access Key Secret。<code>your_oss_endpoint</code>是你的OSS服务的访问域名，<code>your_bucket_name</code>是你创建的存储桶名称。</p> 
<h4>2.6.3 编写阿里云OSS文件上传函数</h4> 
<p>接下来编写一个函数来实现将文件上传到阿里云OSS的功能。</p> 
<p>示例：</p> 
<pre><code>import oss2
from django.conf import settings

def upload_to_oss(file):
    auth = oss2.Auth(settings.ALIYUN_ACCESS_KEY_ID, settings.ALIYUN_ACCESS_KEY_SECRET)
    bucket = oss2.Bucket(auth, settings.ALIYUN_OSS_ENDPOINT, settings.ALIYUN_OSS_BUCKET_NAME)

    # 生成一个随机的文件名
    filename = oss2.utils.to_string(os.urandom(8)).encode('hex') + os.path.splitext(file.name)[1]

    # 上传文件到阿里云OSS
    bucket.put_object(filename, file)

    # 返回文件在OSS中的访问URL
    return f'https://{settings.ALIYUN_OSS_BUCKET_NAME}.{settings.ALIYUN_OSS_ENDPOINT}/{filename}'
</code></pre> 
<p>在这个函数中，我们首先使用Access Key ID和Access Key Secret创建一个<code>Auth</code>对象，并指定OSS服务的访问域名和存储桶名称。然后，我们生成一个随机的文件名，并调用<code>bucket.put_object</code>方法将文件上传到OSS中。</p> 
<p>最后，获取返回文件在OSS中的访问URL，保存到数据库，供后续使用。</p> 
<h4>2.6.4 调用阿里云OSS文件上传函数</h4> 
<p>在视图函数中，可以调用上述编写的阿里云OSS文件上传函数，将文件上传到阿里云OSS。</p> 
<p>示例：</p> 
<pre><code>def upload_file(request):
    if request.method == 'POST':
        form = UploadFileForm(request.POST, request.FILES)
        if form.is_valid():
            file = form.cleaned_data['file']

            # 将文件上传到阿里云OSS
            oss_url = upload_to_oss(file)

            # 在这里可以对上传成功的文件进行其他操作
            # ...

            return render(request, 'upload_success.html', {'oss_url': oss_url})
    else:
       form = UploadFileForm()
        return render(request, 'upload.html', {'form': form})
</code></pre> 
<h3>3. 技术总结</h3> 
<p>本文介绍了Django框架中文件上传和处理的基本原理和实现方法，以及阿里云oss的对接方法。</p> 
<p>Django 提供了一些内置的功能和工具，使文件上传变得简单和安全。它提供了一个处理文件上传的高级 API，可以验证上传的文件、处理文件存储路径、限制文件大小和类型，以及执行其他与文件操作相关的任务。</p> 
<p>使用阿里云OSS可以方便地将文件存储在云端，并提供高可用性和可靠性。这种集成可以帮助我们在Django项目中实现灵活的文件上传功能。</p> 
<p></p> 
<p>如果文章对你有所帮助，欢迎点赞收藏转发，感谢！！</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/977a3f4ebb26258dec250e482cd59f8e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">（C语言版）力扣（LeetCode）面试题 17.04. 消失的数字5种解法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcc2417623f46ca45fb5ce6bc0987bf2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【git】Git 回退到指定版本：</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>