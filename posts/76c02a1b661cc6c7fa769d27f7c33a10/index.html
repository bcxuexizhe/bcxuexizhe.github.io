<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>XYCTF 2024 部分web wp - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/76c02a1b661cc6c7fa769d27f7c33a10/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="XYCTF 2024 部分web wp">
  <meta property="og:description" content="1、ezhttp 打开靶机
使用御剑扫描得到
跟进之后，发现了账号密码，登录又得到提示
登录得到提示
那我们使用bp抓包添加Referer即可得到下一步提示。
发现还不是XYCTF的浏览器那我们改改浏览器User-Agent：XYCTF
还需要本地用户，那我们在修改一个client-IP:127.0.0.1添加上去即可
还需要一个代理，网上查找了一下伪造代理就发现使用via即可。
那我们就传cookie即可
2、ezMake 打开靶机
随便输入一个ls试试看
这里的SHELL := /bin/bash：这行设置了 Makefile 里命令执行的 shell 环境为 /bin/bash。
ifndef PATH 和 override PATH :=：这两行检查环境变量 PATH 是否被定义，如果没有定义或者已经被定义，它们都会将 PATH 环境变量置空。这可能会导致问题，因为 PATH 是一个重要的环境变量，它定义了 shell 查找可执行文件的位置。
所以我们可以尝试一下echo $(&lt; flag)试试看
返回一个echo，$被过滤了，那我们双写试试看。
3、ez?Make 打开靶机，跟1一样，随便输一个试试看。
被过滤了，那就换一个查。
既然可以pwd，那就试试能不能cd。
开始构造payload
cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;cat /flag 检查发现cat /flag被过滤了，那我们换more，至于flag我们可以使用区间取值。
cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;more [d-h][k-m][9-z][e-h] 4、εZ?¿м@Kε¿? 打开靶机
解析
这个命令看起来是在尝试使用两个输入重定向符号来传递输入给一个空的文件描述符。通常，&lt;符号用于
输入重定向，而 &lt; 是一种 s h e l l 变量，表示从标准输入中读取。但是在这个命令中， &lt;是一种shell变量，表示从标准输入中读取。但是在这个命令中， &lt;是一种shell变量，表示从标准输入中读取。但是在这个命令中，$表示当前shell的进">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-26T17:40:26+08:00">
    <meta property="article:modified_time" content="2024-04-26T17:40:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">XYCTF 2024 部分web wp</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1ezhttp_0"></a>1、ezhttp</h3> 
<p>打开靶机<br> <img src="https://images2.imgbox.com/28/52/XhXlnzpp_o.png" alt="在这里插入图片描述"></p> 
<p>使用御剑扫描得到<br> <img src="https://images2.imgbox.com/41/e3/4uU6kWRn_o.png" alt="在这里插入图片描述"></p> 
<p>跟进之后，发现了账号密码，登录又得到提示<br> <img src="https://images2.imgbox.com/1c/c0/WaZqDxsf_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6c/0d/i1sWKCen_o.png" alt="在这里插入图片描述"><br> 登录得到提示<br> <img src="https://images2.imgbox.com/b7/03/yvy1HFbu_o.png" alt="在这里插入图片描述"></p> 
<p>那我们使用bp抓包添加Referer即可得到下一步提示。</p> 
<p><img src="https://images2.imgbox.com/e3/27/H3DcDjza_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/36/0c/kU6K3B1D_o.png" alt="在这里插入图片描述"></p> 
<p>发现还不是XYCTF的浏览器那我们改改浏览器User-Agent：XYCTF</p> 
<p><img src="https://images2.imgbox.com/6a/31/ep4WY29P_o.png" alt="在这里插入图片描述"></p> 
<p>还需要本地用户，那我们在修改一个client-IP:127.0.0.1添加上去即可</p> 
<p><img src="https://images2.imgbox.com/49/5f/HUytLZ5M_o.png" alt="在这里插入图片描述"></p> 
<p>还需要一个代理，网上查找了一下伪造代理就发现使用via即可。</p> 
<p><img src="https://images2.imgbox.com/10/c5/VU2vOcWr_o.png" alt="在这里插入图片描述"></p> 
<p>那我们就传cookie即可</p> 
<p><img src="https://images2.imgbox.com/6f/d6/HsnWq1yR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2ezMake_47"></a>2、ezMake</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/21/ea/GAndnoxT_o.png" alt="在这里插入图片描述"></p> 
<p>随便输入一个ls试试看</p> 
<p><img src="https://images2.imgbox.com/5b/fa/PsUO6bSp_o.png" alt="在这里插入图片描述"></p> 
<p>这里的SHELL := /bin/bash：这行设置了 Makefile 里命令执行的 shell 环境为 /bin/bash。<br> ifndef PATH 和 override PATH :=：这两行检查环境变量 PATH 是否被定义，如果没有定义或者已经被定义，它们都会将 PATH 环境变量置空。这可能会导致问题，因为 PATH 是一个重要的环境变量，它定义了 shell 查找可执行文件的位置。</p> 
<p>所以我们可以尝试一下echo $(&lt; flag)试试看</p> 
<p><img src="https://images2.imgbox.com/cb/e4/5buU5hu6_o.png" alt="在这里插入图片描述"></p> 
<p>返回一个echo，$被过滤了，那我们双写试试看。</p> 
<p><img src="https://images2.imgbox.com/5c/9e/Tf9g2r2L_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3ezMake_72"></a>3、ez?Make</h3> 
<p>打开靶机，跟1一样，随便输一个试试看。</p> 
<p><img src="https://images2.imgbox.com/66/44/NOR0rjQ4_o.png" alt="在这里插入图片描述"></p> 
<p>被过滤了，那就换一个查。</p> 
<p><img src="https://images2.imgbox.com/ac/e9/n5ELIRx8_o.png" alt="在这里插入图片描述"></p> 
<p>既然可以pwd，那就试试能不能cd。</p> 
<p><img src="https://images2.imgbox.com/3f/e0/siRxvJvs_o.png" alt="在这里插入图片描述"></p> 
<p>开始构造payload</p> 
<pre><code>cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;cat /flag
</code></pre> 
<p><img src="https://images2.imgbox.com/c0/96/zjCujIRb_o.png" alt="在这里插入图片描述"></p> 
<p>检查发现cat /flag被过滤了，那我们换more，至于flag我们可以使用区间取值。</p> 
<pre><code>cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;more [d-h][k-m][9-z][e-h]
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/f3/HCO69fQk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4ZK_104"></a>4、εZ?¿м@Kε¿?</h3> 
<p>打开靶机<br> <img src="https://images2.imgbox.com/2c/71/jcToIfJ7_o.png" alt="在这里插入图片描述"></p> 
<p>解析</p> 
<p>这个命令看起来是在尝试使用两个输入重定向符号来传递输入给一个空的文件描述符。通常，&lt;符号用于</p> 
<p>输入重定向，而<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         &lt; 
        
       
         是一种 
        
       
         s 
        
       
         h 
        
       
         e 
        
       
         l 
        
       
         l 
        
       
         变量，表示从标准输入中读取。但是在这个命令中， 
        
       
      
        &lt;是一种shell变量，表示从标准输入中读取。但是在这个命令中， 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord cjk_fallback">是一种</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right: 0.0197em;">ll</span><span class="mord cjk_fallback">变量，表示从标准输入中读取。但是在这个命令中，</span></span></span></span></span>$表示当前shell的进</p> 
<p>程ID，而&lt;后面跟着的&lt;又被理解为输入重定向符号。所以整个命令看起来有些混乱。</p> 
<p><img src="https://images2.imgbox.com/31/3e/Nwd6FTx6_o.png" alt="在这里插入图片描述"></p> 
<p>首先， $$ 是一个特殊的shell变量，代表当前Shell进程的ID（PID）。在Unix和类Unix系统中，这个变量通常用于引用当前Shell进程的ID。</p> 
<p>然后， &lt; 符号通常用于输入重定向，表示将一个文件的内容作为命令的输入，或者从文件中读取内容。</p> 
<p>接着， $&lt; 看起来像是一个尝试使用 &lt; 符号来读取 $ 字符后面的内容，但这在常规的shell语法中是不被接受的。</p> 
<p>因此，整个命令 $<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         &lt; 
        
       
      
        (&lt; 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mrel">&lt;</span></span></span></span></span>&lt;) 似乎尝试将当前Shell进程的ID作为文件名，然后使用 &lt; 符号将其作为输入重定向，但这在大多数情况下并不合法，因为Shell通常不会允许使用PID来打开文件。</p> 
<h3><a id="5ezmd5_130"></a>5、ezmd5</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/87/fc/BnvKh88Q_o.png" alt="在这里插入图片描述"></p> 
<p>上图片进行比较，那我们随便上传两个试试看</p> 
<p><img src="https://images2.imgbox.com/2c/ca/WhtjbQlv_o.png" alt="在这里插入图片描述"></p> 
<p>返回说只有jpg格式，那我们就把png换一个jpg的试试看</p> 
<p><img src="https://images2.imgbox.com/a5/16/XM0t4wdF_o.png" alt="在这里插入图片描述"><br> 返回</p> 
<p><img src="https://images2.imgbox.com/10/0b/0OfBJ5uQ_o.png" alt="在这里插入图片描述"></p> 
<p>分析一下</p> 
<p>这段文本告诉我们两个对象在不考虑它们的MD5哈希时是相等的，但是它们的MD5哈希值是不同的。这可能意味着虽然两个对象在某种意义上是"相等"的（例如，它们可能有相同的内容或值），但它们在某些细节上有所不同，导致它们的MD5哈希值不匹配。</p> 
<p>那我们百度两张MD5值相同的图片比较一下试试看</p> 
<p><img src="https://images2.imgbox.com/c2/ba/2PaFBgXo_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/dc/44/yTwtITPv_o.png" alt="在这里插入图片描述"></p> 
<p>最后返回flag</p> 
<p><img src="https://images2.imgbox.com/dc/91/ZJy2mGrn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6ezPOP_168"></a>6、ezPOP</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/1f/6a/Zz0OPo6M_o.png" alt="在这里插入图片描述"></p> 
<p>一开始以为pop链条的构造很简单，就是cab触发，关键是calluserfunc怎么利用</p> 
<p>测试一下发现不是这样</p> 
<p>Payload</p> 
<pre><code>var_dump(call_user_func(current,hex2bin)(73797374656d)('dir'));
</code></pre> 
<p>我们把对应参数赋值，c和d分别在pop链条里面进行赋值，a和b在外部</p> 
<p>GET传参</p> 
<p>xy=a:2:{i:0;O:3:“CCC”:1:{s:1:“c”;O:3:“AAA”:2:{s:1:“s”;O:3:“BBB”:2:<br> {s:1:“c”;s:12:“73797374656d”;s:1:“d”;s:9:“cat /flag”;}s:1:“a”;s:1:“g”;}}i:0;N;}</p> 
<p>POST传参</p> 
<pre><code>a=current&amp;c=hex2bin
</code></pre> 
<p>最后得出flag</p> 
<p><img src="https://images2.imgbox.com/8c/e8/I88xjL0J_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7ezRCE_205"></a>7、ezRCE</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/1e/45/MqeTzQl3_o.png" alt="在这里插入图片描述"></p> 
<p>解析</p> 
<p>这是一个白名单绕过，从<span class="katex--inline">KaTeX parse error: Expected group as argument to '\'' at position 63: …8','9','\\','\''̲,'</span>‘,’&lt;'];这里可以看出能给我们输入的并不对<br> 而且system($cmd);是直接执行系统命令<br> 那好，现在我们来尝试构造payload<br> 首先系统命令?cmd=肯定是要的<br> 那我们这里就在想了，既然限制我们只能输入这些<br> 那我们普通的ls cat这些命令不就用不了了嘛<br> 那怎么办呢？？<br> 一开始我也懵啊<br> 然后我就查资料呗<br> 发现其实liunx命令使用八进制也能运行<br> 就比如ls的八进制是\154\163<br> 那我们直接这样就可以被系统读取嘛？？？<br> 那当然不行，如果这样的话，系统会直接默认为普通数字并不会有任何操作<br> 那我怎么办呢？<br> 这里问了一下GPT，我们可以利用bash的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
        
          ′ 
         
        
       
         s 
        
       
         t 
        
       
         r 
        
       
         i 
        
       
         n 
        
        
        
          g 
         
        
          ′ 
         
        
       
         语法，它允许字符串中的转义序列被解释。那这里我们就可以直接写成 
        
       
      
        'string' 语法，它允许字符串中的转义序列被解释。 那这里我们就可以直接写成 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9463em; vertical-align: -0.1944em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal">in</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord cjk_fallback">语法，它允许字符串中的转义序列被解释。那这里我们就可以直接写成</span></span></span></span></span>’ \154\163’,就这样，我们尝试一下能不能在liunx里面运行</p> 
<p><img src="https://images2.imgbox.com/21/2b/4UtYOsLD_o.png" alt="在这里插入图片描述"></p> 
<p>可以看见成功运行，那我们这里的payload就可以写成</p> 
<pre><code>?cmd=$’\154\163’
</code></pre> 
<p>返回</p> 
<p><img src="https://images2.imgbox.com/6e/ef/MebU6qPR_o.png" alt="在这里插入图片描述"></p> 
<p>虽然flag不在当前目录有点可惜，但是我们知道了使用八进制构造payload是可行的<br> 那我们怎么办呢？<br> 直接cat /flag嘛？<br> 那显然是不可能的，因为flag都不在当前页面你怎么cat啊<br> 那这里去请教了一下师傅，我们虽然不能直接cat的<br> 但是我们看见白名单里面有个&lt;小于号<br> 哎，是不是想起来了？<br> 没错，我们可以使用&lt;重定向flag<br> 通俗易懂一点就是说<br> 如果把它想象成一种“流动”，可以这样理解：文件 “/flag” 的内容像水一样流入了 “cat” 命令，然后 “cat” 命令将它输出到了屏幕上。<br> 那cat转换八进制就是\143\141\164<br> /flag八进制就是\057\146\154\141\147<br> &lt;不变<br> 所以我们可以这样构造payload</p> 
<pre><code>?cmd=$'\143\141\164'&lt;$'\057\146\154\141\147'
</code></pre> 
<p>仔细看清楚了没有空格跟括号！！！！<br> 所以最后得出</p> 
<p><img src="https://images2.imgbox.com/e7/d5/YfCJcBvl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8warm_up_268"></a>8、warm up</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/d6/bf/smGyYH0X_o.png" alt="在这里插入图片描述"></p> 
<p>简单分析一下<br> 第一个条件：‘val1’ 和 ‘val2’ 必须存在，且它们的值不能相等，但他们的 md5 值必须相等。这种情况在 PHP 中是可能的，因为 PHP 的 md5 函数对于某些特殊的字符串存在哈希碰撞。一个常见的例子是 ‘val1’ 设置为 ’ QNKCDZO’，‘val2’ 设置为 ‘240610708’，这两个字符串的 md5 值都是 ‘0e830400451993494058024219903391’。</p> 
<p>payload</p> 
<pre><code>http://xyctf.top:42998/?val1=QNKCDZO&amp;val2=240610708
</code></pre> 
<p>即可得到</p> 
<p><img src="https://images2.imgbox.com/1f/93/ylhXQAhI_o.png" alt="在这里插入图片描述"></p> 
<p>第二个条件<br> $md5 必须存在，且 $md5 的 md5 值必须等于 $md5。这个条件只有当 $md5 为一个特定的值时才能满足。<br> 在 PHP 中，当进行字符串比较时，任何以 ‘0e’ 开头的字符串都会被视为 0，因为这种形式的字符串被解析为浮点数（科学计数法）。<br> 所以这个”0e215962017”就是一个满足条件的字符串。它的md5 值是 ‘0e291242834679215926201711822669466’。当 $md5 设置为 ‘0e215962017’ 时，这个字符串的 md5 值和它自身进行比较时，都会被视为 0，因此满足了 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
         d 
        
       
         5 
        
       
         = 
        
       
         = 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         ( 
        
       
      
        md5 == md5( 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mopen">(</span></span></span></span></span>md5) 的条件。</p> 
<p><img src="https://images2.imgbox.com/1e/bb/hSxgdb0K_o.png" alt="在这里插入图片描述"></p> 
<p>最后还有第三个条就能解出，那我们来分析一下<br> 在这个条件中，$XY 必须等于 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
         Y 
        
       
         C 
        
       
         T 
        
       
         F 
        
       
         ， 
        
       
      
        XYCTF， 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord mathnormal" style="margin-right: 0.1389em;">CTF</span><span class="mord cjk_fallback">，</span></span></span></span></span>XY 不能等于 “XYCTF_550102591”，但是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
         Y 
        
       
         的 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         值必须等于 
        
       
         " 
        
       
         X 
        
       
         Y 
        
       
         C 
        
       
         T 
        
        
        
          F 
         
        
          5 
         
        
       
         50102591 
        
       
         " 
        
       
         的 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         值。然而， 
        
       
         " 
        
       
         X 
        
       
         Y 
        
       
         C 
        
       
         T 
        
        
        
          F 
         
        
          5 
         
        
       
         50102591 
        
       
         " 
        
       
         的 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         值是 
        
       
         " 
        
       
         0 
        
       
         e 
        
       
         77033489083562900000837272529 
        
       
         " 
        
       
         。这个 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         值在 
        
       
         P 
        
       
         H 
        
       
         P 
        
       
         中会被解析为 
        
       
         0 
        
       
         ，因为它以 
        
       
         " 
        
       
         0 
        
       
         e 
        
       
         " 
        
       
         开头。在 
        
       
         " 
        
       
         314282422 
        
       
         " 
        
       
         中， 
        
       
      
        XY 的 md5 值必须等于 "XYCTF_550102591" 的 md5 值。 然而，"XYCTF_550102591" 的 md5 值是 "0e77033489083562900000837272529"。这个 md5 值在 PHP 中会被解析为 0，因为它以 "0e" 开头。 在 "314282422" 中， 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8444em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord cjk_fallback">的</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mord cjk_fallback">值必须等于</span><span class="mord">"</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord mathnormal" style="margin-right: 0.1389em;">CT</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">50102591"</span><span class="mord cjk_fallback">的</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mord cjk_fallback">值。然而，</span><span class="mord">"</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord mathnormal" style="margin-right: 0.1389em;">CT</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">50102591"</span><span class="mord cjk_fallback">的</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mord cjk_fallback">值是</span><span class="mord">"0</span><span class="mord mathnormal">e</span><span class="mord">77033489083562900000837272529"</span><span class="mord cjk_fallback">。这个</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mord cjk_fallback">值在</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord cjk_fallback">中会被解析为</span><span class="mord">0</span><span class="mord cjk_fallback">，因为它以</span><span class="mord">"0</span><span class="mord mathnormal">e</span><span class="mord">"</span><span class="mord cjk_fallback">开头。在</span><span class="mord">"314282422"</span><span class="mord cjk_fallback">中，</span></span></span></span></span>XY 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         X 
        
       
         Y 
        
       
         C 
        
       
         T 
        
       
         F 
        
       
         的值都是 
        
       
         " 
        
       
         314282422 
        
       
         " 
        
       
         ，所以它们是相等的。另外， 
        
       
         " 
        
       
         314282422 
        
       
         " 
        
       
         的 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         值是 
        
       
         " 
        
       
         0 
        
       
         e 
        
       
         830400451993494058024219903391 
        
       
         " 
        
       
         , 
        
       
         它以 
        
       
         " 
        
       
         0 
        
       
         e 
        
       
         " 
        
       
         开头，所以在 
        
       
         P 
        
       
         H 
        
       
         P 
        
       
         中会被解析为 
        
       
         0 
        
       
         。这样， 
        
       
         m 
        
       
         d 
        
       
         5 
        
       
         ( 
        
       
      
        XYCTF 的值都是 "314282422"，所以它们是相等的。另外，"314282422" 的 md5 值是 "0e830400451993494058024219903391", 它以 "0e" 开头，所以在 PHP 中会被解析为 0。这样，md5( 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord mathnormal" style="margin-right: 0.1389em;">CTF</span><span class="mord cjk_fallback">的值都是</span><span class="mord">"314282422"</span><span class="mord cjk_fallback">，所以它们是相等的。另外，</span><span class="mord">"314282422"</span><span class="mord cjk_fallback">的</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mord cjk_fallback">值是</span><span class="mord">"0</span><span class="mord mathnormal">e</span><span class="mord">830400451993494058024219903391"</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord cjk_fallback">它以</span><span class="mord">"0</span><span class="mord mathnormal">e</span><span class="mord">"</span><span class="mord cjk_fallback">开头，所以在</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord mathnormal" style="margin-right: 0.0813em;">H</span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mord cjk_fallback">中会被解析为</span><span class="mord">0</span><span class="mord cjk_fallback">。这样，</span><span class="mord mathnormal">m</span><span class="mord mathnormal">d</span><span class="mord">5</span><span class="mopen">(</span></span></span></span></span>XY) 就等于 md5(“XYCTF_550102591”)。</p> 
<p><img src="https://images2.imgbox.com/ef/5d/QqXlc5BR_o.png" alt="在这里插入图片描述"></p> 
<p>访问，URL+LLeeevvveeelll222.php即可</p> 
<p><img src="https://images2.imgbox.com/d9/e6/ET4an6nL_o.png" alt="在这里插入图片描述"></p> 
<p>使用bp抓包修改</p> 
<p><img src="https://images2.imgbox.com/51/63/Jp2PNVC4_o.png" alt="在这里插入图片描述"></p> 
<p>直接发送到repeater修改尝试</p> 
<p>首先，我们要满足条件 isset($_POST[‘a’]) &amp;&amp; !preg_match(‘/[0-9]/’, <span class="katex--inline">KaTeX parse error: Expected 'EOF', got '&amp;' at position 13: _POST['a']) &amp;̲&amp; intval(</span>_POST[‘a’])。我们可以通过发送一个 POST 请求，并设置 a 为一个空数组来实现。</p> 
<p>这样 $_POST[‘a’] 就存在了，且 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
        
          P 
         
        
       
         O 
        
       
         S 
        
       
         T 
        
        
        
          [ 
         
        
          ′ 
         
        
        
        
          a 
         
        
          ′ 
         
        
       
         ] 
        
       
         中不包含数字，但是 
        
       
         i 
        
       
         n 
        
       
         t 
        
       
         v 
        
       
         a 
        
       
         l 
        
       
         ( 
        
       
      
        _POST['a'] 中不包含数字，但是 intval( 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.1389em;">OST</span><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord cjk_fallback">中不包含数字，但是</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mopen">(</span></span></span></span></span>_POST[‘a’]) 的结果为 0，因此这个条件判断为假，进入 else 分支，打印出 “有点汗流浃背”。</p> 
<p>接下来，我们需要执行 preg_replace(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
        
          G 
         
        
       
         E 
        
       
         T 
        
        
        
          [ 
         
        
          ′ 
         
        
        
        
          a 
         
        
          ′ 
         
        
       
         ] 
        
       
         , 
        
       
      
        _GET['a'], 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.1389em;">ET</span><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mpunct">,</span></span></span></span></span>_GET[‘b’],$_GET[‘c’])，并让它执行我们想要的系统命令。我们可以通过在 URL 中添加查询字符串 ?a=/abc/e&amp;b=system(‘/ls’)&amp;c=abc 来实现。这样 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
        
          G 
         
        
       
         E 
        
       
         T 
        
        
        
          [ 
         
        
          ′ 
         
        
        
        
          a 
         
        
          ′ 
         
        
       
         ] 
        
       
         的值就是 
        
       
         / 
        
       
         a 
        
       
         b 
        
       
         c 
        
       
         / 
        
       
         e 
        
       
         ， 
        
       
      
        _GET['a'] 的值就是 /abc/e， 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0019em; vertical-align: -0.25em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.1389em;">ET</span><span class="mopen"><span class="mopen">[</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7519em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord cjk_fallback">的值就是</span><span class="mord">/</span><span class="mord mathnormal">ab</span><span class="mord mathnormal">c</span><span class="mord">/</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">，</span></span></span></span></span>_GET[‘b’] 的值就是 system(‘/ls’)，$_GET[‘c’] 的值就是 abc。</p> 
<p>preg_replace() 函数会在 $_GET[‘c’] 的值 “abc” 中查找与 $_GET[‘a’] 的值 “/abc/e” 匹配的内容，然后使用 $_GET[‘b’] 的值 system(‘/ls’) 替换匹配到的内容。因为 $_GET[‘a’] 的值是一个正则表达式，所以它会匹配到 $_GET[‘c’] 的值 “abc”，并执行 system(‘/ls’) 命令，最后将命令的输出替换到 “abc” 中。</p> 
<p>综上，我们可以通过以下 HTTP 请求来满足这个 PHP 代码的条件，并执行我们想要的系统命令：</p> 
<p><img src="https://images2.imgbox.com/d6/41/FqO3Z8YE_o.png" alt="在这里插入图片描述"></p> 
<p>这里为什么要补上一个Content-Type: application/x-www-form-urlencoded</p> 
<p>因为</p> 
<p>在 HTTP 协议中，当你发送一个 POST 请求时，Content-Type 头部字段用于告诉服务器你发送的数据的类型。application/x-www-form-urlencoded 是一种常见的数据类型，它表示发送的数据是一个 URL 编码的表单。</p> 
<p><img src="https://images2.imgbox.com/18/52/hhJ5loZt_o.png" alt="在这里插入图片描述"></p> 
<p>为什么说那么详细，总的来说这是我第一次做md5的web还是有很多地方值得我反复观看且学习，不是很复杂，但是需要耐心，慢慢寻找资料，理解其中的意思。</p> 
<h3><a id="9_342"></a>9、牢牢记住，逝者为大</h3> 
<p>打开靶机</p> 
<p><img src="https://images2.imgbox.com/81/5f/1Ft36cZA_o.png" alt="在这里插入图片描述"></p> 
<p>名单绕过</p> 
<p>构造payload</p> 
<pre><code>?cmd=%0dprint`dir`;%23
</code></pre> 
<p><img src="https://images2.imgbox.com/39/6c/jtFZB0cd_o.png" alt="在这里插入图片描述"></p> 
<p>发现可以使用GET[‘cmd’]躲避长度限制</p> 
<p>那我们就可以构造payload为（模仿CTFshow的）</p> 
<pre><code>?cmd=%0d`$_GET[c]`;%23&amp;c=cp /flag nn
</code></pre> 
<p>简单来说就是把flag复制到根目录nn里面，如果我们复制成功的话，待会就可以直接访问nn来获取flag了</p> 
<p><img src="https://images2.imgbox.com/99/48/3kJmAl0q_o.png" alt="在这里插入图片描述"></p> 
<p>想法固然不错，但我们还缺一个关键点，名称就是转换成为八进制然后在运行</p> 
<pre><code>?cmd=%0d`$_GET[c]`;%23&amp;c=cp /flag nn转八进制

?cmd=%0d`$_GET[c]`;%23&amp;c=$'\143\160'+$'\57\146\154\141\147'+$'\156\156’
</code></pre> 
<p>然后我们在运行试试看（注意这里前后之间我们使用+链接，要不然系统读取不到）</p> 
<p><img src="https://images2.imgbox.com/f5/28/QW4K732d_o.png" alt="在这里插入图片描述"></p> 
<p>可以看见，大差不差应该是成功了，并没有返回什么错误值</p> 
<p>那我们就可以直接访问nn来获取文件</p> 
<p><img src="https://images2.imgbox.com/39/9e/7uPbvdbr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="10pharme_386"></a>10、pharme</h3> 
<p>生成 phar 包</p> 
<p><img src="https://images2.imgbox.com/e0/6d/qi7jqVAu_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/cb/5e/8SAdfwmW_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e1/02/SAK1J0N0_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/96/5f/X6e45xX0_o.png" alt="在这里插入图片描述"></p> 
<p>成功上传，给出了文件路径，这里的文件名，应该是对原文件名取得哈希值。</p> 
<pre><code>/tmp/f3ccdd27d2000e3f9255a7e3e2c48800.jpg
</code></pre> 
<p>进入 class.php</p> 
<p><img src="https://images2.imgbox.com/f7/14/BXOeFNbw_o.png" alt="在这里插入图片描述"></p> 
<p>命令成功执行</p> 
<p>如有写的不好地方，请师傅们多多包涵，刚学没多久。</p> 
<p>制作不易，点个赞吧~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27f5f8ca22ced6eb090a743815560467/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">llama-factory SFT系列教程 (一)，大模型 API 部署与使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2da9598ede93b27434bbafa2a45d9a8c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">伪分布式数据库搭建（hadoop&#43;spark&#43;scala）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>