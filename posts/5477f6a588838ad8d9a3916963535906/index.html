<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>苍穹外卖11（Apache ECharts前端统计，营业额统计，用户统计，订单统计，销量排名Top10） - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/5477f6a588838ad8d9a3916963535906/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="苍穹外卖11（Apache ECharts前端统计，营业额统计，用户统计，订单统计，销量排名Top10）">
  <meta property="og:description" content="目录
一、Apache ECharts【前端】
1. 介绍
2. 入门案例
二、营业额统计
1. 需求分析和设计
1 产品原型
2 业务规则
3 接口设计
2. 代码开发
3. 功能测试
三、用户统计
1. 需求分析和设计
1 产品原型
2 业务规则
3 接口设计
2. 代码开发
3. 功能测试
四、订单统计
1. 需求分析和设计
1 产品原型
2 业务规则
3 接口设计
2. 代码开发
3. 功能测试
五、销量排名Top10
1. 需求分析和设计
1 产品原型
2 业务规则
3 接口设计
2. 代码开发
3. 功能测试
一、Apache ECharts【前端】 1. 介绍 Apache ECharts 是一款基于 Javascript 的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。 官网地址：Apache ECharts">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-09T18:04:34+08:00">
    <meta property="article:modified_time" content="2024-04-09T18:04:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">苍穹外卖11（Apache ECharts前端统计，营业额统计，用户统计，订单统计，销量排名Top10）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80%E3%80%81Apache%20ECharts%E3%80%90%E5%89%8D%E7%AB%AF%E3%80%91-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81Apache%20ECharts%E3%80%90%E5%89%8D%E7%AB%AF%E3%80%91" rel="nofollow">一、Apache ECharts【前端】</a></p> 
<p id="1.%20%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#1.%20%E4%BB%8B%E7%BB%8D" rel="nofollow">1. 介绍</a></p> 
<p id="2.%20%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B-toc" style="margin-left:40px;"><a href="#2.%20%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B" rel="nofollow">2. 入门案例</a></p> 
<p id="%E4%BA%8C%E3%80%81%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1" rel="nofollow">二、营业额统计</a></p> 
<p id="1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-toc" style="margin-left:40px;"><a href="#1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1" rel="nofollow">1. 需求分析和设计</a></p> 
<p id="1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-toc" style="margin-left:80px;"><a href="#1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B" rel="nofollow">1 产品原型</a></p> 
<p id="2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99-toc" style="margin-left:80px;"><a href="#2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99" rel="nofollow">2 业务规则</a></p> 
<p id="3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-toc" style="margin-left:80px;"><a href="#3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1" rel="nofollow">3 接口设计</a></p> 
<p id="2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-toc" style="margin-left:40px;"><a href="#2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91" rel="nofollow">2. 代码开发</a></p> 
<p id="3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95" rel="nofollow">3. 功能测试</a></p> 
<p id="%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1" rel="nofollow">三、用户统计</a></p> 
<p id="1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-toc" style="margin-left:40px;"><a href="#1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1" rel="nofollow">1. 需求分析和设计</a></p> 
<p id="1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-toc" style="margin-left:80px;"><a href="#1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B" rel="nofollow">1 产品原型</a></p> 
<p id="2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99-toc" style="margin-left:80px;"><a href="#2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99" rel="nofollow">2 业务规则</a></p> 
<p id="3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-toc" style="margin-left:80px;"><a href="#3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1" rel="nofollow">3 接口设计</a></p> 
<p id="2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-toc" style="margin-left:40px;"><a href="#2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91" rel="nofollow">2. 代码开发</a></p> 
<p id="%C2%A03.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%C2%A03.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95" rel="nofollow"> 3. 功能测试</a></p> 
<p id="%E5%9B%9B%E3%80%81%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1" rel="nofollow">四、订单统计</a></p> 
<p id="1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-toc" style="margin-left:40px;"><a href="#1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1" rel="nofollow">1. 需求分析和设计</a></p> 
<p id="1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-toc" style="margin-left:80px;"><a href="#1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B" rel="nofollow">1 产品原型</a></p> 
<p id="2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99-toc" style="margin-left:80px;"><a href="#2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99" rel="nofollow">2 业务规则</a></p> 
<p id="3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-toc" style="margin-left:80px;"><a href="#3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1" rel="nofollow">3 接口设计</a></p> 
<p id="2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-toc" style="margin-left:40px;"><a href="#2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91" rel="nofollow">2. 代码开发</a></p> 
<p id="3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95" rel="nofollow">3. 功能测试</a></p> 
<p id="%E4%BA%94%E3%80%81%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10" rel="nofollow">五、销量排名Top10</a></p> 
<p id="1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1-toc" style="margin-left:40px;"><a href="#1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1" rel="nofollow">1. 需求分析和设计</a></p> 
<p id="1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B-toc" style="margin-left:80px;"><a href="#1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B" rel="nofollow">1 产品原型</a></p> 
<p id="2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99-toc" style="margin-left:80px;"><a href="#2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99" rel="nofollow">2 业务规则</a></p> 
<p id="3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1-toc" style="margin-left:80px;"><a href="#3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1" rel="nofollow">3 接口设计</a></p> 
<p id="2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-toc" style="margin-left:40px;"><a href="#2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91" rel="nofollow">2. 代码开发</a></p> 
<p id="3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95" rel="nofollow">3. 功能测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81Apache%20ECharts%E3%80%90%E5%89%8D%E7%AB%AF%E3%80%91" style="background-color:transparent;">一、Apache ECharts【前端】</h2> 
<h3 id="1.%20%E4%BB%8B%E7%BB%8D">1. 介绍</h3> 
<p>Apache ECharts 是一款基于 Javascript 的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。 官网地址：<a href="https://echarts.apache.org/zh/index.html" rel="nofollow" title="Apache ECharts">Apache ECharts</a></p> 
<p><img alt="" height="248" src="https://images2.imgbox.com/6e/d5/p6b9F0Zd_o.png" width="513"></p> 
<p><strong>常见效果展示：</strong></p> 
<p>1). 柱形图</p> 
<p><img alt="" height="323" src="https://images2.imgbox.com/20/cb/y7eKro48_o.png" width="526"> </p> 
<p>2). 饼形图  </p> 
<p><img alt="" height="316" src="https://images2.imgbox.com/70/fc/mAnoPcdp_o.png" width="500"></p> 
<p>3). 折线图</p> 
<p><img alt="" height="307" src="https://images2.imgbox.com/a0/9c/lQvlWx1m_o.png" width="525"></p> 
<p><strong>总结：</strong>不管是哪种形式的图形，最本质的东西实际上是数据，它其实是对数据的一种可视化展示。</p> 
<h3 id="2.%20%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B">2. 入门案例</h3> 
<p>Apache Echarts官方提供的快速入门：<a href="https://echarts.apache.org/handbook/zh/get-started/" rel="nofollow" title="快速上手 - 使用手册 - Apache ECharts">快速上手 - 使用手册 - Apache ECharts</a></p> 
<p><strong>效果展示：</strong></p> 
<p><img alt="" height="339" src="https://images2.imgbox.com/5a/56/XeahM08i_o.png" width="522"></p> 
<p><strong>实现步骤：</strong></p> 
<p>1). 引入echarts.js 文件(当天资料已提供)</p> 
<p>2). 为 ECharts 准备一个设置宽高的 DOM</p> 
<p>3). 初始化echarts实例</p> 
<p>4). 指定图表的配置项和数据</p> 
<p>5). 使用指定的配置项和数据显示图表</p> 
<p><strong>代码开发：</strong></p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;title&gt;ECharts&lt;/title&gt;
    &lt;!-- 引入刚刚下载的 ECharts 文件 --&gt;
    &lt;script src="echarts.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- 为 ECharts 准备一个定义了宽高的 DOM --&gt;
    &lt;div id="main" style="width: 600px;height:400px;"&gt;&lt;/div&gt;
    &lt;script type="text/javascript"&gt;
      // 基于准备好的dom，初始化echarts实例
      var myChart = echarts.init(document.getElementById('main'));

      // 指定图表的配置项和数据
      var option = {
        title: {
          text: 'ECharts 入门示例'
        },
        tooltip: {},
        legend: {
          data: ['销量']
        },
        xAxis: {
          data: ['衬衫', '羊毛衫', '雪纺衫', '裤子', '高跟鞋', '袜子']
        },
        yAxis: {},
        series: [
          {
            name: '销量',
            type: 'bar',
            data: [5, 20, 36, 10, 10, 20]
          }
        ]
      };

      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p>测试：使用浏览器方式打开即可。</p> 
<p><strong>总结：</strong>使用Echarts，重点在于研究当前图表所需的数据格式。通常是需要后端提供符合格式要求的动态数据，然后响应给前端来展示图表。</p> 
<h2 id="%E4%BA%8C%E3%80%81%E8%90%A5%E4%B8%9A%E9%A2%9D%E7%BB%9F%E8%AE%A1" style="background-color:transparent;">二、营业额统计</h2> 
<p><img alt="" height="719" src="https://images2.imgbox.com/f1/00/O2i1kr4J_o.png" width="1200"></p> 
<h3 id="1.%20%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1">1. 需求分析和设计</h3> 
<h4 id="1%20%E4%BA%A7%E5%93%81%E5%8E%9F%E5%9E%8B">1 产品原型</h4> 
<p>营业额统计是基于折现图来展现，并且按照天来展示的。实际上，就是某一个时间范围之内的每一天的营业额。同时，不管光标放在哪个点上，那么它就会把具体的数值展示出来。并且还需要注意日期并不是固定写死的，是由上边时间选择器来决定。比如选择是近7天、或者是近30日，或者是本周，就会把相应这个时间段之内的每一天日期通过横坐标展示。</p> 
<p><strong>原型图</strong> :</p> 
<p><img alt="" height="320" src="https://images2.imgbox.com/cd/37/chCr4tcp_o.png" width="560"></p> 
<h4 id="2%20%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99">2 业务规则</h4> 
<ul><li> <p>营业额，指<strong>订单状态为已完成</strong>的订单金额合计</p> </li><li> <p>基于可视化报表的折线图展示营业额数据，X轴为日期，Y轴为营业额</p> </li><li> <p>根据时间选择区间，展示每天的营业额数据</p> </li></ul> 
<h4 id="3%20%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1">3 接口设计</h4> 
<p>通过上述原型图，设计出对应的接口。</p> 
<p><img alt="" height="401" src="https://images2.imgbox.com/3c/d3/X7DwejOj_o.png" width="995"></p> 
<p><strong>注意：</strong>具体返回数据一般由前端来决定，前端展示图表，具体折现图对应数据是什么格式，是有固定的要求的。 所以说，后端需要去适应前端，它需要什么格式的数据，我们就给它返回什么格式的数据。</p> 
<h3 id="2.%20%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91">2. 代码开发</h3> 
<pre><code class="language-java">//在sky-pojo模块，TurnoverReportVO.java已定义

package com.sky.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class TurnoverReportVO implements Serializable {

    //日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
    private String dateList;

    //营业额，以逗号分隔，例如：406.0,1520.0,75.0
    private String turnoverList;

}


--------------
//创建ReportController
//根据接口定义创建ReportController：

package com.sky.controller.admin;

import com.sky.result.Result;
import com.sky.service.ReportService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.time.LocalDate;

@RestController
@Api(tags = "数据统计相关接口")
@RequestMapping("/admin/report")
public class ReportController {
    @Autowired
    private ReportService reportService;

    @GetMapping("/turnoverStatistics")
    @ApiOperation("营业额统计接口")
    public Result turnoverStatistics(@DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,
                                     @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end){
        return reportService.turnoverStatistics(begin, end);
    }
}


-------------
//创建ReportService

package com.sky.service;

import com.sky.result.Result;

import java.time.LocalDate;

public interface ReportService {
    /**
     * 统计营业额
     * @param begin
     * @param end
     * @return
     */
    Result turnoverStatistics(LocalDate begin, LocalDate end);
}


-------------
//ReportServiceImpl

package com.sky.service.impl;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.sky.mapper.OrderMapper;
import com.sky.result.Result;
import com.sky.service.ReportService;
import com.sky.vo.TurnoverReportVO;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class ReportServiceImpl implements ReportService {
    @Autowired
    private OrderMapper orderMapper;

    @Override
    public Result turnoverStatistics(LocalDate begin, LocalDate end) {
        TurnoverReportVO vo = new TurnoverReportVO();

        List&lt;LocalDate&gt; dateList = new ArrayList&lt;&gt;();
        List&lt;Double&gt; amountList = new ArrayList&lt;&gt;();
        while (!(begin.isAfter(end))) {
            //1. 把日期添加到dateList里
            dateList.add(begin);
            //2. 查询这一天的营业额，添加到amountList里
            LocalDateTime startOfDay = LocalDateTime.of(begin, LocalTime.MIN);
            LocalDateTime endOfDay = LocalDateTime.of(begin, LocalTime.MAX);
            Double amount = orderMapper.sumAmountByDate(startOfDay, endOfDay);
            amount = amount == null ? 0D : amount;
            amountList.add(amount);

            //3. 到下一天
            begin = begin.plusDays(1);
        }

        //dateList 日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
        String dateListStr = dateList.stream()
                .map(localDate -&gt; localDate.format(DateTimeFormatter.ofPattern("yyyy-MM-dd")))
                .collect(Collectors.joining(","));
        vo.setDateList(dateListStr);

        //turnoverList  营业额，以逗号分隔，例如：406.0,1520.0,75.0
        String turnoverListStr = amountList.stream()
                .map(Object::toString)
                .collect(Collectors.joining(","));
        vo.setTurnoverList(turnoverListStr);
        return Result.success(vo);
    }
}


------------
//OrderMapper

@Select("select sum(amount) from orders where status = 5 and order_time between #{start} and #{end}")
Double sumAmountByDate(LocalDateTime start, LocalDateTime end);</code></pre> 
<h3 id="3.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95">3. 功能测试</h3> 
<p>可以通过如下方式进行测试：</p> 
<ul><li> <p>接口文档测试</p> </li><li> <p>前后端联调测试</p> </li></ul> 
<p>启动服务器，启动nginx，直接采用前后端联调测试。</p> 
<p>进入数据统计模块</p> 
<p><strong>1). 查看近7日营业额统计</strong></p> 
<p><img alt="" height="407" src="https://images2.imgbox.com/8f/b6/tG6WvgTU_o.png" width="1015"></p> 
<p><img alt="" height="139" src="https://images2.imgbox.com/11/75/NmEc4Etf_o.png" width="1010"> </p> 
<p><strong>2). 查看近30日营业额统计</strong></p> 
<p><img alt="" height="416" src="https://images2.imgbox.com/01/3b/BMU5fgJW_o.png" width="1005"> </p> 
<p>进入开发者模式，查看返回数据</p> 
<p><img alt="" height="132" src="https://images2.imgbox.com/b5/53/EIVfaMnf_o.png" width="1005"> 也可通过断点方式启动，查看每步执行情况。</p> 
<h2 id="%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%BB%9F%E8%AE%A1">三、用户统计</h2> 
<h3>1. 需求分析和设计</h3> 
<h4>1 产品原型</h4> 
<p>所谓用户统计，实际上统计的是用户的数量。通过折线图来展示，上面这根蓝色线代表的是用户总量，下边这根绿色线代表的是新增用户数量，是具体到每一天。所以说用户统计主要统计<strong>两个数据</strong>，一个是<strong>总的用户数量</strong>，另外一个是<strong>新增用户数量</strong>。</p> 
<p><strong>原型图</strong> :</p> 
<p><img alt="" height="459" src="https://images2.imgbox.com/24/72/P5eEVCx3_o.png" width="1011"></p> 
<h4>2 业务规则</h4> 
<ul><li> <p>基于可视化报表的折线图展示用户数据，X轴为日期，Y轴为用户数</p> </li><li> <p>根据时间选择区间，展示每天新增用户量，和截止到当天的用户总量和</p> </li></ul> 
<h4>3 接口设计</h4> 
<p>根据上述原型图设计接口。</p> 
<p><img alt="" height="366" src="https://images2.imgbox.com/f5/5c/oDWyH8vO_o.png" width="917"></p> 
<h3>2. 代码开发</h3> 
<pre><code class="language-java">//在sky-pojo模块，UserReportVO.java已定义

package com.sky.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class UserReportVO implements Serializable {

    //日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
    private String dateList;

    //用户总量，以逗号分隔，例如：200,210,220
    private String totalUserList;

    //新增用户，以逗号分隔，例如：20,21,10
    private String newUserList;

}


--------------
//ReportController

@GetMapping("/userStatistics")
@ApiOperation("用户统计接口")
public Result userStatistics(@DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,
                             @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end){
    return reportService.userStatistics(begin, end);
}


-------------
//ReportService

    /**
     * 统计用户
     * @param begin
     * @param end
     * @return
     */
    Result userStatistics(LocalDate begin, LocalDate end);

------------
//ReportServiceImpl

@Override
public Result userStatistics(LocalDate begin, LocalDate end) {
    UserReportVO vo = new UserReportVO();

    List&lt;LocalDate&gt; dateList = new ArrayList&lt;&gt;();
    List&lt;Integer&gt; totalCountList = new ArrayList&lt;&gt;();
    List&lt;Integer&gt; newCountList = new ArrayList&lt;&gt;();
    while (!(begin.isAfter(end))) {
        //把日期加到dateList集合里
        dateList.add(begin);

        //获取截止到当天的用户总量 select count(*) from user where create_time &lt;= 当天日期
        LocalDateTime endOfDay = LocalDateTime.of(begin, LocalTime.MAX);
        Integer totalCount = userMapper.countByDate(null, endOfDay);
        totalCountList.add(totalCount==null?0:totalCount);

        //获取当天的新用户数量 select count(*) from user where create_time between 当天日期开始时间 and 当天日期结束时间
        LocalDateTime startOfDay = LocalDateTime.of(begin, LocalTime.MIN);
        Integer newCount = userMapper.countByDate(startOfDay, endOfDay);
        newCountList.add(newCount==null?0:newCount);

        //到下一天
        begin = begin.plusDays(1);
    }

    //日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
    String dateListStr = dateList.stream()
        .map(date -&gt; date.format(DateTimeFormatter.ofPattern("yyyy-MM-dd")))
        .collect(Collectors.joining(","));
    vo.setDateList(dateListStr);

    //用户总量，以逗号分隔，例如：200,210,220
    String totalListStr = totalCountList.stream()
        .map(Objects::toString)
        .collect(Collectors.joining(","));
    vo.setTotalUserList(totalListStr);

    //新增用户，以逗号分隔，例如：20,21,10
    String newListStr = newCountList.stream()
        .map(Objects::toString)
        .collect(Collectors.joining(","));
    vo.setNewUserList(newListStr);

    return Result.success(vo);
}


-------------
//UserMapper

/**
 * 统计指定日期范围内的用户数量
 */
Integer countByDate(LocalDateTime startOfDay, LocalDateTime endOfDay);


-------------
//UserMapper.xml

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.sky.mapper.UserMapper"&gt;
    &lt;select id="countByDate" resultType="int"&gt;
        select count(*) from user
        &lt;where&gt;
            &lt;if test="startOfDay!=null"&gt;
                and create_time &gt;= #{startOfDay}
            &lt;/if&gt;
            &lt;if test="endOfDay!=null"&gt;
                and create_time &amp;lt;= #{endOfDay}
            &lt;/if&gt;
        &lt;/where&gt;
    &lt;/select&gt;
&lt;/mapper&gt;</code></pre> 
<h3 id="%C2%A03.%20%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"> 3. 功能测试</h3> 
<p>可以通过如下方式进行测试：</p> 
<ul><li> <p>接口文档测试</p> </li><li> <p>前后端联调测试</p> </li></ul> 
<p>进入数据统计模块</p> 
<p><strong>1). 查看近7日用户统计</strong></p> 
<p><img alt="" height="417" src="https://images2.imgbox.com/60/a8/0BkopxQc_o.png" width="1005"></p> 
<p>进入开发者模式，查看返回数据</p> 
<p><img alt="" height="180" src="https://images2.imgbox.com/12/19/6DHZMntz_o.png" width="1016"></p> 
<p><strong>2). 查看近30日用户统计</strong></p> 
<p><img alt="" height="415" src="https://images2.imgbox.com/ea/be/j89cF9CO_o.png" width="1012"></p> 
<p>进入开发者模式，查看返回数据</p> 
<p><img alt="" height="154" src="https://images2.imgbox.com/58/a4/KmviIVE8_o.png" width="1011"></p> 
<p>也可通过断点方式启动，查看每步执行情况。</p> 
<h2 id="%E5%9B%9B%E3%80%81%E8%AE%A2%E5%8D%95%E7%BB%9F%E8%AE%A1">四、订单统计</h2> 
<h3>1. 需求分析和设计</h3> 
<h4>1 产品原型</h4> 
<p>订单统计通过一个折现图来展现，折线图上有两根线，这根蓝色的线代表的是订单总数，而下边这根绿色的线代表的是有效订单数，指的就是状态是已完成的订单就属于有效订单，分别反映的是每一天的数据。上面还有3个数字，分别是订单总数、有效订单、订单完成率，它指的是整个时间区间之内总的数据。</p> 
<p><strong>原型图：</strong></p> 
<p><img alt="" height="539" src="https://images2.imgbox.com/cf/fb/n0VE49SC_o.png" width="987"></p> 
<h4>2 业务规则</h4> 
<ul><li> <p>有效订单，指状态为 “已完成” 的订单</p> </li><li> <p>基于可视化报表的折线图展示订单数据，X轴为日期，Y轴为订单数量</p> </li><li> <p>根据时间选择区间，展示每天的订单总数和有效订单数</p> </li><li> <p>展示所选时间区间内的有效订单数、总订单数、订单完成率，订单完成率 = 有效订单数 / 总订单数 * 100%</p> </li></ul> 
<h4>3 接口设计</h4> 
<p>根据上述原型图设计接口。</p> 
<p><img alt="" height="420" src="https://images2.imgbox.com/0b/56/Rn9iRll9_o.png" width="987"></p> 
<h3>2. 代码开发</h3> 
<pre><code class="language-java">//在sky-pojo模块，OrderReportVO.java已定义

package com.sky.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OrderReportVO implements Serializable {

    //日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
    private String dateList;

    //每日订单数，以逗号分隔，例如：260,210,215
    private String orderCountList;

    //每日有效订单数，以逗号分隔，例如：20,21,10
    private String validOrderCountList;

    //订单总数
    private Integer totalOrderCount;

    //有效订单数
    private Integer validOrderCount;

    //订单完成率
    private Double orderCompletionRate;

}


--------------
//ReportController

@GetMapping("/ordersStatistics")
@ApiOperation("订单统计接口")
public Result orderStatistics(@DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,
                              @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end){
    return reportService.orderStatistics(begin, end);
}


--------------
//ReportService

    /**
     * 统计订单
     * @param begin
     * @param end
     * @return
     */
    Result orderStatistics(LocalDate begin, LocalDate end);


--------------
//ReportServiceImpl

@Override
public Result orderStatistics(LocalDate begin, LocalDate end) {
    OrderReportVO vo = new OrderReportVO();
    List&lt;LocalDate&gt; dateList = new ArrayList&lt;&gt;();
    List&lt;Integer&gt; countList = new ArrayList&lt;&gt;();
    List&lt;Integer&gt; completeCountList = new ArrayList&lt;&gt;();

    while (!(begin.isAfter(end))) {
        //把日期添加到dateList里
        dateList.add(begin);

        //统计当天的订单数量
        LocalDateTime startOfDay = LocalDateTime.of(begin, LocalTime.MIN);
        LocalDateTime endOfDay = LocalDateTime.of(begin, LocalTime.MAX);
        Integer count = orderMapper.countStatistics(startOfDay, endOfDay, null);
        countList.add(count==null?0:count);

        //统计当天的有效订单数量
        Integer completeCount = orderMapper.countStatistics(startOfDay, endOfDay, Orders.COMPLETED);
        completeCountList.add(completeCount == null ? 0 : completeCount);

        //到下一天
        begin = begin.plusDays(1);
    }

    //日期，以逗号分隔，例如：2022-10-01,2022-10-02,2022-10-03
    String dateListStr = dateList.stream()
        .map(date -&gt; date.format(DateTimeFormatter.ofPattern("yyyy-MM-dd")))
        .collect(Collectors.joining(","));
    vo.setDateList(dateListStr);

    //每日订单数，以逗号分隔，例如：260,210,215   select count(*) from orders where order_time &gt;= ? and order_time &lt;= ?
    String countListStr = countList.stream()
        .map(Objects::toString)
        .collect(Collectors.joining(","));
    vo.setOrderCountList(countListStr);

    //每日有效订单数，以逗号分隔，例如：20,21,10   select count(*) from orders where order_time &gt;= ? and order_time &lt;= ? and status = 5
    String completeListStr = completeCountList.stream()
        .map(Objects::toString)
        .collect(Collectors.joining(","));
    vo.setValidOrderCountList(completeListStr);

    //订单总数  select count(*) from orders
    Integer totalCount = countList.stream().reduce(Integer::sum).orElse(0);
    vo.setTotalOrderCount(totalCount);

    //有效订单数 select count(*) from orders where status = 5
    Integer completeCount = completeCountList.stream().reduce(Integer::sum).orElse(0);
    vo.setValidOrderCount(completeCount);

    //订单完成率 有效订单数/订单总数
    if (totalCount == 0) {
        vo.setOrderCompletionRate(0D);
    }else{
        vo.setOrderCompletionRate(1.0 * completeCount/totalCount);
    }

    return Result.success(vo);
}


-----------
//OrderMapper

/**
 * 根据日期范围和状态，统计订单数量
 */
Integer countStatistics(LocalDateTime startOfDay, LocalDateTime endOfDay, Integer status);


------------
//OrderMapper.xml

    &lt;select id="countStatistics" resultType="int"&gt;
        select count(*) from orders
        &lt;where&gt;
            &lt;if test="startOfDay!=null"&gt;
                and order_time &gt;= #{startOfDay}
            &lt;/if&gt;
            &lt;if test="endOfDay!=null"&gt;
                and order_time &amp;lt;= #{endOfDay}
            &lt;/if&gt;
            &lt;if test="status!=null"&gt;
                and status = #{status}
            &lt;/if&gt;
        &lt;/where&gt;
    &lt;/select&gt;    </code></pre> 
<h3>3. 功能测试</h3> 
<p>可以通过如下方式进行测试：</p> 
<ul><li> <p>接口文档测试</p> </li><li> <p>前后端联调</p> </li></ul> 
<p>重启服务，直接采用前后端联调测试。</p> 
<p>进入数据统计模块</p> 
<p><strong>1). 查看近7日订单统计</strong></p> 
<p><img alt="" height="487" src="https://images2.imgbox.com/ab/92/lgSKrftV_o.png" width="1007"></p> 
<p><img alt="" height="156" src="https://images2.imgbox.com/5e/fc/jz1QW2gg_o.png" width="1006"></p> 
<p><strong>2). 查看近30日订单统计</strong></p> 
<p><img alt="" height="456" src="https://images2.imgbox.com/97/30/4fyws493_o.png" width="1006"></p> 
<p>进入开发者模式，查看返回数据</p> 
<p><img alt="" height="142" src="https://images2.imgbox.com/63/85/PEmCcH8x_o.png" width="1007"></p> 
<p>也可通过断点方式启动，查看每步执行情况</p> 
<h2 id="%E4%BA%94%E3%80%81%E9%94%80%E9%87%8F%E6%8E%92%E5%90%8DTop10">五、销量排名Top10</h2> 
<h3>1. 需求分析和设计</h3> 
<h4>1 产品原型</h4> 
<p>所谓销量排名，销量指的是商品销售的数量。项目当中的商品主要包含两类：一个是<strong>套餐</strong>，一个是<strong>菜品</strong>，所以销量排名其实指的就是菜品和套餐销售的数量排名。通过柱形图来展示销量排名，这些销量是按照降序来排列，并且只需要统计销量排名前十的商品。</p> 
<p><strong>原型图：</strong></p> 
<p><img alt="" height="342" src="https://images2.imgbox.com/a7/78/OAd9RecX_o.png" width="568"></p> 
<h4>2 业务规则</h4> 
<ul><li> <p>根据时间选择区间，展示销量前10的商品（包括菜品和套餐）</p> </li><li> <p>基于可视化报表的柱状图降序展示商品销量</p> </li><li> <p>此处的销量为商品销售的份数</p> </li></ul> 
<h4>3 接口设计</h4> 
<p><img alt="" height="351" src="https://images2.imgbox.com/ab/d7/ApqTcsCs_o.png" width="906"></p> 
<h3>2. 代码开发</h3> 
<pre><code class="language-java">//在sky-pojo模块，SalesTop10ReportVO.java已定义

package com.sky.vo;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;
import java.io.Serializable;

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class SalesTop10ReportVO implements Serializable {

    //商品名称列表，以逗号分隔，例如：鱼香肉丝,宫保鸡丁,水煮鱼
    private String nameList;

    //销量列表，以逗号分隔，例如：260,215,200
    private String numberList;

}


-------------
//ReportController

@GetMapping("/top10")
@ApiOperation("查询销量排名top10接口")
public Result top10Dishes(@DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate begin,
                          @DateTimeFormat(pattern = "yyyy-MM-dd") LocalDate end){
    return reportService.top10Dishes(begin, end);
}


-------------
//ReportService

    /**
     * 查询销量排名top10接口
     * @param begin
     * @param end
     * @return
     */
    Result top10Dishes(LocalDate begin, LocalDate end);


------------
//ReportServiceImpl

@Override
public Result top10Dishes(LocalDate begin, LocalDate end) {
    SalesTop10ReportVO vo = new SalesTop10ReportVO();

    LocalDateTime start = LocalDateTime.of(begin, LocalTime.MIN);
    LocalDateTime stop = LocalDateTime.of(end, LocalTime.MAX);

    List&lt;GoodsSalesDTO&gt; salesTop10 = orderMapper.salesTop10(start, stop);

    //商品名称列表，以逗号分隔，例如：鱼香肉丝,宫保鸡丁,水煮鱼
    String names = salesTop10.stream()
        .map(GoodsSalesDTO::getName)
        .collect(Collectors.joining(","));
    vo.setNameList(names);

    //销量列表，以逗号分隔，例如：260,215,200
    String numbers = salesTop10.stream()
        .map(GoodsSalesDTO::getNumber)
        .map(Objects::toString)
        .collect(Collectors.joining(","));
    vo.setNumberList(numbers);

    return Result.success(vo);
}


-------------
//OrderMapper

/**
* 查询商品销量前10名
* @param begin
* @param end
*/
List&lt;GoodsSalesDTO&gt; salesTop10(LocalDateTime start, LocalDateTime stop);

------------
//OrderMapper.xml

&lt;select id="salesTop10" resultType="com.sky.dto.GoodsSalesDTO"&gt;
    select od.name as name, sum(od.number) as number from orders o, order_detail od
    &lt;where&gt;
        o.id = od.order_id and o.status = 5
        &lt;if test="start!=null"&gt;
            and o.order_time &gt;= #{start}
        &lt;/if&gt;
        &lt;if test="stop!=null"&gt;
            and o.order_time &amp;lt;= #{stop}
        &lt;/if&gt;
    &lt;/where&gt;
    group by od.name
    order by number desc
    limit 10
&lt;/select&gt;

</code></pre> 
<h3>3. 功能测试</h3> 
<p>可以通过如下方式进行测试：</p> 
<ul><li> <p>接口文档测试</p> </li><li> <p>前后端联调</p> </li></ul> 
<p>重启服务，直接采用前后端联调测试。</p> 
<p><strong>查看近30日销量排名Top10统计</strong></p> 
<p>若查询的某一段时间没有销量数据，则显示不出效果。</p> 
<p><img alt="" height="407" src="https://images2.imgbox.com/a0/10/AORQbOJt_o.png" width="1014"></p> 
<p>进入开发者模式，查看返回数据</p> 
<p><img alt="" height="186" src="https://images2.imgbox.com/a6/93/IG3iBJFB_o.png" width="899">也可通过断点方式启动，查看每步执行情况。  </p> 
<p><strong>       </strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef60a44eef4a5f66b1f87e63d32e4150/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flink WordCount实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5e998a80c2addc4caba20e59ad0432bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java的警示之有危险的行为</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>