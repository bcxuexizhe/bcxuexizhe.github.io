<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫基本原理 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/b9f6ed895d3c7dbaacb42dce0dc33c31/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="爬虫基本原理">
  <meta property="og:description" content="一、爬虫的原理 爬虫是什么？把互联网上的数据，抓取下来，存到自己的本地。
以百度为例，爬取一个个的网页，存到自己库中，当我们搜索的时候，去百度的数据库中搜索，显示在前端，点击某个页面，直接跳转到真正的地址。
基本原理：
发送http请求（requests）----&gt;返回数据-----&gt;解析数据（数据清洗，bs4，re…）----&gt;入库(文件，excel，mysql，redis，mongodb)
注：
爬取数据时，如果被禁止了，一定是你模拟的不像。
爬虫协议：
每个网站，都有爬虫协议，规定了哪些允许你爬，哪些不允许你爬（君子协议）
robots.txt----&gt;只是一个协议
反爬：
验证码封ip封账号js逆向：js比较不错app爬取：加密app逆向：java，动态调试so文件----&gt;汇编 爬虫所需工具：
请求库：requests,selenium
解析库：正则，beautifulsoup，pyquery
存储库：文件，MySQL，Mongodb，Redis
爬虫常用框架：
scrapy
二、请求库requests基本使用 模拟发送http请求（只要http请求有的东西，都可以使用requests发送出去）。
python内置的urllib2、urllib3，不太好用，用起来比较麻烦。
大神基于urllib3封装了requests，python界非常出名的第三方库，只能发送http请求，不能解析；
又封装了一个requets-html库，把request和解析库封装到一起了。
安装：pip3 install requests
1.基本使用
import requests # res对象中会有，响应体，响应头，cookie。。。。 # 请求头中带User-Agent，是客户端类型 # 加入请求头 res = requests.get(&#39;https://dig.chouti.com/&#39;,headers={ &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36&#39; }) print(res.text) # 响应体，转成了字符串 with open(&#39;a.html&#39;,&#39;w&#39;,encoding=&#39;utf-8&#39;) as f: f.write(res.text) # 另外一种使用 requests.request(&#39;post&#39;,cookies={}) 2.带参数的GET请求
# 方式一：get请求参数，直接拼接在路径中 response = requests.get(&#39;https://www.baidu.com/s?wd=美女&#39;, headers={ &#39;User-Agent&#39;: &#39;Mozilla/5.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-06-28T01:20:34+08:00">
    <meta property="article:modified_time" content="2023-06-28T01:20:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫基本原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、爬虫的原理</h3> 
<p>爬虫是什么？把互联网上的数据，抓取下来，存到自己的本地。</p> 
<p>以百度为例，爬取一个个的网页，存到自己库中，当我们搜索的时候，去百度的数据库中搜索，显示在前端，点击某个页面，直接跳转到真正的地址。</p> 
<p><strong>基本原理：</strong><br> 发送http请求（requests）----&gt;返回数据-----&gt;解析数据（数据清洗，bs4，re…）----&gt;入库(文件，excel，mysql，redis，mongodb)</p> 
<p>注：<br> 爬取数据时，如果被禁止了，一定是你模拟的不像。</p> 
<p><strong>爬虫协议：</strong><br> 每个网站，都有爬虫协议，规定了哪些允许你爬，哪些不允许你爬（君子协议）<br> robots.txt----&gt;只是一个协议</p> 
<p><strong>反爬：</strong></p> 
<ul><li>验证码</li><li>封ip</li><li>封账号</li><li>js逆向：js比较不错</li><li>app爬取：加密</li><li>app逆向：java，动态调试so文件----&gt;汇编</li></ul> 
<p><strong>爬虫所需工具：</strong><br> 请求库：requests,selenium<br> 解析库：正则，beautifulsoup，pyquery<br> 存储库：文件，MySQL，Mongodb，Redis</p> 
<p><strong>爬虫常用框架：</strong><br> scrapy</p> 
<h3><a id="requests_30"></a>二、请求库requests基本使用</h3> 
<p>模拟发送http请求（只要http请求有的东西，都可以使用requests发送出去）。<br> python内置的urllib2、urllib3，不太好用，用起来比较麻烦。</p> 
<p>大神基于urllib3封装了requests，python界非常出名的第三方库，只能发送http请求，不能解析；<br> 又封装了一个requets-html库，把request和解析库封装到一起了。</p> 
<p>安装：<code>pip3 install requests</code></p> 
<p><strong>1.基本使用</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

<span class="token comment"># res对象中会有，响应体，响应头，cookie。。。。</span>
<span class="token comment"># 请求头中带User-Agent，是客户端类型</span>
<span class="token comment"># 加入请求头</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://dig.chouti.com/'</span><span class="token punctuation">,</span>headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment"># 响应体，转成了字符串</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'a.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment"># 另外一种使用</span>
requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">'post'</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>2.带参数的GET请求</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 方式一：get请求参数，直接拼接在路径中</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/s?wd=美女'</span><span class="token punctuation">,</span>
                        headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'baidu.html'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment"># 方式二：使用params参数</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/s'</span><span class="token punctuation">,</span>
                        params<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'wd'</span><span class="token punctuation">:</span> <span class="token string">'帅哥'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
                            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.75 Safari/537.36'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'baidu.html'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><strong>3.带参数的GET请求（headers）</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

<span class="token comment"># res对象中会有，响应体，响应头，cookie。。。。</span>
<span class="token comment"># 请求头中带User-Agent，是客户端类型</span>
<span class="token comment"># referer：上一次请求的地址,做图片防盗链</span>
<span class="token comment"># cookie：cookie信息</span>
<span class="token comment"># 加入请求头</span>
header<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'referer'</span><span class="token punctuation">:</span><span class="token string">'https://www.lagou.com/wn/zhaopin'</span>
<span class="token punctuation">}</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.lagou.com/gongsi/'</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment"># 响应体，转成了字符串</span>
</code></pre> 
<p>referer：比如向这个<a href="https://pic.cnblogs.com/face/1330165/20180409101658.png" rel="nofollow">图片地址</a>发请求，会有referer，检测referer是不是这个网站的，不是则禁止。</p> 
<p><strong>4.带参数的GET请求（cookies）</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 方式一：带在请求头中</span>
header<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token string">'cookie'</span><span class="token punctuation">:</span><span class="token string">'deviceId=web.eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqaWQiOiIwZmVlMjk5OS1iMDgzLTRmYzctOTM4MC03YjIzZmVmY2U5YmYiLCJleHBpcmUiOiIxNjIzOTA0ODk5MzM5In0.7cadtBYznS6OgnLwEF8aH0AmtDOoYB1WKDgdU4eYYS0; __snaker__id=VbChmBUEZIVY3FPa; _9755xjdesxxd_=32; YD00000980905869%3AWM_TID=%2FazmF9%2FrClJFEVFBVRN70z7msH6De39Y; Hm_lvt_03b2668f8e8699e91d479d62bc7630f1=1631674964,1634180671,1634183906; gdxidpyhxdE=SmmnuyrMOQB%2B9hzOlIaMPx0O9ZJbqWBllx7aa1OTmRwgGymo94mTYgZ0DrUWw7tfx8qIZmRt01BbIVX2jIc30jqSzPWznXpll6kBokS56266%2FmPg%2BC%5CvNV%2BJhO%5C9ln%2FQdskmo%2FH5A%2BLOADRDACtDp59%5CH51jexwMSIXSA9atTxuJDXOn%3A1634184810108; YD00000980905869%3AWM_NI=WlPwT2GigeoAGFNAH66LZluq3E87sk7E%2Bn6YtGANtE0G%2Bke2f0x6a1rG8kACozd%2FrWBXr3ne%2FBnps6fdDDeTm052UXP1VES3VxQISaL9zd91nvo%2FON%2FVuXS9INJSQYS%2FOG8%3D; YD00000980905869%3AWM_NIKE=9ca17ae2e6ffcda170e2e6ee97c96aadeda38de27286ef8bb3d45a828f8babae8095aea8d0b47e9191e186c42af0fea7c3b92a95b4a098d73a85b7a986ee4b859a82a2cb3ef694968df87bf19bf8d8f261f59be58fb553b8998faff74ff499e58ce83aa6f0b8d7e43bb299f88cc449ada6acd0f15d8288bed4ed6fed9ea291f23ea6bc8ca5e860aff0fbd3d85494ef9aa6d23996a89faad26b90e7b685bc3baeaaa1d0ce46ed8abbb9d2338b9286b4d45391f181a8bb37e2a3; token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqaWQiOiJjZHVfNTMyMDcwNzg0NjAiLCJleHBpcmUiOiIxNjM2Nzc1OTIyMTI2In0.o5-Y9-USxFog5sdo1WR1WORUzPkUD4fozEVA_f0WSHU; Hm_lpvt_03b2668f8e8699e91d479d62bc7630f1=1634183939'</span>
<span class="token punctuation">}</span>
<span class="token comment"># post请求，携带在请求体中的数据</span>
res<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://dig.chouti.com/link/vote'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'linkId'</span><span class="token punctuation">:</span> <span class="token string">'32667354'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span>
<span class="token comment">#https://dig.chouti.com/link/cancel/vote</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment"># 方式二：直接以参数形式传入，cookie会经常用，而且一般是字典形式，提供了一个cookie参数</span>
header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment"># cookies需要是：Dict or CookieJar object</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'https://dig.chouti.com/link/vote'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'linkId'</span><span class="token punctuation">:</span> <span class="token string">'32667354'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><strong>5.POST请求</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 发送post请求，模拟浏览器的登录行为</span>
header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://www.aa7a.cn/user.php?&amp;ref=http%3A%2F%2Fwww.aa7a.cn%2F'</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span>
<span class="token punctuation">}</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://www.aa7a.cn/user.php'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'xxx@qq.com'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    <span class="token string">'captcha'</span><span class="token punctuation">:</span> <span class="token string">'fmd8'</span><span class="token punctuation">,</span>
    <span class="token string">'remember'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'ref'</span><span class="token punctuation">:</span> <span class="token string">'http://www.aa7a.cn/'</span><span class="token punctuation">,</span>
    <span class="token string">'act'</span><span class="token punctuation">:</span> <span class="token string">'act_login'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 获取到cookie，登陆过后的cookie</span>
cookie <span class="token operator">=</span> res<span class="token punctuation">.</span>cookies
<span class="token keyword">print</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>  <span class="token comment"># CookieJar</span>

res1 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.aa7a.cn/'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookie<span class="token punctuation">)</span>
<span class="token comment"># res1=requests.get('http://www.aa7a.cn/',headers=header)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxx@qq.com'</span> <span class="token keyword">in</span> res1<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><strong>6.响应Response</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
respone<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.360buy.com'</span><span class="token punctuation">)</span>
<span class="token comment"># respone属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>text<span class="token punctuation">)</span>   <span class="token comment"># body的内容转成str类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token comment"># body的二进制内容 （图片，视频）</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span> <span class="token comment"># 响应状态码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>    <span class="token comment"># 响应头</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>    <span class="token comment"># 把响应的cookie转成了cookiejar的对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 把cookiejar的对象转成字典</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># key和value</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>url<span class="token punctuation">)</span>          <span class="token comment"># 请求的地址</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>history<span class="token punctuation">)</span>       <span class="token comment"># 请求历史，重定向，才有数据，列表</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>   <span class="token comment"># 响应的编码格式</span>

response<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#循环它，如果是视频，一点一点保存</span>
</code></pre> 
<p><strong>解析json（http请求返回的数据是json格式）：</strong><br> res.text是json字符串，取值不好取，需要json.loads(res.text)转成字典，再取值<br> 直接res.json()转成json后的字典形式</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=keyword'</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'cname'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'pid'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'keyword'</span><span class="token punctuation">:</span> <span class="token string">'上海'</span><span class="token punctuation">,</span>
    <span class="token string">'pageIndex'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'pageSize'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># print(res.text)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>7.编码问题</strong><br> url编码问题 把中文用url编码，把url编码解成中文</p> 
<pre><code class="prism language-python"><span class="token comment"># https://www.baidu.com/s?wd=%E7%BE%8E%E5%A5%B3</span>
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
<span class="token comment"># 把中文用url编码，</span>
res<span class="token operator">=</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span><span class="token string">'美女'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token comment"># 把url编码解成中文</span>
res<span class="token operator">=</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span><span class="token string">'%E7%BE%8E%E5%A5%B3'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> 
<p>网站编码，不是utf-8，使用res.text默认用utf-8转，可能出乱码</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token comment"># res.encoding='GBK'</span>
res<span class="token punctuation">.</span>encoding<span class="token operator">=</span>res<span class="token punctuation">.</span>apparent_encoding
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><strong>8.获取二进制数据</strong><br> 视频、图片需要保存二进制</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://img.lianzhixiu.com/uploads/allimg/202001/9999/a7b0199df8.jpg'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'致命诱惑2.png'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token comment"># f.write(res.content)</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> res<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
</code></pre> 
<p><strong>9.request.session的使用</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 可以帮咱们保持cookie，以后不用手动携带</span>

header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://www.aa7a.cn/user.php?&amp;ref=http%3A%2F%2Fwww.aa7a.cn%2F'</span><span class="token punctuation">,</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36'</span>
<span class="token punctuation">}</span>
res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://www.aa7a.cn/user.php'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'xxx@qq.com'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
    <span class="token string">'captcha'</span><span class="token punctuation">:</span> <span class="token string">'fmd8'</span><span class="token punctuation">,</span>
    <span class="token string">'remember'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string">'ref'</span><span class="token punctuation">:</span> <span class="token string">'http://www.aa7a.cn/'</span><span class="token punctuation">,</span>
    <span class="token string">'act'</span><span class="token punctuation">:</span> <span class="token string">'act_login'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 获取到cookie，登陆过后的cookie</span>
<span class="token comment"># cookie=res.cookies</span>
<span class="token comment"># print(cookie)  # CookieJar</span>

res1 <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.aa7a.cn/'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxx@qq.com'</span> <span class="token keyword">in</span> res1<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><strong>补充：</strong><br> 什么是正向代理，什么是反向代理？</p> 
<ul><li> <p>正向代理，隐藏客户端<br> 翻墙软件</p> </li><li> <p>反向代理，隐藏服务器<br> nginx 是一个反向代理服务器</p> </li></ul> 
<p>正向代理----&gt;买票的黄牛<br> 反向代理----&gt;租房的代理</p> 
<p><strong>总结：</strong><br> 1 爬虫介绍</p> 
<ul><li>模拟发送http请求----&gt;获取到数据（html，json，图片，视频）----&gt;数据清洗----&gt;入库</li></ul> 
<p>2 请求库：requests模块</p> 
<ul><li>跟其他服务交互，使用requests模块</li><li>postman：完全自己写，使用requests写</li></ul> 
<p>3 发送get请求</p> 
<p>4 发送get请求，地址中带参数</p> 
<ul><li>直接拼在路径中</li><li>params参数传入，字典</li><li>url编码和解码：中文编成url的编码形式</li></ul> 
<p>5 发送get请求，携带请求头</p> 
<ul><li>headers参数</li><li>user-agent：客户端类型</li><li>referer：上一个地址</li></ul> 
<p>6 发送请求，携带cookie<br> 请求头<br> 以参数形式携带</p> 
<p>7 发送post请求</p> 
<ul><li>地址中带数据：params参数传入</li><li>请求头中带：headers</li><li>请求体中：data={},json={}</li></ul> 
<p>8 Respons对象属性，参数</p> 
<ul><li>text：响应的body体，转成了字符串</li><li>content：响应体的二进制（图片，视频）</li><li>iter_content：图片，视频，循环保存</li><li>编码</li><li>cookies：一旦登录成功，这个cookies就是认证后的cookies</li><li>json() :把返回的json格式字符串直接转成字典形式</li></ul> 
<p>9 编码问题</p> 
<p>10 request.session的使用</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/96d650508ed48830e5cda97e74ea0643/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习之目标检测R-CNN模型算法流程详解说明（超详细理论篇）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f91919e673d8234738f7a1ca93ae2e70/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio 使用SQLite数据库来创建数据库&#43;创建数据库表&#43;更新表再次往表添加字段</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>