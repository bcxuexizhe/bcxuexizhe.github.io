<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【大模型】Spring AI对接ChatGpt使用详解 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/181f1886010248c99a9de61034d45795/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【大模型】Spring AI对接ChatGpt使用详解">
  <meta property="og:description" content="目录
一、前言
二、spring ai介绍
2.1 什么是Spring AI
2.2 Spring AI 特点
2.3 Spring AI 为开发带来的便利
2.4 Spring AI应用领域
2.4.1 聊天模型
2.4.2 文本到图像模型
2.4.3 音频转文本
2.4.4 嵌入大模型使用
2.4.5 矢量数据库支持
2.4.6 用于数据工程ETL框架
三、Spring AI对接ChatGPT
3.1 前置准备
3.2 添加依赖
3.3 接入流程
3.3.1 配置文件
3.3.2 增加一个测试接口
3.3.3 接口测试
3.4 OpenAiChatClient 使用
3.4.1 call使用Prompt传递参数方式1
3.4.2 call使用Prompt传递参数2
3.5 OpenAiImageClient使用
3.5.1 其他参数传递使用情况
3.6 OpenAiAudioTranscriptionClient 使用
3.7 OpenAiAudioSpeechClient使用
四、Spring AI对接Ollama
4.1 Ollama介绍
4.2 Ollama本地部署
4.2.1 下载安装包
4.2.2 执行安装">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-19T14:04:12+08:00">
    <meta property="article:modified_time" content="2024-05-19T14:04:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【大模型】Spring AI对接ChatGpt使用详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80" rel="nofollow">一、前言</a></p> 
<p id="%E4%BA%8C%E3%80%81spring%20ai%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81spring%20ai%E4%BB%8B%E7%BB%8D" rel="nofollow">二、spring ai介绍</a></p> 
<p id="2.1%20%E4%BB%80%E4%B9%88%E6%98%AFSpring%20AI-toc" style="margin-left:40px;"><a href="#2.1%20%E4%BB%80%E4%B9%88%E6%98%AFSpring%20AI" rel="nofollow">2.1 什么是Spring AI</a></p> 
<p id="2.2%20Spring%20AI%20%E7%89%B9%E7%82%B9-toc" style="margin-left:40px;"><a href="#2.2%20Spring%20AI%20%E7%89%B9%E7%82%B9" rel="nofollow">2.2 Spring AI 特点</a></p> 
<p id="2.3%20Spring%20AI%20%E4%B8%BA%E5%BC%80%E5%8F%91%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BE%BF%E5%88%A9-toc" style="margin-left:40px;"><a href="#2.3%20Spring%20AI%20%E4%B8%BA%E5%BC%80%E5%8F%91%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BE%BF%E5%88%A9" rel="nofollow">2.3 Spring AI 为开发带来的便利</a></p> 
<p id="2.4%20Spring%20AI%E5%BA%94%E7%94%A8%E9%A2%86%E5%9F%9F-toc" style="margin-left:40px;"><a href="#2.4%20Spring%20AI%E5%BA%94%E7%94%A8%E9%A2%86%E5%9F%9F" rel="nofollow">2.4 Spring AI应用领域</a></p> 
<p id="2.4.1%20%E8%81%8A%E5%A4%A9%E6%A8%A1%E5%9E%8B-toc" style="margin-left:80px;"><a href="#2.4.1%20%E8%81%8A%E5%A4%A9%E6%A8%A1%E5%9E%8B" rel="nofollow">2.4.1 聊天模型</a></p> 
<p id="2.4.2%20%E6%96%87%E6%9C%AC%E5%88%B0%E5%9B%BE%E5%83%8F%E6%A8%A1%E5%9E%8B-toc" style="margin-left:80px;"><a href="#2.4.2%20%E6%96%87%E6%9C%AC%E5%88%B0%E5%9B%BE%E5%83%8F%E6%A8%A1%E5%9E%8B" rel="nofollow">2.4.2 文本到图像模型</a></p> 
<p id="2.4.3%20%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%96%87%E6%9C%AC-toc" style="margin-left:80px;"><a href="#2.4.3%20%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%96%87%E6%9C%AC" rel="nofollow">2.4.3 音频转文本</a></p> 
<p id="2.4.4%20%E5%B5%8C%E5%85%A5%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8-toc" style="margin-left:80px;"><a href="#2.4.4%20%E5%B5%8C%E5%85%A5%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8" rel="nofollow">2.4.4 嵌入大模型使用</a></p> 
<p id="2.4.5%20%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81-toc" style="margin-left:80px;"><a href="#2.4.5%20%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81" rel="nofollow">2.4.5 矢量数据库支持</a></p> 
<p id="2.4.6%20%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8BETL%E6%A1%86%E6%9E%B6-toc" style="margin-left:80px;"><a href="#2.4.6%20%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8BETL%E6%A1%86%E6%9E%B6" rel="nofollow">2.4.6 用于数据工程ETL框架</a></p> 
<p id="%E4%B8%89%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5ChatGPT-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5ChatGPT" rel="nofollow">三、Spring AI对接ChatGPT</a></p> 
<p id="3.1%20%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#3.1%20%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87" rel="nofollow">3.1 前置准备</a></p> 
<p id="3.2%20%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96-toc" style="margin-left:40px;"><a href="#3.2%20%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96" rel="nofollow">3.2 添加依赖</a></p> 
<p id="3.3%20%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#3.3%20%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B" rel="nofollow">3.3 接入流程</a></p> 
<p id="3.3.1%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#3.3.1%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">3.3.1 配置文件</a></p> 
<p id="3.3.2%20%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3-toc" style="margin-left:80px;"><a href="#3.3.2%20%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3" rel="nofollow">3.3.2 增加一个测试接口</a></p> 
<p id="3.3.3%20%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#3.3.3%20%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95" rel="nofollow">3.3.3 接口测试</a></p> 
<p id="3.4%20OpenAiChatClient%20%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#3.4%20OpenAiChatClient%20%E4%BD%BF%E7%94%A8" rel="nofollow">3.4 OpenAiChatClient 使用</a></p> 
<p id="3.4.1%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F1-toc" style="margin-left:80px;"><a href="#3.4.1%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F1" rel="nofollow">3.4.1 call使用Prompt传递参数方式1</a></p> 
<p id="3.4.2%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B02-toc" style="margin-left:80px;"><a href="#3.4.2%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B02" rel="nofollow">3.4.2 call使用Prompt传递参数2</a></p> 
<p id="3.5%20OpenAiImageClient%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#3.5%20OpenAiImageClient%E4%BD%BF%E7%94%A8" rel="nofollow">3.5 OpenAiImageClient使用</a></p> 
<p id="3.5.1%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5-toc" style="margin-left:80px;"><a href="#3.5.1%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5" rel="nofollow">3.5.1 其他参数传递使用情况</a></p> 
<p id="3.6%20OpenAiAudioTranscriptionClient%20%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#3.6%20OpenAiAudioTranscriptionClient%20%E4%BD%BF%E7%94%A8" rel="nofollow">3.6 OpenAiAudioTranscriptionClient 使用</a></p> 
<p id="3.7%20OpenAiAudioSpeechClient%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#3.7%20OpenAiAudioSpeechClient%E4%BD%BF%E7%94%A8" rel="nofollow">3.7 OpenAiAudioSpeechClient使用</a></p> 
<p id="%E5%9B%9B%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5Ollama-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5Ollama" rel="nofollow">四、Spring AI对接Ollama</a></p> 
<p id="4.1%20Ollama%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#4.1%20Ollama%E4%BB%8B%E7%BB%8D" rel="nofollow">4.1 Ollama介绍</a></p> 
<p id="4.2%20Ollama%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2-toc" style="margin-left:40px;"><a href="#4.2%20Ollama%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2" rel="nofollow">4.2 Ollama本地部署</a></p> 
<p id="4.2.1%20%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85-toc" style="margin-left:80px;"><a href="#4.2.1%20%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85" rel="nofollow">4.2.1 下载安装包</a></p> 
<p id="4.2.2%20%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#4.2.2%20%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85" rel="nofollow">4.2.2 执行安装</a></p> 
<p id="4.2.3%20Ollama%E9%83%A8%E7%BD%B2%E5%8D%83%E9%97%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B-toc" style="margin-left:80px;"><a href="#4.2.3%20Ollama%E9%83%A8%E7%BD%B2%E5%8D%83%E9%97%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B" rel="nofollow">4.2.3 Ollama部署千问大模型</a></p> 
<p id="4.2.4%20%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#4.2.4%20%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" rel="nofollow">4.2.4 补充说明</a></p> 
<p id="4.3%C2%A0Spring%20Ai%E6%8E%A5%E5%85%A5Ollama-toc" style="margin-left:40px;"><a href="#4.3%C2%A0Spring%20Ai%E6%8E%A5%E5%85%A5Ollama" rel="nofollow">4.3 Spring Ai接入Ollama</a></p> 
<p id="4.3.1%20%E5%BC%95%E5%85%A5Ollama%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#4.3.1%20%E5%BC%95%E5%85%A5Ollama%E4%BE%9D%E8%B5%96" rel="nofollow">4.3.1 引入Ollama依赖</a></p> 
<p id="4.3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#4.3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">4.3.2 添加配置文件</a></p> 
<p id="4.3.3%20%E4%BD%BF%E7%94%A8Ollama%E8%81%8A%E5%A4%A9api-toc" style="margin-left:80px;"><a href="#4.3.3%20%E4%BD%BF%E7%94%A8Ollama%E8%81%8A%E5%A4%A9api" rel="nofollow">4.3.3 使用Ollama聊天api</a></p> 
<p id="%E4%BA%94%E3%80%81%E5%86%99%E5%9C%A8%E6%96%87%E6%9C%AB-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E5%86%99%E5%9C%A8%E6%96%87%E6%9C%AB" rel="nofollow">五、写在文末</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80">一、前言</h2> 
<p>ChatGPT从问世到现在，热度一直不减，GPT的广泛推广和使用，让AI领域变得越来越热闹，于是基于ChatGPT的核心，越来越多的公司和技术团队加入了大模型的领域。在这其中，作为技术框架语言，像主流的python，java等，为了方便开发者对ChatGPT的使用，以及后续生态的融合，也开始在框架层面引入对ChatGPT的支持，本文聊聊spring框架下对ChatGPT的支持的一个新组件spring ai的使用。</p> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81spring%20ai%E4%BB%8B%E7%BB%8D">二、spring ai介绍</h2> 
<p></p> 
<h3 id="2.1%20%E4%BB%80%E4%B9%88%E6%98%AFSpring%20AI">2.1 什么是Spring AI</h3> 
<p>spring ai官网文档地址：<a href="https://docs.spring.io/spring-ai/reference/api/prompt.html" rel="nofollow" title="Prompts :: Spring AI Reference">Prompts :: Spring AI Reference</a> ，官网对Spring AI的定义如下：</p> 
<blockquote> 
 <p>Spring AI is an application framework for AI engineering. Its goal is to apply to the AI domain Spring ecosystem design principles such as portability and modular design and promote using POJOs as the building blocks of an application to the AI domain.</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/1b/fe/9aVoFJcn_o.png"></p> 
<p></p> 
<h3 id="2.2%20Spring%20AI%20%E7%89%B9%E7%82%B9">2.2 Spring AI 特点</h3> 
<p>Spring AI 是一个AI工程领域的应用程序框架，它的目标是将Spring生态系统的设计原则应用于人工智能领域，比如Spring生态系统的可移植性和模块化设计，并推广使用POJO来构建人工智能领域应用程序，但它并不是要构建一个自己的AI大模型，而是让你对接各种AI大模型，官网介绍Spring AI 具备如下特征：</p> 
<ul><li> <p>支持所有主要的模型提供商，如OpenAI、微软、亚马逊、谷歌和Huggingface；</p> </li><li> <p>支持的模型类型有聊天和文本到图像，还有更多；</p> </li><li> <p>可移植的API跨人工智能提供商聊天和嵌入模型。同时支持同步和流API选项。还支持下拉访问特定于型号的功能；</p> </li><li> <p>人工智能模型输出到POJO的映射；</p> </li><li> <p>支持所有主要的矢量数据库提供商，如Azure矢量搜索、Chroma、Milvus、Neo4j、PostgreSQL/PGVector、PineCone、Qdrant、Redis和Weaviate；</p> </li><li> <p>跨矢量存储提供商的可移植API，包括一个新的类似SQL的元数据过滤器API，它也是可移植的；</p> </li><li> <p>支持函数调用；</p> </li><li> <p>用于AI模型和矢量存储的Spring Boot自动配置和启动器；</p> </li><li> <p>可以用于数据工程的ETL框架；</p> </li></ul> 
<p></p> 
<h3 id="2.3%20Spring%20AI%20%E4%B8%BA%E5%BC%80%E5%8F%91%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BE%BF%E5%88%A9">2.3 Spring AI 为开发带来的便利</h3> 
<p>Spring Framework 和AI技术的结合，将为java生态对接人工智能，大模型提供了非常大的便利，尤其是技术组件生态完善的Spring 框架来说，这更是为项目开发对接AI应用提供了基础支撑，具体来说，好处如下：</p> 
<ul><li> <p><strong>整合简单</strong></p> 
  <ul><li> <p>Spring Framework 提供了广泛的功能和模块，结合人工智能技术可以打造完整的AI对接与解决方案。</p> </li></ul></li><li> <p><strong>简化开发</strong></p> 
  <ul><li> <p>Spring Framework 的框架和工具可以大大简化开发流程，而人工智能技术可以增强应用程序的智能化水平。</p> </li></ul></li><li> <p><strong>高效性</strong></p> 
  <ul><li> <p>结合 Spring Framework 的性能优势和人工智能技术的高效处理能力，可以实现高性能的智能化应用程序。</p> </li></ul></li><li> <p><strong>灵活性</strong></p> 
  <ul><li> <p>可能在 Spring Framework 的基础上开发出灵活、可扩展的人工智能模块，以满足不同应用场景的需求。</p> </li></ul></li></ul> 
<h3 id="2.4%20Spring%20AI%E5%BA%94%E7%94%A8%E9%A2%86%E5%9F%9F">2.4 Spring AI应用领域</h3> 
<p>从上文对Spring AI的特点介绍，不难发现，Spring AI将会在众多的领域提供有力的支撑，下面做详细说明。</p> 
<p></p> 
<h4 id="2.4.1%20%E8%81%8A%E5%A4%A9%E6%A8%A1%E5%9E%8B">2.4.1 聊天模型</h4> 
<p>Chat Models支持很多种聊天模型，基于不同的聊天模型，可以打造多场景下的聊天应用，比如当下各种聊天应用。</p> 
<p></p> 
<h4 id="2.4.2%20%E6%96%87%E6%9C%AC%E5%88%B0%E5%9B%BE%E5%83%8F%E6%A8%A1%E5%9E%8B">2.4.2 文本到图像模型</h4> 
<p>即Text-to-image Models，目前支持：</p> 
<ul><li> <p>OpenAI with DALL-E；</p> </li><li> <p>StabilityAI；</p> </li></ul> 
<blockquote> 
 <p>文本转图像在现实中有着广泛的需求场景，用户按照自身的需求，输入特定的参数，即可生成预期的图片。目前在市场上，已经出现很多类似的大模型产品可供商用。</p> 
</blockquote> 
<p></p> 
<h4 id="2.4.3%20%E9%9F%B3%E9%A2%91%E8%BD%AC%E6%96%87%E6%9C%AC">2.4.3 音频转文本</h4> 
<p>与上面的文本转图像类似，可将一段音频中提取出文本内容，在某些商业领域有着较多的使用。</p> 
<p></p> 
<h4 id="2.4.4%20%E5%B5%8C%E5%85%A5%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8">2.4.4 嵌入大模型使用</h4> 
<p>GPT问世之后，陆陆续续出现了很多可以商用的开源大模型，比如Ollama，ONNX等，使用spring ai作为底层开发框架，利用open ai就可以对接大模型，从而打造属于企业自身的大模型应用。</p> 
<p></p> 
<h4 id="2.4.5%20%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81">2.4.5 矢量数据库支持</h4> 
<p>Vector Store API提供了跨不同提供商的可移植性，其特点是提供了一种新颖的类似SQL的元数据过滤API，以保持可移植性，目前对矢量数据库的支持包括：</p> 
<ul><li> <p>Azure Vector Search；</p> </li><li> <p>Chroma；</p> </li><li> <p>Milvus；</p> </li><li> <p>Neo4j；</p> </li><li> <p>PostgreSQL/PGVector；</p> </li><li> <p>PineCone；</p> </li><li> <p>Redis；</p> </li><li> <p>Weaviate；</p> </li><li> <p>Qdrant；</p> </li></ul> 
<p></p> 
<h4 id="2.4.6%20%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%B7%A5%E7%A8%8BETL%E6%A1%86%E6%9E%B6">2.4.6 用于数据工程ETL框架</h4> 
<p>利用spring ai作为连接GPT的支撑，结合java自身优秀的数据处理特点，可以将其用于大数据ETL领域中，具体来说：</p> 
<ul><li> <p>ETL框架的核心功能是使用Vector Store促进文档向模型提供者的传输。ETL框架基于Java函数式编程概念，可帮助您将多个步骤链接在一起；</p> </li><li> <p>支持阅读各种格式的文档，包括PDF、JSON等；</p> </li><li> <p>该框架允许数据操作以满足您的需求。这通常包括拆分文档以遵守上下文窗口限制，并使用关键字增强它们以提高文档检索效率；</p> </li><li> <p>最后，处理后的文档存储在矢量数据库中，以便将来检索；</p> </li></ul> 
<p></p> 
<h2 id="%E4%B8%89%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5ChatGPT">三、Spring AI对接ChatGPT</h2> 
<p></p> 
<h3 id="3.1%20%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87">3.1 前置准备</h3> 
<p>在正式开始使用java对接ChatGPT之前，你需要做下面几件事，确保在后面的代码层面可以正常调用ChatGPT的相关接口。</p> 
<ul><li> <p>api-key</p> 
  <ul><li> <p>调用open-ai接口必须传递的参数，api-key的获取方式很多，可以通过官网注册，或者通过中转的渠道获取；</p> </li><li> <p>如果是自己注册获得的api-key，需要解决本地的魔法上网问题；</p> </li><li> <p>如果是通过中转渠道获取的api-key，注意拿到中转的url，这个其实就是使用被人的代理服务器解决本地魔法上网的问题；</p> </li></ul></li><li> <p>jdk17环境</p> 
  <ul><li> <p>如果纯粹是调用open-ai接口，不用jdk17也没问题，但是后面需要使用spring ai集成调用，建议使用jdk17。</p> </li></ul></li><li> <p>提前搭建springboot工程；</p> </li></ul> 
<p></p> 
<h3 id="3.2%20%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96">3.2 添加依赖</h3> 
<p>本例使用springboot 3.2的版本，核心依赖如下</p> 
<pre><code class="language-java">    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.4&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
        &lt;spring-ai.version&gt;1.0.0-SNAPSHOT&lt;/spring-ai.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
            &lt;version&gt;4.5.13&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ai-openai-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
                &lt;artifactId&gt;spring-ai-bom&lt;/artifactId&gt;
                &lt;version&gt;${spring-ai.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;!--maven中心仓库还没有更新spring ai的jar包，所以使用spring的仓库ai包--&gt;
    &lt;repositories&gt;
        &lt;!--快照版本的仓库--&gt;
        &lt;repository&gt;
            &lt;id&gt;spring-snapshot&lt;/id&gt;
            &lt;name&gt;Spring Snapshots&lt;/name&gt;
            &lt;url&gt;https://repo.spring.io/snapshot&lt;/url&gt;
            &lt;releases&gt;
                &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;/releases&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;</code></pre> 
<p>这里重点补充一下，由于目前maven中央仓库还没有spring ai的包，所以需要从spring官方提供的仓库里下载，所以在pom中需要配置官网提供的仓库地址</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/60/ea/pzinAvwr_o.png"></p> 
<p></p> 
<h3 id="3.3%20%E6%8E%A5%E5%85%A5%E6%B5%81%E7%A8%8B">3.3 接入流程</h3> 
<h4></h4> 
<h4 id="3.3.1%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.3.1 配置文件</h4> 
<p>在配置文件中主要配置你的apkey，和base-url信息</p> 
<pre><code class="language-java">server:
  port: 8088

spring:
  application:
    name: chat-001

  ai:
    openai:
      api-key: 你的apikey
      base-url: 默认的是openai的地址</code></pre> 
<p></p> 
<h4 id="3.3.2%20%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3">3.3.2 增加一个测试接口</h4> 
<p>编写一个测试接口，使用OpenAiChatClient这个聊天对象api进行调用</p> 
<pre><code class="language-java">import org.springframework.ai.openai.OpenAiChatClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ChatController {

    @Autowired
    private OpenAiChatClient openAiChatClient;

    //http://localhost:8088/chat?message=介绍下上海这个城市
    @GetMapping("/chat")
    public Object chat(@RequestParam("message") String message){
        String result = openAiChatClient.call(message);
        return result;
    }

}</code></pre> 
<h4 id="3.3.3%20%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95">3.3.3 接口测试</h4> 
<p>启动工程之后，调用一下接口，可以看到下面的效果</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b3/70/XkAp8UCP_o.png"></p> 
<p></p> 
<h3 id="3.4%20OpenAiChatClient%20%E4%BD%BF%E7%94%A8">3.4 OpenAiChatClient 使用</h3> 
<p>上面通过一个简单的案例介绍了spring ai如何快速调用gpt的接口，在OpenAiChatClient这个对象中，还提供了很多种方式调用call的方法，从而返回响应结果，如下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f8/97/Fhcm392M_o.png"></p> 
<p>下面来分别聊聊几种不同API的用法</p> 
<p></p> 
<h4 id="3.4.1%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F1">3.4.1 call使用Prompt传递参数方式1</h4> 
<p><strong>传递一个字符串参数</strong>，使用call调用方法的时候，也可以传递一个Prompt的对象，返回的是一个ChatResponse对象，如下：</p> 
<pre><code class="language-java">    //http://localhost:8088/chat/pro?message=介绍下上海这个城市
    @GetMapping("/chat/pro")
    public Object chatCallPrompt(@RequestParam("message") String message){
        ChatResponse call = openAiChatClient.call(new Prompt(message));
        return call;
    }</code></pre> 
<p>调用一下该接口，看到如下的响应结果，此时返回的是一个json对象，也可以使用ChatResponse 获取单纯的文本结果</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/87/57/8SsCrdL5_o.png"></p> 
<p></p> 
<h4 id="3.4.2%20call%E4%BD%BF%E7%94%A8Prompt%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B02">3.4.2 call使用Prompt传递参数2</h4> 
<p>从Prompt的对象参数中不难发现，支持传递的构造对象方式有很多，上面是传递一个简单的字符串作为参数，也可以使用其他的方式</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7e/7f/ZRnhHqcB_o.png"></p> 
<p>在官网的api文档中有详细的介绍：<a href="https://docs.spring.io/spring-ai/reference/api/clients/openai-chat.html" rel="nofollow" title="OpenAI Chat :: Spring AI Reference">OpenAI Chat :: Spring AI Reference</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/36/cc/efhwnJSZ_o.png"></p> 
<p></p> 
<p>看下面的写法，通过这种方式，可以更好的控制gpt接口返回的响应结果的质量，当然，Prompt里面可以传递的参数还有很多，可以结合官网的解释进一步理解</p> 
<pre><code class="language-java">    //http://localhost:8088/chat/v2?message=介绍下上海这个城市
    @GetMapping("/chat/v2")
    public Object chatCallPromptV2(@RequestParam("message") String message){
        Prompt prompt = new Prompt(
                message,
                OpenAiChatOptions.builder()
                        .withModel("gpt-4-32k") //32k 参数量，参数量越大，越准确
                        .withTemperature(0.4f)  //温度值，温度值越高，准确率下降，但是创新性好
                        .build()
        );
        return openAiChatClient.call(prompt);
    }</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/49/60/SLIhkPxO_o.png"></p> 
<p></p> 
<p>补充说明</p> 
<blockquote> 
 <p>Prompt对象中的参数，也可以通过配置文件的形式进行配置，如果配置文件和代码中同时配置了，以代码中的生效</p> 
</blockquote> 
<p></p> 
<h3 id="3.5%20OpenAiImageClient%E4%BD%BF%E7%94%A8">3.5 OpenAiImageClient使用</h3> 
<p>OpenAiImageClient是spring ai中提供的用于生成图片的核心对象，借助这个对象，可以传递相关的参数和描述，生成符合要求的图片，下面看一个具体的案例，如下，提供一个生成图片的接口：</p> 
<pre><code class="language-java">import org.springframework.ai.image.ImagePrompt;
import org.springframework.ai.image.ImageResponse;
import org.springframework.ai.openai.OpenAiImageClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ImageChatController {

    @Autowired
    private OpenAiImageClient openAiImageClient;

    //http://localhost:8088/image/generate?message=生成一张猫的图片
    @GetMapping("/image/generate")
    public Object chat(@RequestParam("message") String message){
        ImagePrompt imagePrompt = new ImagePrompt(message);
        ImageResponse imageResponse = openAiImageClient.call(imagePrompt);
        return imageResponse.getResult().getOutput();
    }

}</code></pre> 
<p>在这段代码中，通过传递一个message参数，从而构造出一个ImagePrompt的对象，最后调用openAiImageClient的call方法生成图片，调用接口，看的如下返回结果</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/09/16/335fXavE_o.png"></p> 
<p>然后将返回结果中的url输入到浏览器，就能看到一张猫的图片</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d2/04/1FjUOJPr_o.png"></p> 
<p><strong>注意点：</strong></p> 
<blockquote> 
 <p>调用生成图片的接口，你的apikey需要使用GPT4.0的模型，3.5的会报错，不支持生成图片</p> 
</blockquote> 
<p></p> 
<h4 id="3.5.1%20%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5">3.5.1 其他参数传递使用情况</h4> 
<p>在ImagePrompt对象的参数中，除了传递一个message之外，从下面的参数展示中，还可以传递其他类型的参数</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/31/68/4aYaX2xR_o.png"></p> 
<p>在spring ai官方文档中，关于ImagePrompt对象的构造参数中，提供了如下的示例，即可以通过OpenAiImageOptions构造出第二个参数，一起传给ImagePrompt进行使用</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/55/1f/xfM289cZ_o.png"></p> 
<p></p> 
<p>下面看具体的接口示例</p> 
<pre><code class="language-java">    //http://localhost:8088/image/generate/v2?message=生成一只狗的图片
    @GetMapping("/image/generate/v2")
    public Object genImageV2(@RequestParam("message") String message){
        ImagePrompt imagePrompt = new ImagePrompt(message, OpenAiImageOptions.builder()
                .withQuality("hd") //高清图像
                .withN(1) //生成1张图片，不同的模型可以生成的数量不一样
                .withHeight(1024)
                .withWidth(1024).build());
        ImageResponse imageResponse = openAiImageClient.call(imagePrompt);
        return imageResponse.getResult().getOutput();
    }</code></pre> 
<p>每个参数的具体含义，在官网的文档中也有详细的说说明，需要注意的是，这些参数也可以在工程的配置文件中进行配置，如果配置文件和代码中都设置了，以代码中的设置为准；</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8f/97/MK3iLS1t_o.png"></p> 
<p>调用接口，看的如下返回信息</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/53/cd/YAw32Iqk_o.png"></p> 
<p>浏览器中输入这段url，可以看的正好是一张小狗的图片</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/32/73/ngH4FBYC_o.png"></p> 
<p></p> 
<h3 id="3.6%20OpenAiAudioTranscriptionClient%20%E4%BD%BF%E7%94%A8">3.6 OpenAiAudioTranscriptionClient 使用</h3> 
<p>即音频转文本的API对象，音频转文本的场景在日常生活中也比较常见，在GPT问世之前，也有一些厂商提供相关的商用软件，spring ai 官方的示例代码：<a href="https://github.com/spring-projects/spring-ai/blob/main/models/spring-ai-openai/src/test/java/org/springframework/ai/openai/audio/transcription/OpenAiTranscriptionClientWithTranscriptionResponseMetadataTests.java" title="spring-ai/models/spring-ai-openai/src/test/java/org/springframework/ai/openai/audio/transcription/OpenAiTranscriptionClientWithTranscriptionResponseMetadataTests.java at main · spring-projects/spring-ai · GitHub">spring-ai/models/spring-ai-openai/src/test/java/org/springframework/ai/openai/audio/transcription/OpenAiTranscriptionClientWithTranscriptionResponseMetadataTests.java at main · spring-projects/spring-ai · GitHub</a></p> 
<p></p> 
<p>看下面的示例代码，需要提前在本地目录下提供一个音频文件；</p> 
<pre><code class="language-java">@RestController
public class TranslateController {

    @Autowired
    private OpenAiAudioTranscriptionClient openAiAudioTranscriptionClient;

    //http://localhost:8088/audio/translate/text
    @GetMapping("/audio/translate/text")
    public Object audioTranslateText(){
        Resource resource = new FileSystemResource("D:\\cat.mp3");
        String call = openAiAudioTranscriptionClient.call(resource);
        return call;
    }

}</code></pre> 
<h3 id="3.7%20OpenAiAudioSpeechClient%E4%BD%BF%E7%94%A8">3.7 OpenAiAudioSpeechClient使用</h3> 
<p>文本转语音的API对象，即将一段文本转为语音，参考如下代码</p> 
<pre><code class="language-java">    @Autowired
    private OpenAiAudioSpeechClient openAiAudioSpeechClient;

    //http://localhost:8088/text/translate/audio?msg=春天悄然而至，绿意盎然的枝头绽放出无尽的生命力，仿佛是大自然的调色板，绘出一幅幅美妙的画卷。
    @GetMapping("/text/translate/audio")
    public Object textToAudio(@RequestParam String msg) throws Exception{
        byte[] call = openAiAudioSpeechClient.call(msg);
        FileOutputStream fos = new FileOutputStream("D:\\output.mp3");
        fos.write(call);
        System.out.println("字节数组写入文件成功！");
        return "success";
    }</code></pre> 
<p>执行完成后，本地将会生成一个音频文件</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0f/0c/EbaWdKK6_o.png"></p> 
<p></p> 
<h2 id="%E5%9B%9B%E3%80%81Spring%20AI%E5%AF%B9%E6%8E%A5Ollama">四、Spring AI对接Ollama</h2> 
<p></p> 
<h3 id="4.1%20Ollama%E4%BB%8B%E7%BB%8D">4.1 Ollama介绍</h3> 
<p>Ollama是一个用于部署和运行各种开源大模型的工具，能够帮助用户快速在本地运行各种大模型，极大地简化了大模型在本地运行的过程。对用户来说，只需要通过执行几条命令就能在本地运行开源大模型，如Llama 2等。</p> 
<p></p> 
<p>官网：<a href="https://ollama.com/" rel="nofollow" title="Ollama">Ollama</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/4c/bf/ghv723hi_o.png"></p> 
<h3 id="4.2%20Ollama%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2">4.2 Ollama本地部署</h3> 
<p>进入网站之后，点击右上角的 Download按钮，根据个人的实际情况，选择不同类型的安装包进行部署，我这里选择的是Windows的版本；</p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/85/29/sB7pSMy2_o.png"></p> 
<p><strong>注意</strong></p> 
<blockquote> 
 <p>Ollama部署的时候，对服务器或机器是有一定要求的，所以需要根据你的机器配置情况进行选择，在Ollama的官网通过github的链接点进去，可以看到如下的相关参数指导说明，在这里，你部署的大模型参数越多，理论上来说，对机器的配置要求就越高，目前先关注这一点即可。</p> 
</blockquote> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5d/56/4kDs6hvO_o.png"></p> 
<p></p> 
<h4 id="4.2.1%20%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85">4.2.1 下载安装包</h4> 
<p></p> 
<p>这里选择下载的是windows版本</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/74/92/ItmaCTw2_o.png"></p> 
<h4 id="4.2.2%20%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85">4.2.2 执行安装</h4> 
<p>Ollama的安装比较简单，双击执行这个exe文件，等待安装完成即可</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ab/fa/mUntgMKD_o.png"></p> 
<p>安装完成之后，点击开始进入下面的shell窗口</p> 
<p style="text-align:center;"><img alt="" class="left" src="https://images2.imgbox.com/45/b6/aLOjhiJC_o.png"></p> 
<p></p> 
<p><strong>Ollama常用命令</strong></p> 
<p>cmd窗口输入Ollama，即可了解常用的Ollama命令</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ba/7e/KiUGFbbD_o.png"></p> 
<p></p> 
<p>如何理解本机部署的这个Ollama呢？如果使用过Docker的同学对docker部署一些中间件应该不陌生，比如使用docker中部署mysql或redis，只需要运行一段docker命令即可完成，非常方便，类比于Ollama，是一个大模型的部署管理工具，只需要使用Ollama的命令，也可以快速部署起一个本地的大模型进行使用。</p> 
<p></p> 
<p>如果你需要使用Ollama部署大模型，可以在Ollama官网进行搜索，类似于你使用docker search 镜像名一样</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/49/68/xKn7WSft_o.png"></p> 
<p>如下，进入到某个大模型中，拷贝命令到shell窗口中执行即可</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/64/15/3qHJ1t6f_o.png"></p> 
<h4 id="4.2.3%20Ollama%E9%83%A8%E7%BD%B2%E5%8D%83%E9%97%AE%E5%A4%A7%E6%A8%A1%E5%9E%8B">4.2.3 Ollama部署千问大模型</h4> 
<p>“通义千问大模型”是阿里云推出的一个超大规模的语言模型，具有强大的归纳和理解能力，可以处理各种自然语言处理任务，包括但不限于文本分类、文本生成、情感分析等。此模型能够极大地提高了自然语言处理的效率和准确性，给用户提供了一种新的、简便的工具。</p> 
<p></p> 
<p>在Ollama中搜索关键字qwen，然后选择一个参数相对较少（对本地的空间和资源占用减小）的进行运行</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d6/00/2TBniahF_o.png"></p> 
<p>使用下面的命令运行</p> 
<pre><code class="language-bash">ollama run qwen:0.5b-chat </code></pre> 
<p>然后等待模型下载完成运行起来之后就可以使用了，下面这个进度窗口是不是与docker部署中间件很相像</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cd/99/UnYrwbxD_o.png"></p> 
<p></p> 
<p>然后就可以输入文本，与大千问模型进行对话，而后，就可以基于部署的模型应用于实际工作或业务中进行结合使用</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/68/64/i8eKyIug_o.png"></p> 
<p></p> 
<h4 id="4.2.4%20%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E">4.2.4 补充说明</h4> 
<p>大模型参数数量与资源消耗具有如下关系：</p> 
<ul><li>大模型参数越多 
  <ul><li>模型的尺寸就越大；</li><li>模型的输出结果越准确；</li><li>允许所需要的资源成本越高；</li></ul></li><li>本地开发不适合使用尺寸较大的模型；</li><li>折中的方案 
  <ul><li>开发时在本地运行参数较少的模型；</li><li>集成测试时使用外部服务</li></ul></li></ul> 
<h3></h3> 
<h3 id="4.3%C2%A0Spring%20Ai%E6%8E%A5%E5%85%A5Ollama">4.3 Spring Ai接入Ollama</h3> 
<p>接下来演示如何在springboot项目中集成Ollama，参考下面的操作步骤</p> 
<p></p> 
<h4 id="4.3.1%20%E5%BC%95%E5%85%A5Ollama%E4%BE%9D%E8%B5%96">4.3.1 引入Ollama依赖</h4> 
<p>基于上述的spring ai版本，添加下面的依赖</p> 
<pre><code class="language-java">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
            &lt;artifactId&gt;spring-ai-ollama-spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<h4 id="4.3.2%20%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4.3.2 添加配置文件</h4> 
<p>配置文件中添加Ollama相关的配置信息，注意的是，Ollama默认端口为11434</p> 
<pre><code class="language-java">server:
  port: 8088

spring:
  application:
    name: chat-001

  ai:
    ollama:
      base-url: http://localhost:11434
      chat:
        options:
          model: qwen:0.5b-chat
    openai:
      api-key: 你的apikey
      base-url: openai地址</code></pre> 
<h4 id="4.3.3%20%E4%BD%BF%E7%94%A8Ollama%E8%81%8A%E5%A4%A9api">4.3.3 使用Ollama聊天api</h4> 
<p>Ollama聊天API的核心对象为OllamaChatClient，与上述的spring ai中提供的client对象类似，在程序中可以直接调用其api，如下，传入一个msg参数，返回响应的文本内容</p> 
<pre><code class="language-java">import jakarta.annotation.Resource;
import org.springframework.ai.ollama.OllamaChatClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class OllamaChatController {

    @Resource
    private OllamaChatClient ollamaChatClient;

    //http://localhost:8088/ollama/chat?msg=大数据的技术栈有哪些
    @GetMapping("/ollama/chat")
    public String ollamaChat(@RequestParam String msg){
        String resMsg = ollamaChatClient.call(msg);
        return resMsg;
    }

}</code></pre> 
<p>启动服务，调用一下接口，可以看到响应的内容，通过这种方式，相当于是利用spring ai接入了本地的大模型进行对话聊天</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d9/21/bShbB26W_o.png"></p> 
<p>也可以使用Prompt进行参数传递，看下面的接口</p> 
<pre><code class="language-java">    @GetMapping("/ollama/chat/v2")
    public Object ollamaChatV2(@RequestParam String msg){
        Prompt prompt = new Prompt(msg);
        ChatResponse chatResponse = ollamaChatClient.call(prompt);
        return chatResponse;
    }</code></pre> 
<p>返回结果如下，返回这种结构的数据在实际使用的时候，需要对json中的字段进行解析即可</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d4/f1/sx1pT3qX_o.png"></p> 
<p>spring ai官网中也提供了Ollama的相关文档，地址：<a href="https://docs.spring.io/spring-ai/reference/api/clients/ollama-chat.html" rel="nofollow" title="Ollama Chat :: Spring AI Reference">Ollama Chat :: Spring AI Reference</a>，在文档中，可以找到很多有关Ollama的详细的配置参数，这些配置参数，都可以在Prompt对象或者配置文件中进行合理的使用，达到最佳的实践效果</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/9f/62/psfAgRNb_o.png"></p> 
<p>比如，在下面的接口中，仍然使用Prompt对象，里面传入更多的参数选项做控制</p> 
<pre><code class="language-java">    //http://localhost:8088/ollama/chat/v3?msg=中国排名前十的大学
    @GetMapping("/ollama/chat/v3")
    public Object ollamaChatV3(@RequestParam String msg){
        Prompt prompt = new Prompt(
                msg,
                OllamaOptions.create()
                        .withModel("qwen:0.5b-chat")
                        .withTemperature(0.4F)
        );
        ChatResponse chatResponse = ollamaChatClient.call(prompt);
        return chatResponse.getResult().getOutput().getContent();
    }</code></pre> 
<p>再次调用一下接口，当然这个结果是否一定准确呢？对于结果的使用还需要做认真的鉴别</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/2e/af/NRcl2oAi_o.png"></p> 
<p></p> 
<h2 id="%E4%BA%94%E3%80%81%E5%86%99%E5%9C%A8%E6%96%87%E6%9C%AB">五、写在文末</h2> 
<p>本文详细介绍了spring ai的使用，并通过案例详细介绍了spring ai中常用的api使用方法，最后通过本地安装安装Ollama并部署大模型接入通义千问，希望对看到的同学有用，本篇到此结束感谢观看。</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f2a2344224c98d6d927028845e5bdc0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">土家风景文化|基于SSM＋vue的土家风景文化管理平台的设计与实现(源码&#43;数据库&#43;文档)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9181d2cbf40f20366713cb6a794e677a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Gin框架学习笔记(五) ——文件上传与路由中间件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>