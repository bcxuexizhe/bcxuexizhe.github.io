<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用Lama Cleaner本地实现AIGC试玩：擦除对象、替换对象、更换风格等等 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/08b42f8b818a87d3ea2bc6fdca973971/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="利用Lama Cleaner本地实现AIGC试玩：擦除对象、替换对象、更换风格等等">
  <meta property="og:description" content="目录 一、安装二、擦除功能1. LaMa模型实操实例一：去除路人实操实例二：去水印实操实例三：老照片修复 2. LDM模型3. ZITS模型4. MAT模型5. FcF模型6. Manga模型 三、替换对象功能1. sd1.52. sd23. anything44. realisticVision1.45. 四个模型的对比 四、进阶版功能1. Paint By Example2. Stable Diffusion with ControlNet3. Instruct Pix2pix 五、遇到的问题 Lama Cleaner是一个免费的、开源的、完全自托管的修复工具，里面提供了很多最前沿的AIGC模型。可以使用它从图片中删除任何不需要的物体、缺陷、人物，或删除和替换图片上的任何内容。本文章详细介绍了该工具的所有功能，并体验了下每个功能的实际效果。
github：https://github.com/Sanster/lama-cleaner
官方使用文档：https://lama-cleaner-docs.vercel.app/
一、安装 # 如果电脑带GPU，为了使用GPU首先安装与cuda版本相对应的pytorch，比如cuda11.7的 pip install torch==1.13.1&#43;cu117 torchvision==0.14.1 --extra-index-url https://download.pytorch.org/whl/cu117 # pip直接安装 pip install lama-cleaner 本文安装时版本更新到1.2.4
二、擦除功能 下方擦除功能所需要的模型全部上传至夸克网盘（链接：https://pan.quark.cn/s/370b455924ab，提取码：SNrE），在github下载失败时可手动网盘下载至规定路径。
找到lama-cleaner.exe的路径：C:\Users\zhouying\AppData\Roaming\Python\Python39\Scripts（不同电脑路径不同）
cd C:\Users\zhouying\AppData\Roaming\Python\Python39\Scripts lama-cleaner --model=lama --device=cuda --port=8080 device如果没有gpu：--device=cpu。
默认模型权重下载后保存的路径为C盘，可在上面的命令后再加一个参数--model-dir=F:/lama-cleaner/checkpoints用于指定保存权重文件的路径。
该命令会自动下载AI模型到本地（也可手动下载big-lama.pt到下图红框中的路径），然后浏览器打开http://localhost:8080/就可以使用了。
1. LaMa模型 github：https://github.com/saic-mdal/lama
paper：Resolution-robust Large Mask Inpainting with Fourier Convolutions
lama是默认模型，模型196MB，性能已经挺不错了。
实操实例一：去除路人 实操实例二：去水印 涂抹过程中可以长按Ctrl键进行多处涂抹">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-29T17:34:26+08:00">
    <meta property="article:modified_time" content="2024-04-29T17:34:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用Lama Cleaner本地实现AIGC试玩：擦除对象、替换对象、更换风格等等</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">一、安装</a></li><li><a href="#_19" rel="nofollow">二、擦除功能</a></li><li><ul><li><a href="#1_LaMa_36" rel="nofollow">1. LaMa模型</a></li><li><ul><li><a href="#_43" rel="nofollow">实操实例一：去除路人</a></li><li><a href="#_48" rel="nofollow">实操实例二：去水印</a></li><li><a href="#_57" rel="nofollow">实操实例三：老照片修复</a></li></ul> 
   </li><li><a href="#2_LDM_71" rel="nofollow">2. LDM模型</a></li><li><a href="#3_ZITS_96" rel="nofollow">3. ZITS模型</a></li><li><a href="#4_MAT_116" rel="nofollow">4. MAT模型</a></li><li><a href="#5__FcF_135" rel="nofollow">5. FcF模型</a></li><li><a href="#6_Manga_155" rel="nofollow">6. Manga模型</a></li></ul> 
  </li><li><a href="#_172" rel="nofollow">三、替换对象功能</a></li><li><ul><li><a href="#1_sd15_174" rel="nofollow">1. sd1.5</a></li><li><a href="#2_sd2_201" rel="nofollow">2. sd2</a></li><li><a href="#3_anything4_213" rel="nofollow">3. anything4</a></li><li><a href="#4_realisticVision14_223" rel="nofollow">4. realisticVision1.4</a></li><li><a href="#5__233" rel="nofollow">5. 四个模型的对比</a></li></ul> 
  </li><li><a href="#_247" rel="nofollow">四、进阶版功能</a></li><li><ul><li><a href="#1_Paint_By_Example_249" rel="nofollow">1. Paint By Example</a></li><li><a href="#2_Stable_Diffusion_with_ControlNet_266" rel="nofollow">2. Stable Diffusion with ControlNet</a></li><li><a href="#3_Instruct_Pix2pix_294" rel="nofollow">3. Instruct Pix2pix</a></li></ul> 
  </li><li><a href="#_314" rel="nofollow">五、遇到的问题</a></li></ul> 
</div> 
<p></p> 
<blockquote> 
 <p><strong>Lama Cleaner</strong>是一个免费的、开源的、完全自托管的修复工具，里面提供了很多最前沿的AIGC模型。可以使用它从图片中删除任何不需要的物体、缺陷、人物，或删除和替换图片上的任何内容。<strong>本文章详细介绍了该工具的所有功能，并体验了下每个功能的实际效果</strong>。</p> 
</blockquote> 
<p>github：<a href="https://github.com/Sanster/lama-cleaner">https://github.com/Sanster/lama-cleaner</a></p> 
<p>官方使用文档：<a href="https://lama-cleaner-docs.vercel.app/" rel="nofollow">https://lama-cleaner-docs.vercel.app/</a></p> 
<h2><a id="_7"></a>一、安装</h2> 
<pre><code class="prism language-bash"><span class="token comment"># 如果电脑带GPU，为了使用GPU首先安装与cuda版本相对应的pytorch，比如cuda11.7的</span>
pip <span class="token function">install</span> <span class="token assign-left variable">torch</span><span class="token operator">==</span><span class="token number">1.13</span>.1+cu117 <span class="token assign-left variable">torchvision</span><span class="token operator">==</span><span class="token number">0.14</span>.1 --extra-index-url https://download.pytorch.org/whl/cu117

<span class="token comment"># pip直接安装</span>
pip <span class="token function">install</span> lama-cleaner
</code></pre> 
<p>本文安装时版本更新到1.2.4</p> 
<h2><a id="_19"></a>二、擦除功能</h2> 
<blockquote> 
 <p>下方擦除功能所需要的模型全部上传至夸克网盘（链接：<a href="https://pan.quark.cn/s/370b455924ab" rel="nofollow">https://pan.quark.cn/s/370b455924ab</a>，提取码：SNrE），在github下载失败时可手动网盘下载至规定路径。</p> 
</blockquote> 
<p>找到<code>lama-cleaner.exe</code>的路径：<code>C:\Users\zhouying\AppData\Roaming\Python\Python39\Scripts</code>（不同电脑路径不同）</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>zhouying<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Roaming<span class="token punctuation">\</span>Python<span class="token punctuation">\</span>Python39<span class="token punctuation">\</span>Scripts

lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>lama <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p>device如果没有gpu：<code>--device=cpu</code>。<br> <font color="#0000FF">默认模型权重下载后保存的路径为C盘，可在上面的命令后再加一个参数<code>--model-dir=F:/lama-cleaner/checkpoints</code>用于指定保存权重文件的路径。</font></p> 
<p>该命令会自动下载AI模型到本地（也可手动下载<a href="https://github.com/Sanster/models/releases/download/add_big_lama/big-lama.pt">big-lama.pt</a>到下图红框中的路径），然后浏览器打开<a href="http://localhost:8080/" rel="nofollow">http://localhost:8080/</a>就可以使用了。<br> <img src="https://images2.imgbox.com/cf/93/NW7As7v2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1_LaMa_36"></a>1. LaMa模型</h3> 
<ul><li> <p>github：<a href="https://github.com/saic-mdal/lama">https://github.com/saic-mdal/lama</a></p> </li><li> <p>paper：<a href="https://arxiv.org/abs/2109.07161" rel="nofollow">Resolution-robust Large Mask Inpainting with Fourier Convolutions</a></p> </li></ul> 
<p>lama是默认模型，模型196MB，性能已经挺不错了。</p> 
<h4><a id="_43"></a>实操实例一：去除路人</h4> 
<p><img src="https://images2.imgbox.com/91/da/WSISthRb_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_48"></a>实操实例二：去水印</h4> 
<p>涂抹过程中可以长按Ctrl键进行多处涂抹<br> <img src="https://images2.imgbox.com/7b/32/yGyVpYnA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/17/8d/3XzhmwOp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_57"></a>实操实例三：老照片修复</h4> 
<p><img src="https://images2.imgbox.com/06/3a/kFudmBge_o.gif" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>可以在网页中选择不同的AI模型或在命令行中选择不同模型（下方章节），这样都会自动下载相应的模型到本地。</strong></p> 
<p><img src="https://images2.imgbox.com/b4/f7/dFfXLZih_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="2_LDM_71"></a>2. LDM模型</h3> 
<ul><li> <p>github：<a href="https://github.com/CompVis/latent-diffusion">https://github.com/CompVis/latent-diffusion</a></p> </li><li> <p>paper：<a href="https://arxiv.org/abs/2112.10752" rel="nofollow">High-Resolution Image Synthesis with Latent Diffusion Models</a></p> </li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>ldm <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<blockquote> 
 <p>LDM模型手动下载链接：<a href="https://github.com/Sanster/models/releases/download/add_ldm/diffusion.pt">diffusion.pt</a>、<a href="https://github.com/Sanster/models/releases/download/add_ldm/cond_stage_model_decode.pt">cond_stage_model_decode.pt</a>、<a href="https://github.com/Sanster/models/releases/download/add_ldm/cond_stage_model_encode.pt">cond_stage_model_encode.pt</a></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7a/30/uObNXF6p_o.png" alt="在这里插入图片描述"></p> 
<p><strong>LDM vs LaMa</strong></p> 
<ul><li>可能比LaMa有更好、更多的细节</li><li>可以通过调整<code>Steps</code>来平衡时间和质量</li><li>比LaMa慢很多（3080 12it/s）</li><li>需要更多的GPU内存（512x512 5.8G）</li></ul> 
<p><img src="https://images2.imgbox.com/b5/da/Y79kFEFk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_ZITS_96"></a>3. ZITS模型</h3> 
<ul><li> <p>github：<a href="https://github.com/DQiaole/ZITS_inpainting">https://github.com/DQiaole/ZITS_inpainting</a></p> </li><li> <p>paper：<a href="https://arxiv.org/abs/2203.00867" rel="nofollow">Incremental Transformer Structure Enhanced Image Inpainting with Masking Positional Encoding</a></p> </li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>zits <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<blockquote> 
 <p>ZITS模型手动下载链接：<a href="https://github.com/Sanster/models/releases/download/add_zits/zits-wireframe-0717.pt">zits-wireframe-0717.pt</a>、<a href="https://github.com/Sanster/models/releases/download/add_zits/zits-edge-line-0717.pt">zits-edge-line-0717.pt</a>、<a href="https://github.com/Sanster/models/releases/download/add_zits/zits-structure-upsample-0717.pt">zits-structure-upsample-0717.pt</a>、<a href="https://github.com/Sanster/models/releases/download/add_zits/zits-inpaint-0717.pt">zits-inpaint-0717.pt</a></p> 
</blockquote> 
<p><strong>ZITS vs LaMa</strong></p> 
<ul><li>擅长在高分辨弱纹理场景中恢复关键的边缘和线框</li><li>ZITS的<code>Wireframe</code>模块在CPU上会非常慢</li></ul> 
<p><img src="https://images2.imgbox.com/cd/54/Pa1sge7b_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_MAT_116"></a>4. MAT模型</h3> 
<ul><li> <p>github：<a href="https://github.com/fenglinglwb/MAT">https://github.com/fenglinglwb/MAT</a></p> </li><li> <p>paper：<a href="https://arxiv.org/abs/2203.15270" rel="nofollow">Mask-Aware Transformer for Large Hole Image Inpainting</a></p> </li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>mat <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<blockquote> 
 <p>MAT模型手动下载链接：<a href="https://github.com/Sanster/models/releases/download/add_mat/Places_512_FullData_G.pth">Places_512_FullData_G.pth</a></p> 
</blockquote> 
<p>特点：MAT可实现大面积像素缺失的补全和提供多样性生成</p> 
<p><img src="https://images2.imgbox.com/48/23/F9o7BJPD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5__FcF_135"></a>5. FcF模型</h3> 
<ul><li> <p>github：<a href="https://github.com/SHI-Labs/FcF-Inpainting">https://github.com/SHI-Labs/FcF-Inpainting</a></p> </li><li> <p>paper：<a href="https://arxiv.org/abs/2208.03382" rel="nofollow">Keys to Better Image Inpainting: Structure and Texture Go Hand in Hand</a></p> </li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>fcf <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<blockquote> 
 <p>FcF模型手动下载链接：<a href="https://github.com/Sanster/models/releases/download/add_fcf/places_512_G.pth">places_512_G.pth</a></p> 
</blockquote> 
<p>FcF vs LaMa</p> 
<ul><li>能生成更好的结构和纹理</li><li>仅支持固定大小（512x512）的输入</li></ul> 
<p><img src="https://images2.imgbox.com/3c/27/CYNdlvbV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_Manga_155"></a>6. Manga模型</h3> 
<ul><li> <p>github：<a href="https://github.com/msxie92/MangaInpainting">https://github.com/msxie92/MangaInpainting</a></p> </li><li> <p>paper：<a href="https://www.cse.cuhk.edu.hk/~ttwong/papers/mangainpaint/mangainpaint.html" rel="nofollow">Seamless Manga Inpainting with Semantics Awareness</a></p> </li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>manga <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<blockquote> 
 <p>Manga模型手动下载链接：<a href="https://github.com/Sanster/models/releases/download/manga/erika.jit">erika.jit</a>、<a href="https://github.com/Sanster/models/releases/download/manga/manga_inpaintor.jit">manga_inpaintor.jit</a></p> 
</blockquote> 
<p>特点：在漫画图像上表现的比LaMa模型效果更好</p> 
<p><img src="https://images2.imgbox.com/8e/c2/rs0rl2e6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_172"></a>三、替换对象功能</h2> 
<h3><a id="1_sd15_174"></a>1. sd1.5</h3> 
<p>github：<a href="https://github.com/runwayml/stable-diffusion">https://github.com/runwayml/stable-diffusion</a></p> 
<p>hugging face：<a href="https://huggingface.co/runwayml/stable-diffusion-inpainting" rel="nofollow">https://huggingface.co/runwayml/stable-diffusion-inpainting</a></p> 
<p>因为需要访问hugging face，所以<strong>需要魔法</strong></p> 
<ul><li>运行方式一：</li></ul> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>sd1.5 <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p>自动下载的文件保存路径为<code>C:\Users\zhouying\.cache\huggingface\hub\models--runwayml--stable-diffusion-inpainting</code>。</p> 
<p><img src="https://images2.imgbox.com/48/73/oTvFZzDG_o.png" alt="在这里插入图片描述"></p> 
<ul><li>运行方式二：</li></ul> 
<p>可以先下载<a href="https://cdn-lfs.huggingface.co/repos/28/5e/285eb65c80a79a0d555ab9f79ed524aac4548cceb7a5e49c9084f0633c51009a/c6bbc15e3224e6973459ba78de4998b80b50112b0ae5b5c67113d56b4e366b19?response-content-disposition=attachment%3B+filename*%3DUTF-8%27%27sd-v1-5-inpainting.ckpt%3B+filename%3D%22sd-v1-5-inpainting.ckpt%22%3B&amp;Expires=1698326621&amp;Policy=eyJTdGF0ZW1lbnQiOlt7IkNvbmRpdGlvbiI6eyJEYXRlTGVzc1RoYW4iOnsiQVdTOkVwb2NoVGltZSI6MTY5ODMyNjYyMX19LCJSZXNvdXJjZSI6Imh0dHBzOi8vY2RuLWxmcy5odWdnaW5nZmFjZS5jby9yZXBvcy8yOC81ZS8yODVlYjY1YzgwYTc5YTBkNTU1YWI5Zjc5ZWQ1MjRhYWM0NTQ4Y2NlYjdhNWU0OWM5MDg0ZjA2MzNjNTEwMDlhL2M2YmJjMTVlMzIyNGU2OTczNDU5YmE3OGRlNDk5OGI4MGI1MDExMmIwYWU1YjVjNjcxMTNkNTZiNGUzNjZiMTk%7EcmVzcG9uc2UtY29udGVudC1kaXNwb3NpdGlvbj0qIn1dfQ__&amp;Signature=mCnrXtYtqPUXmO0%7ECA8eOZk0v7yp-UI5Q5412G2mK17C65hI1nrOQl9GHTEOHtH5F2kAIo%7Ev-POkxTuy8pTeGsd65Uy1P%7EuM2cRrIeOPFO5RR8LMChSPqikjNtcdFvNSefwfsLsXsyCaSxbEes43qfnc6-VObFZtTKrlb1BlXtKdIXUYY4WcXXTUrGHhtItAvNY88eu%7E8ZBUsIOjlpgnyT1VyhaPoYyA%7EdECDMAc6BW-YXPwtJua1rifSf1zf8pPfGMXSX1vti9adJIBSwk7aChbNZhkL9jOIxB60-0Y%7E9KzdVHPAQGUgxslGEJxgiXsgaWDxei88jdmCo9kr-7dcQ__&amp;Key-Pair-Id=KVTP0A1DKRTAX" rel="nofollow">sd-v1-5-inpainting.ckpt</a>到本地，然后下面的命令运行</p> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>sd1.5 <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span> --sd-local-model-path ./sd-v1-5-inpainting.ckpt --local-files-only
</code></pre> 
<h3><a id="2_sd2_201"></a>2. sd2</h3> 
<p>github：<a href="https://github.com/Stability-AI/stablediffusion">https://github.com/Stability-AI/stablediffusion</a></p> 
<p>hugging face：<a href="https://huggingface.co/stabilityai/stable-diffusion-2-inpainting" rel="nofollow">https://huggingface.co/stabilityai/stable-diffusion-2-inpainting</a></p> 
<pre><code>lama-cleaner --model=sd2 --device=cuda --port=8080
</code></pre> 
<p>下载的文件保存在<code>C:\Users\zhouying\.cache\huggingface\hub\models--stabilityai--stable-diffusion-2-inpainting</code></p> 
<h3><a id="3_anything4_213"></a>3. anything4</h3> 
<p>hugging face： <a href="https://huggingface.co/andite/anything-v4.0" rel="nofollow">https://huggingface.co/andite/anything-v4.0</a></p> 
<pre><code>lama-cleaner --model=anything4 --device=cuda --port=8080
</code></pre> 
<p>下载的文件保存在<code>C:\Users\zhouying\.cache\huggingface\hub\models--Sanster--anything-4.0-inpainting</code></p> 
<h3><a id="4_realisticVision14_223"></a>4. realisticVision1.4</h3> 
<p>hugging face：<a href="https://huggingface.co/SG161222/Realistic_Vision_V1.4" rel="nofollow">https://huggingface.co/SG161222/Realistic_Vision_V1.4</a></p> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>realisticVision1.4 <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p>下载的文件保存在<code>C:\Users\zhouying\.cache\huggingface\hub\models--Sanster--Realistic_Vision_V1.4-inpainting</code></p> 
<h3><a id="5__233"></a>5. 四个模型的对比</h3> 
<p>原图：</p> 
<p><img src="https://images2.imgbox.com/40/f7/sedtjceX_o.jpg" alt="在这里插入图片描述"></p> 
<p>涂抹图中小狗，然后prompt输入“a fox sitting on a bench”的输出如下：</p> 
<p><img src="https://images2.imgbox.com/5f/9e/wiPvxSJj_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>同时，这些模型同样能提供擦除功能，只需将prompt填写为“background”</p> 
</blockquote> 
<h2><a id="_247"></a>四、进阶版功能</h2> 
<h3><a id="1_Paint_By_Example_249"></a>1. Paint By Example</h3> 
<p>这个模型的输入是一张图片，模型会由这个示例图指导生成类似的内容。</p> 
<p>github：<a href="https://github.com/Fantasy-Studio/Paint-by-Example">https://github.com/Fantasy-Studio/Paint-by-Example</a></p> 
<p>paper：<a href="https://arxiv.org/abs/2211.13227" rel="nofollow">Paint by Example: Exemplar-based Image Editing with Diffusion Models</a></p> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>paint_by_example <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p>下载的文件保存在<code>C:\Users\zhouying\.cache\huggingface\hub\models--Fantasy-Studio--Paint-by-Example</code></p> 
<p><img src="https://images2.imgbox.com/81/5e/FiMuChFE_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="2_Stable_Diffusion_with_ControlNet_266"></a>2. Stable Diffusion with ControlNet</h3> 
<p>使用ControlNet可以获得更好的修复效果，命令如下：</p> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>sd1.5 --sd-controlnet --sd-controlnet-method control_v11p_sd15_inpaint <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p><code>--model</code>支持的参数有：</p> 
<ul><li>sd1.5</li><li>anything4</li><li>realisticVision1.4</li></ul> 
<p><code>--sd-controlnet-method</code>支持的参数有：</p> 
<ul><li>control_v11p_sd15_canny</li><li>control_v11p_sd15_openpose</li><li>control_v11p_sd15_inpaint</li><li>control_v11f1p_sd15_depth</li></ul> 
<blockquote> 
 <p>官方提示，这四种方法在应用时都需要适当地调整ControlNet Weight的数值，建议canny和openpose从0.4开始调整，inpaint和depth从1.0开始调整。</p> 
</blockquote> 
<p>尝试了一下，加了个ControlNet也没好多少，可能weight值还没调好。</p> 
<p><img src="https://images2.imgbox.com/29/ef/8oRz9aB4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_Instruct_Pix2pix_294"></a>3. Instruct Pix2pix</h3> 
<p>这个模型可以不用mask，而是直接输入prompt</p> 
<p>github：<a href="https://github.com/timothybrooks/instruct-pix2pix">https://github.com/timothybrooks/instruct-pix2pix</a></p> 
<p>paper：<a href="https://arxiv.org/abs/2211.09800" rel="nofollow">InstructPix2Pix: Learning to Follow Image Editing Instructions</a></p> 
<pre><code class="prism language-bash">lama-cleaner <span class="token parameter variable">--model</span><span class="token operator">=</span>instruct_pix2pix <span class="token parameter variable">--device</span><span class="token operator">=</span>cuda <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/94/39/3hlvd45F_o.png" alt="在这里插入图片描述"></p> 
<p>拿张图试玩一下，效果挺不错的。</p> 
<p><img src="https://images2.imgbox.com/63/04/fSH8jZa6_o.jpg" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/97/36/mx7lEImV_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_314"></a>五、遇到的问题</h2> 
<p>如果是开的网络代理，直接运行命令可能会出现连接问题</p> 
<pre><code class="prism language-bash">requests.exceptions.ConnectionError: <span class="token punctuation">(</span>MaxRetryError<span class="token punctuation">(</span><span class="token string">"HTTPSConnectionPool(host='huggingface.co', port=443): Max retries
exceeded with url: /api/models/timbrooks/instruct-pix2pix/revision/main (Caused by
NewConnectionError('&lt;urllib3.connection.HTTPSConnection object at 0x0000028076B1F5B0&gt;: Failed to establish a new
connection: [WinError 10060] 由于连接方在一段时间后没有正确答复或连接的主机没有反应，连接尝试失败。'))"</span><span class="token punctuation">)</span>,
<span class="token string">'(Request ID: 2dc5e5dc-d590-4f8d-87f7-ddcadc83656f)'</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用vscode打开lama-cleaner库的源码（路径参考<code>F:\Anaconda3\envs\ip2p\Lib\site-packages\lama_cleaner\parse_args.py</code>），增加下面这段代码，然后再重新运行代码。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'HTTP_PROXY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'http://xx.xx.xxx.xx:8080'</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'HTTPS_PROXY'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'http://xx.xx.xxx.xx:8080'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/23/df/zvIM3RQL_o.png" alt="，"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e70e5d33ac819c8904da3cc4fe2e71c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 开发 OCR 拍照 &#43; ML Kit 识别文字 巨详细全部代码教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/272ee618a7cc6416b322d215e5495198/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据复制的艺术：深拷贝与浅拷贝在JavaScript中的实现方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>