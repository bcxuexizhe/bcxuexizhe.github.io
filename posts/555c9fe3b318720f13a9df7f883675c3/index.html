<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JS执行原理大揭秘：事件循环Event Loop与宏任务、微任务 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/555c9fe3b318720f13a9df7f883675c3/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="JS执行原理大揭秘：事件循环Event Loop与宏任务、微任务">
  <meta property="og:description" content="前言
📫 大家好，我是南木元元，热爱技术和分享，欢迎大家交流，一起学习进步！
🍅 个人主页：南木元元
目录
事件循环概述
异步和单线程
同步任务
异步任务
任务队列
宏任务
微任务
例题
示例1
示例2 示例3 示例4 结语
事件循环概述 JavaScript是一种单线程语言，事件循环（Event Loop）作为JavaScript的核心执行机制，可以有效地进行异步处理，保证用户界面的响应性和流畅性。
事件循环的工作流程如下：
所有同步任务都在主线程上执行，形成一个执行栈在执行同步任务的时候，如果遇到了异步事件，会将该任务挂起，继续执行同步任务，当异步事件执行完后（如定时器到时，ajax请求返回），再将对应的回调加入到一个任务队列中等待执行，任务队列分为宏任务队列和微任务队列当执行栈中的同步任务执行完毕后，会执行所有微任务，清空微任务队列当执行完所有微任务后，再去执行宏任务队列中的下一个宏任务，不断循环，直到所有任务都完成。 异步和单线程 JavaScript 最初被设计为一门单线程语言，是因为它的主要用途是与用户的交互以及操作DOM。为了避免同一时间对同一个DOM元素进行操作从而导致不可预知的问题，JavaScript从一诞生就是单线程，避免了多线程环境中的复杂同步问题。
单线程的意思是在任何给定时间内，只能执行一个任务。这也意味着 JavaScript 代码执行可能面临阻塞问题，即一个耗时操作（如大量计算或高延迟的 I/O 操作）会阻塞整个程序的运行，如果代码阻塞只能一直等下去，这样导致很差的用户体验。所以事件循环的出现让 js 拥有异步的能力。
同步任务 同步任务指的是在主线程上直接执行的任务，按照代码顺序依次执行，其执行会阻塞后续代码的运行，直到任务完成。
console.log(&#39;开始执行&#39;); // 同步任务 function doSomething() { console.log(&#39;这是一个同步任务&#39;); } doSomething(); // 调用同步函数 console.log(&#39;结束执行&#39;); //开始执行 //这是一个同步任务 //结束执行 在这个示例中， doSomething()函数的调用是同步的，因此它会立即执行，并且后续代码必须等待它执行完成才能继续。
异步任务 异步任务是在主线程执行的同时，通过回调函数等机制委托给其他线程或事件来处理的任务，它不会立即执行，而是在将来的某个时刻完成。在执行异步任务时，主线程不会等待任务完成，而是继续执行后续代码。
异步执行的机制使得 JavaScript 能够更好地处理耗时操作，保持页面的响应性。
console.log(&#39;开始执行&#39;); // 异步任务 setTimeout(() =&gt; { console.log(&#39;这是一个异步任务&#39;); }, 1000); // 延迟1秒后执行 console.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-10T16:52:30+08:00">
    <meta property="article:modified_time" content="2024-05-10T16:52:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JS执行原理大揭秘：事件循环Event Loop与宏任务、微任务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>前言</strong></p> 
<blockquote> 
 <p> 📫 大家好，我是南木元元，热爱技术和分享，欢迎大家交流，一起学习进步！</p> 
 <p> 🍅 <strong>个人主页：<strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><a href="https://blog.csdn.net/weixin_43288600" title="南木元元">南木元元</a></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p> 
</blockquote> 
<hr> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%A6%82%E8%BF%B0" rel="nofollow">事件循环概述</a></p> 
<p id="%E5%BC%82%E6%AD%A5%E5%92%8C%E5%8D%95%E7%BA%BF%E7%A8%8B-toc" style="margin-left:0px;"><a href="#%E5%BC%82%E6%AD%A5%E5%92%8C%E5%8D%95%E7%BA%BF%E7%A8%8B" rel="nofollow">异步和单线程</a></p> 
<p id="%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1" rel="nofollow">同步任务</a></p> 
<p id="%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1" rel="nofollow">异步任务</a></p> 
<p id="%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97-toc" style="margin-left:0px;"><a href="#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97" rel="nofollow">任务队列</a></p> 
<p id="%E5%AE%8F%E4%BB%BB%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E5%AE%8F%E4%BB%BB%E5%8A%A1" rel="nofollow">宏任务</a></p> 
<p id="%E5%BE%AE%E4%BB%BB%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E5%BE%AE%E4%BB%BB%E5%8A%A1" rel="nofollow">微任务</a></p> 
<p id="%E4%BE%8B%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E4%BE%8B%E9%A2%98" rel="nofollow">例题</a></p> 
<p id="%E7%A4%BA%E4%BE%8B1-toc" style="margin-left:40px;"><a href="#%E7%A4%BA%E4%BE%8B1" rel="nofollow">示例1</a></p> 
<p id="%E7%A4%BA%E4%BE%8B2%C2%A0-toc" style="margin-left:40px;"><a href="#%E7%A4%BA%E4%BE%8B2%C2%A0" rel="nofollow">示例2 </a></p> 
<p id="%E7%A4%BA%E4%BE%8B3%C2%A0-toc" style="margin-left:40px;"><a href="#%E7%A4%BA%E4%BE%8B3%C2%A0" rel="nofollow">示例3 </a></p> 
<p id="%E7%A4%BA%E4%BE%8B4%C2%A0-toc" style="margin-left:40px;"><a href="#%E7%A4%BA%E4%BE%8B4%C2%A0" rel="nofollow">示例4 </a></p> 
<p id="%E7%BB%93%E8%AF%AD-toc" style="margin-left:0px;"><a href="#%E7%BB%93%E8%AF%AD" rel="nofollow">结语</a></p> 
<hr id="hr-toc"> 
<h2>事件循环概述</h2> 
<p>JavaScript是一种单线程语言，<strong>事件循环（Event Loop）</strong>作为JavaScript的核心执行机制，可以有效地进行异步处理，保证用户界面的响应性和流畅性。</p> 
<p>事件循环的工作流程如下：</p> 
<ol><li>所有同步任务都在主线程上执行，形成一个执行栈</li><li>在执行同步任务的时候，如果遇到了异步事件，会将该任务挂起，继续执行同步任务，当异步事件执行完后（如定时器到时，ajax请求返回），再将对应的回调加入到一个任务队列中等待执行，任务队列分为宏任务队列和微任务队列</li><li>当执行栈中的同步任务执行完毕后，会执行所有微任务，清空微任务队列</li><li>当执行完所有微任务后，再去执行宏任务队列中的下一个宏任务，不断循环，直到所有任务都完成。</li></ol> 
<p><img alt="" src="https://images2.imgbox.com/fd/f4/M1pRXlLC_o.png"></p> 
<h2 id="%E5%BC%82%E6%AD%A5%E5%92%8C%E5%8D%95%E7%BA%BF%E7%A8%8B">异步和单线程</h2> 
<p style="text-align:justify;">JavaScript 最初被设计为一门单线程语言，是因为它的主要用途是与用户的交互以及操作DOM。为了避免同一时间对同一个DOM元素进行操作从而导致不可预知的问题，JavaScript从一诞生就是单线程，避免了多线程环境中的复杂同步问题。</p> 
<p>单线程的意思是在任何给定时间内，只能执行一个任务。这也意味着 JavaScript 代码执行可能面临阻塞问题，即一个耗时操作（如大量计算或高延迟的 I/O 操作）会阻塞整个程序的运行，如果代码阻塞只能一直等下去，这样导致很差的用户体验。所以事件循环的出现让 js 拥有异步的能力。</p> 
<h3 id="%E5%90%8C%E6%AD%A5%E4%BB%BB%E5%8A%A1">同步任务</h3> 
<p>同步任务指的是在主线程上直接执行的任务，按照代码顺序依次执行，其执行会阻塞后续代码的运行，直到任务完成。</p> 
<pre><code class="language-javascript">console.log('开始执行');

// 同步任务
function doSomething() {
    console.log('这是一个同步任务');
}

doSomething();  // 调用同步函数

console.log('结束执行');
//开始执行
//这是一个同步任务
//结束执行</code></pre> 
<p>在这个示例中， doSomething()函数的调用是同步的，因此它会立即执行，并且后续代码必须等待它执行完成才能继续。</p> 
<h3 id="%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1">异步任务</h3> 
<p>异步任务是在主线程执行的同时，通过回调函数等机制委托给其他线程或事件来处理的任务，它不会立即执行，而是在将来的某个时刻完成。在执行异步任务时，主线程不会等待任务完成，而是继续执行后续代码。</p> 
<p>异步执行的机制使得 JavaScript 能够更好地处理耗时操作，保持页面的响应性。</p> 
<pre><code class="language-javascript">console.log('开始执行');

// 异步任务
setTimeout(() =&gt; {
    console.log('这是一个异步任务');
}, 1000);  // 延迟1秒后执行

console.log('结束执行');
//开始执行
//结束执行
//这是一个异步任务</code></pre> 
<p>在上述例子中，setTimeout是一个异步任务，它会在1秒后将回调函数推入任务队列，而主线程不会等待这个1秒，而是继续执行后面的console.log('结束执行')。当主线程的同步任务执行完成后，它会检查任务队列，将异步任务的回调函数推入执行栈进行执行。</p> 
<h2 id="%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97">任务队列</h2> 
<p>任务队列分为<strong>宏任务</strong>队列和<strong>微任务</strong>队列两种。每当一个宏任务执行完毕，会检查微任务队列，执行所有的微任务，再继续下一个宏任务。</p> 
<h3 id="%E5%AE%8F%E4%BB%BB%E5%8A%A1">宏任务</h3> 
<p>宏任务是一些较大粒度的任务，包括：</p> 
<ul><li>script</li><li>setTimeout、setInterval</li><li> <p>I/O操作，如文件读写</p> </li><li> <p>用户交互事件，如点击事件</p> </li><li> <p>UI render（页面渲染）</p> </li><li> <p>requestAnimationFrame（在浏览器中）</p> </li><li> <p>...</p> </li></ul> 
<h3 id="%E5%BE%AE%E4%BB%BB%E5%8A%A1">微任务</h3> 
<p>微任务通常是需要快速执行的小任务，它们的执行时机是在当前宏任务执行完毕并且在下一个宏任务开始之前。微任务的执行会比任何其他宏任务以及渲染操作更优先。包括：</p> 
<ul><li>Promise.then</li><li>async/await</li><li>process.nextTick（node中）</li><li>...</li></ul> 
<p><strong>为什么要引入微任务？</strong></p> 
<p style="text-align:justify;">为了解决异步回调的问题，如果将异步回调也进行宏任务的入队操作，那么必须等前面所有的宏任务完成之后再执行回调，如果任务队列非常长，那么回调迟迟得不到执行，就会造成页面卡顿。通过引入微任务的方式，在每一个宏任务中定义一个微任务队列，当该宏任务执行完成，会先去执行其中所有微任务，执行完成才去执行下一个宏任务。</p> 
<p style="text-align:justify;"><strong>概况一下</strong>：为了给高优先级任务一个插队的机会，否则新入队的任务永远被放在队尾，微任务比宏任务有更高优先级。</p> 
<h2 id="%E4%BE%8B%E9%A2%98">例题</h2> 
<p>如果看到这里，还觉得有点懵，那么接下来就通过几个例子来帮助你更好地理解。</p> 
<h3 id="%E7%A4%BA%E4%BE%8B1" style="background-color:transparent;">示例1</h3> 
<p class="img-center"><img alt="" height="338" src="https://images2.imgbox.com/60/e8/57YZ3DEX_o.png" width="328"></p> 
<ol><li>创建Promise实例是同步的，所以先执行主线程上的同步任务，打印1、3、4、5、7。</li><li>主线程的同步任务执行完毕后，会先执行微任务，执行Promise的then方法里的代码，打印6</li><li>微任务执行完毕后，最后执行定时器里的宏任务，打印2</li></ol> 
<h3 id="%E7%A4%BA%E4%BE%8B2%C2%A0">示例2 </h3> 
<p><strong>注意点：</strong>如果在执行微任务的过程中，产生新的微任务也需要一起清空；微任务队列没清空之前，是不会执行下一个宏任务的。</p> 
<p class="img-center"><img alt="" height="623" src="https://images2.imgbox.com/a7/63/sXenqxp4_o.png" width="382"></p> 
<h3 id="%E7%A4%BA%E4%BE%8B3%C2%A0">示例3 </h3> 
<p><strong>注意点：</strong>事件循环每一次只执行一个宏任务</p> 
<p class="img-center"><img alt="" height="443" src="https://images2.imgbox.com/4a/cd/QfG9K5P2_o.png" width="614"></p> 
<h3 id="%E7%A4%BA%E4%BE%8B4%C2%A0">示例4 </h3> 
<p><strong>注意点：</strong>微任务是DOM渲染前触发，宏任务是DOM渲染后触发</p> 
<p class="img-center"><img alt="" height="390" src="https://images2.imgbox.com/43/22/tAxd9DdH_o.png" width="466"></p> 
<h2 id="%E7%BB%93%E8%AF%AD">结语</h2> 
<p>🔥如果此文对你有帮助的话，欢迎💗<span style="color:#fe2c24;"><strong>关注</strong></span>、👍<span style="color:#ff9900;"><strong>点赞</strong></span>、⭐<span style="color:#4da8ee;"><strong>收藏</strong></span>、✍️<span style="color:#9c8ec1;"><strong>评论</strong></span>，支持一下博主~ </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/198ae0c17cfd2eb3e9534c7c5df0887f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">怎么查论文的AI率是多少？这10款AI 检测工具别错过</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1707713a0884f2958b9a1448ec90bd7b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于SpringBoot的全国风景区WebGIS按省展示实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>