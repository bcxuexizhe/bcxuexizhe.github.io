<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C--贪吃蛇 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/51315b7bf7a13724ad80f66e295d7773/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="C--贪吃蛇">
  <meta property="og:description" content="目录
前言
简单的准备工作
蛇的节点
开始前 void GameStart(pSnake ps)
void WelcomeToGame()
void CreateMap()
void InitSnake(pSnake ps)
void CreateFood(pSnake ps)
游戏进行 void GameRun(pSnake ps)
int NextIsFood(pSnakeNode psn, pSnake ps)
void NoFood(pSnakeNode psn, pSnake ps)
void SnakeMove(pSnake ps)
游戏结束 void GameEnd(pSnake ps)
源码
test.c
snake.h
snake.cpp
总结
前言 贪吃蛇游戏是一个耳熟能详的小游戏,本次我们讲解他的简单的实现,需要掌握基本的API知识(http://t.csdnimg.cn/uHH6y),简单的C语言知识和基本的数据结构链表
简单的准备工作 效果展示 屏幕录制 2024-05-16 092902
蛇的节点 在游戏运⾏的过程中，蛇每次吃⼀个⻝物，蛇的⾝体就会变⻓⼀节，如果我们使⽤链表存储蛇的信 息，那么蛇的每⼀节其实就是链表的每个节点。每个节点只要记录好蛇⾝节点在地图上的坐标就⾏， 所以蛇节点结构如下：
typedef struct SnakeNode { int x; int y; struct SnakeNode* next; }SnakeNode, * pSnakeNode; 但是这样不好维护这一条蛇,要管理整条贪吃蛇，我们再封装⼀个Snake的结构来维护整条贪吃蛇">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-16T09:47:50+08:00">
    <meta property="article:modified_time" content="2024-05-16T09:47:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C--贪吃蛇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E7%AE%80%E5%8D%95%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" rel="nofollow">简单的准备工作</a></p> 
<p id="%E8%9B%87%E7%9A%84%E8%8A%82%E7%82%B9-toc" style="margin-left:40px;"><a href="#%E8%9B%87%E7%9A%84%E8%8A%82%E7%82%B9" rel="nofollow">蛇的节点</a></p> 
<p id="%E5%BC%80%E5%A7%8B%E5%89%8D%C2%A0void%20GameStart(pSnake%20ps)-toc" style="margin-left:0px;"><a href="#%E5%BC%80%E5%A7%8B%E5%89%8D%C2%A0void%20GameStart%28pSnake%20ps%29" rel="nofollow">开始前 void GameStart(pSnake ps)</a></p> 
<p id="void%20WelcomeToGame()-toc" style="margin-left:40px;"><a href="#void%20WelcomeToGame%28%29" rel="nofollow">void WelcomeToGame()</a></p> 
<p id="void%20CreateMap()-toc" style="margin-left:40px;"><a href="#void%20CreateMap%28%29" rel="nofollow">void CreateMap()</a></p> 
<p id="%C2%A0%20void%20InitSnake(pSnake%20ps)-toc" style="margin-left:40px;"><a href="#%C2%A0%20void%20InitSnake%28pSnake%20ps%29" rel="nofollow">  void InitSnake(pSnake ps)</a></p> 
<p id="%C2%A0void%20CreateFood(pSnake%20ps)-toc" style="margin-left:40px;"><a href="#%C2%A0void%20CreateFood%28pSnake%20ps%29" rel="nofollow"> void CreateFood(pSnake ps)</a></p> 
<p id="%E6%B8%B8%E6%88%8F%E8%BF%9B%E8%A1%8C%20void%20GameRun(pSnake%20ps)-toc" style="margin-left:0px;"><a href="#%E6%B8%B8%E6%88%8F%E8%BF%9B%E8%A1%8C%20void%20GameRun%28pSnake%20ps%29" rel="nofollow">游戏进行 void GameRun(pSnake ps)</a></p> 
<p id="%C2%A0%20int%20NextIsFood(pSnakeNode%20psn%2C%20pSnake%20ps)-toc" style="margin-left:40px;"><a href="#%C2%A0%20int%20NextIsFood%28pSnakeNode%20psn%2C%20pSnake%20ps%29" rel="nofollow">  int NextIsFood(pSnakeNode psn, pSnake ps)</a></p> 
<p id="%C2%A0void%20NoFood(pSnakeNode%20psn%2C%20pSnake%20ps)-toc" style="margin-left:40px;"><a href="#%C2%A0void%20NoFood%28pSnakeNode%20psn%2C%20pSnake%20ps%29" rel="nofollow"> void NoFood(pSnakeNode psn, pSnake ps)</a></p> 
<p id="void%20SnakeMove(pSnake%20ps)-toc" style="margin-left:40px;"><a href="#void%20SnakeMove%28pSnake%20ps%29" rel="nofollow">void SnakeMove(pSnake ps)</a></p> 
<p id="%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%20void%20GameEnd(pSnake%20ps)-toc" style="margin-left:0px;"><a href="#%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%20void%20GameEnd%28pSnake%20ps%29" rel="nofollow">游戏结束 void GameEnd(pSnake ps)</a></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E6%BA%90%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E6%BA%90%E7%A0%81" rel="nofollow">源码</a></p> 
<p id="test.c-toc" style="margin-left:80px;"><a href="#test.c" rel="nofollow">test.c</a></p> 
<p id="snake.h-toc" style="margin-left:40px;"><a href="#snake.h" rel="nofollow">snake.h</a></p> 
<p id="snake.cpp-toc" style="margin-left:40px;"><a href="#snake.cpp" rel="nofollow">snake.cpp</a></p> 
<p id="-toc" style="margin-left:80px;"></p> 
<p id="-toc" style="margin-left:80px;"></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2></h2> 
<h2 id="%E5%89%8D%E8%A8%80">前言</h2> 
<blockquote> 
 <p>贪吃蛇游戏是一个耳熟能详的小游戏,本次我们讲解他的简单的实现,需要掌握基本的<span style="color:#fe2c24;">API</span>知识(<a href="http://t.csdnimg.cn/uHH6y" rel="nofollow" title="http://t.csdnimg.cn/uHH6y">http://t.csdnimg.cn/uHH6y</a>),简单的C语言知识和基本的数据结构<span style="color:#fe2c24;">链表</span></p> 
</blockquote> 
<h2 id="%E7%AE%80%E5%8D%95%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">简单的准备工作</h2> 
<h2>效果展示</h2> 
<div class="csdn-video-box"> 
 <iframe id="A3PpCbmn-1715823869924" frameborder="0" src="https://live.csdn.net/v/embed/387887" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>屏幕录制 2024-05-16 092902</p> 
</div> 
<h3 id="%E8%9B%87%E7%9A%84%E8%8A%82%E7%82%B9">蛇的节点</h3> 
<p>在游戏运⾏的过程中，蛇每次吃⼀个⻝物，蛇的⾝体就会变⻓⼀节，如果我们使⽤链表存储蛇的信 息，那么蛇的每⼀节其实就是链表的每个节点。每个节点只要记录好蛇⾝节点在地图上的坐标就⾏， 所以蛇节点结构如下：</p> 
<pre><code> typedef struct SnakeNode
 {
 int x;
 int y;
 struct SnakeNode* next;
 }SnakeNode, * pSnakeNode;</code></pre> 
<p>但是这样不好维护这一条蛇,要管理整条贪吃蛇，我们再封装⼀个Snake的结构来维护整条贪吃蛇</p> 
<pre><code class="language-cpp">typedef struct Snake
 {
 pSnakeNode _pSnake;维护整条蛇的指针 
pSnakeNode _pFood;维护⻝物的指针 
enum DIRECTION _Dir;头的⽅向默认是向右 
enum GAME_STATUS _Status;游戏状态 
int _Socre;当前获得分数 
int _Add;默认每个⻝物10分 
int _SleepTime;每⾛⼀步休眠时间
}Snake, * pSnake;</code></pre> 
<p></p> 
<h2 id="%E5%BC%80%E5%A7%8B%E5%89%8D%C2%A0void%20GameStart(pSnake%20ps)">开始前 void GameStart(pSnake ps)</h2> 
<p>游戏开始,先打印蛇的身体和地图,以及一些帮助的提示语句,先完成一些准备工作</p> 
<pre><code class="language-cpp">void GameStart(pSnake ps)
 {
 
设置控制台窗⼝的⼤⼩，30⾏，100列 
//mode 为DOS命令
 system("mode con cols=100 lines=30");
 //设置cmd窗⼝名称
 system("title 贪吃蛇"); 
//获取标准输出的句柄(⽤来标识不同设备的数值) 
HANDLE hOutput = GetStdHandle(STD_OUTPUT_HANDLE); //影藏光标操作 
CONSOLE_CURSOR_INFO CursorInfo; //打印欢迎界⾯ 
WelcomeToGame(); //打印地图 
CreateMap(); //初始化蛇 
GetConsoleCursorInfo(hOutput, &amp;CursorInfo);//获取控制台光标信息 
CursorInfo.bVisible = false; //隐藏控制台光标 
SetConsoleCursorInfo(hOutput, &amp;CursorInfo);//设置控制台光标状态 
InitSnake(ps);
 //创造第⼀个⻝物 
CreateFood(ps);
 }
 </code></pre> 
<h3 id="void%20WelcomeToGame()">void WelcomeToGame()</h3> 
<p>在游戏正式开始之前，做⼀些功能提醒,来让玩家了解游戏方法与规则,其中SetPos是一个已经封装后的函数,可以把这个字体打在这个坐标</p> 
<p><img alt="" height="187" src="https://images2.imgbox.com/b7/b9/cjCNw3Lp_o.png" width="300"></p> 
<pre><code class="language-cpp"> void WelcomeToGame()
 {
 SetPos(40, 15);
 printf("欢迎来到贪吃蛇⼩游戏");
 SetPos(40, 25);//让按任意键继续的出现的位置好看点 
system("pause");
 system("cls");
 SetPos(25, 12);
 printf("⽤ ↑ . ↓ . ← . → 分别控制蛇的移动， F3为加速，F4为减速\n");
 SetPos(25, 13);
 printf("加速将能得到更⾼的分数。\n");
 SetPos(40, 25);//让按任意键继续的出现的位置好看点 
system("pause");
 system("cls");
 }</code></pre> 
<h3 id="void%20CreateMap()">void CreateMap()</h3> 
<blockquote> 
 <p>创建地图就是将强打印出来，因为是宽字符打印，所有使⽤<span style="color:#fe2c24;">wprintf</span>函数，打印格式串前使⽤L 打印地图的关键是要算好坐标，才能在想要的位置打印墙体。</p> 
</blockquote> 
<pre><code class="language-cpp"> void CreateMap()
 {
 int i = 0;
 //上(0,0)-(56, 0) 
SetPos(0, 0);
 for (i = 0; i &lt; 58; i += 2)
 {
 wprintf(L"%c", WALL);
 } //下(0,26)-(56, 26)  
 SetPos(0, 26); for (i = 0; i &lt; 58; i += 2)
 { wprintf(L"%c", WALL);
 } //左//x是0，y从1开始增⻓ 
for (i = 1; i &lt; 26; i++)
 {
 SetPos(0, i);
 wprintf(L"%c", WALL);}  //是56y从1开始增⻓ 
for (i = 1; i &lt; 26; i++)
 {
 SetPos(56, i);
 wprintf(L"%c", WALL);
 }
 } </code></pre> 
<h3 id="%C2%A0%20void%20InitSnake(pSnake%20ps)">  void InitSnake(pSnake ps)</h3> 
<blockquote> 
 <p>蛇最开始⻓度为5节，每节对应链表的⼀个节点，蛇⾝的每⼀个节点都有⾃⼰的坐标。 创建5个节点，然后将每个节点存放在链表中进⾏管理。创建完蛇⾝后，将蛇的每⼀节打印在屏幕上。 再设置当前游戏的状态，蛇移动的速度，默认的⽅向，初始成绩，蛇的状态，每个⻝物的分数。</p> 
</blockquote> 
<pre><code class="language-cpp">void InitSnake(pSnake ps)
 {
    pSnakeNode cur = NULL;
    int i = 0;
    //创建蛇⾝节点，并初始化坐标 
    //头插法
    for (i = 0; i &lt; 5; i++)
    {
        //创建蛇⾝的节点 
        cur = (pSnakeNode)malloc(sizeof(SnakeNode));
        if (cur == NULL)
        {
            perror("InitSnake()::malloc()");
            return;
        }
        //设置坐标 
        cur-&gt;next = NULL;
        cur-&gt;x = POS_X + i * 2;
        cur-&gt;y = POS_Y;
        //头插法 
        if (ps-&gt;_pSnake == NULL)
        {
            ps-&gt;_pSnake = cur;
        }
        else
        {
            cur-&gt;next = ps-&gt;_pSnake;
            ps-&gt;_pSnake = cur;
        }
    }
    //打印蛇的⾝体
    cur = ps-&gt;_pSnake;
    while (cur)
    {
 SetPos(cur-&gt;x, cur-&gt;y);
 wprintf(L"%c", BODY);
 cur = cur-&gt;next;
 }
 //
初始化贪吃蛇数据 
ps-&gt;_SleepTime = 200;
 ps-&gt;_Socre = 0;
 ps-&gt;_Status = OK;
 ps-&gt;_Dir = RIGHT;
 ps-&gt;_Add = 10;
 }</code></pre> 
<h3 id="%C2%A0void%20CreateFood(pSnake%20ps)"> void CreateFood(pSnake ps)</h3> 
<blockquote> 
 <p>先随机⽣成⻝物的坐标 ◦</p> 
 <ul><li>x坐标必须是2的倍数 ◦</li><li>⻝物的坐标不能和蛇⾝每个节点的坐标重复 </li><li>创建⻝物节点，打印⻝物</li></ul> 
</blockquote> 
<pre><code class="language-cpp"> void CreateFood(pSnake ps)
 {
    int x = 0;
    int y = 0;
 again:
    //产⽣的x坐标应该是2倍数，这样才可能和蛇头坐标对⻬。 
    do
    {
        x = rand() % 53 + 2;
        y = rand() % 25 + 1;
    } while (x % 2 != 0);
    pSnakeNode cur = ps-&gt;_pSnake;//获取指向蛇头的指针
     //⻝物不能和蛇⾝冲突
    while (cur)
    {
        if (cur-&gt;x == x &amp;&amp; cur-&gt;y == y)
        {
            goto again;
        }
        cur = cur-&gt;next;
    }
    pSnakeNode pFood = (pSnakeNode)malloc(sizeof(SnakeNode)); //创建⻝物
    if (pFood == NULL)
    {
        perror("CreateFood::malloc()");
        return;
    }
    else
    {
        pFood-&gt;x = x;
        pFood-&gt;y = y;
        SetPos(pFood-&gt;x, pFood-&gt;y);
        wprintf(L"%c", FOOD);
        ps-&gt;_pFood = pFood;
    }
 }</code></pre> 
<h2 id="%E6%B8%B8%E6%88%8F%E8%BF%9B%E8%A1%8C%20void%20GameRun(pSnake%20ps)">游戏进行 void GameRun(pSnake ps)</h2> 
<blockquote> 
 <p>游戏运⾏期间，右侧打印帮助信息，提⽰玩家 根据游戏状态检查游戏是否继续，如果是状态是OK，游戏继续，否则游戏结束。 如果游戏继续，就是检测按键情况，确定蛇下⼀步的⽅向，或者是否加速减速，是否暂停或者退出游 戏。 确定了蛇的⽅向和速度，蛇就可以移动了。</p> 
 <pre><code class="language-cpp"> void GameRun(pSnake ps)
 {
 //打印右侧帮助信息
PrintHelpInfo();
 do
 {
 SetPos(64, 10); printf("得分：%d ", ps-&gt;_Socre);
 printf("每个⻝物得分：%d分", ps-&gt;_Add);
 if (KEY_PRESS(VK_UP) &amp;&amp; ps-&gt;_Dir != DOWN)
 {
 ps-&gt;_Dir = UP;
 }
 else if (KEY_PRESS(VK_DOWN) &amp;&amp; ps-&gt;_Dir != UP)
 {

            ps-&gt;_Dir = DOWN;
        }
        else if (KEY_PRESS(VK_LEFT) &amp;&amp; ps-&gt;_Dir != RIGHT)
        {
            ps-&gt;_Dir = LEFT;
        }
        else if (KEY_PRESS(VK_RIGHT) &amp;&amp; ps-&gt;_Dir != LEFT)
        {
            ps-&gt;_Dir = RIGHT;
        }
        else if (KEY_PRESS(VK_SPACE))
        {
            pause();
        }
        else if (KEY_PRESS(VK_ESCAPE))
        {
            ps-&gt;_Status = END_NOMAL;
            break;
        }
        else if (KEY_PRESS(VK_F3))
        {
            if (ps-&gt;_SleepTime &gt;= 50)
            {
                ps-&gt;_SleepTime -= 30;
                ps-&gt;_Add += 2;
            }
        }
        else if (KEY_PRESS(VK_F4))
        {
            if (ps-&gt;_SleepTime &lt; 350)
            {
                ps-&gt;_SleepTime += 30;
                ps-&gt;_Add -= 2;
                if (ps-&gt;_SleepTime == 350)
                {
                    ps-&gt;_Add = 1;
                }
            }
        }
        //蛇每次⼀定之间要休眠的时间，时间短，蛇移动速度就快
         Sleep(ps-&gt;_SleepTime);
        SnakeMove(ps);
    } while (ps-&gt;_Status == OK);
 }
 </code></pre> 
 <p></p> 
</blockquote> 
<h3 id="%C2%A0%20int%20NextIsFood(pSnakeNode%20psn%2C%20pSnake%20ps)">  int NextIsFood(pSnakeNode psn, pSnake ps)</h3> 
<p>是一个判断下一个位置是食物的函数,会在下面SnakeMove起到作用,是食物的话将吃掉,不是的话将继续按按键运动</p> 
<pre><code class="language-cpp"> 
int NextIsFood(pSnakeNode psn, pSnake ps)
 {
    return (psn-&gt;x == ps-&gt;_pFood-&gt;x) &amp;&amp; (psn-&gt;y == ps-&gt;_pFood-&gt;y);
 }
 </code></pre> 
<h3 id="%C2%A0void%20NoFood(pSnakeNode%20psn%2C%20pSnake%20ps)"> void NoFood(pSnakeNode psn, pSnake ps)</h3> 
<p>将下⼀个节点头插⼊蛇的⾝体，并将之前蛇⾝最后⼀个节点打印为空格，放弃掉蛇⾝的最后⼀个节点,在时间是毫米的瞬间完成,造成移动的效果</p> 
<pre><code class="language-cpp">void NoFood(pSnakeNode psn, pSnake ps)
 {
 //头插法 
psn-&gt;next = ps-&gt;_pSnake;
 ps-&gt;_pSnake = psn;
 pSnakeNode cur = ps-&gt;_pSnake;
 //打印蛇 
while (cur-&gt;next-&gt;next)
 {
 SetPos(cur-&gt;x, cur-&gt;y);
 wprintf(L"%c", BODY);
 }
 //最后⼀个位置打印空格，然后释放节点 
SetPos(cur-&gt;next-&gt;x, cur-&gt;next-&gt;y);
 printf("  ");
 free(cur-&gt;next);
 cur-&gt;next = NULL;
 }</code></pre> 
<h3 id="void%20SnakeMove(pSnake%20ps)">void SnakeMove(pSnake ps)</h3> 
<blockquote> 
 <p>蛇⾝移动先创建下⼀个节点，根据移动⽅向和蛇头的坐标，蛇移动到下⼀个位置的坐标。 确定了下⼀个位置后，看下⼀个位置是否是⻝物（NextIsFood），是⻝物就做吃⻝物处理 （EatFood），如果不是⻝物则做前进⼀步的处理（NoFood）。 蛇⾝移动后，判断此次移动是否会造成撞墙（KillByWall）或者撞上⾃⼰蛇⾝（KillBySelf），从⽽影 响游戏的状态</p> 
</blockquote> 
<pre><code class="language-cpp"> void SnakeMove(pSnake ps)
 {
 //创建下⼀个节点 
pSnakeNode pNextNode = (pSnakeNode)malloc(sizeof(SnakeNode));
 if (pNextNode == NULL)
 {
 perror("SnakeMove()::malloc()");
 return;
 } //确定下⼀个节点的坐标，下⼀个节点的坐标根据，蛇头的坐标和⽅向确定 
switch (ps-&gt;_Dir)
 {
 case UP:
 {
 pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x;
 pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y - 1;

        }
        break;
        case DOWN:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y + 1;
        }
        break;
        case LEFT:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x - 2;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y;
        }
        break;
        case RIGHT:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x + 2;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y;
        }
        break;
    }
    //如果下⼀个位置就是⻝物
 
    if (NextIsFood(pNextNode, ps))
    {
        EatFood(pNextNode, ps);
    }
    else//如果没有⻝物 
    {
        NoFood(pNextNode, ps);
    }
    KillByWall(ps);
    KillBySelf(ps);
 }</code></pre> 
<h2 id="%E6%B8%B8%E6%88%8F%E7%BB%93%E6%9D%9F%20void%20GameEnd(pSnake%20ps)">游戏结束 void GameEnd(pSnake ps)</h2> 
<p>游戏结束 游戏状态不再是OK（游戏继续）的时候，要告知游戏技术的原因，并且释放蛇⾝节点。</p> 
<pre><code class="language-cpp"> void GameEnd(pSnake ps)
 {
 pSnakeNode cur = ps-&gt;_pSnake;
 SetPos(24, 12);
 switch (ps-&gt;_Status)
 {
 case END_NOMAL:
 printf("您主动退出游戏\n");
 break;
 case KILL_BY_SELF: printf("您撞上⾃⼰了 ,游戏结束!\n");
 break;
 case KILL_BY_WALL:
printf("您撞墙了,游戏结束!\n"); } //释放蛇⾝的节点 
while (cur)
 {
 pSnakeNode del = cur;
 cur = cur-&gt;next;
 free(del);
 }
 }</code></pre> 
<h2></h2> 
<h2 id="%E6%BA%90%E7%A0%81">源码</h2> 
<h4 id="test.c">test.c</h4> 
<pre><code class="language-cpp"> #include "Snake.h"
 #include &lt;locale.h&gt;
 void test()
 {
 int ch = 0;
 srand((unsigned int)time(NULL));
 do
 {
 Snake snake = { 0 };
 GameStart(&amp;snake);
 GameRun(&amp;snake);
 GameEnd(&amp;snake);
 SetPos(20, 15);
 printf("再来⼀局吗？(Y/N):");
 ch = getchar();
 getchar();//清理\n } while (ch == 'Y');
 SetPos(0, 27);
 }
 int main()
 {
 //修改当前地区为本地模式，为了⽀持中⽂宽字符的打印
 setlocale(LC_ALL, ""); 
test();
 return 0;
 }</code></pre> 
<h3 id="snake.h">snake.h</h3> 
<pre><code class="language-cpp"> #pragma once
 #include &lt;windows.h&gt;
 #include &lt;time.h&gt;
 #include &lt;stdio.h&gt;
 #define KEY_PRESS(VK)  ((GetAsyncKeyState(VK)&amp;0x1) ? 1 : 0)
 //⽅向
enum DIRECTION
 {
 UP = 1,
 DOWN,
 LEFT,
 RIGHT
 };
 //游戏状态 
enum GAME_STATUS
 {
 OK,//正常运⾏ 
KILL_BY_WALL,//撞墙 
KILL_BY_SELF,//咬到⾃⼰ 
END_NOMAL//正常结束 
};
 #define WALL L'□' 
#define BODY L'●'  // ★ ○● ◇◆ □■ 
#define FOOD L' ★ '  // ★ ○● ◇◆ □■ //蛇的初始位置 
#define POS_X 24
 #define POS_Y 5 //蛇⾝节点
 typedef struct SnakeNode
 {
 int x;
 int y;
 struct SnakeNode* next;
 }SnakeNode, * pSnakeNode;
 typedef struct Snake
 {
 pSnakeNode _pSnake;//整条蛇的指针 
pSnakeNode _pFood;//维护⻝物的指针 
enum DIRECTION _Dir;//蛇头的⽅向默认是向右 
enum GAME_STATUS _Status;//游戏状态 
int _Socre;//当前获得分数 
int _Add;//默认每个⻝物 
int _SleepTime;//每⾛⼀步休眠时间 
}Snake, * pSnake;
 //游戏开始前的初始化 
void GameStart(pSnake ps); //游戏运⾏过程 
void GameRun(pSnake ps); //结束 
void GameEnd(pSnake ps); //设置光标的坐标 
void SetPos(short x, short y); //欢迎界⾯ 
void WelcomeToGame(); //打印帮助信息 
void PrintHelpInfo(); //创建地图 
void CreateMap();//初始化蛇 
void InitSnake(pSnake ps); //⻝物 
void CreateFood(pSnake ps);暂停响应 
void pause(); //下⼀个节点是⻝物
 int NextIsFood(pSnakeNode psn, pSnake ps); //吃⻝物 
void EatFood(pSnakeNode psn, pSnake ps); //不吃⻝物 
void NoFood(pSnakeNode psn, pSnake ps); //撞墙检测 
int KillByWall(pSnake ps); //撞⾃⾝检测 
int KillBySelf(pSnake ps); //蛇的移动 
void SnakeMove(pSnake ps); //游戏初始化 
void GameStart(pSnake ps); //游戏运⾏ 
void GameRun(pSnake ps); //游戏结束
 void GameEnd(pSnake ps);</code></pre> 
<h3 id="snake.cpp">snake.cpp</h3> 
<pre><code class="language-cs"> #include "Snake.h"
 //设置光标的坐标 
void SetPos(short x, short y)
 {
 COORD pos = { x, y };
 HANDLE hOutput = NULL;//获取标准输出的句柄(⽤来标识不同设备的数值) 
hOutput = GetStdHandle(STD_OUTPUT_HANDLE);//设置标准输出上光标的位置为
pos SetConsoleCursorPosition(hOutput, pos);
 }
 void WelcomeToGame()
 {
 SetPos(40, 15);
 printf("欢迎来到贪吃蛇⼩游戏");
 SetPos(40, 25);//让按任意键继续的出现的位置好看点 
system("pause");
 system("cls");
 SetPos(25, 12);
 printf("⽤ ↑ . ↓ . ← . → 控制蛇的移动， F3为加速，F4为减速\n");
 SetPos(25, 13);
 printf("加速将能得到更⾼的分数。\n");
 SetPos(40, 25);//让按任意键继续的出现的位置好看点 
system("pause");
 system("cls"); } void CreateMap()
 {
 int i = 0;
 //上(0,0)-(56, 0) 
SetPos(0, 0);
 for (i = 0; i &lt; 58; i += 2)
 {
 wprintf(L"%c", WALL);
 }
 //
下(0,26)-(56, 26) 
SetPos(0, 26);
 for (i = 0; i &lt; 58; i += 2)
 {
 wprintf(L"%c", WALL);
 }
 //左 
//x0，y从1开始增⻓ 
for (i = 1; i &lt; 26; i++)
 {
 SetPos(0, i);
 wprintf(L"%c", WALL);
 }
 //56，从开始增⻓ 
for (i = 1; i &lt; 26; i++)
 {
 SetPos(56, i);
 wprintf(L"%c", WALL);
 }
 }
void InitSnake(pSnake ps)
 {
    pSnakeNode cur = NULL;
    int i = 0;
    //创建蛇⾝节点，并初始化坐标
     //头插法
 
    for (i = 0; i &lt; 5; i++)
    {
        //创建蛇⾝的节点
 cur = (pSnakeNode)malloc(sizeof(SnakeNode));
        if (cur == NULL)
        {
            perror("InitSnake()::malloc()");
            return;
        }
        //设置坐标
        cur-&gt;next = NULL;
        cur-&gt;x = POS_X + i * 2;
        cur-&gt;y = POS_Y;
        //头插法
        if (ps-&gt;_pSnake == NULL)
        {
            ps-&gt;_pSnake = cur;
        }
        else
        {
            cur-&gt;next = ps-&gt;_pSnake;
            ps-&gt;_pSnake = cur;
        }
    }
    //打印蛇的⾝体 
    cur = ps-&gt;_pSnake;
    while (cur)
    {
        SetPos(cur-&gt;x, cur-&gt;y);
        wprintf(L"%c", BODY);
        cur = cur-&gt;next;
    }
    //初始化贪吃蛇数据
    ps-&gt;_SleepTime = 200;
    ps-&gt;_Socre = 0;
    ps-&gt;_Status = OK;
    ps-&gt;_Dir = RIGHT;
    ps-&gt;_Add = 10;
 }
 void CreateFood(pSnake ps)
 {
    int x = 0;
    int y = 0;
 again:
    //产⽣的x坐标应该是2的倍数，这样才可能和蛇头坐标对⻬。
    do
    {
        x = rand() % 53 + 2;
        y = rand() % 25 + 1;
    } while (x % 2 != 0);
    pSnakeNode cur = ps-&gt;_pSnake;//指向蛇头的指针     //⻝物不能和蛇⾝冲突
    while (cur)
    {
        if (cur-&gt;x == x &amp;&amp; cur-&gt;y == y)
        {
            goto again;
        }
        cur = cur-&gt;next;
    }
    pSnakeNode pFood = (pSnakeNode)malloc(sizeof(SnakeNode)); //
创建⻝物
 
    if (pFood == NULL)
    {
        perror("CreateFood::malloc()");
        return;
    }
    else
    {
        pFood-&gt;x = x;
        pFood-&gt;y = y;
        SetPos(pFood-&gt;x, pFood-&gt;y);
        wprintf(L"%c", FOOD);
        ps-&gt;_pFood = pFood;
    }
 }
 void PrintHelpInfo()
 {
 }
 void pause()//暂停 
{打印提⽰信息 
SetPos(64, 15);
 printf("不能穿墙，不能咬到⾃⼰\n");
 SetPos(64, 16);
 printf("⽤↑.↓.←.→分别控制蛇的移动.");
 SetPos(64, 17);
 printf("F1 为加速，F2 为减速\n");
 SetPos(64, 18);
 printf("ESC ：退出游戏.space：暂停游戏.");
 SetPos(64, 20);
 while (1)
 {
 Sleep(300);
 if (KEY_PRESS(VK_SPACE))
 {
 break;
 }
 }
 }
 //pSnakeNode psn 是下⼀个节点的地址 
//pSnake ps 维护蛇的指针 
int NextIsFood(pSnakeNode psn, pSnake ps)
 {
 return (psn-&gt;x == ps-&gt;_pFood-&gt;x) &amp;&amp; (psn-&gt;y == ps-&gt;_pFood-&gt;y);
 }
 //pSnakeNode psn 是下⼀个节点的地址 
//pSnake ps 维护蛇的指针 
void EatFood(pSnakeNode psn, pSnake ps)
 {
 //头插法 
psn-&gt;next = ps-&gt;_pSnake;
 ps-&gt;_pSnake = psn;
 pSnakeNode cur = ps-&gt;_pSnake;
 //打印蛇 
while (cur)
 {
 SetPos(cur-&gt;x, cur-&gt;y);
 wprintf(L"%c", BODY);
 cur = cur-&gt;next;

 }
 ps-&gt;_Socre += ps-&gt;_Add;
 free(ps-&gt;_pFood);
 CreateFood(ps);
 }
 //pSnakeNode psn 
是下⼀个节点的地址
 
//pSnake ps 
维护蛇的指针
 
void NoFood(pSnakeNode psn, pSnake ps)
 {
 //头插法
 psn-&gt;next = ps-&gt;_pSnake;
 ps-&gt;_pSnake = psn;
 pSnakeNode cur = ps-&gt;_pSnake; //打印蛇 
while (cur-&gt;next-&gt;next)
 {
 SetPos(cur-&gt;x, cur-&gt;y);
 wprintf(L"%c", BODY);
 cur = cur-&gt;next;
 }
 //最后⼀个位置打印空格，然后释放节点 
SetPos(cur-&gt;next-&gt;x, cur-&gt;next-&gt;y);
 printf("  ");
 free(cur-&gt;next);
 cur-&gt;next = NULL;
 }
 //pSnake ps 
维护蛇的指针
int KillByWall(pSnake ps)
 {
 if ((ps-&gt;_pSnake-&gt;x == 0)
 || (ps-&gt;_pSnake-&gt;x == 56)
 || (ps-&gt;_pSnake-&gt;y == 0)
 || (ps-&gt;_pSnake-&gt;y == 26))
 {
 ps-&gt;_Status = KILL_BY_WALL;
 return 1;
 }
 return 0;
 }
 //pSnake ps 
维护蛇的指针 
int KillBySelf(pSnake ps)
 {
    pSnakeNode cur = ps-&gt;_pSnake-&gt;next;
    while (cur)
    {
        if ((ps-&gt;_pSnake-&gt;x == cur-&gt;x)
            &amp;&amp; (ps-&gt;_pSnake-&gt;y == cur-&gt;y))
        {
            ps-&gt;_Status = KILL_BY_SELF;
            return 1;
        }
        cur = cur-&gt;next;
    }
    return 0;
 }
 void SnakeMove(pSnake ps)
 {
    //创建下⼀个节点 
    pSnakeNode pNextNode = (pSnakeNode)malloc(sizeof(SnakeNode));
    if (pNextNode == NULL)
    {
        perror("SnakeMove()::malloc()");
        return;
    }
    //
确定下⼀个节点的坐标，下⼀个节点的坐标根据，蛇头的坐标和⽅向确定
 
    switch (ps-&gt;_Dir)
    {
        case UP:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y - 1;
        }
        break;
        case DOWN:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y + 1;
        }
        break;
        case LEFT:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x - 2;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y;
        }
        break;
        case RIGHT:
        {
            pNextNode-&gt;x = ps-&gt;_pSnake-&gt;x + 2;
            pNextNode-&gt;y = ps-&gt;_pSnake-&gt;y;
        }
        break;
    }
    //如果下⼀个位置就是⻝物
 
    if (NextIsFood(pNextNode, ps))
    {
        EatFood(pNextNode, ps);
    }
    else//如果没有⻝物

    {
        NoFood(pNextNode, ps);
    }
    KillByWall(ps);
    KillBySelf(ps);
 }
 void GameStart(pSnake ps)
 {
    //设置控制台窗⼝的⼤⼩，30⾏，100 
    //mode 为DOS命令 
    system("mode con cols=100 lines=30");
    //设置cmd窗⼝名称 
    system("title 贪吃蛇"); 
    //获取标准输出的句柄(来标识不同设备的数值) 
    HANDLE hOutput = GetStdHandle(STD_OUTPUT_HANDLE);  //影藏光标操作
    CONSOLE_CURSOR_INFO CursorInfo;
    GetConsoleCursorInfo(hOutput, &amp;CursorInfo);//获取控制台光标信息
    CursorInfo.bVisible = false; //隐藏控制台光标 
    SetConsoleCursorInfo(hOutput, &amp;CursorInfo);//设置控制台光标状态 //打印欢迎界⾯ 
    WelcomeToGame();   //打印地图 
   CreateMap();   //初始化蛇
    InitSnake(ps);  /创造第⼀个⻝物
    CreateFood(ps);
 
}
 void GameRun(pSnake ps)
 {    //打印右侧帮助信息
 
    PrintHelpInfo();
    do
    {
        SetPos(64, 10);
        printf("得分：%d ", ps-&gt;_Socre);        printf("每个⻝物得分：%d分", ps-&gt;_Add);
        if (KEY_PRESS(VK_UP) &amp;&amp; ps-&gt;_Dir != DOWN)
        {
            ps-&gt;_Dir = UP;
        }
        else if (KEY_PRESS(VK_DOWN) &amp;&amp; ps-&gt;_Dir != UP)
        {
            ps-&gt;_Dir = DOWN;
        }
        else if (KEY_PRESS(VK_LEFT) &amp;&amp; ps-&gt;_Dir != RIGHT)
        {
            ps-&gt;_Dir = LEFT;
        }
        else if (KEY_PRESS(VK_RIGHT) &amp;&amp; ps-&gt;_Dir != LEFT)
        {
            ps-&gt;_Dir = RIGHT;
        }
        else if (KEY_PRESS(VK_SPACE))
        {
            pause();
        }
        else if (KEY_PRESS(VK_ESCAPE))
        {
            ps-&gt;_Status = END_NOMAL;
            break;
        }
        else if (KEY_PRESS(VK_F3))
        {
            if (ps-&gt;_SleepTime &gt;= 50)
            {
                ps-&gt;_SleepTime -= 30;
                ps-&gt;_Add += 2;
            }
        }
        else if (KEY_PRESS(VK_F4))
        {

            if (ps-&gt;_SleepTime &lt; 350)
            {
                ps-&gt;_SleepTime += 30;
                ps-&gt;_Add -= 2;
                if (ps-&gt;_SleepTime == 350)
                {
                    ps-&gt;_Add = 1;
                }
            }
        }
        //蛇每次⼀定之间要休眠的时间，时间短，蛇移动速度就快
 
        Sleep(ps-&gt;_SleepTime);
        SnakeMove(ps);
    } while (ps-&gt;_Status == OK);
 }
 void GameEnd(pSnake ps)
 {
    pSnakeNode cur = ps-&gt;_pSnake;
    SetPos(24, 12);
    switch (ps-&gt;_Status)
    {
    case END_NOMAL:        printf("您主动退出游戏\n");
        break;
    case KILL_BY_SELF:
        printf("您撞上⾃⼰了 ,游戏结束!\n");        break;
    case KILL_BY_WALL:
        printf("您撞墙了,游戏结束!\n");
        break;
    }
    //释放蛇⾝的节点 
    while (cur)
    {
        pSnakeNode del = cur;
        cur = cur-&gt;next;
        free(del);
    }
 }</code></pre> 
<h4></h4> 
<h4></h4> 
<h2 id="%E6%80%BB%E7%BB%93">总结</h2> 
<blockquote> 
 <p>贪吃蛇小游戏是一个有趣的小游戏,也让我学到了很多,希望大家多多支持!!!</p> 
</blockquote> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79a4eaae2a6b9c46dac23605294fcc49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【高阶数据结构(四)】图的最短路径问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e31953c30bcb88a7d20b0b5415a01ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VScode代码片段自动转图标</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>