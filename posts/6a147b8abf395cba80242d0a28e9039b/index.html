<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Java】Java 17 新特性概览 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/6a147b8abf395cba80242d0a28e9039b/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="【Java】Java 17 新特性概览">
  <meta property="og:description" content="Java 17 新特性概览 1. Java 17 简介2. Java 17 新特性类型推断 - 新的 var 关键字垃圾回收器改进JEP 356 增强的伪随机数生成器（1）提供了一个新接口 RandomGenerator（2）提供了一个新类 RandomGeneratorFactory（3）提供了四个新的专用 RandomGenerator 接口 JEP 398 删除弃用的 Applet APIJEP 406 - switch 表达式增强JEP 407 - 删除远程方法调用激活机制JEP 409 - 密封类（Sealed Classes）JEP 410 - 删除实验性的 AOT 和 JIT 编译器JEP 411 - 删除弃用的安全管理器JEP 412 - 外部函数和内存 API（孵化）JEP 414 - 向量（Vector） API（第二次孵化） 3. Java 17 升级实战 1. Java 17 简介 Java 17 于 2021年09月14日 正式发布，且为长期支持版本（Long-Term-Support - LTS）。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-08T15:38:48+08:00">
    <meta property="article:modified_time" content="2023-11-08T15:38:48+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Java】Java 17 新特性概览</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Java 17 新特性概览</h4> 
 <ul><li><a href="#1_Java_17__1" rel="nofollow">1. Java 17 简介</a></li><li><a href="#2_Java_17__9" rel="nofollow">2. Java 17 新特性</a></li><li><ul><li><a href="#___var__10" rel="nofollow">类型推断 - 新的 var 关键字</a></li><li><a href="#_32" rel="nofollow">垃圾回收器改进</a></li><li><a href="#JEP_356__42" rel="nofollow">JEP 356 增强的伪随机数生成器</a></li><li><ul><li><a href="#1_RandomGenerator_48" rel="nofollow">（1）提供了一个新接口 RandomGenerator</a></li><li><a href="#2_RandomGeneratorFactory_71" rel="nofollow">（2）提供了一个新类 RandomGeneratorFactory</a></li><li><a href="#3_RandomGenerator__113" rel="nofollow">（3）提供了四个新的专用 RandomGenerator 接口</a></li></ul> 
   </li><li><a href="#JEP_398__Applet_API_125" rel="nofollow">JEP 398 删除弃用的 Applet API</a></li><li><a href="#JEP_406__switch__132" rel="nofollow">JEP 406 - switch 表达式增强</a></li><li><a href="#JEP_407___204" rel="nofollow">JEP 407 - 删除远程方法调用激活机制</a></li><li><a href="#JEP_409__Sealed_Classes_209" rel="nofollow">JEP 409 - 密封类（Sealed Classes）</a></li><li><a href="#JEP_410___AOT__JIT__243" rel="nofollow">JEP 410 - 删除实验性的 AOT 和 JIT 编译器</a></li><li><a href="#JEP_411___250" rel="nofollow">JEP 411 - 删除弃用的安全管理器</a></li><li><a href="#JEP_412___API_256" rel="nofollow">JEP 412 - 外部函数和内存 API（孵化）</a></li><li><a href="#JEP_414__Vector_API_290" rel="nofollow">JEP 414 - 向量（Vector） API（第二次孵化）</a></li></ul> 
  </li><li><a href="#3_Java_17__311" rel="nofollow">3. Java 17 升级实战</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_Java_17__1"></a>1. Java 17 简介</h2> 
<p>Java 17 于 2021年09月14日 正式发布，且为长期支持版本（Long-Term-Support - LTS）。</p> 
<p><code>Spring 6.x 和 Spring Boot 3.x 最低支持的 Java 17</code>，这里敲黑板：<strong>Java 17 将是继 Java 8 以来最重要的长期支持版本</strong>。</p> 
<p>下面为 Oracle Java SE 产品的一些关键产品日期示例（<a href="https://www.oracle.com/java/technologies/java-se-support-roadmap.html" rel="nofollow">Oracle Java SE Product Releases</a>）：</p> 
<p><img src="https://images2.imgbox.com/02/ae/0gUmA2Ej_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_Java_17__9"></a>2. Java 17 新特性</h2> 
<h3><a id="___var__10"></a>类型推断 - 新的 var 关键字</h3> 
<p>从 Java 10 开始，引入了局部变量类型推断（Local Variable Type Inference）功能，它可以让我们使用关键字 var 声明局部变量（而不是实际类型），而由编译器根据变量初始化的值自动推断出类型。</p> 
<pre><code class="prism language-java"><span class="token comment">// Java 8 传统变量声明方法</span>
<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"pointer"</span><span class="token punctuation">;</span>

<span class="token comment">// Java 10 使用类型推断的变量声明方法</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">"pointer"</span><span class="token punctuation">;</span>
</code></pre> 
<p>Java 11 允许在 lambda 表达式中使用 var 进行参数声明：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VarInLambdaExample</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_32"></a>垃圾回收器改进</h3> 
<p>从 Java 9 开始，<code>G1</code> 是<strong>默认的垃圾收集器</strong>。与 Parallel GC 相比，它减少了暂停时间，尽管它的总体吞吐量可能较低。G1 的更新包括将未使用的已提交内存返回给操作系统的能力（<a href="https://openjdk.org/jeps/346" rel="nofollow">JEP 346</a>）。</p> 
<p><code>ZGC</code> 垃圾收集器已在 Java 11 中引入，并已在 Java 15 (<a href="https://openjdk.org/jeps/377" rel="nofollow">JEP 377</a>) 中达到产品状态。它旨在进一步减少停顿。从 Java 13 开始，它也可以将未使用的已提交内存返回给操作系统 (<a href="https://openjdk.org/jeps/351" rel="nofollow">JEP 351</a>)。</p> 
<p>JDK 14 中引入了 <code>Shenandoah GC</code>，并在 Java 15 ( <a href="https://openjdk.org/jeps/379" rel="nofollow">JEP 379</a>) 中达到了产品状态。它旨在保持低暂停时间并独立于堆大小。</p> 
<p>在 Java 8 中如果您没有手动更改 GC，您仍然使用 Parallel GC。简单地切换到 Java 17 可能会使您的应用程序运行得更快，并具有更一致的方法运行时间。切换到 ZGC 或 Shenandoah 可能会得到更好的结果。</p> 
<p>最后，No-Op Garbage Collector（<a href="https://openjdk.org/jeps/318" rel="nofollow">JEP 318</a>），尽管它是一个实验性功能。这个垃圾收集器实际上不做任何工作，因此允许您精确测量应用程序的内存使用情况。如果您想保持尽可能低的内存操作吞吐量，则很有用。</p> 
<h3><a id="JEP_356__42"></a>JEP 356 增强的伪随机数生成器</h3> 
<p>JDK 17 之前，我们可以借助 Random、ThreadLocalRandom 和SplittableRandom 来生成随机数。不过，这 3 个类都各有缺陷，且缺少常见的伪随机算法支持。</p> 
<p>Java 17 为伪随机数生成器 (PRNG) 提供新的接口类型和实现，包括可跳转的 PRNG 和另一类可拆分的 PRNG 算法 (LXM)。</p> 
<blockquote> 
 <p>PRNGopen in new window 用来生成接近于绝对随机数序列的数字序列。一般来说，PRNG 会依赖于一个初始值，也称为种子，来生成对应的伪随机数序列。只要种子确定了，PRNG 所生成的随机数就是完全确定的，因此其生成的随机数序列并不是真正随机的。</p> 
</blockquote> 
<h4><a id="1_RandomGenerator_48"></a>（1）提供了一个新接口 RandomGenerator</h4> 
<p>它为所有现有的和新的 PRNG 提供了一个统一的 API。 RandomGenerators 提供名为 ints、longs、doubles、nextBoolean、nextInt、nextLong、nextDouble 和 nextFloat 的方法，以及它们当前的所有参数的变化。从而更容易在应用程序中互换使用各种 PRNG 算法。例如：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">testRandomGenerator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">testRandomGenerator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SplittableRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">testRandomGenerator</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testRandomGenerator</span><span class="token punctuation">(</span><span class="token class-name">RandomGenerator</span> randomGenerator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">IntStream</span> ints <span class="token operator">=</span> randomGenerator<span class="token punctuation">.</span><span class="token function">ints</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> randoms <span class="token operator">=</span> ints<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">:</span> randoms<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"random count = "</span> <span class="token operator">+</span> randoms<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_RandomGeneratorFactory_71"></a>（2）提供了一个新类 RandomGeneratorFactory</h4> 
<p>它用于定位和构造 RandomGenerator 实现的实例：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">testRandomGeneratorFactory</span><span class="token punctuation">(</span><span class="token string">"Random"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">testRandomGeneratorFactory</span><span class="token punctuation">(</span><span class="token string">"L128X128MixRandom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">testRandomGeneratorFactory</span><span class="token punctuation">(</span><span class="token string">"Xoshiro256PlusPlus"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testRandomGeneratorFactory</span><span class="token punctuation">(</span><span class="token class-name">String</span> randomGeneratorName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RandomGeneratorFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RandomGenerator</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span> <span class="token class-name">RandomGeneratorFactory</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>randomGeneratorName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用时间戳作为随机数种子</span>
        <span class="token class-name">RandomGenerator</span> randomGenerator <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 生成随机数</span>
        val nextInt <span class="token operator">=</span> randomGenerator<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>nextInt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>上述方法还支持如下LXM 系列 PRNG 算法：</strong></p> 
<ul><li>L32X64MixRandom</li><li>L32X64StarStarRandom</li><li>L64X128MixRandom</li><li>L64X128StarStarRandom</li><li>L64X256MixRandom</li><li>L64X1024MixRandom</li><li>L128X128MixRandom</li><li>L128X256MixRandom</li><li>L128X1024MixRandom</li></ul> 
<p><strong>以及广泛使用的 PRNG 算法：</strong></p> 
<ul><li> <p>Xoshiro256PlusPlus</p> </li><li> <p>Xoroshiro128PlusPlus</p> </li></ul> 
<h4><a id="3_RandomGenerator__113"></a>（3）提供了四个新的专用 RandomGenerator 接口</h4> 
<ul><li> <p>SplittableRandomGenerator 扩展了 RandomGenerator 并且还提供名为 split 和 splits 的方法。 可拆分性允许用户从现有的 RandomGenerator 生成一个新的 RandomGenerator，这通常会产生统计上独立的结果。</p> </li><li> <p>JumpableRandomGenerator 扩展了RandomGenerator 并且还提供名为 jump 和 jumps 的方法。 可跳跃性允许用户跳到中等数量的抽签。</p> </li><li> <p>LeapableRandomGenerator 扩展了 RandomGenerator 并且还提供方法名为leap和leaps的方法。 可跳跃性允许用户跳过大量的抽签。</p> </li><li> <p>ArbitrarilyJumpableRandomGenerator 扩展了 LeapableRandomGenerator 并且还提供了jump 和 jumps 的方法额外的变体，允许指定任意跳跃距离。</p> </li></ul> 
<p><a href="https://openjdk.org/jeps/356" rel="nofollow">JEP 356: Enhanced Pseudo-Random Number Generators</a></p> 
<h3><a id="JEP_398__Applet_API_125"></a>JEP 398 删除弃用的 Applet API</h3> 
<p>Applet API 在 Java 17 进行删除。</p> 
<p>Applet API 用于编写在 Web 浏览器端运行的 Java 小程序， 在 <a href="https://openjdk.org/jeps/289" rel="nofollow">Java 9</a> 时被标记弃用，但没有删除。</p> 
<p><a href="https://openjdk.org/jeps/398" rel="nofollow">JEP 398: Deprecate the Applet API for Removal</a></p> 
<h3><a id="JEP_406__switch__132"></a>JEP 406 - switch 表达式增强</h3> 
<p>Java 16 中，<a href="https://openjdk.org/jeps/394" rel="nofollow">JEP 394</a> 扩展了 instanceof 操作符以获取类型模式并执行类型匹配。这种适度的扩展可以简化熟悉的 instanceof-and-cast 习惯用法:</p> 
<pre><code class="prism language-java"><span class="token comment">// Old code</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> use s <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// New code</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> use s <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Java 17 中对 switch 表达式进行了增强，其中包括对 switch 表达式的模式匹配进行了优化。这些改进可以让开发人员更方便地使用 switch 表达式来进行条件判断和分支控制。</p> 
<pre><code class="prism language-java"><span class="token comment">// Old code</span>
<span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatter</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> formatted <span class="token operator">=</span> <span class="token string">"unknown"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Integer</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"int %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Long</span> l<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"long %d"</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"double %f"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        formatted <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"String %s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> formatted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// New code</span>
<span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatterPatternSwitch</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">switch</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token class-name">Integer</span> i <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"int %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Long</span> l    <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"long %d"</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">Double</span> d  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"double %f"</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token class-name">String</span> s  <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"String %s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>        <span class="token operator">-&gt;</span> o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对于 <code>null</code> 值的判断也进行了优化：</p> 
<pre><code class="prism language-java"><span class="token comment">// Old code</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testFooBar</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"oops!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> <span class="token string">"Bar"</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Great"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>           <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// New code</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testFooBar</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token keyword">null</span>         <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Oops"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">"Foo"</span><span class="token punctuation">,</span> <span class="token string">"Bar"</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Great"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span>           <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><a href="https://openjdk.org/jeps/406" rel="nofollow">JEP 406: Pattern Matching for switch (Preview)</a></p> 
<h3><a id="JEP_407___204"></a>JEP 407 - 删除远程方法调用激活机制</h3> 
<p>删除远程方法调用 (RMI) 激活机制，同时保留 RMI 的其余部分。RMI 激活机制已过时且不再使用。</p> 
<p><a href="https://openjdk.org/jeps/407" rel="nofollow">JEP 407: Remove RMI Activation</a></p> 
<h3><a id="JEP_409__Sealed_Classes_209"></a>JEP 409 - 密封类（Sealed Classes）</h3> 
<p>密封类（Sealed Classes）由 <a href="https://openjdk.org/jeps/360" rel="nofollow">JEP 360</a> 提出，并作为<code>预览功能</code>在 JDK 15 中提供。它们由 <a href="https://openjdk.org/jeps/397" rel="nofollow">JEP 397</a> 再次提出并进行了改进，并作为预览功能在 JDK 16 中提供 。此 JEP 建议在 JDK 17 中最终确定密封类，与 JDK 16 相比没有任何更改。</p> 
<p>没有密封类之前，在 Java 中如果想让一个类不能被继承和修改，我们可以使用 <code>final</code> 关键字对类进行修饰。不过，这种方式不太灵活，直接把一个类的继承和修改渠道给堵死了。</p> 
<p>密封类可以对继承或者实现它们的类进行限制，这样这个类就<strong>只能被指定的类继承</strong>。</p> 
<pre><code class="prism language-java"><span class="token comment">// 抽象类 Shape 只允许 Circle 和 Circle 继承。</span>
<span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token keyword">permits</span> <span class="token class-name">Circle</span><span class="token punctuation">,</span> <span class="token class-name">Circle</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Shape 类的定义</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Circle 类的定义</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Rectangle 类的定义</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>另外，任何扩展密封类的类本身都必须声明为 <code>sealed</code>、<code>non-sealed</code> 或 <code>final</code>。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">non-sealed</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token keyword">extends</span> <span class="token class-name">Shape</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<p><a href="https://openjdk.org/jeps/409" rel="nofollow">JEP 409: Sealed Classes</a></p> 
<h3><a id="JEP_410___AOT__JIT__243"></a>JEP 410 - 删除实验性的 AOT 和 JIT 编译器</h3> 
<p>在 Java 9 的 <a href="https://openjdk.org/jeps/295" rel="nofollow">JEP 295</a> 引入了实验性的提前 (AOT) 编译器，在启动虚拟机之前将 Java 类编译为本机代码。</p> 
<p>在 Java 17，删除实验性的提前 (AOT) 和即时 (JIT) 编译器，因为该编译器自推出以来很少使用，维护它所需的工作量很大。保留实验性的 Java 级 JVM 编译器接口 (JVMCI)，以便开发人员可以继续使用外部构建的编译器版本进行 JIT 编译。</p> 
<p><a href="https://openjdk.org/jeps/410" rel="nofollow">JEP 410: Remove the Experimental AOT and JIT Compiler</a></p> 
<h3><a id="JEP_411___250"></a>JEP 411 - 删除弃用的安全管理器</h3> 
<p>安全管理器可追溯到 Java 1.0，多年来，它一直不是保护客户端 Java 代码的主要方法，也很少用于保护服务器端代码。为了推动 Java 向前发展，Java 17 删除了弃用的安全管理器。</p> 
<p><a href="https://openjdk.org/jeps/411" rel="nofollow">JEP 411: Deprecate the Security Manager for Removal</a></p> 
<h3><a id="JEP_412___API_256"></a>JEP 412 - 外部函数和内存 API（孵化）</h3> 
<p>Java 程序可以通过该 API 与 Java 运行时之外的代码和数据进行互操作。通过高效地调用外部函数（即 JVM 之外的代码）和安全地访问外部内存（即不受 JVM 管理的内存），该 API 使 Java 程序能够调用本机库并处理本机数据，而不会像 JNI 那样危险和脆弱。</p> 
<p>下面是 FFM API 使用示例，这段代码获取了 C 库函数的 radixsort 方法句柄，然后使用它对 Java 数组中的四个字符串进行排序。</p> 
<pre><code class="prism language-java"><span class="token comment">// 1. 在C库路径上查找外部函数</span>
<span class="token class-name">Linker</span> linker <span class="token operator">=</span> <span class="token class-name">Linker</span><span class="token punctuation">.</span><span class="token function">nativeLinker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SymbolLookup</span> stdlib <span class="token operator">=</span> linker<span class="token punctuation">.</span><span class="token function">defaultLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MethodHandle</span> radixSort <span class="token operator">=</span> linker<span class="token punctuation">.</span><span class="token function">downcallHandle</span><span class="token punctuation">(</span>
                             stdlib<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token string">"radixsort"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 分配堆上内存以存储四个字符串</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> javaStrings   <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"mouse"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"dog"</span><span class="token punctuation">,</span> <span class="token string">"car"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 分配堆外内存以存储四个指针</span>
<span class="token class-name">SegmentAllocator</span> allocator <span class="token operator">=</span> <span class="token function">implicitAllocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MemorySegment</span> offHeap  <span class="token operator">=</span> allocator<span class="token punctuation">.</span><span class="token function">allocateArray</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span><span class="token constant">ADDRESS</span><span class="token punctuation">,</span> javaStrings<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 4. 将字符串从堆上复制到堆外</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> javaStrings<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在堆外分配一个字符串，然后存储指向它的指针</span>
    <span class="token class-name">MemorySegment</span> cString <span class="token operator">=</span> allocator<span class="token punctuation">.</span><span class="token function">allocateUtf8String</span><span class="token punctuation">(</span>javaStrings<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    offHeap<span class="token punctuation">.</span><span class="token function">setAtIndex</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span><span class="token constant">ADDRESS</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> cString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 5. 通过调用外部函数对堆外数据进行排序</span>
radixSort<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>offHeap<span class="token punctuation">,</span> javaStrings<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token class-name">MemoryAddress</span><span class="token punctuation">.</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 6. 将(重新排序的)字符串从堆外复制到堆上</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> javaStrings<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">MemoryAddress</span> cStringPtr <span class="token operator">=</span> offHeap<span class="token punctuation">.</span><span class="token function">getAtIndex</span><span class="token punctuation">(</span><span class="token class-name">ValueLayout</span><span class="token punctuation">.</span><span class="token constant">ADDRESS</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    javaStrings<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> cStringPtr<span class="token punctuation">.</span><span class="token function">getUtf8String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">assert</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>javaStrings<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token string">"car"</span><span class="token punctuation">,</span> <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"dog"</span><span class="token punctuation">,</span> <span class="token string">"mouse"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>

</code></pre> 
<p><a href="https://openjdk.org/jeps/412" rel="nofollow">JEP 412: Foreign Function &amp; Memory API (Incubator)</a></p> 
<h3><a id="JEP_414__Vector_API_290"></a>JEP 414 - 向量（Vector） API（第二次孵化）</h3> 
<p>Vector API 最初在 <a href="https://openjdk.org/jeps/338" rel="nofollow">Java 16</a> 孵化并集成，在 Java 17 中进行第二次孵化。这个特性可以让开发人员更方便地使用向量操作来进行数据处理。Vector API 可以提供更高的并行性和更好的性能，从而加速数据处理过程。</p> 
<pre><code class="prism language-java"><span class="token comment">// 创建一个 Vector</span>
<span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Float</span><span class="token punctuation">&gt;</span></span> v <span class="token operator">=</span> <span class="token class-name">Vector</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对 Vector 中的元素进行操作</span>
<span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Float</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">-&gt;</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Vector</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出结果</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><a href="https://openjdk.org/jeps/414" rel="nofollow">JEP 414: Vector API (Second Incubator)</a></p> 
<p><strong>更多新特性请参考：</strong></p> 
<p><a href="https://www.geeksforgeeks.org/jdk-17-new-features-in-java-17/" rel="nofollow">JDK 17 – New Features in Java 17</a></p> 
<p><a href="https://openjdk.org/projects/jdk/17/" rel="nofollow">https://openjdk.org/projects/jdk/17/</a></p> 
<h2><a id="3_Java_17__311"></a>3. Java 17 升级实战</h2> 
<p><a href="https://mp.weixin.qq.com/s/doJBJ3kaqptCyRCRVLUAlw" rel="nofollow">解决GC毛刺问题——转转搜索推荐服务JDK17升级实践</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a58e109f9e9c7e23cbefedff1f1b5c4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Unable to make field private final java.lang.String java.io.File.path accessible: module java.base d</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d42f52f9027ccb86770d9047868f655d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mathtype7.6产品密钥在哪里？有mathtype7.6破解版吗？MathType- Win-安装包：https://souurl.cn/NMiwukMathType- Mac-安装包：ht</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>