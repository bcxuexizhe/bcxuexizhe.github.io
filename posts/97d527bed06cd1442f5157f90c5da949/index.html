<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文心一言API使用教程（python版） - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/97d527bed06cd1442f5157f90c5da949/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="文心一言API使用教程（python版）">
  <meta property="og:description" content="注：在做项目的时候需要调用文心一言，发现网上的版本很乱，基本都止步在官方文档的代码上，所以写了一篇博客来记录自己的尝试实现了对文心一言的循环调用和自定义询问，本篇文章不需要有任何对api的基础知识，代码全部成功运行，并引用官方文档，祝大家成功实现自己的调用
预置准备部分 注册百度千帆平台账户，并注册api 文心一言的使用需要注册一个百度账户，可以使用百度网盘的账户进行登录百度智能云-登录 (baidu.com)申请以后，进入文心千帆大模型操作百度智能云控制台 (baidu.com)选择右侧边栏的应用接入，再点击创建应用就可以申请一个api了创建过程中只需要填写当前api的名称以及描述，默认所有服务都是勾选的（对api的使用没有任何影响）创建成功后会返回到应用接入的界面，记录下此时AppID、API Key、Secret Key 配置api，开通服务接口 1.点击控制台右上角的计费管理开通服务
注意文心一言的api的调用是需要付费的，并且提供多个大模型可以根据自己的选择进行开通，博主只开通了 ERNIE-Bot-turbo大模型公有云在线调用服务和ERNIE-Bot大模型公有云在线调用服务，不同服务的差别可以参考API列表API列表 - 千帆大模型平台 | 百度智能云文档 (baidu.com)
python装配库 下载requsets库下载json库 程序编写部分 获取Acees Token: 需要通过Acess Token来访问文心一言，注意：access_token默认有效期30天，生产环境注意及时刷新。可参考官方文档获取access_token - 千帆大模型平台 | 百度智能云文档 (baidu.com) import requests import json def main(): # client id = API Key, client_secret = Secret Key 修改成自己的API Key 和Sercet Key client_id=&#34;4YqbzGV59w6BU3Hh1GlBsaA1&#34; client_secret=&#34;3mM6ys4yAG5j******v&#34; url = &#34;https://aip.baidubce.com/oauth/2.0/token?grant_type= client_credentials &amp; client_id= 4Y****saA1 &amp; client_secret = 3mM6ys4yAG5j*****PnH0yDHlv &#34; payload = &#34;&#34; headers = { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Accept&#39;: &#39;application/json&#39; } response = requests.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-13T00:28:09+08:00">
    <meta property="article:modified_time" content="2023-10-13T00:28:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">文心一言API使用教程（python版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> 注：在做项目的时候需要调用文心一言，发现网上的版本很乱，基本都止步在官方文档的代码上，所以写了一篇博客来记录自己的尝试实现了对文心一言的循环调用和自定义询问，本篇文章不需要有任何对api的基础知识，代码全部成功运行，并引用官方文档，祝大家成功实现自己的调用</p> 
<h2><span style="color:#0d0016;">预置准备部分</span> </h2> 
<hr> 
<ul><li> <h3><span style="color:#0d0016;">注册百度千帆平台账户</span>，并注册api</h3> 
  <ol><li>文心一言的使用需要注册一个百度账户，可以使用百度网盘的账户进行登录<a href="https://login.bce.baidu.com/?redirect=https%3A%2F%2Fconsole.bce.baidu.com%2Fqianfan%2Foverview" rel="nofollow" title="百度智能云-登录 (baidu.com)">百度智能云-登录 (baidu.com)</a></li><li>申请以后，进入文心千帆大模型操作<a href="https://console.bce.baidu.com/qianfan/overview?_=1697115820672" rel="nofollow" title="百度智能云控制台 (baidu.com)">百度智能云控制台 (baidu.com)</a><img alt="" height="364" src="https://images2.imgbox.com/06/3c/JldvV1ot_o.png" width="649"></li><li>选择右侧边栏的应用接入，再点击创建应用就可以申请一个api了<img alt="" src="https://images2.imgbox.com/94/6d/AfjlOmVk_o.png"></li><li>创建过程中只需要填写当前api的名称以及描述，默认所有服务都是勾选的（对api的使用没有任何影响）<img alt="" src="https://images2.imgbox.com/7a/18/nN57M2Fp_o.png"></li><li style="text-align:center;">创建成功后会返回到应用接入的界面，记录下此时AppID、API Key、Secret Key<img alt="" src="https://images2.imgbox.com/fa/d2/ryCKH06U_o.png"></li></ol></li><li> <h3>配置api，开通服务接口</h3> </li></ul> 
<p>        1.点击控制台右上角的计费管理开通服务</p> 
<p class="img-center"><img alt="" height="368" src="https://images2.imgbox.com/9f/88/xbYcXfce_o.png" width="644"></p> 
<p>       注意文心一言的api的调用是需要付费的，并且提供多个大模型可以根据自己的选择进行开通，博主只开通了  ERNIE-Bot-turbo大模型公有云在线调用服务和ERNIE-Bot大模型公有云在线调用服务，不同服务的差别可以参考API列表<a href="https://cloud.baidu.com/doc/WENXINWORKSHOP/s/Nlks5zkzu" rel="nofollow" title="API列表 - 千帆大模型平台 | 百度智能云文档 (baidu.com)">API列表 - 千帆大模型平台 | 百度智能云文档 (baidu.com)</a></p> 
<p class="img-center"><img alt="" height="394" src="https://images2.imgbox.com/bc/e6/lEWpvbLE_o.png" width="677"></p> 
<ul><li> <h3> python装配库</h3> 
  <ul><li>下载requsets库</li><li>下载json库</li></ul></li></ul> 
<p>         </p> 
<hr> 
<h2>程序编写部分</h2> 
<ul><li> <h3>获取Acees Token:</h3> 
  <ol><li>需要通过Acess Token来访问文心一言，注意：access_token默认有效期30天，生产环境注意及时刷新。可参考官方文档<a href="https://cloud.baidu.com/doc/WENXINWORKSHOP/s/Ilkkrb0i5" rel="nofollow" title="获取access_token - 千帆大模型平台 | 百度智能云文档 (baidu.com)">获取access_token - 千帆大模型平台 | 百度智能云文档 (baidu.com)</a> <pre><code class="language-python">import requests
import json

def main():
    # client id = API Key, client_secret = Secret Key 修改成自己的API Key 和Sercet Key
    client_id="4YqbzGV59w6BU3Hh1GlBsaA1"
    client_secret="3mM6ys4yAG5j******v"
    url = "https://aip.baidubce.com/oauth/2.0/token?grant_type= client_credentials 
 &amp; client_id= 4Y****saA1 &amp; client_secret = 3mM6ys4yAG5j*****PnH0yDHlv "

    
    payload = ""
    headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
    }
    
    response = requests.request("POST", url, headers=headers, data=payload)
    
    print(response.text)
    

if __name__ == '__main__':
    main()

#会再终端打印一行文本即acess token</code></pre> </li><li>根据终端打印的Acess Token获取数据，记录其中的refresh_tolen(不用抄下来这一步是为了让大家更好的理解接下来的get_acess_token()函数)<img alt="" src="https://images2.imgbox.com/9d/ef/5ShvgjRC_o.png"><p></p> </li></ol></li></ul> 
<ul><li> <h3>    实现基本调用</h3> </li></ul> 
<ol><li>将refresh_token作为参数传入到调用程序中，现在就完成了最基本的使用，此时是默认的问题“你好”，message中的数据必须是奇数条，负责会报错 <pre><code class="language-python">import requests
import json
#修改成自己的api key和secret key
API_KEY = "Kc8pXsRQ***TbbF"
SECRET_KEY = "bgS856cVXiw5gj****IekgH4b2n"


def main():
    url = "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/eb-instant?access_token=" + get_access_token()
#注意message必须是奇数条
    payload = json.dumps({
        "messages": [
            {
                "role": "user",
                "content": "你好"
            }
            #,
            #{
            #    "role": "assistant",
            #    "content": "你好，有什么我可以帮助你的吗？"
            #}
        ]
    })
    headers = {
        'Content-Type': 'application/json'
    }

    response = requests.request("POST", url, headers=headers, data=payload)

    print(response.text)


def get_access_token():
    """
    使用 AK，SK 生成鉴权签名（Access Token）
    :return: access_token，或是None(如果错误)
    """
    url = "https://aip.baidubce.com/oauth/2.0/token"
    params = {"grant_type": "client_credentials", "client_id": API_KEY, "client_secret": SECRET_KEY}
    return str(requests.post(url, params=params).json().get("access_token"))


if __name__ == '__main__':
    main()</code></pre> <p></p> </li></ol> 
<ul><li> 
  <hr><h3> 程序升级部分</h3> </li></ul> 
<p> 此部分需要一定的python基础，如json，requset等相关知识，可以自己在CSDN，博客园，菜鸟驿站和B站找相关教程，当然可以直接看最后的代码就是最终成品</p> 
<ul><li> 
  <ul><li> 问题：不能自定义问题的： 
    <ul><li>设定一个输入字符串来解决</li><li>将message中的"content“ ： ”你好“ 换成 s </li></ul></li><li>问题：打印输出的内容存在不需要的部分： <pre><code class="language-python">{"id":"as-nuhbvmdj8h",
"object":"chat.completion",
"created":1697125231,
"result":"长沙有很多好玩的地方，以下是一些值得推荐的项目：\n\n* 橘子洲：位于长沙市区对面的湘江中，是长沙必游的景点之一。这里有一片人工沙滩可以戏水游玩，还有毛泽东青年雕像、历史浮雕等可以参观。\n* 岳麓山：位于长沙市区的岳麓山风景区是国家5A级旅游景区。这里有悠久的历史文化，拥有碑刻、古建筑、古植物、山水风光等各种景观，是长沙的一大标志性景点。\n* 长沙IFS：这里以商场和写字楼为主，地下一楼有美食城，有丰富的长沙本地小吃。\n* 湖南省博物馆：是湖南省最大的综合性历史博物馆，馆内珍藏着许多珍贵文物，记录了湖南的历史和文化。\n* 天心阁：是长沙市区的标志性建筑之一，有着悠久的历史和文化背景。\n\n此外，长沙还有一些其他值得一游的地方，如黄兴广场、太平街、湖南省植物园等。这些地方都有各自独特的景观和特色，值得一探究竟。\n\n以上信息仅供参考，如有需要，建议您查阅官方资讯。"
,"is_truncated":false,
"need_clear_history":false,
"usage":{"prompt_tokens":8,"completion_tokens":323,"total_tokens":331}}
</code></pre> 
    <ul><li>第一步：返回的response是一个response类型数据，我们可以用.json()将其转换成一个json类型</li><li>第二步：观察到json的response是一个字典类型我们可以用['result']来访问元素</li><li> <pre><code class="language-python">import requests
import json
#修改成自己的api key和secret key
API_KEY = "4YqbzGV59w******lBsaA1"
SECRET_KEY = "3mM6ys******xDPnH0yDHlv"


def main():
    url = "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/eb-instant?access_token=" + get_access_token()
    s=input()
#注意message必须是奇数条
    payload = json.dumps({
        "messages": [
            {
                "role": "user",
                "content": s
            }
        ]
    })
    headers = {
        'Content-Type': 'application/json'
    }

    res = requests.request("POST", url, headers=headers, data=payload).json()
    print(res['result'])


def get_access_token():
    """
    使用 AK，SK 生成鉴权签名（Access Token）
    :return: access_token，或是None(如果错误)
    """
    url = "https://aip.baidubce.com/oauth/2.0/token"
    params = {"grant_type": "client_credentials", "client_id": API_KEY, "client_secret": SECRET_KEY}
    return str(requests.post(url, params=params).json().get("access_token"))


if __name__ == '__main__':
    main()</code></pre> </li></ul></li><li>问题：只能输入一次询问 
    <ul><li>如果没有其它传感器的话传入信号，我们就可以使用一个永真循环来实现 <pre><code class="language-python">import requests
import json
#修改成自己的api key和secret key
API_KEY = "4YqbzGV59w***GlBsaA1"
SECRET_KEY = "3mM6ys4yAG58***QxDPnH0yDHlv"


def main():
    url = "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/eb-instant?access_token=" + get_access_token()
    while(1):
        s=input()
        # 注意message必须是奇数条
        payload = json.dumps({
        "messages": [
            {
                "role": "user",
                "content": s
            }
        ]
        })
        headers = {
            'Content-Type': 'application/json'
        }

        res = requests.request("POST", url, headers=headers, data=payload).json()
        print(res['result'])




def get_access_token():
    """
    使用 AK，SK 生成鉴权签名（Access Token）
    :return: access_token，或是None(如果错误)
    """
    url = "https://aip.baidubce.com/oauth/2.0/token"
    params = {"grant_type": "client_credentials", "client_id": API_KEY, "client_secret": SECRET_KEY}
    return str(requests.post(url, params=params).json().get("access_token"))


if __name__ == '__main__':
    main()</code></pre> </li></ul></li></ul></li><li> <h2>最终结果 ,完结，撒花！！！</h2> <pre><code class="language-python">import requests
import json
#修改成自己的api key和secret key
API_KEY = "4Y***U3Hh1GlBsaA1"
SECRET_KEY = "3mM6ys4yAG5***xDPnH0yDHlv"


def main():
    url = "https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/eb-instant?access_token=" + get_access_token()
    while(1):
        s=input()
        # 注意message必须是奇数条
        payload = json.dumps({
        "messages": [
            {
                "role": "user",
                "content": s
            }
        ]
        })
        headers = {
            'Content-Type': 'application/json'
        }

        res = requests.request("POST", url, headers=headers, data=payload).json()
        print(res['result'])




def get_access_token():
    """
    使用 AK，SK 生成鉴权签名（Access Token）
    :return: access_token，或是None(如果错误)
    """
    url = "https://aip.baidubce.com/oauth/2.0/token"
    params = {"grant_type": "client_credentials", "client_id": API_KEY, "client_secret": SECRET_KEY}
    return str(requests.post(url, params=params).json().get("access_token"))


if __name__ == '__main__':
    main()</code></pre> </li></ul> 
<h3></h3> 
<p>         </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf5f0a4947de51211ed777cc7b64f034/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Eureka（服务注册和发现）——Eureka的简介和原理 &amp; Eureka的使用和分析 &amp; 心跳续约策略，服务的下线和剔除，自我保护 &amp; Eureka集群的搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f200d53ee8ebee64bfb0d4a40ac01ca9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL的指令大全和注意事项(强烈推荐收藏)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>