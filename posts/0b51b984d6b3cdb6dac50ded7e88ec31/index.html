<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark读写MySQL数据库 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/0b51b984d6b3cdb6dac50ded7e88ec31/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Spark读写MySQL数据库">
  <meta property="og:description" content="Spark读写MySQL数据库 文章目录 Spark读写MySQL数据库一、读取数据库（一）通过RDD的方式读取MySQL数据库（二）通过DataFrame的方式读取MySQL数据库 二、添加数据到MySQL（一）通过RDD的方式插入数据到MySQL（二）通过RDD的方式插入数据到MySQL 2（三）使用DataFrame插入数据到MySQL 一、读取数据库 （一）通过RDD的方式读取MySQL数据库 四要素：驱动、连接地址、账号密码
import org.apache.spark.rdd.JdbcRDD import org.apache.spark.sql.SparkSession import java.sql.DriverManager /** * 使用RDD读取MySQL数据库 */ object spark_read_mysql { def main(args: Array[String]): Unit = { //创建SparkSession，作用：连接Spark val spark = SparkSession .builder() .master(&#34;local[*]&#34;) //指定运行的方式 .appName(&#34;spark_read_mysql&#34;) //程序的名字 .getOrCreate() //创建SparkContext val sc = spark.sparkContext //驱动名称 val driver = &#34;com.mysql.cj.jdbc.Driver&#34; //连接信息 val url = &#34;jdbc:mysql://192.168.80.145:3306/test&#34; //用户名 val username = &#34;root&#34; //密码 val password = &#34;123456&#34; //具体的SQL查询语句 val sql = &#34;select * from t_user where id&gt;=?">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-13T16:37:21+08:00">
    <meta property="article:modified_time" content="2023-12-13T16:37:21+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark读写MySQL数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="SparkMySQL_0"></a>Spark读写MySQL数据库</h3> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#SparkMySQL_0" rel="nofollow">Spark读写MySQL数据库</a></li><li><ul><li><a href="#_2" rel="nofollow">一、读取数据库</a></li><li><ul><li><a href="#RDDMySQL_4" rel="nofollow">（一）通过RDD的方式读取MySQL数据库</a></li><li><a href="#DataFrameMySQL_70" rel="nofollow">（二）通过DataFrame的方式读取MySQL数据库</a></li></ul> 
    </li><li><a href="#MySQL_103" rel="nofollow">二、添加数据到MySQL</a></li><li><ul><li><a href="#RDDMySQL_105" rel="nofollow">（一）通过RDD的方式插入数据到MySQL</a></li><li><a href="#RDDMySQL_2_172" rel="nofollow">（二）通过RDD的方式插入数据到MySQL 2</a></li><li><a href="#DataFrameMySQL_244" rel="nofollow">（三）使用DataFrame插入数据到MySQL</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_2"></a>一、读取数据库</h4> 
<h5><a id="RDDMySQL_4"></a>（一）通过RDD的方式读取MySQL数据库</h5> 
<p>四要素：驱动、连接地址、账号密码</p> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span></span>JdbcRDD
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>DriverManager

<span class="token comment">/**
 * 使用RDD读取MySQL数据库
 */</span>
<span class="token keyword">object</span> spark_read_mysql <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//创建SparkSession，作用：连接Spark</span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession
      <span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span> <span class="token comment">//指定运行的方式</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"spark_read_mysql"</span><span class="token punctuation">)</span> <span class="token comment">//程序的名字</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//创建SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext

    <span class="token comment">//驱动名称</span>
    <span class="token keyword">val</span> driver <span class="token operator">=</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span>
    <span class="token comment">//连接信息</span>
    <span class="token keyword">val</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://192.168.80.145:3306/test"</span>
    <span class="token comment">//用户名</span>
    <span class="token keyword">val</span> username <span class="token operator">=</span> <span class="token string">"root"</span>
    <span class="token comment">//密码</span>
    <span class="token keyword">val</span> password <span class="token operator">=</span> <span class="token string">"123456"</span>

    <span class="token comment">//具体的SQL查询语句</span>
    <span class="token keyword">val</span> sql <span class="token operator">=</span> <span class="token string">"select * from t_user where id&gt;=? and id&lt;=?"</span>

    <span class="token comment">//查询</span>
    <span class="token keyword">val</span> rsRDD <span class="token operator">=</span> <span class="token keyword">new</span> JdbcRDD<span class="token punctuation">(</span>
      sc<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//加载驱动</span>
        Class<span class="token punctuation">.</span>forName<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
        <span class="token comment">//创建和MySQL数据库的连接</span>
        DriverManager<span class="token punctuation">.</span>getConnection<span class="token punctuation">(</span>url<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">//需要执行的SQL语句</span>
      sql<span class="token punctuation">,</span>
      <span class="token comment">//查询的开始行</span>
      <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">//查询的结束行</span>
      <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token comment">//运行几个分区执行</span>
      <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token comment">//返回值的处理（将返回值变为RDD的元素），数字从1开始，表示字段的编号</span>
      rs <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span>getInt<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rs<span class="token punctuation">.</span>getString<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>rs<span class="token punctuation">.</span>getInt<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">//将RDD的元素打印在终端</span>
    rsRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="DataFrameMySQL_70"></a>（二）通过DataFrame的方式读取MySQL数据库</h5> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token comment">/**
 * 使用DataFrame读取MySQL数据库
 */</span>
<span class="token keyword">object</span> spark_read_mysql2 <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//创建SparkSession，作用：连接Spark</span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession
      <span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span><span class="token comment">//指定运行的方式</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"spark_read_mysql2"</span><span class="token punctuation">)</span><span class="token comment">//程序的名字</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//创建DataFrame</span>
    <span class="token keyword">val</span> jdbcDF <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"jdbc"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span><span class="token string">"jdbc:mysql://192.168.80.145:3306/test"</span><span class="token punctuation">)</span><span class="token comment">//指定连接</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token comment">//指定驱动</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token comment">//指定连接的用户</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token comment">//指定连接的用户的密码</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"dbtable"</span><span class="token punctuation">,</span><span class="token string">"t_user"</span><span class="token punctuation">)</span><span class="token comment">//查询的表</span>
      <span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//加载数据库表</span>

    <span class="token comment">//在终端显示DataFrame的内容</span>
    jdbcDF<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="MySQL_103"></a>二、添加数据到MySQL</h4> 
<h5><a id="RDDMySQL_105"></a>（一）通过RDD的方式插入数据到MySQL</h5> 
<p>每个分区执行一次创建连接和关闭连接</p> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>DriverManager

<span class="token comment">/**
 * 使用RDD插入数据到MySQL，RDD的每个元素都会执行一次创建连接和关闭连接
 */</span>
<span class="token keyword">object</span> spark_write_mysql <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//创建SparkSession，作用：连接Spark</span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession
      <span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span> <span class="token comment">//指定运行的方式</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"spark_write_mysql"</span><span class="token punctuation">)</span> <span class="token comment">//程序的名字</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//创建SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext

    <span class="token comment">//驱动名称</span>
    <span class="token keyword">val</span> driver <span class="token operator">=</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span>
    <span class="token comment">//连接信息</span>
    <span class="token comment">//?useUnicode=true&amp;characterEncoding=UTF-8 指定连接的参数；字符集为utf8，防止插入的数据中文乱码</span>
    <span class="token keyword">val</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://192.168.80.145:3306/test?useUnicode=true&amp;characterEncoding=UTF-8"</span>
    <span class="token comment">//用户名</span>
    <span class="token keyword">val</span> username <span class="token operator">=</span> <span class="token string">"root"</span>
    <span class="token comment">//密码</span>
    <span class="token keyword">val</span> password <span class="token operator">=</span> <span class="token string">"123456"</span>

    <span class="token comment">//创建RDD</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"zhaoba"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"孙七"</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//打印RDD的元素</span>
    <span class="token comment">//rdd.collect().foreach(println)</span>

    <span class="token comment">//通过循环的方式读取RDD的每条元素，将元素插入MySQL；一个元素执行一次创建连接和插入和关闭连接</span>
    rdd<span class="token punctuation">.</span>foreach <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">case</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//加载驱动</span>
        Class<span class="token punctuation">.</span>forName<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
        <span class="token comment">//创建和MySQL的链接</span>
        <span class="token keyword">val</span> conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span>getConnection<span class="token punctuation">(</span>url<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span>
        <span class="token comment">//添加的SQL语句</span>
        <span class="token keyword">val</span> sql <span class="token operator">=</span> <span class="token string">"insert into t_user(name,age) values(?,?)"</span>
        <span class="token comment">//给SQL语句配置参数</span>
        <span class="token keyword">val</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span>prepareStatement<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        <span class="token comment">//根据参数的类型配置参数</span>
        ps<span class="token punctuation">.</span>setString<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        ps<span class="token punctuation">.</span>setInt<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span>
        <span class="token comment">//执行SQL语句</span>
        ps<span class="token punctuation">.</span>executeUpdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//关闭连接</span>
        ps<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="RDDMySQL_2_172"></a>（二）通过RDD的方式插入数据到MySQL 2</h5> 
<p>每个分区执行一次创建连接和关闭连接</p> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>SparkSession

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span>DriverManager

<span class="token comment">/**
 * 使用RDD插入数据到MySQL，RDD的每个分区执行一次创建连接和关闭连接；推荐
 */</span>
<span class="token keyword">object</span> spark_write_mysql2 <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//创建SparkSession，作用：连接Spark</span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession
      <span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span> <span class="token comment">//指定运行的方式</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"spark_write_mysql2"</span><span class="token punctuation">)</span> <span class="token comment">//程序的名字</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//创建SparkContext</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext

    <span class="token comment">//驱动名称</span>
    <span class="token keyword">val</span> driver <span class="token operator">=</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span>
    <span class="token comment">//连接信息</span>
    <span class="token comment">//?useUnicode=true&amp;characterEncoding=UTF-8 指定连接的参数；字符集为utf8，防止插入的数据中文乱码</span>
    <span class="token keyword">val</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://192.168.80.145:3306/test?useUnicode=true&amp;characterEncoding=UTF-8"</span>
    <span class="token comment">//用户名</span>
    <span class="token keyword">val</span> username <span class="token operator">=</span> <span class="token string">"root"</span>
    <span class="token comment">//密码</span>
    <span class="token keyword">val</span> password <span class="token operator">=</span> <span class="token string">"123456"</span>

    <span class="token comment">//创建RDD</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"zhaoba"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"孙七"</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//打印RDD的元素</span>
    <span class="token comment">//rdd.collect().foreach(println)</span>

    <span class="token comment">//通过循环的方式读取RDD的每个分区，将元素插入MySQL；一个分区执行一次创建连接和关闭连接</span>
    rdd<span class="token punctuation">.</span>foreachPartition <span class="token punctuation">{<!-- --></span>
      datas <span class="token keyword">=&gt;</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//加载驱动</span>
        Class<span class="token punctuation">.</span>forName<span class="token punctuation">(</span>driver<span class="token punctuation">)</span>
        <span class="token comment">//创建和MySQL的链接</span>
        <span class="token keyword">val</span> conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span>getConnection<span class="token punctuation">(</span>url<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span>
        <span class="token comment">//添加的SQL语句</span>
        <span class="token keyword">val</span> sql <span class="token operator">=</span> <span class="token string">"insert into t_user(name,age) values(?,?)"</span>
        <span class="token comment">//给SQL语句配置参数</span>
        <span class="token keyword">val</span> ps <span class="token operator">=</span> conn<span class="token punctuation">.</span>prepareStatement<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        <span class="token comment">//根据参数的类型配置参数</span>
        datas<span class="token punctuation">.</span>foreach<span class="token punctuation">{<!-- --></span>
          <span class="token keyword">case</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token keyword">=&gt;</span><span class="token punctuation">{<!-- --></span>
            ps<span class="token punctuation">.</span>setString<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
            ps<span class="token punctuation">.</span>setInt<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span>

            <span class="token comment">//执行SQL语句</span>
            ps<span class="token punctuation">.</span>executeUpdate<span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//关闭连接</span>
        ps<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="DataFrameMySQL_244"></a>（三）使用DataFrame插入数据到MySQL</h5> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>Row<span class="token punctuation">,</span> SparkSession<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>types<span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>IntegerType<span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> StructField<span class="token punctuation">,</span> StructType<span class="token punctuation">}</span>

<span class="token comment">/**
 * 使用DataFrame插入数据到MySQL
 */</span>

<span class="token keyword">object</span> spark_write_mysql3 <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//创建SparkSession，作用：连接Spark</span>
    <span class="token keyword">val</span> spark <span class="token operator">=</span> SparkSession
      <span class="token punctuation">.</span>builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>master<span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span> <span class="token comment">//指定运行的方式</span>
      <span class="token punctuation">.</span>appName<span class="token punctuation">(</span><span class="token string">"spark_write_mysql3"</span><span class="token punctuation">)</span> <span class="token comment">//程序的名字</span>
      <span class="token punctuation">.</span>getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//1.创建DataFrame</span>
    <span class="token comment">//1.1 schema</span>
    <span class="token keyword">val</span> schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span>List<span class="token punctuation">(</span>StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span>IntegerType<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//1.2 行rows</span>
    <span class="token comment">//1.2.1 创建RDD</span>
    <span class="token keyword">val</span> dataRDD <span class="token operator">=</span> spark<span class="token punctuation">.</span>sparkContext<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Array<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Array<span class="token punctuation">(</span><span class="token string">"王五"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//1.2.2 创建rows</span>
    <span class="token keyword">val</span> rows <span class="token operator">=</span> dataRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x<span class="token keyword">=&gt;</span>Row<span class="token punctuation">(</span>x<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//1.3 拼接表头（schema）和行内容（rows）</span>
    <span class="token keyword">val</span> df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>rows<span class="token punctuation">,</span>schema<span class="token punctuation">)</span>

    <span class="token comment">//2.通过DataFrame插入数据到MySQL</span>
    <span class="token comment">//如果直接使用df.write则会将整个DataFrame的表写入MySQL形成一个新表，需要注意表不能存在</span>
    <span class="token comment">//df.write.mode("append")，是以追加的方式将数据写入到已经存在的表中</span>
    df<span class="token punctuation">.</span>write
      <span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"jdbc"</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"jdbc:mysql://192.168.80.145:3306/test?useUnicode=true&amp;characterEncoding=UTF-8"</span><span class="token punctuation">)</span> <span class="token comment">//指定连接</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">,</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span> <span class="token comment">//指定驱动</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">)</span> <span class="token comment">//指定连接的用户</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span> <span class="token comment">//指定连接的用户的密码</span>
      <span class="token punctuation">.</span>option<span class="token punctuation">(</span><span class="token string">"dbtable"</span><span class="token punctuation">,</span> <span class="token string">"t_user2"</span><span class="token punctuation">)</span> <span class="token comment">//查询的表</span>
      <span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//保存数据</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c337b3f3803a2322f3fc619121b84b1f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">采用MQTT协议实现Android APP与阿里云平台的连接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bd3ee9808db96e9b64466595e778a68b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">人工智能技术的工程伦理问题 --以美团外卖大数据杀熟为例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>