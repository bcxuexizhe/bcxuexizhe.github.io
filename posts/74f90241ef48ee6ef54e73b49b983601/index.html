<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Postgresql中PL/pgSQL代码块的语法与使用-声明与赋值、IF语句、CASE语句、循环语句 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/74f90241ef48ee6ef54e73b49b983601/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Postgresql中PL/pgSQL代码块的语法与使用-声明与赋值、IF语句、CASE语句、循环语句">
  <meta property="og:description" content="场景 PostGresSQL简介与Windows上的安装教程：
PostGresSQL简介与Windows上的安装教程_postgressql windows安装免费吗?-CSDN博客
除了标准 SQL 语句之外，PostgreSQL 还支持使用各种过程语言（例如 PL/pgSQL、C、PL/Tcl、PL/Python、PL/Perl、PL/Java 等 ）
创建复杂的过程和函数，称为存储过程（Stored Procedure）和自定义函数（User-Defined Function）。
存储过程支持许多过程元素，例如控制结构、循环和复杂的计算。
注：
博客：
霸道流氓气质_C#,架构之路,SpringBoot-CSDN博客
实现 1、PL/pgSQL 代码块结构 [ &lt;&lt;label&gt;&gt; ] [ DECLARE declarations ] BEGIN statements; ... END [ label ]; 结构说明：
label 是一个可选的代码块标签，可以用于 EXIT 语句退出指定的代码块，或者限定变量的名称；
DECLARE 是一个可选的声明部分，用于定义变量；
BEGIN 和 END 之间是代码主体，也就是主要的功能代码；所有的语句都使用分号（;）结束，
END 之后的分号表示代码块结束。
代码块示例：
DO $$ DECLARE name text; BEGIN name := &#39;霸道&#39;; RAISE NOTICE &#39;Hello % !&#39;, name; END $$; 运行结果：
示例说明：
以上是一个匿名块，与此相对的是命名块（也就是存储过程和函数）。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-19T17:36:02+08:00">
    <meta property="article:modified_time" content="2023-12-19T17:36:02+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Postgresql中PL/pgSQL代码块的语法与使用-声明与赋值、IF语句、CASE语句、循环语句</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>场景</h2> 
<p>PostGresSQL简介与Windows上的安装教程：</p> 
<p><a href="https://blog.csdn.net/BADAO_LIUMANG_QIZHI/article/details/113981563" title="PostGresSQL简介与Windows上的安装教程_postgressql windows安装免费吗?-CSDN博客">PostGresSQL简介与Windows上的安装教程_postgressql windows安装免费吗?-CSDN博客</a></p> 
<p>除了标准 SQL 语句之外，PostgreSQL 还支持使用各种过程语言（例如 PL/pgSQL、C、PL/Tcl、PL/Python、PL/Perl、PL/Java 等 ）</p> 
<p>创建复杂的过程和函数，称为存储过程（Stored Procedure）和自定义函数（User-Defined Function）。</p> 
<p>存储过程支持许多过程元素，例如控制结构、循环和复杂的计算。</p> 
<p>注：</p> 
<p>博客：<br><a href="https://blog.csdn.net/badao_liumang_qizhi" title="霸道流氓气质_C#,架构之路,SpringBoot-CSDN博客">霸道流氓气质_C#,架构之路,SpringBoot-CSDN博客</a></p> 
<h2>实现</h2> 
<h3>1、PL/pgSQL 代码块结构</h3> 
<pre><code class="hljs">[ &lt;&lt;label&gt;&gt; ]
[ DECLARE
 declarations ]
BEGIN
 statements;
 ...
END [ label ];</code></pre> 
<p>结构说明：</p> 
<p>label 是一个可选的代码块标签，可以用于 EXIT 语句退出指定的代码块，或者限定变量的名称；</p> 
<p>DECLARE 是一个可选的声明部分，用于定义变量；</p> 
<p>BEGIN 和 END 之间是代码主体，也就是主要的功能代码；所有的语句都使用分号（;）结束，</p> 
<p>END 之后的分号表示代码块结束。</p> 
<p>代码块示例：</p> 
<pre><code class="hljs">DO $$
DECLARE
 name text;
BEGIN
 name := '霸道';
 RAISE NOTICE 'Hello % !', name;
END $$;</code></pre> 
<p>运行结果：</p> 
<p><img alt="" height="579" src="https://images2.imgbox.com/6b/19/LnCUEJco_o.png" width="631"></p> 
<p>示例说明：</p> 
<p>以上是一个匿名块，与此相对的是命名块（也就是存储过程和函数）。</p> 
<p>其中，DO 语句用于执行匿名块；我们定义了一个字符串变量 name，然后给它赋值并输出一个信息；</p> 
<p>RAISE NOTICE用于输出通知消息。</p> 
<p>$$用于替换单引号（'），因为 PL/pgSQL 代码主体必须是字符串文本，意味着代码中所有的单引号都必须转义（重复写两次），</p> 
<p>显然这种写法很不方便，因此 PL/pgSQL 提供了$$避免单引号问题。</p> 
<h3>2、嵌套子块</h3> 
<p>PL/pgSQL 支持代码块的嵌套，也就是将一个代码块嵌入其他代码块的主体中。被嵌套的代码块被称为子块（subblock），</p> 
<p>包含子块的代码块被称为外部块（subblock）。子块可以将代码进行逻辑上的拆分，子块中可以定义与外部块重名的变量，</p> 
<p>而且在子块内拥有更高的优先级。</p> 
<p>示例代码：</p> 
<pre><code class="hljs">DO $$
&lt;&lt;outer_block&gt;&gt;
DECLARE
 name text;
BEGIN
 name := 'outer_block';
 RAISE NOTICE 'This is %', name;
 DECLARE
 name text := 'sub_block';
 BEGIN
 RAISE NOTICE 'This is %', name;
 RAISE NOTICE 'The name FROM the outer block is %', outer_block.name;
 END;
 RAISE NOTICE 'This is %', name;
 
END outer_block $$;</code></pre> 
<p>执行结果：</p> 
<h3><img alt="" height="603" src="https://images2.imgbox.com/0e/69/Yl8bMR7G_o.png" width="722"></h3> 
<h3>3、声明与赋值</h3> 
<h4>声明变量</h4> 
<p>variable_name data_type [ NOT NULL ] [ { DEFAULT | := |= } expression ];</p> 
<p>variable_name 是变量的名称，通常需要指定一个有意义的名称；</p> 
<p>data_type 是变量的类型，可以是任何 SQL 数据类型；</p> 
<p>如果指定了 NOT NULL，必须使用后面的表达式为变量指定初始值。</p> 
<p>变量声明示例：</p> 
<pre><code class="hljs">DO $$
DECLARE
 name text;
 age numeric(5) DEFAULT 20;
 url varchar := 'www.123.com';
BEGIN
 name := '霸道';
 RAISE NOTICE 'age= %', age;
 RAISE NOTICE 'url= %', url;
END $$;</code></pre> 
<p>除了基本的 SQL 数据类型之外，PL/pgSQL 还支持基于表的字段或行或者其他变量定义变量，这里不再实现。</p> 
<h4>声明常量</h4> 
<p>如果在定义变量时指定了 CONSTANT 关键字，意味着定义的是常量。常量的值需要在声明时初始化，并且不能修改。</p> 
<p>示例代码：</p> 
<p>通过定义PI计算圆的面积</p> 
<pre><code class="hljs">DO $$
DECLARE
 PI CONSTANT NUMERIC := 3.14159265;
 radius NUMERIC;
BEGIN
 radius := 5.0;
 RAISE NOTICE 'The area is %', PI * radius * radius;
END $$;</code></pre> 
<p>示例运行结果：</p> 
<h3><img alt="" height="387" src="https://images2.imgbox.com/c6/d0/Qgt85nRr_o.png" width="667"></h3> 
<h3>4、控制结构</h3> 
<h4>IF语句</h4> 
<p>PL/pgSQL 提供了三种形式的 IF 语句</p> 
<p>• IF … THEN … END IF<br> • IF … THEN … ELSE … END IF<br> • IF … THEN … ELSIF … THEN … ELSE … END IF</p> 
<p>示例代码：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 3;
j INTEGER := 3;
BEGIN
 IF
  i &gt; j THEN
   RAISE NOTICE'i 大于 j';
  ELSIF i &lt; j THEN
   RAISE NOTICE'i 小于 j';
   ELSE RAISE NOTICE'i 等于 j';
   
  END IF;
  
 END $$;</code></pre> 
<h4>CASE语句</h4> 
<p>类似Java中switch-case语句</p> 
<p>简单Case语句示例：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 3;
BEGIN
 CASE
   i
   WHEN 1,
   2 THEN
    RAISE NOTICE'one or two';
   
   WHEN 3,
   4 THEN
    RAISE NOTICE'three or four';
    ELSE RAISE NOTICE'other value';
    
   END CASE;
   
  END $$;</code></pre> 
<p>搜索CASE语句示例：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 3;
BEGIN
 CASE
   
   WHEN i BETWEEN 0
   AND 10 THEN
    RAISE NOTICE'value is between zero and ten';
   
   WHEN i BETWEEN 11
   AND 20 THEN
    RAISE NOTICE'value is between eleven and twenty';
    ELSE RAISE NOTICE'other value';
    
   END CASE;
  
END $$;</code></pre> 
<h4>循环语句</h4> 
<p>PostgreSQL 提供 4 种循环执行命令的语句：</p> 
<p>LOOP、WHILE、FOR 和 FOREACH 循环，以及循环控制的 EXIT 和 CONTINUE 语句。</p> 
<p>LOOP 用于定义一个无限循环语句，一般需要使用 EXIT 或者 RETURN 语句退出循环，</p> 
<p>label 可以用于 EXIT 或者 CONTINUE 语句退出或者跳到执行的嵌套循环中。</p> 
<p>LOOP循环示例：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 0;
BEGIN
  LOOP
  EXIT
  WHEN i = 5;
 i := i + 1;
 RAISE NOTICE'Loop: %',
 i;
 
END LOOP;

END $$;</code></pre> 
<p>CONTINUE 表示忽略后面的语句，直接进入下一次循环。</p> 
<p>示例：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 0;
BEGIN
  LOOP
  EXIT
  WHEN i = 10;
 i := i + 1;
 CONTINUE
  WHEN MOD ( i, 2 ) = 1;
 RAISE NOTICE'Loop: %',
 i;
 
END LOOP;

END $$;</code></pre> 
<p>WHILE循环表示当表达式 boolean-expression 的值为真时，循环执行其中的语句；</p> 
<p>然后重新计算表达式的值，当表达式的值假时退出循环。</p> 
<p>WHILE循环示例：</p> 
<pre><code class="hljs">DO $$ DECLARE
i INTEGER := 0;
BEGIN
  WHILE
  i &lt; 5
  LOOP
  i := i + 1;
 RAISE NOTICE'Loop: %',
 i;
 
END LOOP;

END $$;</code></pre> 
<p>FOR 循环可以用于遍历一个整数范围或者查询结果集。</p> 
<p>FOR 循环默认从小到大进行遍历，REVERSE 表示从大到小遍历；BY 用于指定每次的增量，默认为 1。</p> 
<p>FOR循环示例：</p> 
<pre><code class="hljs">DO $$ BEGIN
 FOR i IN 1..5 BY 2
 LOOP
 RAISE NOTICE'Loop: %',
 i;
 
END LOOP;

END $$;</code></pre> 
<p>FOREACH 循环与 FOR 循环类似，只不过变量的是一个数组</p> 
<p>FOREACH 循环示例：</p> 
<pre><code class="hljs">DO $$ DECLARE x INT; BEGIN FOREACH x IN ARRAY ( ARRAY [[ 1, 2, 3 ],[ 4, 5, 6 ]]
  )
 LOOP
 RAISE NOTICE'x = %',
 x;
 
END LOOP;

END $$;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79955088da34333920b30f888bf1f217/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hadoop的基础操作——Hadoop中创建、修改、查看、删除文件夹及文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2b7b6ec3c55e03b138ee8091b2b37fb9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决ADB连接不了问题： daemon not running:staring now at tcp:5037.adb:CreateFileW ‘nul‘ failed:系统找不到指定的文件。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>