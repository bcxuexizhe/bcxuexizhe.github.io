<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Python&#43;大数据的旅游景区推荐系统设计与实现 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/f2cc5d64c513b80b4b867a00cd5d054b/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="基于Python&#43;大数据的旅游景区推荐系统设计与实现">
  <meta property="og:description" content="💗博主介绍：✌全网粉丝10W&#43;,CSDN全栈领域优质创作者，博客之星、掘金/华为云/阿里云等平台优质作者。
👇🏻 精彩专栏 推荐订阅👇🏻
计算机毕业设计精品项目案例-200套
🌟文末获取源码&#43;数据库&#43;文档🌟
感兴趣的可以先收藏起来，还有大家在毕设选题，项目以及论文编写等相关问题都可以和学长沟通，希望帮助更多的人
一.前言 近些年来，随着科技的飞速发展，互联网的普及逐渐延伸到各行各业中，给人们生活带来了十分的便利，旅游景区推荐系统利用计算机网络实现信息化管理，使整个旅游景区推荐的发展和服务水平有显著提升。
本文拟采用PyCharm开发工具，Python语言、Django框架进行开发，后台使用MySQL数据库进行信息管理，设计开发的旅游景区推荐系统。通过调研和分析，系统拥有管理员和用户两个角色，主要具备注册登录、个人信息修改、用户、景点分类、景点信息、旅游景区等功能模块。将纸质管理有效实现为在线管理，极大提高工作效率。
二.技术环境 开发语言：Python
python框架：django
软件版本：python3.7/python3.8
数据库：mysql 5.7或更高版本
数据库工具：Navicat11
爬虫框架：Scrapy
开发软件：PyCharm/vs code
前端框架:vue.js
三.功能设计 系统用例图如图3-1、图3-2、图3-3、图3-4所示。
系统功能结构图是系统设计阶段，系统功能结构图只是这个阶段一个基础，整个系统的架构决定了系统的整体模式，是系统的根据。本系统的整个设计结构如图所示。
四.数据设计 概念模型的设计是为了抽象真实世界的信息，并对信息世界进行建模。它是数据库设计的强大工具。数据库概念模型设计可以通过E-R图描述现实世界的概念模型。系统的E-R图显示了系统中实体之间的链接。而且Mysql数据库是自我保护能力比较强的数据库，下图主要是对数据库实体的E-R图：
五.部分效果展示 系统前台功能实现效果 当游客打开系统的网址后，首先看到的就是首页界面。在这里，游客能够看到旅游景区推荐系统的导航条显示首页、景点信息、旅游景区、景点资讯、个人中心。系统首页界面如图所示：
在系统首页点击中间的注册/登录按钮，然后页面跳转到注册登录界面，后来输入信息完成后，单击注册或者登录操作，如图所示：
用户点击景点信息，在景点信息页面的搜索栏输入景点名称、景点分类、景点星级、景点地址，进行查询，然后可以查看景点名称、景点分类、景点星级、景点图片、景点地址、营业时间、咨询热线，还可以对景点信息进行收藏或者评论操作；如图所示：
景点资讯；在景点资讯页面查看标题、内容、发布时间等信息进行详细操作，如图所示：
在个人中心页面可以输入个人详细信息，进行信息更新操作，还可以对我的收藏进行详细操作，如图所示：
系统管理员功能实现效果 管理员登录，通过登录页面填写用户名和密码等信息，点击登录操作，如图所示。
管理员登录进入系统可以查看系统首页、个人中心、用户管理、景点分类管理、景点信息管理、旅游景区管理、系统管理等功能，进行详细操作，如图所示。
管理员点击用户管理；在用户管理页面输入用户名、姓名、性别、头像、年龄、手机等信息，进行查询，新增或删除用户信息等操作；如图所示。
管理员点击景点信息管理；在景点信息管理页面输入景点名称、景点分类、景点星级、景点图片、景点地址、营业时间、咨询热线等信息，进行查询、新增或删除景点信息等操作；如图所示。
管理员点击旅游景区管理；在旅游景区管理页面对标题、封面、位置、价格、点评、评论等信息，进行查询或删除旅游景区等操作；如图所示。
管理员点击系统管理；在系统管理页面对系统简介、轮播图管理、景点资讯等信息，进行查询系统信息等操作；如图所示。
数据可视化分析大屏展示实现效果 旅游景区推荐系统展示图，如图所示。
在性别统计页面用饼状图进行展示所示。
在用户年龄分布统计页面用条形图进行展示所示。
六.部分功能代码 # 数据爬取文件 import scrapy import pymysql import pymssql from ..items import QingdaolvyouItem import time import re import random import platform import json import os from urllib.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-05T09:15:00+08:00">
    <meta property="article:modified_time" content="2024-02-05T09:15:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Python&#43;大数据的旅游景区推荐系统设计与实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>💗博主介绍：✌全网粉丝10W+,CSDN全栈领域优质创作者，博客之星、掘金/华为云/阿里云等平台优质作者。<br> 👇🏻 精彩专栏 推荐订阅👇🏻<br> <a href="https://blog.csdn.net/qq_15801219/category_11466472.html">计算机毕业设计精品项目案例-200套</a><br> 🌟<strong>文末获取源码+数据库+文档</strong>🌟<br> 感兴趣的可以先收藏起来，还有大家在毕设选题，项目以及论文编写等相关问题都可以和学长沟通，希望帮助更多的人</p> 
</blockquote> 
<h3><a id="_5"></a>一.前言</h3> 
<p><img src="https://images2.imgbox.com/5a/d2/FktOp6pM_o.png" alt="在这里插入图片描述"><br> 近些年来，随着科技的飞速发展，互联网的普及逐渐延伸到各行各业中，给人们生活带来了十分的便利，旅游景区推荐系统利用计算机网络实现信息化管理，使整个旅游景区推荐的发展和服务水平有显著提升。<br> 本文拟采用PyCharm开发工具，Python语言、Django框架进行开发，后台使用MySQL数据库进行信息管理，设计开发的旅游景区推荐系统。通过调研和分析，系统拥有管理员和用户两个角色，主要具备注册登录、个人信息修改、用户、景点分类、景点信息、旅游景区等功能模块。将纸质管理有效实现为在线管理，极大提高工作效率。</p> 
<hr> 
<h3><a id="_13"></a>二.技术环境</h3> 
<p>开发语言：Python<br> python框架：django<br> 软件版本：python3.7/python3.8<br> 数据库：mysql 5.7或更高版本<br> 数据库工具：Navicat11<br> 爬虫框架：Scrapy<br> 开发软件：PyCharm/vs code<br> 前端框架:vue.js</p> 
<hr> 
<h3><a id="_25"></a>三.功能设计</h3> 
<p>系统用例图如图3-1、图3-2、图3-3、图3-4所示。</p> 
<p><img src="https://images2.imgbox.com/d5/d3/85FIpaSu_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/96/76/YT5emkV4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0f/9e/i0lWpe4g_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/73/54/hqw7uBNj_o.png" alt="在这里插入图片描述"></p> 
<p>系统功能结构图是系统设计阶段，系统功能结构图只是这个阶段一个基础，整个系统的架构决定了系统的整体模式，是系统的根据。本系统的整个设计结构如图所示。<br> <img src="https://images2.imgbox.com/7a/8e/0nHaXxLa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_41"></a>四.数据设计</h3> 
<p>概念模型的设计是为了抽象真实世界的信息，并对信息世界进行建模。它是数据库设计的强大工具。数据库概念模型设计可以通过E-R图描述现实世界的概念模型。系统的E-R图显示了系统中实体之间的链接。而且Mysql数据库是自我保护能力比较强的数据库，下图主要是对数据库实体的E-R图：<br> <img src="https://images2.imgbox.com/b1/8b/nlGWS41U_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/bf/17/BpySrfFo_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_49"></a>五.部分效果展示</h3> 
<h4><a id="_51"></a>系统前台功能实现效果</h4> 
<p>当游客打开系统的网址后，首先看到的就是首页界面。在这里，游客能够看到旅游景区推荐系统的导航条显示首页、景点信息、旅游景区、景点资讯、个人中心。系统首页界面如图所示：<br> <img src="https://images2.imgbox.com/6a/b5/cab3QoE4_o.png" alt="在这里插入图片描述"></p> 
<p>在系统首页点击中间的注册/登录按钮，然后页面跳转到注册登录界面，后来输入信息完成后，单击注册或者登录操作，如图所示：</p> 
<p><img src="https://images2.imgbox.com/67/4c/XoyK51MY_o.png" alt="在这里插入图片描述"></p> 
<p>用户点击景点信息，在景点信息页面的搜索栏输入景点名称、景点分类、景点星级、景点地址，进行查询，然后可以查看景点名称、景点分类、景点星级、景点图片、景点地址、营业时间、咨询热线，还可以对景点信息进行收藏或者评论操作；如图所示：</p> 
<p><img src="https://images2.imgbox.com/fc/71/z2kCcFuC_o.png" alt="在这里插入图片描述"></p> 
<p>景点资讯；在景点资讯页面查看标题、内容、发布时间等信息进行详细操作，如图所示：<br> <img src="https://images2.imgbox.com/d3/78/SZJb3Is7_o.png" alt="在这里插入图片描述"></p> 
<p>在个人中心页面可以输入个人详细信息，进行信息更新操作，还可以对我的收藏进行详细操作，如图所示：<br> <img src="https://images2.imgbox.com/2e/ca/ErLxY6xO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_78"></a>系统管理员功能实现效果</h4> 
<p>管理员登录，通过登录页面填写用户名和密码等信息，点击登录操作，如图所示。</p> 
<p><img src="https://images2.imgbox.com/50/3b/P0MaggQJ_o.png" alt="在这里插入图片描述"></p> 
<p>管理员登录进入系统可以查看系统首页、个人中心、用户管理、景点分类管理、景点信息管理、旅游景区管理、系统管理等功能，进行详细操作，如图所示。</p> 
<p><img src="https://images2.imgbox.com/4d/71/gU1T8vKi_o.png" alt="在这里插入图片描述"></p> 
<p>管理员点击用户管理；在用户管理页面输入用户名、姓名、性别、头像、年龄、手机等信息，进行查询，新增或删除用户信息等操作；如图所示。</p> 
<p><img src="https://images2.imgbox.com/f1/68/j1lMESkM_o.png" alt="在这里插入图片描述"></p> 
<p>管理员点击景点信息管理；在景点信息管理页面输入景点名称、景点分类、景点星级、景点图片、景点地址、营业时间、咨询热线等信息，进行查询、新增或删除景点信息等操作；如图所示。<br> <img src="https://images2.imgbox.com/09/d1/evlgnB1H_o.png" alt="在这里插入图片描述"></p> 
<p>管理员点击旅游景区管理；在旅游景区管理页面对标题、封面、位置、价格、点评、评论等信息，进行查询或删除旅游景区等操作；如图所示。<br> <img src="https://images2.imgbox.com/24/e3/VviGDcLg_o.png" alt="在这里插入图片描述"></p> 
<p>管理员点击系统管理；在系统管理页面对系统简介、轮播图管理、景点资讯等信息，进行查询系统信息等操作；如图所示。</p> 
<p><img src="https://images2.imgbox.com/2c/b4/dS11VpYr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_110"></a>数据可视化分析大屏展示实现效果</h4> 
<p>旅游景区推荐系统展示图，如图所示。</p> 
<p><img src="https://images2.imgbox.com/52/40/MuKSxffU_o.png" alt="在这里插入图片描述"></p> 
<p>在性别统计页面用饼状图进行展示所示。<br> <img src="https://images2.imgbox.com/5f/2f/IrUbllNe_o.png" alt="在这里插入图片描述"></p> 
<p>在用户年龄分布统计页面用条形图进行展示所示。</p> 
<p><img src="https://images2.imgbox.com/d5/2d/v0C1OtMe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_130"></a>六.部分功能代码</h3> 
<pre><code class="prism language-python"><span class="token comment"># 数据爬取文件</span>

<span class="token keyword">import</span> scrapy
<span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> pymssql
<span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>items <span class="token keyword">import</span> QingdaolvyouItem
<span class="token keyword">import</span> time
<span class="token keyword">import</span> re
<span class="token keyword">import</span> random
<span class="token keyword">import</span> platform
<span class="token keyword">import</span> json
<span class="token keyword">import</span> os
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> emoji

<span class="token comment"># 旅游票务</span>
<span class="token keyword">class</span> <span class="token class-name">QingdaolvyouSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'qingdaolvyouSpider'</span>
    spiderUrl <span class="token operator">=</span> <span class="token string">'https://piao.qunar.com/ticket/list.htm?keyword=%E9%9D%92%E5%B2%9B&amp;region=%E9%9D%92%E5%B2%9B&amp;from=mpshouye_hotcity&amp;page={}'</span>
    start_urls <span class="token operator">=</span> spiderUrl<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span>
    protocol <span class="token operator">=</span> <span class="token string">''</span>
    hostname <span class="token operator">=</span> <span class="token string">''</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"cookie"</span><span class="token punctuation">:</span><span class="token string">"SECKEY_ABVK=vlhpRLsLQG31Po7dyp9LqZqIVWCqTw4N5fBZ1DsuytI%3D; BMAP_SECKEY=fYAVeumEoDJpvS6t9mUnIfl7ylS6g05LSr9A_ZA18UssrV2x9Nvb--l3q9TLiknfzexlawoBsTebfVGIHzfyqOYfo51s-Ty6bZN2gB7dr1ALnVPRdfYiZs3FsCl2tC0PoI6DkXokTEOHVASpbWqBKuvneDEGUXxubzmT6qyM8jikWfPePl74wseQQxqH3SH3; QN1=00008c0031984ca726d0ccdd; HN1=v1d5a05c0541e94af107a046147dde57e6; HN2=qungnknsnqczr; QN300=s%3Dbaidu; _i=DFiEuMlwNifDZ7e6ttNii8l8C0yw; QN269=3C0E7D80A48D11EDA4E6FA163E7C276C; fid=c122ef21-269d-44af-816b-a3af77b6e9a0; ctt_june=1654604625968##iK3wWsjmahPwawPwa%3DXNWK0GE2GIaRkTESWRa%3Da8aDkGES0REDPsXPWGWKj8iK3siK3saKj%2BWKPnWsj%2BaSjnVuPwaUvt; ctf_june=1654604625968##iK3wVRtnahPwawPwasWGa%3DasWK2naS2%3DaSETVPDmWSXNWSvmXSWGX%3DPOVRDniK3siK3saKj%2BWKPnWsjmaSj%3DWwPwaUvt; cs_june=a4e7c8acd60e0c8483c9c4af0f303f81fd7bf3054fa1059b680a62984007c656679c337a756eb8f3b21f18c3ca84c016ab0131ff331f4cb4e98fa22f3456d33eb17c80df7eee7c02a9c1a6a5b97c117961a58ae707d2d19d229b1e3a0abd1ac65a737ae180251ef5be23400b098dd8ca; qunar-assist={%22version%22:%2220211215173359.925%22%2C%22show%22:false%2C%22audio%22:false%2C%22speed%22:%22middle%22%2C%22zomm%22:1%2C%22cursor%22:false%2C%22pointer%22:false%2C%22bigtext%22:false%2C%22overead%22:false%2C%22readscreen%22:false%2C%22theme%22:%22default%22}; QN205=organic; QN277=organic; csrfToken=CHPGSBwmGivAQIY68e9qdAdiTV3ndNSv; QN57=16773851843530.3742666257450069; Hm_lvt_15577700f8ecddb1a927813c81166ade=1677385185; QN267=9396775017807b72f; _vi=kLcz4BXbLA-Z_dmzAME0UN9x6XaB-aiI3ZQP-imSw9FAo6neFHeLQ5sMT6sMGgFb5a8IfmLRa7vmEMF3xiAAC7OMS4j9DgEidNCIF7BZoBbk58pE_3MLJ42UlqZfLutL8q10pZv62VI2_1_qG1wdurlugFXSrwHiB_htc5SdZS6G; QN58=1677387675012%7C1677387675012%7C1; ariaDefaultTheme=undefined; Hm_lpvt_15577700f8ecddb1a927813c81166ade=1677387675; __qt=v1%7CVTJGc2RHVmtYMS9NUFFkYWJvb2FuMVkzNDhtbjNjU0lZQUhsdmlmeUlENW91YjBzZTdodm9FVGdOWTVFUzh6dnVJTFVtUDNVQjFMa1RRVy82NjZoTWRYY2NKcGIxMGlnZnhqOG9tMy9sYjdjbUthUGdQVC92T0U2RTNJR0lKaWc5elpiMzBpWGxJZ0o4UjlueEMvMmZnPT0%3D%7C1677387675401%7CVTJGc2RHVmtYMTlEUVJsa1RGdmswaFhyMXFlQkZOUnFvNCt0OGxtTGtjNWt4VzdmbDluZFBBZVdlRGptcTFJZXAyOXIxaFRqQk5RY0pCdms3bzkwRmc9PQ%3D%3D%7CVTJGc2RHVmtYMStqelpiM1RGUERkbHpQY1J2MHo5Nk9wcWYvRnlDOUxERUk4RVExOTllczRSNUlhSGxmUmlsRXpzdTBGN052RjVzVmRwcG4raFRQWHRUNXdhbFNyR1RLNU9iY0hRU1BMK05UaHRRUTcwbUwvbWdMeEI4RnY2Y3l3SlV2ZFBFTHZGV2tobVJlcG5aUXhyL3FPcHRkZmx0VXZtR3hoRUJxcjh1ZjBJcFZVS1l5RmQ4NC9Xa0VjbGoySEVZcG03S2pKVEVSaWlVVHU2Z2haTExReXJoOFAvN3pKOUJjWnBQZmJSVWxsUk9Yd0tCZk53Uk9wSXZ0Z29LNTdSN3JrSHV1MFlZc20xdWxkQVZ6bUx3THBLcEcwNDhiRGhSNHlpWngrU01uVG10YjFKMC9jb2VtSmI3ajlkRDAzd3VLcTBNVGY4R0FBQTd1SlozdWpPMkVFdDRBT0l1UVVsblpJbXdXSXI3eWRSZG4vMnNkK00wR0xSU2JxZU8zNlROU2xQcGQxVkNKT3ZQK1diaVA3NzZjeHpObkE2bnRhTG52R3FqaStkQkN5UVpQaTd3amwySVlvaEtXdGlNcjByQWNzRHo0Njd2TzJlVFVaaVdla1U5RUIzRU5veFJCWXZkU2haYUpyeHRjY0t2M3pOd0U2a0JsM2pnakRZbCtTVE12QWNpR0dXS2Z6T3oxNVoxeHBXVzVSeEUzNU1OZ2Ezc2RKcFg1STVHWkZvL0ZHMWtIS0doRDlpQnNWK0Y5UkxnaklCc2p5alZFdTRxaEVsVkdjQThNV1N0L29QaVBmR3l2RDRneHNVUUhMU3ZOdnVlMi8rb3VaeWFFcm9VUDh1T1NiZURBblVCSHJkNjlDSU1QbUdJcTNvbWpUb0tJNFE0cUZLSDI4ckw5bmpCSjFtK1Q0ZVRXWml6aDgrWWx1VU9SMnJkVUFHVmVtSmhGZHJ0RWI4TFp2eUVPSFZLalB1M29WcVlSb1oxQXZTVWhESW5ycVhnek4wSjNTYjNnRFNNK2JObXlVTXRpcFhiUEh2SkRzenMzSWdsdi9xOE9QeHI4VFRiUHdoZDFIWUlFL0E0SVVtL2NjdFlMY0hhNQ%3D%3D; JSESSIONID=F90B651C1C838D80BE882B24C9D63F8A; QN271=217bc6aa-758f-4cb5-8d18-a95283b08907"</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        plat <span class="token operator">=</span> platform<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> plat <span class="token operator">==</span> <span class="token string">'linux'</span> <span class="token keyword">or</span> plat <span class="token operator">==</span> <span class="token string">'windows'</span><span class="token punctuation">:</span>
            connect <span class="token operator">=</span> self<span class="token punctuation">.</span>db_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> connect<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>table_exists<span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> <span class="token string">'2o7ww_qingdaolvyou'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                connect<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>temp_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>

        pageNum <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> self<span class="token punctuation">.</span>start_urls<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'{}'</span> <span class="token keyword">in</span> url<span class="token punctuation">:</span>
                <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pageNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    next_link <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
                    <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                        url<span class="token operator">=</span>next_link<span class="token punctuation">,</span>
                        headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span>
                        callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse
                    <span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>
                    url<span class="token operator">=</span>url<span class="token punctuation">,</span>
                    callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse
                <span class="token punctuation">)</span>

    <span class="token comment"># 列表解析</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        _url <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>self<span class="token punctuation">.</span>spiderUrl<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>protocol <span class="token operator">=</span> _url<span class="token punctuation">.</span>scheme
        self<span class="token punctuation">.</span>hostname <span class="token operator">=</span> _url<span class="token punctuation">.</span>netloc
        plat <span class="token operator">=</span> platform<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> plat <span class="token operator">==</span> <span class="token string">'windows_bak'</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">elif</span> plat <span class="token operator">==</span> <span class="token string">'linux'</span> <span class="token keyword">or</span> plat <span class="token operator">==</span> <span class="token string">'windows'</span><span class="token punctuation">:</span>
            connect <span class="token operator">=</span> self<span class="token punctuation">.</span>db_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
            cursor <span class="token operator">=</span> connect<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>table_exists<span class="token punctuation">(</span>cursor<span class="token punctuation">,</span> <span class="token string">'2o7ww_qingdaolvyou'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                connect<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>temp_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>

        <span class="token builtin">list</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'div#search-list div[class~="sight_item"]'</span><span class="token punctuation">)</span>
        
        <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>

            fields <span class="token operator">=</span> QingdaolvyouItem<span class="token punctuation">(</span><span class="token punctuation">)</span>



            fields<span class="token punctuation">[</span><span class="token string">"laiyuan"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>item<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'h3.sight_item_caption a.name::attr(href)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            fields<span class="token punctuation">[</span><span class="token string">"jiage"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>item<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'span.sight_item_price em::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            detailUrlRule <span class="token operator">=</span> item<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'h3.sight_item_caption a.name::attr(href)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>protocol <span class="token keyword">in</span> detailUrlRule<span class="token punctuation">:</span>
                <span class="token keyword">pass</span>
            <span class="token keyword">elif</span> detailUrlRule<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'//'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                detailUrlRule <span class="token operator">=</span> self<span class="token punctuation">.</span>protocol <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> detailUrlRule
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                detailUrlRule <span class="token operator">=</span> self<span class="token punctuation">.</span>protocol <span class="token operator">+</span> <span class="token string">'://'</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>hostname <span class="token operator">+</span> detailUrlRule
                fields<span class="token punctuation">[</span><span class="token string">"laiyuan"</span><span class="token punctuation">]</span> <span class="token operator">=</span> detailUrlRule

            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>detailUrlRule<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'fields'</span><span class="token punctuation">:</span> fields<span class="token punctuation">}</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>detail_parse<span class="token punctuation">)</span>


    <span class="token comment"># 详情解析</span>
    <span class="token keyword">def</span> <span class="token function">detail_parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fields <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'fields'</span><span class="token punctuation">]</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''div.mp-description-detail div.mp-description-view span.mp-description-name::text'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"biaoti"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''div.mp-description-detail div.mp-description-view span.mp-description-name::text'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'biaoti'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'biaoti'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'biaoti'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'biaoti'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"biaoti"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-description-detail div.mp-description-view span.mp-description-name::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"biaoti"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-description-detail div.mp-description-view span.mp-description-name::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''div#mp-slider-content div.mp-description-image img::attr(src)'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"fengmian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''div#mp-slider-content div.mp-description-image img::attr(src)'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'fengmian'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'fengmian'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'fengmian'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'fengmian'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"fengmian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div#mp-slider-content div.mp-description-image img::attr(src)'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"fengmian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div#mp-slider-content div.mp-description-image img::attr(src)'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''div.mp-description-onesentence::text'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"miaoshu"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''div.mp-description-onesentence::text'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'miaoshu'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'miaoshu'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'miaoshu'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'miaoshu'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"miaoshu"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-description-onesentence::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"miaoshu"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-description-onesentence::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''span.mp-description-address::text'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"weizhi"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''span.mp-description-address::text'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'weizhi'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'weizhi'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'weizhi'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'weizhi'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"weizhi"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span.mp-description-address::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"weizhi"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span.mp-description-address::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''span#mp-description-commentscore'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"dianping"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''span#mp-description-commentscore'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'dianping'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'dianping'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'dianping'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'dianping'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"dianping"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span#mp-description-commentscore'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"dianping"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span#mp-description-commentscore'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''span.mp-description-commentCount a::text'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"pinglun"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''span.mp-description-commentCount a::text'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'pinglun'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'pinglun'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'pinglun'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'pinglun'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"pinglun"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span.mp-description-commentCount a::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"pinglun"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''span.mp-description-commentCount a::text'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''div.mp-charact-intro div.mp-charact-desc'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"tese"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''div.mp-charact-intro div.mp-charact-desc'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'tese'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'tese'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'tese'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'tese'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"tese"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-charact-intro div.mp-charact-desc'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"tese"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-charact-intro div.mp-charact-desc'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>


        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'(.*?)'</span> <span class="token keyword">in</span> <span class="token triple-quoted-string string">'''div.mp-charact-content div.mp-charact-desc'''</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span><span class="token string">"kaifangshijian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token triple-quoted-string string">r'''div.mp-charact-content div.mp-charact-desc'''</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'kaifangshijian'</span> <span class="token operator">!=</span> <span class="token string">'xiangqing'</span> <span class="token keyword">and</span> <span class="token string">'kaifangshijian'</span> <span class="token operator">!=</span> <span class="token string">'detail'</span> <span class="token keyword">and</span> <span class="token string">'kaifangshijian'</span> <span class="token operator">!=</span> <span class="token string">'pinglun'</span> <span class="token keyword">and</span> <span class="token string">'kaifangshijian'</span> <span class="token operator">!=</span> <span class="token string">'zuofa'</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"kaifangshijian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_html<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-charact-content div.mp-charact-desc'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    fields<span class="token punctuation">[</span><span class="token string">"kaifangshijian"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emoji<span class="token punctuation">.</span>demojize<span class="token punctuation">(</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''div.mp-charact-content div.mp-charact-desc'''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>




        <span class="token keyword">return</span> fields

    <span class="token comment"># 去除多余html标签</span>
    <span class="token keyword">def</span> <span class="token function">remove_html</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> html <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
        pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;[^&gt;]+&gt;'</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pattern<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 数据库连接</span>
    <span class="token keyword">def</span> <span class="token function">db_connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">type</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'TYPE'</span><span class="token punctuation">,</span> <span class="token string">'mysql'</span><span class="token punctuation">)</span>
        host <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'HOST'</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
        port <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'PORT'</span><span class="token punctuation">,</span> <span class="token number">3306</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        user <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'USER'</span><span class="token punctuation">,</span> <span class="token string">'root'</span><span class="token punctuation">)</span>
        password <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'PASSWORD'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            database <span class="token operator">=</span> self<span class="token punctuation">.</span>databaseName
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            database <span class="token operator">=</span> self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'DATABASE'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">'mysql'</span><span class="token punctuation">:</span>
            connect <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">,</span> db<span class="token operator">=</span>database<span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span> passwd<span class="token operator">=</span>password<span class="token punctuation">,</span> charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            connect <span class="token operator">=</span> pymssql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span>host<span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">,</span> database<span class="token operator">=</span>database<span class="token punctuation">)</span>

        <span class="token keyword">return</span> connect

    <span class="token comment"># 断表是否存在</span>
    <span class="token keyword">def</span> <span class="token function">table_exists</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cursor<span class="token punctuation">,</span> table_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"show tables;"</span><span class="token punctuation">)</span>
        tables <span class="token operator">=</span> <span class="token punctuation">[</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        table_list <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'(\'.*?\')'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>tables<span class="token punctuation">)</span><span class="token punctuation">)</span>
        table_list <span class="token operator">=</span> <span class="token punctuation">[</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>each<span class="token punctuation">)</span> <span class="token keyword">for</span> each <span class="token keyword">in</span> table_list<span class="token punctuation">]</span>

        <span class="token keyword">if</span> table_name <span class="token keyword">in</span> table_list<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>

    <span class="token comment"># 数据缓存源</span>
    <span class="token keyword">def</span> <span class="token function">temp_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

        connect <span class="token operator">=</span> self<span class="token punctuation">.</span>db_connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cursor <span class="token operator">=</span> connect<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sql <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
            insert into qingdaolvyou(
                laiyuan
                ,biaoti
                ,fengmian
                ,miaoshu
                ,weizhi
                ,dianping
                ,pinglun
                ,jiage
                ,tese
                ,kaifangshijian
            )
            select
                laiyuan
                ,biaoti
                ,fengmian
                ,miaoshu
                ,weizhi
                ,dianping
                ,pinglun
                ,jiage
                ,tese
                ,kaifangshijian
            from 2o7ww_qingdaolvyou
            where(not exists (select
                laiyuan
                ,biaoti
                ,fengmian
                ,miaoshu
                ,weizhi
                ,dianping
                ,pinglun
                ,jiage
                ,tese
                ,kaifangshijian
            from qingdaolvyou where
             qingdaolvyou.laiyuan=2o7ww_qingdaolvyou.laiyuan
            and qingdaolvyou.biaoti=2o7ww_qingdaolvyou.biaoti
            and qingdaolvyou.fengmian=2o7ww_qingdaolvyou.fengmian
            and qingdaolvyou.miaoshu=2o7ww_qingdaolvyou.miaoshu
            and qingdaolvyou.weizhi=2o7ww_qingdaolvyou.weizhi
            and qingdaolvyou.dianping=2o7ww_qingdaolvyou.dianping
            and qingdaolvyou.pinglun=2o7ww_qingdaolvyou.pinglun
            and qingdaolvyou.jiage=2o7ww_qingdaolvyou.jiage
            and qingdaolvyou.tese=2o7ww_qingdaolvyou.tese
            and qingdaolvyou.kaifangshijian=2o7ww_qingdaolvyou.kaifangshijian
            ))
            limit {0}
        '''</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        connect<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

        connect<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>



</code></pre> 
<h3><a id="_440"></a>最后</h3> 
<p><a href="https://yidianbishe.blog.csdn.net/article/details/131622291" rel="nofollow">最新计算机毕业设计选题篇-选题推荐（值得收藏）</a><br> <a href="https://blog.csdn.net/qq_15801219/category_11466472.html">计算机毕业设计精品项目案例-200套（值得订阅）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/14dfd217292319744b643271df6794ce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RabbitMQ之交换机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5b3c97e092b1d2f472433ab9b98734a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【报错记录】The project is using an incompatible version (AGP 8.3.0-alpha01) of the Android Gradle plugin.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>