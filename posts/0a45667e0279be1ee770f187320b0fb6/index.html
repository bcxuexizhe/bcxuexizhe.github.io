<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python安卓自动化pyaibote实践------学习通自动刷课 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/0a45667e0279be1ee770f187320b0fb6/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="python安卓自动化pyaibote实践------学习通自动刷课">
  <meta property="og:description" content="前言 欢迎来到我的博客
个人主页:北岭敲键盘的荒漠猫-CSDN博客
本文是一个完成一个自动播放课程，避免人为频繁点击脚本的构思与源码。
加油！为实现全部电脑自动化办公而奋斗！
为实现摆烂躺平的人生而奋斗！！！
环境描述 aibote,雷电模拟器,学习通,python3.12,pyaibote框架。
环境不会搭建可以看我这篇博客:pyaibote--安卓自动化环境配置与基础的使用方法_aibote链接手机-CSDN博客
成品代码 from PyAibote import AndroidBotMain import time # 2. 自定义一个脚本类，继承 AndroidBotMain class CustomAndroidScript(AndroidBotMain): #初始化配置 Log_Level = &#34;DEBUG&#34; Log_Storage = True def start_xuexitong(self): #打开学习通，进入看课区域 result = self.start_app(&#34;学习通&#34;, 5, 0.5) print(&#34;app运行状态:{}&#34;.format(result)) place=self.get_element_rect(&#34;com.chaoxing.mobile/com.chaoxing.mobile:id=tabButton[3]&#34;, 15, 0.5) self.click((place)) print(&#34;点击任务状态:{}&#34;.format(place)) place=self.get_element_rect(&#34;com.chaoxing.mobile/com.chaoxing.mobile:id=myCourse&#34;, 15, 0.5) self.click((place)) print(&#34;点击任务状态:{}&#34;.format(place)) def select_class(self): #选择目标课程，并且判断是否有课程 self.my_class=input(&#34;输入想要刷课的名称:&#34;) result = self.init_ocr_server(&#34;127.0.0.1&#34;, False, False, False) print(&#34;初始化状态:{}&#34;.format(result)) result = self.get_text() print(result) if self.my_class in result: print(&#34;发现目标课程&#34;) result = self.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-03T13:21:01+08:00">
    <meta property="article:modified_time" content="2024-05-03T13:21:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python安卓自动化pyaibote实践------学习通自动刷课</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <h2 style="text-align:center;"><span style="color:#faa572;"><strong>前言</strong></span></h2> 
 <p style="text-align:center;"><span style="color:#9c8ec1;">欢迎来到我的博客</span></p> 
 <p style="text-align:center;"><span style="color:#6eaad7;">个人主页:</span><a href="https://blog.csdn.net/2302_79590880?spm=1000.2115.3001.5343" title="北岭敲键盘的荒漠猫-CSDN博客">北岭敲键盘的荒漠猫-CSDN博客</a></p> 
 <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/bc/91/eFxTQgVo_o.png"></p> 
</blockquote> 
<p style="text-align:center;">本文是一个完成一个自动播放课程，避免人为频繁点击脚本的构思与源码。</p> 
<p style="text-align:center;">加油！为实现全部电脑自动化办公而奋斗！</p> 
<p style="text-align:center;">为实现摆烂躺平的人生而奋斗！！！</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0d/4a/uAFuXJ3c_o.gif"></p> 
<h2> 环境描述</h2> 
<p>aibote,雷电模拟器,学习通,python3.12,pyaibote框架。</p> 
<p>环境不会搭建可以看我这篇博客:<a href="https://blog.csdn.net/2302_79590880/article/details/138261789?spm=1001.2014.3001.5501" title="pyaibote--安卓自动化环境配置与基础的使用方法_aibote链接手机-CSDN博客">pyaibote--安卓自动化环境配置与基础的使用方法_aibote链接手机-CSDN博客</a></p> 
<p></p> 
<h2>成品代码</h2> 
<pre><code class="language-python">from PyAibote import AndroidBotMain
import time

# 2. 自定义一个脚本类，继承 AndroidBotMain
class CustomAndroidScript(AndroidBotMain):
    #初始化配置
    Log_Level = "DEBUG"
    Log_Storage = True
    def start_xuexitong(self):
        #打开学习通，进入看课区域
        result = self.start_app("学习通", 5, 0.5)
        print("app运行状态:{}".format(result))
        place=self.get_element_rect("com.chaoxing.mobile/com.chaoxing.mobile:id=tabButton[3]", 15, 0.5)
        self.click((place))
        print("点击任务状态:{}".format(place))
        place=self.get_element_rect("com.chaoxing.mobile/com.chaoxing.mobile:id=myCourse", 15, 0.5)
        self.click((place))
        print("点击任务状态:{}".format(place))

    def select_class(self):
        #选择目标课程，并且判断是否有课程
        self.my_class=input("输入想要刷课的名称:")
        result = self.init_ocr_server("127.0.0.1", False, False, False)
        print("初始化状态:{}".format(result))
        result = self.get_text()
        print(result)
        if self.my_class in result:
            print("发现目标课程")
            result = self.find_text(self.my_class)
            print(result)
            self.click(result)
            time.sleep(1)

    def look_class(self):
        #观看课程
        self.current_class=float(input("(示例:2.3)\n输入你当前刷课进度：")) #当前的课程
        self.show_first_class()
        while True:
            self.cut_class()
            print("start look class")
            time.sleep(2)
            result = self.find_text("视频")
            print(result)
            self.click(result)
            time.sleep(3)
            self.ago_now()

    def ago_now(self):
        #判断课程是否看过
        result=self.find_text("任务点已完成")
        if result==():
            result = self.get_element_rect("com.chaoxing.mobile/android.widget.Button@text=播放", 5, 0.5)
            self.click(result)
            time.sleep(3)
            #判断是否看完
            i=1
            while i==1:
                time.sleep(5)
                outline=self.element_exists("com.chaoxing.mobile/android.widget.Button@text=重试", 1, 0.5)
                if outline: #判断是否断网
                    self.click_element("com.chaoxing.mobile/android.widget.Button@text=重试", 1, 0.5)
                result = self.element_exists("com.chaoxing.mobile/com.chaoxing.mobile:id=start", 1, 0.5)
                if result: #判断是否看完
                    self.back()
                    time.sleep(2)
                    result=self.find_text("任务点已完成")
                    if result!=():
                        break
                    else:
                        self.click_element("com.chaoxing.mobile/android.widget.Button@text=播放", 1, 0.5)
        self.back()

    def cut_class(self):
        #看完课程更替视频
        self.infor_dispose()
        while True:
            #匹配课程
            print(self.current_class)
            result = self.element_exists("com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
            print("当前课程的状态:{}".format(result))
            if result==True: #如果存在课程,就点击进入课程
                result=self.click_element("com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
                self.current_class += 0.1  # 转换到下一门课
                break
            else: #如果不存在，下滑一下屏幕再匹配。
                print("屏幕未找到对应元素，正在执行下滑操作")
                self.swipe((306, 1116), (306, 750), 1)
                result = self.element_exists(
                    "com.chaoxing.mobile/android.widget.TextView@text={:.1f}".format(self.current_class), 5, 0.5)
                print("下滑后匹配元素状态:{}".format(result))
                if result: #如果匹配到了进入
                    self.click_element(
                        "com.chaoxing.mobile/android.widget.TextView@text={:.1f}".format(self.current_class), 5, 0.5)
                    self.current_class += 0.1  # 转换到下一门课
                    break
                else: #匹配不到可能是转换章节
                    self.current_class+=1
                    self.current_class-=(self.current_class%1)
                    self.current_class+=0.1
                    result = self.element_exists(
                        "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
                    if result: #转换章节后匹配到
                        self.click_element(
                            "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5,
                            0.5)
                        self.current_class += 0.1  # 转换到下一门课
                        break
                    else: #匹配不到的话
                        print("该课程已经刷完，或者程序出错。")
                        break

    def show_first_class(self):
        #防止第一个课程不在屏幕内
        result = self.element_exists(
            "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
        if result:
            print("初始化目标课程在屏幕内")
        else:
            for i in range(15):
                self.swipe((402, 1404), (402, 564), 2)
                result = self.element_exists(
                    "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 3, 0.5)
                if result:
                    break

    def infor_dispose(self):
        #解决python浮点不精准问题
        self.current_class=round(self.current_class,2)
        self.current_class_1=self.current_class%0.1
        if self.current_class_1==0:
            self.current_class=round(self.current_class,1)

    def script_main(self):
        #执行函数
        self.start_xuexitong()
        self.select_class()
        self.look_class()


if __name__ == '__main__':
    CustomAndroidScript.execute("0.0.0.0", 16678)</code></pre> 
<p></p> 
<h2>效果演示</h2> 
<p>因为我已经刷完了，所以他点进去后，发现任务已完成就退出来进行下一节了。</p> 
<p>他支持选择课程，定义开始课程节数，自动处理网络重连问题。</p> 
<div class="csdn-video-box"> 
 <iframe id="c8sZO7Ln-1714534427839" frameborder="0" src="https://live.csdn.net/v/embed/383869" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>安卓自动化演示</p> 
</div> 
<p></p> 
<h2>需求操作分析</h2> 
<p>我们先来分析一下学习通刷课的操作流程。</p> 
<p>开启APP</p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/f9/29/rFDVywrF_o.png" width="489"></p> 
<p>点击我，点击课程，然后从里面选取要刷的课。</p> 
<p><img alt="" height="44" src="https://images2.imgbox.com/71/2b/AIOPz5ZE_o.png" width="523"></p> 
<p><img alt="" height="207" src="https://images2.imgbox.com/af/cc/pXKn24OD_o.png" width="550"></p> 
<p></p> 
<p><img alt="" height="337" src="https://images2.imgbox.com/a3/53/OirAPAqJ_o.png" width="537"></p> 
<p>选好课程后，我们需要选择我们要从哪节开始刷。</p> 
<p><img alt="" height="507" src="https://images2.imgbox.com/f9/55/j2rv1TgZ_o.png" width="544"></p> 
<p>点进去后要点击视频切换到视频的页面</p> 
<p><img alt="" height="261" src="https://images2.imgbox.com/dc/f1/DMup781B_o.png" width="533"></p> 
<p>之后我们要判断这节有没有刷，刷完返回下一节，没刷就进去看。</p> 
<p><img alt="" height="357" src="https://images2.imgbox.com/07/14/DhAHzqK7_o.png" width="531"></p> 
<p>如果看的话，还要判断好是否结束了。还要应对中途可能发生的网络异常情况。</p> 
<p><img alt="" height="893" src="https://images2.imgbox.com/d2/42/bpm7G8pE_o.png" width="1200"></p> 
<p>识别到看完后，我们就要返回进入下一节以此类推</p> 
<p></p> 
<h2>代码解刨</h2> 
<h3>基本框架</h3> 
<p>首先是pyaibote的基本运行框架。</p> 
<p>我们把要执行的代码放到script_main中。</p> 
<pre><code class="language-python">  # 1. 导入 AndroidBotMain 类
  from PyAibote import AndroidBotMain
  import time
  
  
  
  # 2. 自定义一个脚本类，继承 AndroidBotMain
  class CustomAndroidScript(AndroidBotMain):
  
      # 2.1. 设置是否终端打印输出 DEBUG：输出， INFO：不输出, 默认打印输出
      Log_Level = "DEBUG" 
  
      # 2.2. 终端打印信息是否存储LOG文件 True： 储存， False：不存储
      Log_Storage = True  
  
  
      # 2.3. 注意：script_main 此方法是脚本执行入口必须存在此方法
      def script_main(self):
          # 显示手机最近任务列表
          result = self.recent_tasks()
          print(result)
  
  
  
  
  
  
  
  
  if __name__ == '__main__':
      # 3. 注意：此处监听的端口号，必须和手机端的脚本端口号一致
      # 3.1 监听 16678 号端口
      CustomAndroidScript.execute("0.0.0.0", 16678)</code></pre> 
<h3></h3> 
<h3>定义进入APP的方法</h3> 
<p>我们需要通过找元素，点击进入这个区域。</p> 
<p><img alt="" src="https://images2.imgbox.com/a5/7b/X1lAVu6J_o.png"></p> 
<pre><code class="language-python">    def start_xuexitong(self):
        #打开学习通，进入看课区域
        result = self.start_app("学习通", 5, 0.5)
        print("app运行状态:{}".format(result))
        place=self.get_element_rect("com.chaoxing.mobile/com.chaoxing.mobile:id=tabButton[3]", 15, 0.5)
        self.click((place))
        print("点击任务状态:{}".format(place))
        place=self.get_element_rect("com.chaoxing.mobile/com.chaoxing.mobile:id=myCourse", 15, 0.5)
        self.click((place))
        print("点击任务状态:{}".format(place))</code></pre> 
<p>通过这个方法来点进这个课程页面。</p> 
<p></p> 
<h3>定义选课方法</h3> 
<p>我们需要找到我们想要的课程，于是我们定义这个方法来找课程。</p> 
<pre><code class="language-python">    def select_class(self):
        #选择目标课程，并且判断是否有课程
        self.my_class=input("输入想要刷课的名称:")
        #初始化文字识别服务
        result = self.init_ocr_server("127.0.0.1", False, False, False)
        print("初始化状态:{}".format(result))
        #查找文本
        result = self.get_text()
        print(result)
        if self.my_class in result:#如果目标课程在里面就点击进入
            print("发现目标课程")
            result = self.find_text(self.my_class)
            print(result)
            self.click(result)
            time.sleep(1)</code></pre> 
<h3 style="background-color:transparent;">定义看课方法</h3> 
<p>选好课程后我们总要开始刷课吧。</p> 
<p>这个方法是用来看课相关的操作的。</p> 
<pre><code class="language-python">    def look_class(self):
        #观看课程
        self.current_class=float(input("(示例:2.3)\n输入你当前刷课进度：")) #当前的课程
        self.show_first_class() #自定义的滑动函数(防止开始刷课的节数不在屏幕中)
        while True: #循环执行
            self.cut_class() #自定义切换方法，用来判断当前应该看哪节课，并点进去
            print("start look class")
            time.sleep(2) #防止未加载出页面就文字识别导致错误
            result = self.find_text("视频")#识别文字
            print(result)
            self.click(result) #点击视频进去视频页面
            time.sleep(3)
            self.ago_now() #自定义函数，判断这节课是否刷完</code></pre> 
<h3>定义滑动方法</h3> 
<p>因为我们有可以自定义开始刷课节数的功能，那么我们可能会遇到这个节数不在屏幕中会下滑的情况，这个方法就是判断并且识别这种情况的。</p> 
<pre><code class="language-python">    def show_first_class(self):
        #防止第一个课程不在屏幕内
        result = self.element_exists(
            "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
        if result: #判断屏幕中是否有这个课程的元素
            print("初始化目标课程在屏幕内")
        else: #如果没有
            for i in range(15): #下拉寻找
                self.swipe((402, 1404), (402, 564), 2)
                result = self.element_exists(
                    "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 3, 0.5)
                if result: #如果该目标进入了屏幕就退出循环
                    break
</code></pre> 
<h3>定义切换，判断当前课程是否刷完的方法</h3> 
<p>第一我们要点进去这节课，</p> 
<p>第二我们还要根据他的元素text1.1这类的章节数，来找下一节课，</p> 
<p>最后我们计算机会有浮点计算偏差，但是课程就是1.1,2.2。最后的结果不能出现偏差，所以我们要把结果转化为正确无偏差的。</p> 
<pre><code class="language-python">    def cut_class(self):
        #看完课程更替视频
        self.infor_dispose() #自定义方法解决计算机浮点计算偏差问题
        while True:
            #匹配课程
            print(self.current_class)
            result = self.element_exists("com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
            print("当前课程的状态:{}".format(result))
            if result==True: #如果存在课程,就点击进入课程
                result=self.click_element("com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
                self.current_class += 0.1  # 转换到下一门课
                break
            else: #如果不存在，下滑一下屏幕再匹配。
                print("屏幕未找到对应元素，正在执行下滑操作")
                self.swipe((306, 1116), (306, 750), 1)
                result = self.element_exists(
                    "com.chaoxing.mobile/android.widget.TextView@text={:.1f}".format(self.current_class), 5, 0.5)
                print("下滑后匹配元素状态:{}".format(result))
                if result: #如果匹配到了进入
                    self.click_element(
                        "com.chaoxing.mobile/android.widget.TextView@text={:.1f}".format(self.current_class), 5, 0.5)
                    self.current_class += 0.1  # 转换到下一门课
                    break
                else: #匹配不到可能是转换章节
                    self.current_class+=1
                    self.current_class-=(self.current_class%1)
                    self.current_class+=0.1
                    result = self.element_exists(
                        "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5, 0.5)
                    if result: #转换章节后匹配到
                        self.click_element(
                            "com.chaoxing.mobile/android.widget.TextView@text={}".format(self.current_class), 5,
                            0.5)
                        self.current_class += 0.1  # 转换到下一门课
                        break
                    else: #匹配不到的话
                        print("该课程已经刷完，或者程序出错。")
                        break</code></pre> 
<h3>定义去除偏差方法</h3> 
<p>python浮点数加减其实会有一个很小偏差。</p> 
<p>比如1.1+0.1=1.2000000002。</p> 
<p>但是我们下一节就是1.2这样会出错。</p> 
<p>于是我们用下面方法来四舍五入到我们规定的格式。</p> 
<p>保留两位小数，如果利用取余判断小数第二位是否为0。</p> 
<p>为0保留一位，不为0保留两位。</p> 
<pre><code class="language-python">    def infor_dispose(self):
        #解决python浮点不精准问题
        self.current_class=round(self.current_class,2)
        self.current_class_1=self.current_class%0.1
        if self.current_class_1==0:
            self.current_class=round(self.current_class,1)</code></pre> 
<h3 style="background-color:transparent;">定义判断这节该不该刷，以及刷完退出的方法</h3> 
<p>我们肯定不能刷刷过的课浪费大量时间，这就需要我们加一个判定。</p> 
<p>循环前是进行判断，有没有那个任务点已完成。</p> 
<p>后面是刷课结束以及判断是否断网。</p> 
<pre><code class="language-python">    def ago_now(self):
        #判断课程是否看过
        result=self.find_text("任务点已完成")
        if result==():
            result = self.get_element_rect("com.chaoxing.mobile/android.widget.Button@text=播放", 5, 0.5)
            self.click(result)
            time.sleep(3)
            #判断是否看完
            i=1
            while i==1:
                time.sleep(5)
                outline=self.element_exists("com.chaoxing.mobile/android.widget.Button@text=重试", 1, 0.5)
                if outline: #判断是否断网
                    self.click_element("com.chaoxing.mobile/android.widget.Button@text=重试", 1, 0.5)
                result = self.element_exists("com.chaoxing.mobile/com.chaoxing.mobile:id=start", 1, 0.5)
                if result: #判断是否看完
                    self.back()
                    time.sleep(2)
                    result=self.find_text("任务点已完成")
                    if result!=():
                        break
                    else:
                        self.click_element("com.chaoxing.mobile/android.widget.Button@text=播放", 1, 0.5)
        self.back()</code></pre> 
<h3>最后组装方法</h3> 
<p>在执行方法中拼凑方法。</p> 
<p>主要的方法是三大步骤。</p> 
<p>进入，选课，以及刷课</p> 
<pre><code class="language-python">    def script_main(self):
        #执行函数
        self.start_xuexitong()
        self.select_class()
        self.look_class()</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/91/10/ywIOX1t2_o.gif"></p> 
<h2 style="text-align:center;"><span style="color:#faa572;">总结</span></h2> 
<p style="text-align:center;"><span style="color:#0d0016;">以上就是整个刷课脚本的实现流程与代码，可以为我点一个赞吗。</span></p> 
<p style="text-align:center;"><span style="color:#0d0016;"><img alt="" src="https://images2.imgbox.com/3d/59/GMjShJ6A_o.gif"></span></p> 
<p>更新日志：</p> 
<p>5.3：ago_now方法存在逻辑漏洞，导致看课途中有概率会弹出。已修改。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f9495f14e1185adb0742f3e51af0a36/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【redis】redix在Linux下的环境配置和redis的全局命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/926f6e5129f495cfdd1fe5f0c1dbbd62/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DS：链表的分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>