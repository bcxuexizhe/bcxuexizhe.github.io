<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable Diffusion安装（非秋叶包一键部署） - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/6839ea1421f14a9a4cc135b37bb3639f/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="Stable Diffusion安装（非秋叶包一键部署）">
  <meta property="og:description" content="Stable Diffusion安装与配置详细步骤 一 、下载前置资源 下载CUDA 1. 查看CUDA版本 通过以下命令查看CUDA版本： nvidia-smi 复制 确保CUDA版本符合要求。 2. 下载CUDA 访问NVIDIA官网获取当前版本CUDA：CUDA Toolkit Downloads 获取旧版本CUDA：CUDA Toolkit Archive 下载Visual Studio和visual-cpp-build-tools 官网： Visual Studio 2022 IDE - 适用于软件开发人员的编程工具 (microsoft.com) Microsoft C&#43;&#43; Build Tools - Visual Studio
3. 下载和安装MiniConda 4. 安装Visual Studio和CUDA 安装Visual Studio和CUDA，确保环境配置完整。 二、安装stable-diffusion-webui 1. 克隆webui 使用以下命令克隆webui项目： git clone git@github.com:AUTOMATIC1111/stable-diffusion-webui.git 复制 2. 解决bug 在文件webui.py中搜索“shared.demo.launch”并进行必要的修改。 下载必要文件到openai文件夹，例如： git clone https://www.modelscope.cn/AI-ModelScope/clip-vit-large-patch14.git 复制 编辑webui-user.bat文件，添加修改显卡参数 跳转到显存优化命令写法 修改端口号位置防止和ollama冲突 在/stable-diffusion-webui/webui-user.sh文件中，修改端口号位置，例如： export COMMANDLINE_ARGS=&#34;--xformers --medvram --theme=dark --port=8888&#34; 复制 3 安装依赖和运行 打开cmd到相应路径 conda create -n StableDiffusion python=3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-10T12:00:00+08:00">
    <meta property="article:modified_time" content="2024-04-10T12:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable Diffusion安装（非秋叶包一键部署）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p>Stable Diffusion安装与配置详细步骤 </p> 
<p>一 、下载前置资源 </p> 
<p>下载CUDA </p> 
<p>1. 查看CUDA版本 </p> 
<p>通过以下命令查看CUDA版本： </p> 
<p>nvidia-smi <br> 复制 </p> 
<p>确保CUDA版本符合要求。 <br><img alt="" height="280" src="https://images2.imgbox.com/f0/b8/4RgNBSoS_o.png" width="560"></p> 
<p>2. 下载CUDA </p> 
<ul><li> <p>访问NVIDIA官网获取当前版本CUDA：<a href="https://developer.nvidia.com/cuda-downloads" rel="nofollow" title="CUDA Toolkit Downloads">CUDA Toolkit Downloads</a> </p> </li><li> <p>获取旧版本CUDA：<a href="https://developer.nvidia.com/cuda-toolkit-archive" rel="nofollow" title="CUDA Toolkit Archive">CUDA Toolkit Archive</a> </p> </li></ul> 
<p>下载Visual Studio和visual-cpp-build-tools </p> 
<p>官网： <br><a href="https://visualstudio.microsoft.com/zh-hans/vs/" rel="nofollow" title="Visual Studio 2022 IDE - 适用于软件开发人员的编程工具 (microsoft.com)">Visual Studio 2022 IDE - 适用于软件开发人员的编程工具 (microsoft.com)</a> <br><a href="https://visualstudio.microsoft.com/visual-cpp-build-tools/" rel="nofollow" title="Microsoft C++ Build Tools - Visual Studio">Microsoft C++ Build Tools - Visual Studio</a></p> 
<p>3. 下载和安装MiniConda </p> 
<p>4. 安装Visual Studio和CUDA </p> 
<p>安装Visual Studio和CUDA，确保环境配置完整。 </p> 
<p>二、安装stable-diffusion-webui </p> 
<p>1. 克隆webui </p> 
<p>使用以下命令克隆webui项目： </p> 
<p>git clone git@github.com:AUTOMATIC1111/stable-diffusion-webui.git <br> 复制 </p> 
<p>2. 解决bug </p> 
<ol><li> <p>在文件webui.py中搜索“shared.demo.launch”并进行必要的修改。 <br><img alt="" height="296" src="https://images2.imgbox.com/41/2d/qwRSDOfI_o.png" width="560"></p> </li></ol> 
<ol><li> <p>下载必要文件到openai文件夹，例如： </p> </li></ol> 
<p>git clone https://www.modelscope.cn/AI-ModelScope/clip-vit-large-patch14.git <br> 复制 </p> 
<ol><li> <p>编辑webui-user.bat文件，添加修改显卡参数 <br>跳转到显存优化命令写法 </p> </li></ol> 
<ol><li> <p>修改端口号位置防止和ollama冲突 <br> 在/stable-diffusion-webui/webui-user.sh文件中，修改端口号位置，例如： </p> </li></ol> 
<p>export COMMANDLINE_ARGS="--xformers --medvram --theme=dark --port=8888" <br> 复制 </p> 
<p>3 安装依赖和运行 </p> 
<p>打开cmd到相应路径 </p> 
<p>conda create -n StableDiffusion python=3.10.6 <br> conda activate StableDiffusion <br> pip install insightface==0.7.3 <br> 复制 </p> 
<p>运行服务： </p> 
<p>conda activate StableDiffusion <br> webui-user.bat <br> 复制 </p> 
<ol><li> <p>安装汉化插件 <br> 汉化包我们选择 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FVinsonLaro%2Fstable-diffusion-webui-chinese" rel="nofollow" title="stable-diffusion-webui-chinese">stable-diffusion-webui-chinese</a>, <br><img alt="" height="432" src="https://images2.imgbox.com/cd/04/DTDubocj_o.png" width="560"></p> </li></ol> 
<ol><li> <p>(Extensions -&gt; Install from URL), </p> </li></ol> 
<ol><li> <p>https://github.com/VinsonLaro/stable-diffusion-webui-chinese </p> </li></ol> 
<ol><li> <p>点击安装时 <br><img alt="" height="283" src="https://images2.imgbox.com/16/cf/w62g1yXI_o.png" width="560">安装完成后, 点击页面底部的 Reload UI <br><img alt="" height="283" src="https://images2.imgbox.com/0c/f2/I4ohc7oo_o.png" width="560"> <br><img alt="" height="283" src="https://images2.imgbox.com/d9/92/T1h5oJ38_o.png" width="560"> <br> 使用翻译插件 </p> </li></ol> 
<ol><li> <p>选中 </p> </li></ol> 
<ol><li> <p>应用 </p> </li></ol> 
<ol><li> <p>重启 <br><img alt="" height="283" src="https://images2.imgbox.com/d3/cb/sXWgDsx2_o.png" width="560"></p> </li></ol> 
<p>8. 安装插件和下载模型 </p> 
<ul><li> <p>安装插件路径：插件路径 </p> </li><li> <p><a href="https://gitcode.net/rubble7343/sd-webui-extensions/raw/master/index.json" rel="nofollow" title="https://gitcode.net/rubble7343/sd-webui-extensions/raw/master/index.json">https://gitcode.net/rubble7343/sd-webui-extensions/raw/master/index.json</a> <br><img alt="" height="283" src="https://images2.imgbox.com/4a/cb/yLJNqEbK_o.png" width="560"></p> </li><li> <p>下载基础模型地址：<a href="https://cyberes.github.io/stable-diffusion-models/" rel="nofollow" title="Stable Diffusion Models">Stable Diffusion Models</a> </p> </li></ul> 
<p>其他问题的解决办法 </p> 
<p>1 pip问题 </p> 
<p>如果出现ModuleNotFoundError: No module named ‘pip’错误，可以通过以下命令修复： </p> 
<p>python -m ensurepip <br> python -m pip install --upgrade pip <br> 复制 </p> 
<p>2.onnxruntime问题 </p> 
<p>查看对应cuda版本的onnxruntime <br><a href="https://onnxruntime.ai/docs/execution-providers/CUDA-ExecutionProvider.html" rel="nofollow" title="NVIDIA - CUDA | onnxruntime">NVIDIA - CUDA | onnxruntime</a> <br> 在onnxruntime版本与CUDA等版本均对应，但却出现上面的警告信息，且没有查看到GPU调用。 </p> 
<p>考虑是不是onnxruntime压根没找到GPU，所以尝试了下面的代码： </p> 
<p>import onnxruntime <br> onnxruntime.get_device() # 得到的输出结果是GPU，所以按理说是找到了GPU的 <br> print("use"+onnxruntime.get_device()) <br> 复制 </p> 
<p>如果是cpu，就那么就删除所有onnxruntime相关的库文件，重新安装 </p> 
<p>python -m pip install -U pip <br> pip uninstall -y onnxruntime onnxruntime-gpu onnxruntime-silicon onnxruntime-extensions <br> pip install "onnxruntime-gpu&gt;=1.16.1" <br> 复制 </p> 
<p>参考：<a href="https://zhuanlan.zhihu.com/p/687996672" rel="nofollow" title="ONNX模型推理 ｜ ONNX Runtime 找不到 CUDA，推理只能用 CPU 时的解决方案 - 知乎 (zhihu.com)">ONNX模型推理 ｜ ONNX Runtime 找不到 CUDA，推理只能用 CPU 时的解决方案 - 知乎 (zhihu.com)</a> </p> 
<p>3. 解决网页无法打开问题 </p> 
<p>这种情况把提前网路全部断开也可以成功启动 <br> 若启动成功但网页无法打开，可尝试下载插件： </p> 
<ul><li> <p><a href="https://github.com/jiacai2050/gooreplacer/releases/tag/v3.13.0" title="下载插件链接1">下载插件链接1</a></p> </li><li> <p><a href="https://jiacai2050.github.io/gooreplacer/" rel="nofollow" title="下载插件链接2">下载插件链接2</a> <br> 打开任意一个链接下载即可 </p> </li></ul> 
<p><img alt="" height="278" src="https://images2.imgbox.com/83/dd/UAr6dLPi_o.png" width="560"></p> 
<p><img alt="" height="278" src="https://images2.imgbox.com/f1/6a/f2mqZGUz_o.png" width="560"></p> 
<p>以下是对各个显存优化命令的写法: </p> 
<p>一、低显存优化命令示例 </p> 
<ol><li> <p>如果您有 4GB VRAM 并且想要制作 512x512（或最高 640x640）的图像，使用以下命令： </p> </li></ol> 
<p>set COMMANDLINE_ARGS=--medvram <br> 复制 </p> 
<ol><li> <p>如果您有 4GB VRAM 并且想要制作 512x512 图像，但遇到内存不足错误，尝试以下命令： </p> </li></ol> 
<p>set COMMANDLINE_ARGS=--medvram --lowvram --always-batch-cond-uncond <br> 复制 </p> 
<ol><li> <p>如果您有 4GB VRAM 并且想要生成比通常使用的显存容量更大的图像，尝试以下命令： </p> </li></ol> 
<p>set COMMANDLINE_ARGS=--medvram --lowvram <br> 复制 </p> 
<p>二、性能优化参数表 </p> 
<ul><li> <p>--opt-sdp-attention：可能比在某些系统上使用 xformer 的速度更快，但需要更多的 VRAM。 </p> </li><li> <p>--xformers：使用xformers库，内存消耗和速度有显著改进。 </p> </li><li> <p>--force-enable-xformers：无论程序认为您是否可以运行它，都启用 xformers。 </p> </li><li> <p>--medvram：使稳定扩散模型消耗更少的 VRAM，降低性能。 </p> </li><li> <p>--lowvram：对上述内容进行更彻底的优化，对性能有破坏性。 </p> </li><li> <p>--no-half：不将模型切换到 16 位浮点数。 </p> </li></ul> 
<p>三、个人总结优化命令 </p> 
<p>根据您的个人总结，您可以尝试以下命令来生成图像： </p> 
<p>set COMMANDLINE_ARGS=--lowvram --xformers --no-half --autolaunch <br> 复制 </p> 
<p>通过以上优化命令，您可以在低显存环境下尝试生成图像，平衡速度和显存消耗，提高稳定扩散模型的性能和效率。请根据您的实际情况和需求选择合适的优化参数。 <br> 参考：<a href="https://zhuanlan.zhihu.com/p/640722747" rel="nofollow" title="原生Stable Diffusion本地部署伪保姆级（第六篇）--开启SD之旅（3）-性能优化 - 知乎 (zhihu.com)">原生Stable Diffusion本地部署伪保姆级（第六篇）--开启SD之旅（3）-性能优化 - 知乎 (zhihu.com)</a> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a1ba8a8a8718fddd05fb268e86d515d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【小程序】常用方法、知识点汇总1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e69c884894037d6e61f69d192e55a115/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">你真的知道 NPM、Yarn 与 PNPM 这三个前端包管理器之间的区别吗？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>