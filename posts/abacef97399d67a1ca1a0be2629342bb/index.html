<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring boot3ç™»å½•å¼€å‘-å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ç™»å½•è®¾è®¡ä¸å®ç° - ç¼–ç¨‹å­¦ä¹ è€…</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/abacef97399d67a1ca1a0be2629342bb/">
  <meta property="og:site_name" content="ç¼–ç¨‹å­¦ä¹ è€…">
  <meta property="og:title" content="spring boot3ç™»å½•å¼€å‘-å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ç™»å½•è®¾è®¡ä¸å®ç°">
  <meta property="og:description" content="â›°ï¸ä¸ªäººä¸»é¡µ:Â è’¾é…’
ğŸ”¥ç³»åˆ—ä¸“æ ï¼šã€Šspring bootå®æˆ˜ã€‹
ç›®å½•
å†™åœ¨å‰é¢
ç™»å½•æµç¨‹
æµç¨‹è§£æ
å…·ä½“å®ç°
ç›¸å…³ä»£ç 
è¯´æ˜
æœåŠ¡ç«¯
å°ç¨‹åºç«¯
å†™åœ¨æœ€å
å†™åœ¨å‰é¢ æœ¬æ–‡ä»‹ç»äº†springbootå¼€å‘å¾®ä¿¡å°ç¨‹åºåç«¯æœåŠ¡ä¸­ï¼Œç”¨æˆ·ç™»å½•åŠŸèƒ½çš„è®¾è®¡ä¸å®ç°ï¼ŒåšæŒçœ‹å®Œç›¸ä¿¡å¯¹ä½ æœ‰å¸®åŠ©ã€‚
åŒæ—¶æ¬¢è¿è®¢é˜…springbootç³»åˆ—ä¸“æ ï¼ŒæŒç»­åˆ†äº«spring bootçš„ä½¿ç”¨ç»éªŒã€‚
ç™»å½•æµç¨‹ å¦‚å›¾ï¼š
è¿™æ˜¯å¾®ä¿¡å®˜æ–¹æ–‡æ¡£ä¸­å¾®ä¿¡å°ç¨‹åºç™»å½•çš„æµç¨‹æ—¶åºå›¾ï¼Œæˆ‘åœ¨å›¾ä¸­çº¢è‰²åºå·æ ‡æ³¨çš„äº”æ­¥å°±æ˜¯å®Œæ•´çš„å¾®ä¿¡å°ç¨‹åºç™»å½•æµç¨‹ã€‚
æµç¨‹è§£æ å°ç¨‹åºç«¯é€šè¿‡wx.login()è·å–ç”¨æˆ·ç™»å½•å‡­è¯codeã€‚å°ç¨‹åºå°†codeå‘é€åˆ°æœåŠ¡ç«¯çš„ç™»å½•æ¥å£ã€‚æœåŠ¡ç«¯çš„ç™»å½•æ¥å£ä½¿ç”¨è¯¥codeã€å°ç¨‹åºçš„AppIDå’ŒAppSecretå‘å¾®ä¿¡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–ç”¨æˆ·çš„openidã€‚æœåŠ¡ç«¯æ‹¿åˆ°openidåï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç”Ÿæˆç”¨æˆ·ä»¤ç‰Œï¼ˆTokenï¼‰ï¼Œé€šå¸¸åŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€æƒé™ç­‰ï¼Œå¹¶è¿”å›ç»™å°ç¨‹åºã€‚å°ç¨‹åºåœ¨æœ¬åœ°ç¼“å­˜è¯¥ç”¨æˆ·ä»¤ç‰Œã€‚åç»­å°ç¨‹åºå‘èµ·è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦è¯¥ç”¨æˆ·ä»¤ç‰Œ(Token)ã€‚æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒéªŒè¯ç”¨æˆ·ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ç”¨æˆ·æ˜¯ç»è¿‡è®¤è¯å’Œæˆæƒçš„ã€‚ å…·ä½“å®ç° ç™»å½•æ¥å£è®¾è®¡æ€è·¯
æ¥æ”¶å°ç¨‹åºç«¯ä¼ é€’çš„codeå‚æ•°ã€‚ä½¿ç”¨codeã€å°ç¨‹åºçš„AppIDå’ŒAppSecretå‘å¾®ä¿¡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–ç”¨æˆ·çš„openidã€‚åœ¨æ•°æ®åº“ç”¨æˆ·è¡¨ä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥openidã€‚å¦‚æœå­˜åœ¨è¯¥openidï¼Œåˆ™ä½¿ç”¨æŸ¥è¯¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä»¤ç‰Œ(Token)ã€‚å¦‚æœä¸å­˜åœ¨è¯¥openidï¼Œåˆ™è¿›è¡Œç”¨æˆ·æ³¨å†Œæ“ä½œï¼Œå°†æ–°ç”¨æˆ·ä¿¡æ¯æ’å…¥æ•°æ®åº“ç”¨æˆ·è¡¨ï¼Œå¹¶ç”Ÿæˆä»¤ç‰Œ(Token)ã€‚è¿”å›ç”Ÿæˆçš„ä»¤ç‰Œ(Token)ç»™å°ç¨‹åºç«¯ã€‚ ç›¸å…³ä»£ç  è¯´æ˜ ä¸‹é¢ä»£ç åŸºäºjdk17ï¼Œå‘è¯·æ±‚ç”¨çš„æ—¶jdkè‡ªå¸¦çš„httpå·¥å…·ç±»ï¼Œå¦‚æœä½ çš„jdkç‰ˆæœ¬ä½äº11ï¼Œå¯ä»¥ä½¿ç”¨okhttpä¾èµ–æ¥å‘è¯·æ±‚ï¼Œç„¶åjwtç›¸å…³å·¥å…·ç±»ä»£ç åœ¨æˆ‘æœ¬ä¸“æ çš„å…¶ä»–æ–‡ç« é‡Œé¢ï¼Œç”¨åˆ°çš„ORMæ¡†æ¶ä¸ºmybatis-plusæ•´åˆç›¸å…³ä»£ç ä¹Ÿåœ¨æœ¬ä¸“æ ã€‚
æœåŠ¡ç«¯ ç™»å½•dto
@Data public class UserLoginDTO { @NotBlank(message = &#34;codeä¸èƒ½ä¸ºç©º&#34;) private String code; private Map&lt;String,Object&gt; userInfo;//ç”¨æˆ·å®Œå–„ä¿¡æ¯ } ç™»å½•è¿”å›vo
@Data @Builder public class UserLoginVO implements Serializable { private Long id; //ç”¨æˆ·id private String openid;//ç”¨æˆ·åœ¨å°ç¨‹åºå”¯ä¸€æ ‡è¯† private String token;//ç”¨æˆ·ç™»å½•å‡­è¯ } è·å–openidæ–¹æ³•
ä½¿ç”¨çš„æ˜¯jdk17è‡ªå¸¦çš„HttpClient,ä¹Ÿå¯ä»¥ä½¿ç”¨okhttp,æˆ–è€…ç³Šæ¶‚å·¥å…·åŒ…é‡Œé¢çš„ã€‚
private String getOpenid(String code) { HttpClient httpClient = HttpClient.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-27T16:41:45+08:00">
    <meta property="article:modified_time" content="2024-04-27T16:41:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å­¦ä¹ è€…" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å­¦ä¹ è€…</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring boot3ç™»å½•å¼€å‘-å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ç™»å½•è®¾è®¡ä¸å®ç°</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Â <img alt="" height="68" src="https://images2.imgbox.com/37/3f/zGC294p1_o.jpg" width="68"></p> 
<p><span style="color:#a2e043;">â›°ï¸<a href="https://so.csdn.net/so/search?q=%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5&amp;spm=1001.2101.3001.7020" title="ä¸ªäººä¸»é¡µ">ä¸ªäººä¸»é¡µ</a>:Â  Â  Â <a href="https://blog.csdn.net/qq_62262918?spm=1011.2266.3001.5343" title="è’¾é…’">è’¾é…’</a></span></p> 
<p><span style="color:#ed7976;">ğŸ”¥ç³»åˆ—ä¸“æ ï¼š<a href="https://blog.csdn.net/qq_62262918/category_12571219.html?spm=1001.2014.3001.5482" title="ã€Šspring bootå®æˆ˜ã€‹">ã€Šspring bootå®æˆ˜ã€‹</a></span></p> 
<hr> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2-toc" style="margin-left:0px;"><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" rel="nofollow">å†™åœ¨å‰é¢</a></p> 
<p id="%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B-toc" style="margin-left:0px;"><a href="#%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B" rel="nofollow">ç™»å½•æµç¨‹</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90" rel="nofollow">æµç¨‹è§£æ</a></p> 
<p id="%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" rel="nofollow">å…·ä½“å®ç°</a></p> 
<p id="%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81" rel="nofollow">ç›¸å…³ä»£ç </a></p> 
<p id="%E8%AF%B4%E6%98%8E-toc" style="margin-left:80px;"><a href="#%E8%AF%B4%E6%98%8E" rel="nofollow">è¯´æ˜</a></p> 
<p id="%E6%9C%8D%E5%8A%A1%E7%AB%AF-toc" style="margin-left:80px;"><a href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF" rel="nofollow">æœåŠ¡ç«¯</a></p> 
<p id="%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AB%AF-toc" style="margin-left:80px;"><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AB%AF" rel="nofollow">å°ç¨‹åºç«¯</a></p> 
<p id="%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E-toc" style="margin-left:0px;"><a href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E" rel="nofollow">å†™åœ¨æœ€å</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>å†™åœ¨å‰é¢</h2> 
<p>æœ¬æ–‡ä»‹ç»äº†springbootå¼€å‘å¾®ä¿¡å°ç¨‹åºåç«¯æœåŠ¡ä¸­ï¼Œç”¨æˆ·ç™»å½•åŠŸèƒ½çš„è®¾è®¡ä¸å®ç°ï¼ŒåšæŒçœ‹å®Œç›¸ä¿¡å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p> 
<p>åŒæ—¶æ¬¢è¿è®¢é˜…springbootç³»åˆ—ä¸“æ ï¼ŒæŒç»­åˆ†äº«spring bootçš„ä½¿ç”¨ç»éªŒã€‚</p> 
<h2></h2> 
<h2 id="%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B">ç™»å½•æµç¨‹</h2> 
<p>å¦‚å›¾ï¼š</p> 
<p><img alt="" height="1099" src="https://images2.imgbox.com/b8/70/rveRb3NX_o.png" width="1126"></p> 
<p>è¿™æ˜¯å¾®ä¿¡å®˜æ–¹æ–‡æ¡£ä¸­å¾®ä¿¡å°ç¨‹åºç™»å½•çš„æµç¨‹æ—¶åºå›¾ï¼Œæˆ‘åœ¨å›¾ä¸­çº¢è‰²åºå·æ ‡æ³¨çš„äº”æ­¥å°±æ˜¯å®Œæ•´çš„å¾®ä¿¡å°ç¨‹åºç™»å½•æµç¨‹ã€‚</p> 
<h2></h2> 
<h2 id="%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90">æµç¨‹è§£æ</h2> 
<blockquote> 
 <ol><li>å°ç¨‹åºç«¯é€šè¿‡<code>wx.login()</code>è·å–ç”¨æˆ·ç™»å½•å‡­è¯codeã€‚</li><li>å°ç¨‹åºå°†codeå‘é€åˆ°æœåŠ¡ç«¯çš„ç™»å½•æ¥å£ã€‚</li><li>æœåŠ¡ç«¯çš„ç™»å½•æ¥å£ä½¿ç”¨è¯¥codeã€å°ç¨‹åºçš„AppIDå’ŒAppSecretå‘å¾®ä¿¡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–ç”¨æˆ·çš„openidã€‚</li><li>æœåŠ¡ç«¯æ‹¿åˆ°openidåï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç”Ÿæˆç”¨æˆ·ä»¤ç‰Œï¼ˆTokenï¼‰ï¼Œé€šå¸¸åŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€æƒé™ç­‰ï¼Œå¹¶è¿”å›ç»™å°ç¨‹åºã€‚</li><li>å°ç¨‹åºåœ¨æœ¬åœ°ç¼“å­˜è¯¥ç”¨æˆ·ä»¤ç‰Œã€‚</li><li>åç»­å°ç¨‹åºå‘èµ·è¯·æ±‚æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦è¯¥ç”¨æˆ·ä»¤ç‰Œ(Token)ã€‚</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒéªŒè¯ç”¨æˆ·ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ï¼Œç¡®ä¿ç”¨æˆ·æ˜¯ç»è¿‡è®¤è¯å’Œæˆæƒçš„ã€‚</li></ol> 
</blockquote> 
<p></p> 
<h2 id="%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">å…·ä½“å®ç°</h2> 
<p>ç™»å½•æ¥å£è®¾è®¡æ€è·¯</p> 
<blockquote> 
 <ol><li>æ¥æ”¶å°ç¨‹åºç«¯ä¼ é€’çš„codeå‚æ•°ã€‚</li><li>ä½¿ç”¨codeã€å°ç¨‹åºçš„AppIDå’ŒAppSecretå‘å¾®ä¿¡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–ç”¨æˆ·çš„openidã€‚</li><li>åœ¨æ•°æ®åº“ç”¨æˆ·è¡¨ä¸­æŸ¥è¯¢æ˜¯å¦å­˜åœ¨è¯¥openidã€‚</li><li>å¦‚æœå­˜åœ¨è¯¥openidï¼Œåˆ™ä½¿ç”¨æŸ¥è¯¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä»¤ç‰Œ(Token)ã€‚</li><li>å¦‚æœä¸å­˜åœ¨è¯¥openidï¼Œåˆ™è¿›è¡Œç”¨æˆ·æ³¨å†Œæ“ä½œï¼Œå°†æ–°ç”¨æˆ·ä¿¡æ¯æ’å…¥æ•°æ®åº“ç”¨æˆ·è¡¨ï¼Œå¹¶ç”Ÿæˆä»¤ç‰Œ(Token)ã€‚</li><li>è¿”å›ç”Ÿæˆçš„ä»¤ç‰Œ(Token)ç»™å°ç¨‹åºç«¯ã€‚</li></ol> 
</blockquote> 
<h3 id="%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81">ç›¸å…³ä»£ç </h3> 
<h4 id="%E8%AF%B4%E6%98%8E">è¯´æ˜</h4> 
<blockquote> 
 <p>ä¸‹é¢ä»£ç åŸºäºjdk17ï¼Œå‘è¯·æ±‚ç”¨çš„æ—¶jdkè‡ªå¸¦çš„httpå·¥å…·ç±»ï¼Œå¦‚æœä½ çš„jdkç‰ˆæœ¬ä½äº11ï¼Œå¯ä»¥ä½¿ç”¨okhttpä¾èµ–æ¥å‘è¯·æ±‚ï¼Œç„¶åjwtç›¸å…³å·¥å…·ç±»ä»£ç åœ¨æˆ‘æœ¬ä¸“æ çš„å…¶ä»–æ–‡ç« é‡Œé¢ï¼Œç”¨åˆ°çš„ORMæ¡†æ¶ä¸ºmybatis-plusæ•´åˆç›¸å…³ä»£ç ä¹Ÿåœ¨æœ¬ä¸“æ ã€‚</p> 
</blockquote> 
<h4 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF">æœåŠ¡ç«¯</h4> 
<p>ç™»å½•dto</p> 
<pre><code class="language-java">@Data
public class UserLoginDTO {
    @NotBlank(message = "codeä¸èƒ½ä¸ºç©º")
    private String code;

    private Map&lt;String,Object&gt; userInfo;//ç”¨æˆ·å®Œå–„ä¿¡æ¯

}</code></pre> 
<p>ç™»å½•è¿”å›vo</p> 
<pre><code class="language-java">@Data
@Builder
public class UserLoginVO implements Serializable {
    private Long id; //ç”¨æˆ·id

    private String openid;//ç”¨æˆ·åœ¨å°ç¨‹åºå”¯ä¸€æ ‡è¯†

    private String token;//ç”¨æˆ·ç™»å½•å‡­è¯
   
}</code></pre> 
<p>è·å–openidæ–¹æ³•</p> 
<p>ä½¿ç”¨çš„æ˜¯jdk17è‡ªå¸¦çš„HttpClient,ä¹Ÿå¯ä»¥ä½¿ç”¨okhttp,æˆ–è€…ç³Šæ¶‚å·¥å…·åŒ…é‡Œé¢çš„ã€‚</p> 
<pre><code class="language-java"> private String getOpenid(String code) {
        HttpClient httpClient = HttpClient.newHttpClient();
        // æ„å»ºè¯·æ±‚å‚æ•°å­—ç¬¦ä¸²
        String params = String.format("appid=%s&amp;secret=%s&amp;js_code=%s&amp;grant_type=%s",
                URLEncoder.encode(wxMiniConfig.getAppId(), StandardCharsets.UTF_8),
                URLEncoder.encode(wxMiniConfig.getAppSecret(), StandardCharsets.UTF_8),
                URLEncoder.encode(code, StandardCharsets.UTF_8),
                URLEncoder.encode("authorization_code", StandardCharsets.UTF_8));

        // åˆ›å»º GET è¯·æ±‚
        String url = "https://api.weixin.qq.com/sns/jscode2session?" + params;
        HttpRequest httpRequest = HttpRequest.newBuilder()
                .uri(URI.create(url))
                .build();

        try {
            // å‘é€ GET è¯·æ±‚
            HttpResponse&lt;String&gt; httpResponse = httpClient.send(httpRequest, HttpResponse.BodyHandlers.ofString());

            // è·å–å“åº”ç»“æœ
            int statusCode = httpResponse.statusCode();
            String responseBody = httpResponse.body();
            JSONObject responseJson = JSONObject.parseObject(responseBody);
            String openid = responseJson.getString("openid");

            // å¤„ç†å“åº”ç»“æœ
            System.out.println("çŠ¶æ€ä»£ç : " + statusCode);
            System.out.println("å“åº”æ­£æ–‡: " + responseBody);
            return  openid;
        } catch (Exception e) {
           log.error("å‘é€è¯·æ±‚æ—¶å‡ºé”™: {}", e.getMessage());
           return null;
        }
    }</code></pre> 
<p></p> 
<p>ç™»å½•é€»è¾‘ä»£ç </p> 
<p>åœ¨åˆ¤æ–­å‡ºæ˜¯æ–°ç”¨æˆ·æ—¶ï¼Œè¿›è¡Œæ³¨å†Œæ“ä½œè¿˜éœ€è¦å°†è¯·æ±‚æºå¸¦è¿‡æ¥çš„userInfoå®Œå–„ä¿¡æ¯ï¼Œç”¨æˆ·åï¼Œå¤´åƒç­‰ä¸€åŒå°è£…è¿›Userå¯¹è±¡å†æ’å…¥åˆ°æ•°æ®åº“è¿™é‡Œæˆ‘å°±çœç•¥äº†</p> 
<pre><code class="language-java">    @Override
    public UserLoginVO login(UserLoginDTO userLoginDTO) {
        //è·å–openid
        String openid = getOpenid(userLoginDTO.getCode());
        if(StringUtils.isBlank(openid)){
            throw new GeneralBusinessException(ResultEnum.USER_OPENID_ERROR); // openidè·å–å¤±è´¥
        }

        User user = new LambdaQueryChainWrapper&lt;&gt;(userMapper).eq(User::getOpenid, openid).one();

        if(Objects.isNull(user)){
            // ç”¨æˆ·ä¸å­˜åœ¨åˆ™æ³¨å†Œ
            user = new User();
            //è·å–å®Œå–„ä¿¡æ¯ï¼Œç”¨æˆ·å‘¢ç§°ã€å¤´åƒurl
            userLoginDTO.getUserInfo
            //å°è£…ä¿¡æ¯ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
            //ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚
            
            user.setOpenid(openid);

            // æ³¨å†Œç”¨æˆ·
            if(!this.save(user)){
                throw new GeneralBusinessException(ResultEnum.USER_REGISTER_FAIL); // ç”¨æˆ·æ³¨å†Œå¤±è´¥
            }
        }

        return UserLoginVO.builder()
                .id(user.getUserId())
                .openid(user.getOpenid())
                .token(jwtUtils.generateToken(Map.of("userId", user.getUserId()), "user"))
                .build();
    }</code></pre> 
<p></p> 
<h4 id="%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AB%AF">å°ç¨‹åºç«¯</h4> 
<p><img alt="" height="795" src="https://images2.imgbox.com/52/e5/nLi7I4Cm_o.png" width="470"></p> 
<p>å¦‚å›¾ç‚¹å‡»ç™»å½•æŒ‰é’®ä¼šè¿›è¡Œç™»å½•ï¼ˆæ³¨å†Œï¼‰</p> 
<p>wxml:</p> 
<pre><code class="language-html"> &lt;button bindtap="handleLogin"&gt;ç™»å½•&lt;/button&gt;</code></pre> 
<p>js:</p> 
<pre><code class="language-javascript">// ç‚¹å‡»ç™»å½•æŒ‰é’®æ—¶è§¦å‘çš„æ–¹æ³•
handleLogin: function() {
  // è°ƒç”¨å¾®ä¿¡ç™»å½•æ¥å£è·å– code
  wx.login({
    success: res =&gt; {
      const code = res.code;
      if (code) {
        // è°ƒç”¨å¾®ä¿¡ç™»å½•æ¥å£è·å–ç”¨æˆ·ä¿¡æ¯
        wx.getUserProfile({
          desc: 'ç”¨äºå®Œå–„ä¼šå‘˜èµ„æ–™',
          success: res =&gt; {
            const userInfo = res.userInfo;

            // å°† code å’Œç”¨æˆ·ä¿¡æ¯å‘é€åˆ°åç«¯æœåŠ¡å™¨è¿›è¡Œç™»å½•éªŒè¯
            wx.request({
              url: 'http://localhost:8080/user/login',
              method: 'POST',
              data: {
                code: code,
                userInfo: userInfo
              },
              success: res =&gt; {
                const { token } = res.data; // å‡è®¾åç«¯è¿”å›åŒ…å« token çš„æ•°æ®
                if (token) {
                  // ç™»å½•æˆåŠŸï¼Œä¿å­˜ tokenåˆ°æœ¬åœ°å­˜å‚¨
                  wx.setStorageSync('token', token);

                  // è·³è½¬åˆ°ä¸»é¡µæˆ–å…¶ä»–é¡µé¢
                  wx.navigateTo({
                    url: '/pages/home/home'
                  });
                } else {
                  // ç™»å½•å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                  wx.showToast({
                    title: 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•',
                    icon: 'none'
                  });
                }
              },
              fail: err =&gt; {
                console.error('ç™»å½•è¯·æ±‚å¤±è´¥', err);
              }
            });
          },
          fail: err =&gt; {
            console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥', err);
          }
        });
      } else {
        console.error('è·å–ç™»å½•å‡­è¯å¤±è´¥', res.errMsg);
      }
    },
    fail: err =&gt; {
      console.error('è°ƒç”¨ç™»å½•æ¥å£å¤±è´¥', err);
    }
  });
}
</code></pre> 
<p>è¡¥å……ï¼šå®é™…å¼€å‘ä¸­ä¸ä¼šç›´æ¥ä½¿ç”¨wx.requestè¿›è¡Œç™»å½•è¯·æ±‚ï¼Œä¸€èˆ¬éƒ½ä¼šè¿›è¡Œå°è£…ï¼Œè¿™é‡Œä½œä¸ºæ¼”ç¤ºæˆ‘å°±ç›´æ¥ä½¿ç”¨äº†ï¼Œå®é™…å‘é€çš„postè¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¼šæºå¸¦code,å’Œç”¨æˆ·æ˜µç§°ã€å¤´åƒè·¯å¾„ç­‰ä¿¡æ¯ã€‚</p> 
<p></p> 
<h2 id="%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E">å†™åœ¨æœ€å</h2> 
<p>æœ¬æ–‡å®Œæ•´çš„ä»‹ç»äº†springbootå¼€å‘å¾®ä¿¡å°ç¨‹åºæœåŠ¡ç«¯ä¸­ç”¨æˆ·ç™»å½•åŠŸèƒ½çš„è®¾è®¡æ€è·¯,å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/176437101e4abc9d6d079afb713de7c8/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ä½¿ç”¨LM Studioä¸Anything LLMåŸºäºLlama-3é«˜æ•ˆæ„å»ºæœ¬åœ°çŸ¥è¯†åº“ç³»ç»Ÿ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1541d08872e037e0be1d52363ffc5dd3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">æ‰“æ°´é—®é¢˜ï¼ˆè´ªå¿ƒç®—æ³•ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å­¦ä¹ è€….
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>