<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL 8.0 新特性之不可见主键 - 编程学习者</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/f95730ef2038419d27ae023574a791eb/">
  <meta property="og:site_name" content="编程学习者">
  <meta property="og:title" content="MySQL 8.0 新特性之不可见主键">
  <meta property="og:description" content="数据库设计通常需要满足一定的范式要求，其中主键更是最基本的要求。不过，数据库管理系统却允许我们创建没有主键的表。这样的表在 MySQL 中会带来查询性能低下、复制延迟甚至无法实现高可用配置等问题。
为此，MySQL 8.0.30 版本引入了一个新的功能，叫做不可见主键（Generated Invisible Primary Keys），它可以自动为没有显式指定主键的 InnoDB 表创建一个不可见的主键。
不可见主键 MySQL 通过系统变量 sql_generate_invisible_primary_key 控制是否启用 GIPK 特性，该变量的默认设置为 OFF。
以下示例创建了两个表，都没有指定主键。
mysql&gt; SELECT @@sql_generate_invisible_primary_key; &#43;--------------------------------------&#43; | @@sql_generate_invisible_primary_key | &#43;--------------------------------------&#43; | 0 | &#43;--------------------------------------&#43; 1 row in set (0.00 sec) mysql&gt; CREATE TABLE auto_0 (c1 VARCHAR(50), c2 INT); Query OK, 0 rows affected (0.02 sec) mysql&gt; SET sql_generate_invisible_primary_key=ON; Query OK, 0 rows affected (0.00 sec) mysql&gt; SELECT @@sql_generate_invisible_primary_key; &#43;--------------------------------------&#43; | @@sql_generate_invisible_primary_key | &#43;--------------------------------------&#43; | 1 | &#43;--------------------------------------&#43; 1 row in set (0.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-27T21:17:06+08:00">
    <meta property="article:modified_time" content="2024-03-27T21:17:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程学习者" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程学习者</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL 8.0 新特性之不可见主键</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>数据库设计通常需要满足一定的范式要求，其中主键更是最基本的要求。不过，数据库管理系统却允许我们创建没有主键的表。这样的表在 MySQL 中会带来查询性能低下、复制延迟甚至无法实现高可用配置等问题。</p> 
<p>为此，MySQL 8.0.30 版本引入了一个新的功能，叫做不可见主键（Generated Invisible Primary Keys），它可以自动为没有显式指定主键的 InnoDB 表创建一个不可见的主键。</p> 
<h3><a id="_3"></a>不可见主键</h3> 
<p>MySQL 通过系统变量 <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_sql_generate_invisible_primary_key" rel="nofollow">sql_generate_invisible_primary_key</a> 控制是否启用 GIPK 特性，该变量的默认设置为 OFF。</p> 
<p>以下示例创建了两个表，都没有指定主键。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@sql_generate_invisible_primary_key</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> @<span class="token variable">@sql_generate_invisible_primary_key</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span>                                    <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> auto_0 <span class="token punctuation">(</span>c1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c2 <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> sql_generate_invisible_primary_key<span class="token operator">=</span><span class="token keyword">ON</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@sql_generate_invisible_primary_key</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span> @<span class="token variable">@sql_generate_invisible_primary_key</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token operator">|</span>                                    <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> auto_1 <span class="token punctuation">(</span>c1 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c2 <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>创建 auto_0 表时，sql_generate_invisible_primary_key 设置为 OFF；创建 auto_1 表时，sql_generate_invisible_primary_key 设置为 ON。</p> 
<p>使用 SHOW CREATE TABLE 语句查看两个表的区别：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> auto_0\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
       <span class="token keyword">Table</span>: auto_0
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>auto_0<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>c1<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c2<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> auto_1\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
       <span class="token keyword">Table</span>: auto_1
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>auto_1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>my_row_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token comment">/*!80023 INVISIBLE */</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c1<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c2<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>my_row_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>MySQL 自动为 auto_1 创建了一个不可见字段 my_row_id，并且将其设置为主键。</p> 
<blockquote> 
 <p>不可见字段也叫做隐藏字段，是 MySQL 8.0.23 版本增加的<a href="https://tonydong.blog.csdn.net/article/details/113838642" rel="nofollow">新功能</a>。作为不可见字段，my_row_id 不会出现在 SELECT * 或者 TABLE 语句的结果中，查询该字段必须显式指定它的名字。</p> 
</blockquote> 
<p>这种情况下，系统默认增加的不可见主键字段名称固定为 my_row_id，因此我们不能在创建表时指定其他字段名为 my_row_id，除非同时将其指定为主键。</p> 
<h3><a id="_68"></a>修改属性</h3> 
<p>当我们启用了 GIPK 功能时，不可见主键 my_row_id 不能使用 ALTER TABLE 语句进行修改，只能设置它的可见属性。以下命令将 auto_1 表的不可见主键设置为可见字段：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> auto_1 <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> my_row_id <span class="token keyword">SET</span> VISIBLE<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> auto_1\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
       <span class="token keyword">Table</span>: auto_1
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>auto_1<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>my_row_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c1<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>c2<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>my_row_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">4</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>当我们启用了 GIPK 功能时，如果删除不可见主键会导致以下任意情况发生，都不允许删除不可见主键：</p> 
<ul><li>该表没有主键；</li><li>删除主键而保留主键字段。</li></ul> 
<p>另外，GIPK 功能只支持 InnoDB 存储引擎，当我们使用 ALTER TABLE 语句修改这种表的存储引擎时，仍然会保留字段和主键约束，但是它会变成普通的主键字段。</p> 
<h3><a id="_96"></a>字典信息</h3> 
<p>默认情况下，SHOW CREATE TABLE、SHOW COLUMNS 以及 SHOW INDEX 命令都会显示不可见主键信息。同时，information_schema 数据库中的 COLUMNS 和 STATISTICS 表中也包含了不可见主键字段。这一行为可以通过系统变量 <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_show_gipk_in_create_table_and_information_schema" rel="nofollow">show_gipk_in_create_table_and_information_schema</a> 进行控制，默认值为 ON。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@show_gipk_in_create_table_and_information_schema</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token operator">|</span> @<span class="token variable">@show_gipk_in_create_table_and_information_schema</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token operator">|</span>                                                  <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>此时，我们查询系统表 COLUMNS 可以返回 auto_1 中的不可见主键 my_row_id：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> COLUMN_NAME<span class="token punctuation">,</span> ORDINAL_POSITION<span class="token punctuation">,</span> DATA_TYPE<span class="token punctuation">,</span> COLUMN_KEY
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"auto_1"</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token operator">|</span> COLUMN_NAME <span class="token operator">|</span> ORDINAL_POSITION <span class="token operator">|</span> DATA_TYPE <span class="token operator">|</span> COLUMN_KEY <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token operator">|</span> my_row_id   <span class="token operator">|</span>                <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">bigint</span>    <span class="token operator">|</span> PRI        <span class="token operator">|</span>
<span class="token operator">|</span> c1          <span class="token operator">|</span>                <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">varchar</span>   <span class="token operator">|</span>            <span class="token operator">|</span>
<span class="token operator">|</span> c2          <span class="token operator">|</span>                <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">int</span>       <span class="token operator">|</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>如果将系统变量 show_gipk_in_create_table_and_information_schema 设置为 OFF，再次查询系统表 COLUMNS，不会显示不可见主键字段：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SET</span> show_gipk_in_create_table_and_information_schema <span class="token operator">=</span> <span class="token keyword">OFF</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@show_gipk_in_create_table_and_information_schema</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token operator">|</span> @<span class="token variable">@show_gipk_in_create_table_and_information_schema</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token operator">|</span>                                                  <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> COLUMN_NAME<span class="token punctuation">,</span> ORDINAL_POSITION<span class="token punctuation">,</span> DATA_TYPE<span class="token punctuation">,</span> COLUMN_KEY
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">WHERE</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">"auto_1"</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token operator">|</span> COLUMN_NAME <span class="token operator">|</span> ORDINAL_POSITION <span class="token operator">|</span> DATA_TYPE <span class="token operator">|</span> COLUMN_KEY <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token operator">|</span> c1          <span class="token operator">|</span>                <span class="token number">2</span> <span class="token operator">|</span> <span class="token keyword">varchar</span>   <span class="token operator">|</span>            <span class="token operator">|</span>
<span class="token operator">|</span> c2          <span class="token operator">|</span>                <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">int</span>       <span class="token operator">|</span>            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+------------------+-----------+------------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_152"></a>复制与备份</h3> 
<p>系统变量 sql_generate_invisible_primary_key 的配置不会被复制，复制应用线程会忽略该变量。这就意味着源节点的设置不会对副本产生影响。从 MySQL 8.0.32 版本开始，我们可以在 <a href="https://dev.mysql.com/doc/refman/8.0/en/change-replication-source-to.html" rel="nofollow">CHANGE REPLICATION SOURCE TO</a> 语句使用 REQUIRE_TABLE_PRIMARY_KEY_CHECK = GENERATE 选项设置副本节点启用 GIPK 功能，为指定复制渠道中的那些没有主键的表自动增加不可见主键。</p> 
<p>对于 CREATE TABLE … SELECT 语句，GIPK 支持基于行的复制选项，此时二进制日志中包含了 GIPK 定义，可以正确地复制。如果是基于语句的复制，CREATE TABLE … SELECT 不支持 sql_generate_invisible_primary_key = ON。</p> 
<p>如果启用了 GIPK 功能，使用 mysqldump 备份或者还原数据时，可以通过 --skip-generated-invisible-primary-key 选项排除 GIPK 信息。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0cec8cb48a8aedb51657d952269cca08/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">动态规划的时间复杂度优化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a29d01e2d23b942e3d3e580cdc254c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">纯python实现小程序云函数抓包（附完整代码）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程学习者.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>