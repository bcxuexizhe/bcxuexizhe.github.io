<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€SpringBootã€‘SpringBootä¸­é˜²æ­¢æ¥å£é‡å¤æäº¤ï¼ˆå•æœºç¯å¢ƒå’Œåˆ†å¸ƒå¼ç¯å¢ƒï¼‰ - ç¼–ç¨‹å­¦ä¹ è€…</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcxuexizhe.github.io/posts/9a2975bbf394a66ebc56cf64f2267545/">
  <meta property="og:site_name" content="ç¼–ç¨‹å­¦ä¹ è€…">
  <meta property="og:title" content="ã€SpringBootã€‘SpringBootä¸­é˜²æ­¢æ¥å£é‡å¤æäº¤ï¼ˆå•æœºç¯å¢ƒå’Œåˆ†å¸ƒå¼ç¯å¢ƒï¼‰">
  <meta property="og:description" content="ğŸ“ä¸ªäººä¸»é¡µï¼šå“ˆ__
æœŸå¾…æ‚¨çš„å…³æ³¨Â ç›®å½•
ğŸŒ¼å‰è¨€Â ğŸ”’å•æœºç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤
ğŸ“•å¯¼å…¥ä¾èµ–
ğŸ“‚é¡¹ç›®ç»“æ„Â ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£
âœˆåˆ›å»ºAOPåˆ‡é¢Â ğŸš—åˆ›å»ºConotrollerÂ ğŸ’»åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤
ğŸ“•å¯¼å…¥ä¾èµ–
ğŸ“‚é¡¹ç›®ç»“æ„
ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£
ğŸš²åˆ›å»ºkeyçš„ç”Ÿæˆå·¥å…·ç±»Â ğŸ”¨åˆ›å»ºRediså·¥å…·ç±»
ğŸš—åˆ›å»ºAOPåˆ‡é¢ç±»
ğŸ›µåˆ›å»ºControllerÂ ğŸŒ¼å‰è¨€Â åœ¨Webåº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¥å£é‡å¤æäº¤é—®é¢˜ä¸€ç›´æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹å…³æ³¨å’Œè§£å†³çš„éš¾é¢˜ã€‚æ— è®ºæ˜¯ç”±äºç”¨æˆ·è¯¯æ“ä½œã€ç½‘ç»œå»¶è¿Ÿå¯¼è‡´çš„é‡å¤ç‚¹å‡»ï¼Œè¿˜æ˜¯ç”±äºæ¶æ„æ”»å‡»è€…åˆ©ç”¨è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œæ¥å£è½°ç‚¸ï¼Œéƒ½å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸¥é‡çš„è´Ÿæ‹…ï¼Œç”šè‡³å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€æœåŠ¡ä¸å¯ç”¨ç­‰ä¸¥é‡åæœã€‚ç‰¹åˆ«æ˜¯åœ¨SpringBootè¿™æ ·çš„ç°ä»£åŒ–Javaæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ›´éœ€è¦ä¸€å¥—è¡Œä¹‹æœ‰æ•ˆçš„ç­–ç•¥æ¥é˜²æ­¢æ¥å£é‡å¤æäº¤ã€‚
æœ¬æ–‡å°†ä»SpringBootåº”ç”¨çš„è§’åº¦å‡ºå‘ï¼Œæ¢è®¨åœ¨å•æœºç¯å¢ƒå’Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚ä½•æœ‰æ•ˆé˜²æ­¢æ¥å£é‡å¤æäº¤ã€‚å•æœºç¯å¢ƒè™½ç„¶ç›¸å¯¹ç®€å•ï¼Œä½†åŸºæœ¬çš„é˜²æŠ¤ç­–ç•¥åŒæ ·é€‚ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒçš„éƒ¨ç½²ã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é¦–å…ˆåˆ†ææ¥å£é‡å¤æäº¤çš„åŸå› å’Œå±å®³ï¼Œç„¶åè¯¦ç»†ä»‹ç»åœ¨SpringBootåº”ç”¨ä¸­å¯ä»¥é‡‡å–çš„é˜²æŠ¤ç­–ç•¥ï¼ŒåŒ…æ‹¬å‰ç«¯æ§åˆ¶ã€åç«¯æ ¡éªŒã€ä½¿ç”¨ä»¤ç‰Œæœºåˆ¶ï¼ˆå¦‚Tokenï¼‰ã€åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸç­‰ã€‚å¯¹äºåˆ†å¸ƒå¼ç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨åˆ†å¸ƒå¼é”ã€Redisç­‰ä¸­é—´ä»¶æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œé˜²æ­¢æ¥å£è¢«é‡å¤è°ƒç”¨ã€‚
åœ¨æ·±å…¥è§£æå„ç§é˜²æŠ¤ç­–ç•¥çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨SpringBooté¡¹ç›®ä¸­å…·ä½“å®ç°è¿™äº›ç­–ç•¥ï¼Œå¹¶ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ï¼Œä»¥å¸®åŠ©è¯»è€…åœ¨å®é™…å¼€å‘ä¸­æ›´å¥½åœ°åº”ç”¨è¿™äº›æŠ€æœ¯ã€‚å¸Œæœ›é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œè¯»è€…èƒ½å¤ŸæŒæ¡åœ¨SpringBootåº”ç”¨ä¸­é˜²æ­¢æ¥å£é‡å¤æäº¤çš„æœ‰æ•ˆæ–¹æ³•ï¼Œä¸ºWebåº”ç”¨çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§æä¾›åšå®çš„ä¿éšœã€‚
ğŸ”’å•æœºç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤ åœ¨è¿™ç§å•æœºçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œæˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨redisè¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æœ¬åœ°ç¼“å­˜æœºåˆ¶ã€‚åœ¨ç”¨æˆ·å¯¹æ¥å£è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å–æ¥å£çš„ä¸€äº›å‚æ•°ä¿¡æ¯ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›å‚æ•°ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDå­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä¸‹ä¸€æ¬¡åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­è¿™ä¸ªç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„IDï¼Œè‹¥æœ‰åˆ™é˜»æ‹¦ï¼Œè‹¥æ²¡æœ‰é‚£ä¹ˆå°±æ”¾è¡Œã€‚
ğŸ“•å¯¼å…¥ä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;21.0&lt;/version&gt; &lt;/dependency&gt; ğŸ“‚é¡¹ç›®ç»“æ„Â ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ æˆ‘ä»¬ä¹Ÿè¯´è¿‡äº†ï¼Œè¦æ ¹æ®æ¥å£çš„ä¸€äº›ä¿¡æ¯æ¥ç”Ÿæˆä¸€ä¸ªIDï¼Œåœ¨å•æœºç¯å¢ƒä¸‹ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£é‡Œè¾¹ä¿å­˜ç€ä¸€ä¸ªkeyä½œä¸ºIDï¼ŒåŒæ—¶ï¼Œåœ¨æŠŠè¿™ä¸ªæ³¨è§£åŠ åˆ°æ¥å£ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªæ¥å£å°±ä»¥è¿™ä¸ªkeyä½œä¸ºIDï¼Œåœ¨è®¿é—®æ¥å£çš„æ—¶å€™ï¼Œå­˜å‚¨çš„ä¹Ÿæ˜¯è¿™ä¸ªIDå€¼ã€‚
@Target(ElementType.METHOD) @Retention(value = RetentionPolicy.RUNTIME) @Documented @Inherited public @interface LockCommit { String key() default &#34;&#34;; } âœˆåˆ›å»ºAOPåˆ‡é¢Â ä¸ºäº†æ–¹ä¾¿ä¹‹åçš„æ¥å£é™æµï¼ŒåŒæ—¶ä¹Ÿæƒ³æŠŠè¿™ä»¶äº‹æƒ…åšä¸€ä¸ªæ¨¡å—åŒ–å¤„ç†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯AOPåˆ‡é¢ï¼Œè¿™æ ·åšå¯ä»¥å‡å°‘ä»£ç è€¦åˆï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚
çœ‹è¿‡æˆ‘ä¹‹å‰æ–‡ç« çš„æœ‹å‹åº”è¯¥éƒ½çŸ¥é“æˆ‘å–œæ¬¢ä½¿ç”¨æ³¨è§£æ¥å®ç°AOPäº†ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªpointCut()ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯æ³¨è§£ç±»å‹ã€‚å¦‚æœä½ è¿˜ä¸ä¼šAOPçš„è¯ï¼Œå¯ä»¥æ¥çœ‹ä¸€çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ã€‚ã€Springã€‘Springä¸­AOPçš„ç®€ä»‹å’ŒåŸºæœ¬ä½¿ç”¨ï¼ŒSpringBootä½¿ç”¨AOP-CSDNåšå®¢
æ­¤å¤–ä½¿ç”¨äº†ä¸€ä¸ªCacheæœ¬åœ°ç¼“å­˜ç”¨äºå­˜å‚¨æˆ‘ä»¬æ¥å£çš„IDï¼ŒåŒæ—¶è®¾ç½®ç¼“å­˜çš„æœ€å¤§å®¹é‡å’Œå†…å®¹çš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨è¿™é‡Œæˆ‘è®¾ç½®çš„æ˜¯5ç§’é’Ÿï¼Œ5ç§’é’Ÿè¿‡åIDå°±ä¼šè¿‡æœŸï¼Œè¿™ä¸ªæ¥å£å°±å¯ä»¥ç»§ç»­è®¿é—®ã€‚Â ä¸»è¦çš„å°±æ˜¯è¿™ä¸ªç¯ç»•é€šçŸ¥äº†ï¼Œæˆ‘å…ˆè·å–äº†è°ƒç”¨çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„æ–¹æ³•ï¼Œä¹‹åè·å–åŠ åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šçš„æ³¨è§£LockCommitï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹è‡ªå®šä¹‰çš„æ³¨è§£ã€‚ä¹‹åæ‹¿åˆ°æ³¨è§£å†…çš„keyä½œä¸ºIDä¼ å…¥ç¼“å­˜ä¸­ã€‚å­˜å…¥ä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªIDï¼Œå¦‚æœæœ‰å°±æŠ¥é”™ï¼Œæ²¡æœ‰å°±åŠ å…¥åˆ°ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªé€»è¾‘ä¸éš¾ã€‚
@Aspect @Component public class LockAspect { public static final Cache&lt;String,Object&gt; CACHES = CacheBuilder.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-22T14:17:21+08:00">
    <meta property="article:modified_time" content="2024-05-22T14:17:21+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å­¦ä¹ è€…" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å­¦ä¹ è€…</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€SpringBootã€‘SpringBootä¸­é˜²æ­¢æ¥å£é‡å¤æäº¤ï¼ˆå•æœºç¯å¢ƒå’Œåˆ†å¸ƒå¼ç¯å¢ƒï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"><img alt="" height="150" src="https://images2.imgbox.com/4f/3d/lyHPw7BN_o.png" width="150"></p> 
<p style="text-align:center;">Â <strong>Â ğŸ“ä¸ªäººä¸»é¡µï¼š<a class="link-info" href="https://blog.csdn.net/qq_61024956?type=blog" title="å“ˆ__">å“ˆ__</a></strong></p> 
<p style="text-align:center;"><span style="color:#fe2c24;">æœŸå¾…æ‚¨çš„å…³æ³¨Â </span></p> 
<p style="text-align:center;"><img alt="" height="100" src="https://images2.imgbox.com/7e/27/VypDXhBm_o.gif" width="1000"></p> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%F0%9F%8C%BC%E5%89%8D%E8%A8%80%C2%A0-toc" style="margin-left:0px;"><a href="#%F0%9F%8C%BC%E5%89%8D%E8%A8%80%C2%A0" rel="nofollow">ğŸŒ¼å‰è¨€Â </a></p> 
<p id="%C2%A0%F0%9F%94%92%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4-toc" style="margin-left:0px;"><a href="#%C2%A0%F0%9F%94%92%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4" rel="nofollow">Â ğŸ”’å•æœºç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤</a></p> 
<p id="%C2%A0%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-toc" style="margin-left:40px;"><a href="#%C2%A0%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96" rel="nofollow">Â ğŸ“•å¯¼å…¥ä¾èµ–</a></p> 
<p id="%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%C2%A0-toc" style="margin-left:40px;"><a href="#%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%C2%A0" rel="nofollow">ğŸ“‚é¡¹ç›®ç»“æ„Â </a></p> 
<p id="%F0%9F%9A%80%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-toc" style="margin-left:80px;"><a href="#%F0%9F%9A%80%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3" rel="nofollow">ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</a></p> 
<p id="%E2%9C%88%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%C2%A0-toc" style="margin-left:80px;"><a href="#%E2%9C%88%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%C2%A0" rel="nofollow">âœˆåˆ›å»ºAOPåˆ‡é¢Â </a></p> 
<p id="%F0%9F%9A%97%E5%88%9B%E5%BB%BAConotroller%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%9A%97%E5%88%9B%E5%BB%BAConotroller%C2%A0" rel="nofollow">ğŸš—åˆ›å»ºConotrollerÂ </a></p> 
<p id="%F0%9F%92%BB%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4-toc" style="margin-left:0px;"><a href="#%F0%9F%92%BB%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4" rel="nofollow">ğŸ’»åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤</a></p> 
<p id="%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96-toc" style="margin-left:40px;"><a href="#%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96" rel="nofollow">ğŸ“•å¯¼å…¥ä¾èµ–</a></p> 
<p id="%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84-toc" style="margin-left:40px;"><a href="#%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" rel="nofollow">ğŸ“‚é¡¹ç›®ç»“æ„</a></p> 
<p id="%F0%9F%9A%80%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-toc" style="margin-left:80px;"><a href="#%F0%9F%9A%80%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3" rel="nofollow">ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</a></p> 
<p id="%F0%9F%9A%B2%E5%88%9B%E5%BB%BAkey%E7%9A%84%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%B1%BB%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%9A%B2%E5%88%9B%E5%BB%BAkey%E7%9A%84%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%B1%BB%C2%A0" rel="nofollow">ğŸš²åˆ›å»ºkeyçš„ç”Ÿæˆå·¥å…·ç±»Â </a></p> 
<p id="%F0%9F%94%A8%E5%88%9B%E5%BB%BARedis%E5%B7%A5%E5%85%B7%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%F0%9F%94%A8%E5%88%9B%E5%BB%BARedis%E5%B7%A5%E5%85%B7%E7%B1%BB" rel="nofollow">ğŸ”¨åˆ›å»ºRediså·¥å…·ç±»</a></p> 
<p id="%F0%9F%9A%97%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%F0%9F%9A%97%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%E7%B1%BB" rel="nofollow">ğŸš—åˆ›å»ºAOPåˆ‡é¢ç±»</a></p> 
<p id="%F0%9F%9B%B5%E5%88%9B%E5%BB%BAController%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%9B%B5%E5%88%9B%E5%BB%BAController%C2%A0" rel="nofollow">ğŸ›µåˆ›å»ºControllerÂ </a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%F0%9F%8C%BC%E5%89%8D%E8%A8%80%C2%A0">ğŸŒ¼å‰è¨€Â </h2> 
<blockquote> 
 <p><span style="color:#7b7f82;">åœ¨Webåº”ç”¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¥å£é‡å¤æäº¤é—®é¢˜ä¸€ç›´æ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹å…³æ³¨å’Œè§£å†³çš„éš¾é¢˜ã€‚æ— è®ºæ˜¯ç”±äºç”¨æˆ·è¯¯æ“ä½œã€ç½‘ç»œå»¶è¿Ÿå¯¼è‡´çš„é‡å¤ç‚¹å‡»ï¼Œè¿˜æ˜¯ç”±äºæ¶æ„æ”»å‡»è€…åˆ©ç”¨è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œæ¥å£è½°ç‚¸ï¼Œéƒ½å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆä¸¥é‡çš„è´Ÿæ‹…ï¼Œç”šè‡³å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€æœåŠ¡ä¸å¯ç”¨ç­‰ä¸¥é‡åæœã€‚ç‰¹åˆ«æ˜¯åœ¨SpringBootè¿™æ ·çš„ç°ä»£åŒ–Javaæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ›´éœ€è¦ä¸€å¥—è¡Œä¹‹æœ‰æ•ˆçš„ç­–ç•¥æ¥é˜²æ­¢æ¥å£é‡å¤æäº¤ã€‚</span></p> 
 <hr> 
 <p><span style="color:#7b7f82;">æœ¬æ–‡å°†ä»SpringBootåº”ç”¨çš„è§’åº¦å‡ºå‘ï¼Œæ¢è®¨åœ¨å•æœºç¯å¢ƒå’Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚ä½•æœ‰æ•ˆé˜²æ­¢æ¥å£é‡å¤æäº¤ã€‚å•æœºç¯å¢ƒè™½ç„¶ç›¸å¯¹ç®€å•ï¼Œä½†åŸºæœ¬çš„é˜²æŠ¤ç­–ç•¥åŒæ ·é€‚ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒçš„éƒ¨ç½²ã€‚</span></p> 
 <p><span style="color:#7b7f82;">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é¦–å…ˆåˆ†ææ¥å£é‡å¤æäº¤çš„åŸå› å’Œå±å®³ï¼Œç„¶åè¯¦ç»†ä»‹ç»åœ¨SpringBootåº”ç”¨ä¸­å¯ä»¥é‡‡å–çš„é˜²æŠ¤ç­–ç•¥ï¼ŒåŒ…æ‹¬å‰ç«¯æ§åˆ¶ã€åç«¯æ ¡éªŒã€ä½¿ç”¨ä»¤ç‰Œæœºåˆ¶ï¼ˆå¦‚Tokenï¼‰ã€åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸç­‰ã€‚å¯¹äºåˆ†å¸ƒå¼ç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨åˆ†å¸ƒå¼é”ã€Redisç­‰ä¸­é—´ä»¶æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œé˜²æ­¢æ¥å£è¢«é‡å¤è°ƒç”¨ã€‚</span></p> 
 <hr> 
 <p><span style="color:#7b7f82;">åœ¨æ·±å…¥è§£æå„ç§é˜²æŠ¤ç­–ç•¥çš„åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨SpringBooté¡¹ç›®ä¸­å…·ä½“å®ç°è¿™äº›ç­–ç•¥ï¼Œå¹¶ç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ï¼Œä»¥å¸®åŠ©è¯»è€…åœ¨å®é™…å¼€å‘ä¸­æ›´å¥½åœ°åº”ç”¨è¿™äº›æŠ€æœ¯ã€‚å¸Œæœ›é€šè¿‡æœ¬æ–‡çš„ä»‹ç»ï¼Œè¯»è€…èƒ½å¤ŸæŒæ¡åœ¨SpringBootåº”ç”¨ä¸­é˜²æ­¢æ¥å£é‡å¤æäº¤çš„æœ‰æ•ˆæ–¹æ³•ï¼Œä¸ºWebåº”ç”¨çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§æä¾›åšå®çš„ä¿éšœã€‚</span></p> 
 <p><img alt="" height="696" src="https://images2.imgbox.com/41/08/zL5Jhx9g_o.png" width="786"></p> 
</blockquote> 
<h2 id="%C2%A0%F0%9F%94%92%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4">Â ğŸ”’å•æœºç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤</h2> 
<blockquote> 
 <p><span style="color:#7b7f82;">åœ¨è¿™ç§å•æœºçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œæˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨redisè¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æœ¬åœ°ç¼“å­˜æœºåˆ¶ã€‚åœ¨ç”¨æˆ·å¯¹æ¥å£è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å–æ¥å£çš„ä¸€äº›å‚æ•°ä¿¡æ¯ï¼Œå¹¶ä¸”æ ¹æ®è¿™äº›å‚æ•°ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IDå­˜å‚¨åˆ°ç¼“å­˜ä¸­ï¼Œä¸‹ä¸€æ¬¡åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­è¿™ä¸ªç¼“å­˜ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„IDï¼Œè‹¥æœ‰åˆ™é˜»æ‹¦ï¼Œè‹¥æ²¡æœ‰é‚£ä¹ˆå°±æ”¾è¡Œã€‚</span></p> 
 <p><img alt="" height="564" src="https://images2.imgbox.com/ef/7f/YSg2wOiz_o.png" width="1069"></p> 
</blockquote> 
<h3 id="%C2%A0%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96">Â ğŸ“•å¯¼å…¥ä¾èµ–</h3> 
<pre><code class="language-XML">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
            &lt;artifactId&gt;guava&lt;/artifactId&gt;
            &lt;version&gt;21.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h3 id="%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%C2%A0">ğŸ“‚é¡¹ç›®ç»“æ„Â </h3> 
<h4 id="%F0%9F%9A%80%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3">ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">æˆ‘ä»¬ä¹Ÿè¯´è¿‡äº†ï¼Œè¦æ ¹æ®æ¥å£çš„ä¸€äº›ä¿¡æ¯æ¥ç”Ÿæˆä¸€ä¸ªIDï¼Œåœ¨å•æœºç¯å¢ƒä¸‹ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£é‡Œè¾¹ä¿å­˜ç€ä¸€ä¸ªkeyä½œä¸ºIDï¼ŒåŒæ—¶ï¼Œåœ¨æŠŠè¿™ä¸ªæ³¨è§£åŠ åˆ°æ¥å£ä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªæ¥å£å°±ä»¥è¿™ä¸ªkeyä½œä¸ºIDï¼Œåœ¨è®¿é—®æ¥å£çš„æ—¶å€™ï¼Œå­˜å‚¨çš„ä¹Ÿæ˜¯è¿™ä¸ªIDå€¼ã€‚</span></p> 
 <p></p> 
 <pre><code class="language-java">@Target(ElementType.METHOD)
@Retention(value = RetentionPolicy.RUNTIME)
@Documented
@Inherited
public @interface LockCommit {
    String key() default "";
}</code></pre> 
</blockquote> 
<h4 id="%E2%9C%88%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%C2%A0">âœˆåˆ›å»ºAOPåˆ‡é¢Â </h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">ä¸ºäº†æ–¹ä¾¿ä¹‹åçš„æ¥å£é™æµï¼ŒåŒæ—¶ä¹Ÿæƒ³æŠŠè¿™ä»¶äº‹æƒ…åšä¸€ä¸ªæ¨¡å—åŒ–å¤„ç†ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯AOPåˆ‡é¢ï¼Œè¿™æ ·åšå¯ä»¥å‡å°‘ä»£ç è€¦åˆï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</span></p> 
 <hr> 
 <p><span style="color:#7b7f82;">çœ‹è¿‡æˆ‘ä¹‹å‰æ–‡ç« çš„æœ‹å‹åº”è¯¥éƒ½çŸ¥é“æˆ‘å–œæ¬¢ä½¿ç”¨æ³¨è§£æ¥å®ç°AOPäº†ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªpointCut()ï¼Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯æ³¨è§£ç±»å‹ã€‚å¦‚æœä½ è¿˜ä¸ä¼šAOPçš„è¯ï¼Œå¯ä»¥æ¥çœ‹ä¸€çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ã€‚<a href="https://blog.csdn.net/qq_61024956/article/details/138333607?spm=1001.2014.3001.5502" title="ã€Springã€‘Springä¸­AOPçš„ç®€ä»‹å’ŒåŸºæœ¬ä½¿ç”¨ï¼ŒSpringBootä½¿ç”¨AOP-CSDNåšå®¢">ã€Springã€‘Springä¸­AOPçš„ç®€ä»‹å’ŒåŸºæœ¬ä½¿ç”¨ï¼ŒSpringBootä½¿ç”¨AOP-CSDNåšå®¢</a></span></p> 
 <hr> 
 <p><span style="color:#7b7f82;">æ­¤å¤–ä½¿ç”¨äº†ä¸€ä¸ªCacheæœ¬åœ°ç¼“å­˜ç”¨äºå­˜å‚¨æˆ‘ä»¬æ¥å£çš„IDï¼ŒåŒæ—¶è®¾ç½®ç¼“å­˜çš„æœ€å¤§å®¹é‡å’Œå†…å®¹çš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨è¿™é‡Œæˆ‘è®¾ç½®çš„æ˜¯5ç§’é’Ÿï¼Œ5ç§’é’Ÿè¿‡åIDå°±ä¼šè¿‡æœŸï¼Œè¿™ä¸ªæ¥å£å°±å¯ä»¥ç»§ç»­è®¿é—®ã€‚Â </span></p> 
 <p><span style="color:#7b7f82;">ä¸»è¦çš„å°±æ˜¯è¿™ä¸ªç¯ç»•é€šçŸ¥äº†ï¼Œæˆ‘å…ˆè·å–äº†è°ƒç”¨çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å…·ä½“çš„æ–¹æ³•ï¼Œä¹‹åè·å–åŠ åœ¨è¿™ä¸ªæ–¹æ³•ä¸Šçš„æ³¨è§£LockCommitï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šè¾¹è‡ªå®šä¹‰çš„æ³¨è§£ã€‚ä¹‹åæ‹¿åˆ°æ³¨è§£å†…çš„keyä½œä¸ºIDä¼ å…¥ç¼“å­˜ä¸­ã€‚å­˜å…¥ä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªIDï¼Œå¦‚æœæœ‰å°±æŠ¥é”™ï¼Œæ²¡æœ‰å°±åŠ å…¥åˆ°ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªé€»è¾‘ä¸éš¾ã€‚</span></p> 
 <pre><code class="language-java">@Aspect
@Component
public class LockAspect {
    public static final Cache&lt;String,Object&gt; CACHES = CacheBuilder.newBuilder()
            .maximumSize(50)
            .expireAfterWrite(5, TimeUnit.SECONDS)
            .build();
    @Pointcut("@annotation(com.example.day_04_repeat_commit.annotation.LockCommit)&amp;&amp;execution(* com.example.day_04_repeat_commit.controller.*.*(..))")
    public void pointCut(){}

    @Around("pointCut()")
    public Object Lock(ProceedingJoinPoint joinPoint){

        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();
        Method method = methodSignature.getMethod();
        LockCommit lockCommit = method.getAnnotation(LockCommit.class);
        String key = lockCommit.key();
        if(key!=null &amp;&amp;!"".equals(key)){
            if(CACHES.getIfPresent(key)!=null){
                throw new RuntimeException("è¯·å‹¿é‡å¤æäº¤");
            }
            CACHES.put(key,key);
        }
        Object object = null;
        try {
            object = joinPoint.proceed();
        } catch (Throwable e) {
            e.printStackTrace();
        }
        return object;
    }
}</code></pre> 
</blockquote> 
<h4 id="%F0%9F%9A%97%E5%88%9B%E5%BB%BAConotroller%C2%A0">ğŸš—åˆ›å»ºConotrollerÂ </h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">å¯ä»¥çœ‹åˆ°æˆ‘åœ¨æ¥å£ä¸ŠåŠ ä¸Šäº†keyæ˜¯stuï¼Œå¯¹æ¥å£è®¿é—®åï¼Œstuå°±ä½œä¸ºIDä¿å­˜åˆ°CACHEä¸­ã€‚</span><span style="color:#fe2c24;"><strong>è¿™é‡Œéœ€è¦å¤šåŠ æ³¨æ„ï¼Œå¦‚æœæ˜¯å¤šä¸ªäººè®¿é—®è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆéƒ½ä¼šå‡ºç°é˜²æ­¢é‡å¤æäº¤çš„é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªkeyçš„å€¼å¹¶ä¸èƒ½ä»…ä»…è®¾ç½®çš„è¿™ä¹ˆç®€å•ã€‚å¯ä»¥åŠ å…¥ä¸€äº›ç”¨æˆ·IDï¼Œå‚æ•°çš„å€¼ï¼ŒIPç­‰ä¿¡æ¯ä½œä¸ºkeyçš„æ„å»ºå‚æ•°ã€‚è¿™é‡Œæˆ‘ä»…ä»…æ˜¯ä¸ºäº†æ¼”ç¤ºã€‚</strong></span></p> 
 <pre><code class="language-java">@RestController
@RequestMapping("/student")
public class StudentController {
    @RequestMapping("/get-student")
    @LockCommit(key = "stu")
    public String getStudent(){
        return  "å¼ ä¸‰";
    }
}</code></pre> 
 <p><span style="color:#7b7f82;">å¦‚æœä½ ä¸æƒ³è¦åå°æŠ¥é”™ï¼Œè€Œæ˜¯æŠŠé”™è¯¯çš„æç¤ºä¿¡æ¯ä¼ åˆ°å‰ç«¯çš„è¯ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå…¨å±€çš„å¼‚å¸¸æ•è·å™¨ã€‚æˆ‘åˆ›å»ºçš„è¿™ä¸ªå¼‚å¸¸æ•è·å™¨æ•è·çš„æ˜¯Exceptionå¼‚å¸¸ï¼ŒèŒƒå›´æ¯”è¾ƒå¤§ï¼Œå¦‚æœåœ¨çœŸå®çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå®šä¹‰å¼‚å¸¸æ¥æŠ›å‡ºå’Œæ•è·ã€‚</span></p> 
 <pre><code class="language-java">@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(Exception.class)
    public String handleException(Exception e){
        return e.getMessage();
    }
}</code></pre> 
 <p><span style="color:#7b7f82;">æ¥ç€æˆ‘ä»¬å¯åŠ¨é¡¹ç›®æ¥æµ‹è¯•ä¸€ä¸‹ã€‚ä¸ºäº†æ–¹ä¾¿æˆªå›¾æˆ‘å°±ä¸ç”¨æµè§ˆå™¨æ‰“å¼€äº†ï¼Œæˆ‘æ˜¯ç”¨PostManè¿›è¡Œæµ‹è¯•ã€‚</span></p> 
 <ol><li><span style="color:#7b7f82;">ç¬¬ä¸€æ¬¡è®¿é—®ç»“æœå¦‚ä¸‹<img alt="" height="683" src="https://images2.imgbox.com/66/ca/WiCnPS9J_o.png" width="1200"></span></li><li><span style="color:#7b7f82;">äº”ç§’å†…å†æ¬¡è®¿é—®ç»“æœå¦‚ä¸‹<img alt="" height="621" src="https://images2.imgbox.com/32/91/GKeVfvpX_o.png" width="1200"></span></li><li><span style="color:#7b7f82;">äº”ç§’åè®¿é—®ç»“æœå¦‚ä¸‹<img alt="" height="634" src="https://images2.imgbox.com/65/01/edYColoh_o.png" width="1200"></span></li></ol> 
 <p></p> 
</blockquote> 
<h2 id="%F0%9F%92%BB%E5%88%86%E5%B8%83%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%98%B2%E6%AD%A2%E6%8E%A5%E5%8F%A3%E9%87%8D%E5%A4%8D%E6%8F%90%E4%BA%A4">ğŸ’»åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é˜²æ­¢æ¥å£é‡å¤æäº¤</h2> 
<h3 id="%F0%9F%93%95%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96">ğŸ“•å¯¼å…¥ä¾èµ–</h3> 
<pre><code class="language-XML">         &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<h3 id="%F0%9F%93%82%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">ğŸ“‚é¡¹ç›®ç»“æ„</h3> 
<h4>ğŸš€åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£</h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å°±è¦å¤æ‚ä¸€äº›äº†Â </span></p> 
 <ul><li><span style="color:#7b7f82;">åˆ›å»ºCacheLock</span> <pre><code class="language-java">@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
@Documented
@Inherited
public @interface CacheLock {
    /**
     * é”çš„å‰ç¼€
     * @return
     */
    String prefix() default "";

    /**
     * è¿‡æœŸæ—¶é—´
     * @return
     */
    int expire() default 5;

    /**
     * è¿‡æœŸå•ä½
     * @return
     */
    TimeUnit timeUnit() default TimeUnit.SECONDS;

    /**
     * keyçš„åˆ†éš”ç¬¦
     * @return
     */
    String delimiter() default ":";
}</code></pre> <p><span style="color:#7b7f82;">è¿™ä¸ªCacheLockä¹Ÿæ˜¯åŠ é”çš„æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å†…åŒ…å«äº†å¾ˆå¤šçš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯éƒ½è¦ä½œä¸ºRedisåŠ é”çš„å‚æ•°ã€‚</span></p> </li><li> <p><span style="color:#7b7f82;">åˆ›å»ºCacheParam</span></p> <pre><code class="language-java">@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.PARAMETER,ElementType.FIELD})
@Documented
public @interface CacheParam {
    /**
     * å‚æ•°çš„åç§°
     * @return
     */
    String name() default "";
}
</code></pre> <p><span style="color:#7b7f82;">è¿™ä¸ªå‚æ•°æ˜¯éœ€è¦åŠ åœ¨å…·ä½“çš„å‚æ•°ä¸Šè¾¹çš„ï¼Œä»£è¡¨ç€è¿™ä¸ªå‚æ•°è¦ä½œä¸ºkeyæ„å»ºçš„ä¸€éƒ¨åˆ†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ åœ¨ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ä¸Šè¾¹ã€‚</span></p> </li></ul> 
</blockquote> 
<h4 id="%F0%9F%9A%B2%E5%88%9B%E5%BB%BAkey%E7%9A%84%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7%E7%B1%BB%C2%A0">ğŸš²åˆ›å»ºkeyçš„ç”Ÿæˆå·¥å…·ç±»Â </h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">çœ‹åˆ°ä»£ç çš„ä½ ä¸€å®šæ…Œäº†å§ï¼Œä¸è¦æ€¥ï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä¼šå…ˆç»™ä½ è®²ä¸€ä¸‹æˆ‘çš„æ€è·¯ã€‚æˆ‘ä»¬è®²çš„é˜²æ­¢æ¥å£é‡å¤æäº¤ï¼Œæ˜¯é˜²æ­¢ç”¨æˆ·å¯¹ä¸€ä¸ªæ¥å£å¤šæ¬¡ä¼ å…¥ç›¸åŒçš„ä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µæˆ‘è¦è¿›è¡Œå¤„ç†ã€‚æˆ‘çš„æ„å»ºæ€è·¯æ˜¯æƒ³è¦æ„å»ºä¸€ä¸ªè¿™æ ·çš„keyã€‚åŠ äº†CacheParamçš„å‚æ•°æˆ‘è·å–å‚æ•°å…·ä½“çš„å€¼ï¼Œå¹¶ä¸”æŠŠå€¼ä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ã€‚</span></p> 
 <p><span style="color:#7b7f82;"><img alt="" height="139" src="https://images2.imgbox.com/a1/d8/N1YppuhY_o.png" width="697"></span></p> 
 <p><span style="color:#7b7f82;">å€˜è‹¥æˆ‘ä»¬çš„å‚æ•°éƒ½æ²¡æœ‰åŠ CacheParamå‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±ä¼šå»è·å–è¿™ä¸ªå‚æ•°çš„ç±»ï¼Œæ¯”å¦‚è¯´æ˜¯Studentç±»ï¼Œæˆ‘ä»¬å°±å»çœ‹çœ‹è¿™ä¸ªä¼ æ¥çš„Studentç±»å½“ä¸­æœ‰æ²¡æœ‰å±æ€§æ˜¯åŠ äº†CacheParamæ³¨è§£çš„ï¼Œå¦‚æœæœ‰å°±è·å–å€¼ã€‚Â </span></p> 
 <pre><code class="language-java">@Component
public class RedisKeyGenerator {
    @Autowired
    HttpServletRequest request;

    public String getKey(ProceedingJoinPoint joinPoint) throws IllegalAccessException {
        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();
        // è·å–æ–¹æ³•
        Method method = methodSignature.getMethod();
        // è·å–å‚æ•°
        Object [] args = joinPoint.getArgs();
        // è·å–æ³¨è§£
        final Parameter [] parameters = method.getParameters();
        CacheLock cacheLock =  method.getAnnotation(CacheLock.class);
        String prefix = cacheLock.prefix();
        StringBuilder sb = new StringBuilder();
        StringBuilder sb2 = new StringBuilder();
        sb2.append(".").append(joinPoint.getTarget().getClass().getName()).append(".").append(method.getName());
        for(int i = 0;i&lt;args.length;i++){
            CacheParam cacheParam = parameters[i].getAnnotation(CacheParam.class);
            if(cacheParam == null){
                continue;
            }
            sb.append(cacheLock.delimiter()).append(args[i]);
        }
        // å¦‚æœæ–¹æ³•å‚æ•°æ²¡æœ‰CacheParamæ³¨è§£ ä»å‚æ•°ç±»çš„å†…éƒ¨å°è¯•è·å–
        if(StringUtils.isEmpty(sb.toString())){
            for(int i = 0;i&lt; parameters.length;i++){
                final Object object = args[i];
                Field [] fields = object.getClass().getDeclaredFields();
                for (Field field : fields) {
                    final CacheParam annotation = field.getAnnotation(CacheParam.class);
                    if(annotation==null){
                        continue;
                    }
                    field.setAccessible(true);
                    sb.append(cacheLock.delimiter()).append(field.get(object));
                }
            }
        }
        return prefix+sb2+sb;

    }
}</code></pre> 
</blockquote> 
<h4 id="%F0%9F%94%A8%E5%88%9B%E5%BB%BARedis%E5%B7%A5%E5%85%B7%E7%B1%BB">ğŸ”¨åˆ›å»ºRediså·¥å…·ç±»</h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">ä»¥ä¸‹å·¥å…·ç±»æ¥è‡ªå¼•ç”¨DDKK.comã€‚</span></p> 
 <pre><code class="language-java">@Component
@Configuration
@AutoConfigureAfter(RedisAutoConfiguration.class)
public class RedisLockHelper {
    private static final String DELIMITER = "|";

    /**
     * å¦‚æœè¦æ±‚æ¯”è¾ƒé«˜å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼åˆ†é…
     */
    private static final ScheduledExecutorService EXECUTOR_SERVICE = Executors.newScheduledThreadPool(10);

    private final StringRedisTemplate stringRedisTemplate;

    @Autowired
    public RedisLockHelper(StringRedisTemplate stringRedisTemplate) {
        this.stringRedisTemplate = stringRedisTemplate;
    }

    /**
     * è·å–é”ï¼ˆå­˜åœ¨æ­»é”é£é™©ï¼‰
     *
     * @param lockKey lockKey
     * @param value   value
     * @param time    è¶…æ—¶æ—¶é—´
     * @param unit    è¿‡æœŸå•ä½
     * @return true or false
     */
    public boolean tryLock(final String lockKey, final String value, final long time, final TimeUnit unit) {
        return stringRedisTemplate.execute((RedisCallback&lt;Boolean&gt;) connection -&gt; connection.set(lockKey.getBytes(), value.getBytes(), Expiration.from(time, unit), RedisStringCommands.SetOption.SET_IF_ABSENT));
    }

    /**
     * è·å–é”
     *
     * @param lockKey lockKey
     * @param uuid    UUID
     * @param timeout è¶…æ—¶æ—¶é—´
     * @param unit    è¿‡æœŸå•ä½
     * @return true or false
     */
    public boolean lock(String lockKey, final String uuid, long timeout, final TimeUnit unit) {
        final long milliseconds = Expiration.from(timeout, unit).getExpirationTimeInMilliseconds();
        boolean success = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, (System.currentTimeMillis() + milliseconds) + DELIMITER + uuid,timeout,TimeUnit.SECONDS);
        if (success) {

        } else {
            String oldVal = stringRedisTemplate.opsForValue().getAndSet(lockKey, (System.currentTimeMillis() + milliseconds) + DELIMITER + uuid);
            final String[] oldValues = oldVal.split(Pattern.quote(DELIMITER));
            if (Long.parseLong(oldValues[0]) + 1 &lt;= System.currentTimeMillis()) {
                return true;
            }
        }
        return success;
    }
    /**
     * @see &lt;a href="http://redis.io/commands/set"&gt;Redis Documentation: SET&lt;/a&gt;
     */
    public void unlock(String lockKey, String value) {
        unlock(lockKey, value, 0, TimeUnit.MILLISECONDS);
    }

    /**
     * å»¶è¿Ÿunlock
     *
     * @param lockKey   key
     * @param uuid      client(æœ€å¥½æ˜¯å”¯ä¸€é”®çš„)
     * @param delayTime å»¶è¿Ÿæ—¶é—´
     * @param unit      æ—¶é—´å•ä½
     */
    public void unlock(final String lockKey, final String uuid, long delayTime, TimeUnit unit) {
        if (StringUtils.isEmpty(lockKey)) {
            return;
        }
        if (delayTime &lt;= 0) {
            doUnlock(lockKey, uuid);
        } else {
            EXECUTOR_SERVICE.schedule(() -&gt; doUnlock(lockKey, uuid), delayTime, unit);
        }
    }

    /**
     * @param lockKey key
     * @param uuid    client(æœ€å¥½æ˜¯å”¯ä¸€é”®çš„)
     */
    private void doUnlock(final String lockKey, final String uuid) {
        String val = stringRedisTemplate.opsForValue().get(lockKey);
        final String[] values = val.split(Pattern.quote(DELIMITER));
        if (values.length &lt;= 0) {
            return;
        }
        if (uuid.equals(values[1])) {
            stringRedisTemplate.delete(lockKey);
        }
    }

}</code></pre> 
</blockquote> 
<h4>ğŸ”¥åˆ›å»ºStudentç±»</h4> 
<blockquote> 
 <pre><code class="language-java">public class Student {
    @CacheParam
    private String name;
    @CacheParam
    private Integer age;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }
}</code></pre> 
</blockquote> 
<h4 id="%F0%9F%9A%97%E5%88%9B%E5%BB%BAAOP%E5%88%87%E9%9D%A2%E7%B1%BB">ğŸš—åˆ›å»ºAOPåˆ‡é¢ç±»</h4> 
<blockquote> 
 <p><span style="color:#7b7f82;">æ³¨æ„ä¸‹è¾¹æˆ‘æ³¨é‡Šæ‰çš„ä¸€è¡Œä»£ç ï¼Œå¦‚æœåŠ ä¸Šäº†ä»¥åä½ å°±çœ‹ä¸åˆ°é˜²æ­¢é‡å¤æäº¤çš„æç¤ºäº†ï¼Œä¸‹è¾¹çš„ä»£ç å’Œå•æœºç¯å¢ƒçš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åŠ é”ç”¨çš„æ˜¯Redisã€‚</span></p> 
 <pre><code class="language-java">@Aspect
@Component
public class Lock {
    @Autowired
    private RedisLockHelper redisLockHelper;
    @Autowired
    private RedisKeyGenerator redisKeyGenerator;
    @Pointcut("execution(* com.my.controller.*.*(..))&amp;&amp;@annotation(com.my.annotation.CacheLock)")
    public void pointCut(){}

    @Around("pointCut()")
    public Object interceptor(ProceedingJoinPoint joinPoint) throws IllegalAccessException {
        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();
        Method method = methodSignature.getMethod();
        CacheLock cacheLock = method.getAnnotation(CacheLock.class);
        if (StringUtils.isEmpty(cacheLock.prefix())) {
            throw new RuntimeException("é”çš„å‰ç¼€ä¸èƒ½ä¸ºç©º");
        }

        int expireTime = cacheLock.expire();
        TimeUnit timeUnit = cacheLock.timeUnit();
        String key = redisKeyGenerator.getKey(joinPoint);
        System.out.println(key);
        String value = UUID.randomUUID().toString();
        Object object;
        try {
            final boolean tryLock = redisLockHelper.lock(key,value,expireTime,timeUnit);
            if(!tryLock){
                throw new RuntimeException("é‡å¤æäº¤");
            }
            try {
                object = joinPoint.proceed();
            }catch (Throwable e){
                throw new RuntimeException("ç³»ç»Ÿå¼‚å¸¸");
            }
        } finally {
           // redisLockHelper.unlock(key,value);
        }
        return object;
    }
}</code></pre> 
</blockquote> 
<h4 id="%F0%9F%9B%B5%E5%88%9B%E5%BB%BAController%C2%A0">ğŸ›µåˆ›å»ºControllerÂ </h4> 
<pre><code class="language-java">@RestController
@RequestMapping("/student")
public class StudentController {
    @RequestMapping("/get-student")
    @CacheLock(prefix = "stu2",expire = 5,timeUnit = TimeUnit.SECONDS)
    public String getStudent(){

        return  "å¼ ä¸‰";
    }

    @RequestMapping("/get-student2")
    @CacheLock(prefix = "stu2",expire = 5,timeUnit = TimeUnit.SECONDS)
    public String getStudent2(Student student){
        return  "å¼ ä¸‰";
    }
}</code></pre> 
<blockquote> 
 <p><strong>è°ƒç”¨get-studentæµ‹è¯•</strong></p> 
 <ul><li><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨</strong><img alt="" height="646" src="https://images2.imgbox.com/d1/f3/G9AVvfsU_o.png" width="1200"></li><li><strong>ç¬¬äºŒæ¬¡è°ƒç”¨Â </strong><img alt="" height="646" src="https://images2.imgbox.com/cd/d5/hl7db56v_o.png" width="1200"><img alt="" height="103" src="https://images2.imgbox.com/5a/41/kbPdVZZQ_o.png" width="672"></li></ul> 
 <hr> 
 <p><strong>è°ƒç”¨get-student2æµ‹è¯•Â </strong></p> 
 <ul><li><strong>ç¬¬ä¸€æ¬¡è°ƒç”¨</strong><img alt="" height="614" src="https://images2.imgbox.com/ff/07/Fn21727U_o.png" width="1200"></li><li><strong>ç¬¬äºŒæ¬¡è°ƒç”¨</strong><img alt="" height="627" src="https://images2.imgbox.com/cf/46/TyjgBXJd_o.png" width="1200"><img alt="" height="85" src="https://images2.imgbox.com/ef/25/Lf1LyNUl_o.png" width="701"></li></ul> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong>Â æœ€åï¼Œä¸Šè¾¹çš„keyç”Ÿæˆè¿˜æœ‰å¾…å•†æ¦·ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹keyçš„ç”Ÿæˆå¹¶ä¸æ˜¯ä¸€ä¸ªè½»æ¾çš„é—®é¢˜ã€‚æœ¬æ–‡çš„å†…å®¹ä»…å»ºè®®ä½œä¸ºå­¦ä¹ ä½¿ç”¨ã€‚</strong></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c9ed771ae5cea7ae969e685f5d3d78db/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å…³äºå¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯é…ç½®çš„ SpringBoot Web é¡¹ç›®çš„å…¨å±€å¼‚å¸¸å¤„ç†</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8e1e4531f9b36d7dc350b3b7eb356d5e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">spring boot3æ•´åˆspring AIç»„ä»¶</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å­¦ä¹ è€….
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>